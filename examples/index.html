<!DOCTYPE html>
<meta charset="UTF-8"/>
<head>
    <title>Print Constructor</title>
</head>
<body>
<link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Alegreya|Alegreya+Sans|Arsenal|Bad+Script|Caveat|Comfortaa|Cormorant+Infant|Exo+2|Fira+Sans+Extra+Condensed|Forum|Kurale|Lobster|Marck+Script|Marmelad|Montserrat+Alternates|Old+Standard+TT|Oranienbaum|Oswald|PT+Sans+Narrow|Pacifico|Philosopher|Poiret+One|Prata|Roboto+Condensed|Ruslan+Display|Russo+One|Seymour+One|Underdog|Vollkorn|Yanone+Kaffeesatz&subset=latin,cyrillic"/>
<link rel="stylesheet" href="style.css" type="text/css">
<!--<script src="https://raw.githubusercontent.com/AL13/PrintConstructor/master/build/constructor.min.js"></script>-->
<script src="../js/three.js" type="application/javascript"></script>
<script src="../js/OrbitControls.js" type="application/javascript"></script>
<script src="../js/fabric.js" type="application/javascript"></script>
<script src="../js/constructor.js" type="application/javascript"></script>
<script>
    let div = document.createElement("div");
    div.innerHTML = 'Constructor.version: <b>' + Constructor.version
        + '</b> fabric.version: <b>' + fabric.version + '</b>';
    div.style.fontFamily = 'Helvetica';
    document.body.appendChild(div);
</script>
<div class="panel">
    <button value="false" onclick="c.toggleMode();this.value=(c.getMode()===Mode.Mode3D);"><img
            src="icons/icons8-3d.png"></button>
    <button onclick="c.zoomIn()" value="zoom in"><img src="icons/icons8-zoom_in.png"></button>
    <button onclick="c.zoomOut()" value="zoom out"><img src="icons/icons8-zoom_out.png"></button>
    <button onclick="c.zoomToFit()" value="zoom to fit"><img src="icons/icons8-zoom_to_actual_size.png"></button>
    <button onclick="c.resetZoom()" value="zoom 1:1"><img src="icons/icons8-search.png"></button>
    <button onclick="c.setActiveSide(0)" value="side 1"><img src="icons/icons8-1.png"></button>
    <button onclick="c.setActiveSide(1)" value="side 2"><img src="icons/icons8-2.png"></button>
    <button onclick="c.setActiveSide(2)" value="side 3"><img src="icons/icons8-3.png"></button>
    <button onclick="c.setActiveSide(3)" value="side 4"><img src="icons/icons8-4.png"></button>
    <button onclick="c.getActiveSide().clear()" value="clear"><img src="icons/icons8-delete.png"></button>
    <button onclick="c.addSide(800, 600)" value="addSide"><img src="icons/icons8-add_book.png"></button>
    <button onclick="c.paste()" value="paste"><img src="icons/icons8-clipboard.png"></button>
    <button onclick="c.undo()" value="undo"><img src="icons/icons8-undo.png"></button>
    <button onclick="c.redo()" value="redo"><img src="icons/icons8-redo.png"></button>
    <button onclick="c.addElement(ElementType.RECTANGLE)" value="add rectangle"><img src="icons/icons8-rectangular.png">
    </button>
    <button onclick="c.addElement(ElementType.CIRCLE)" value="add circle"><img src="icons/icons8-circle.png"></button>
    <button onclick="c.addElement(ElementType.TRIANGLE)" value="add triangle"><img src="icons/icons8-triangle.png">
    </button>
    <button onclick="c.addElement(ElementType.TEXT)" value="add text"><img src="icons/icons8-add_text.png"></button>
    <button onclick="c.addImage('images/bug.png')" value="add image"><img src="icons/icons8-png.png"></button>
    <button onclick="c.addImage('images/duck.jpg')" value="add image 2"><img src="icons/icons8-jpg.png"></button>
    <button onclick="c.addImage('http://localhost:63342/render/examples/images/hunters.jpg')"
            value="add image HTTP"><img src="icons/icons8-picture.png"></button>
    <button onclick="c.getSelection().toFront()" value="up"><img src="icons/icons8-front_sorting.png"></button>
    <button onclick="c.getSelection().toBack()" value="down"><img src="icons/icons8-transfer.png"></button>
    <button id="locked" type="button" value="false"
            onclick="c.getSelection().setLocked(!c.getSelection().isLocked());this.value=c.getSelection().isLocked()">
        <img src="icons/icons8-lock.png"></button>
    <button id="snap" value="false" onclick="c.snapToObjects=!c.snapToObjects;this.value=c.snapToObjects;"
            value="snap to objects"><img src="icons/icons8-align_bottom.png"></button>
    <button id="snapToGrid" value="false" onclick="c.snapToGrid=!c.snapToGrid;this.value=c.snapToGrid;"
            value="snap to grid"><img src="icons/icons8-data_grid.png"></button>

    <input type="button" onclick="document.getElementById('preview').src = c.preview.exportImage(256)"
           value="preview"/>
    <input type="button" onclick="imageRemote()" value="preview remote"/>
    <input type="button" onclick="exportAnimation()" value="banner"/>
    <input type="button" onclick="image()" value="image"/>

    <input type="button" onclick="loadFast()" value="loadFast"/>
    <button onclick="c.applyPreset('cup_remastered', [{width: 400, height: 300}]);">cup</button>
    <button onclick="c.applyPreset('coffee_cup', [{width: 400, height: 300}]);">cof</button>
    <button onclick="c.preview.loadModel('ball')">ball</button>
</div>

<table>
    <tr>
        <td>
            <div id="container"></div>
        </td>
        <td valign="top">
            <div class="panel">
                <button onclick="c.getSelection().bringUp()"><img src="icons/icons8-upward_arrow.png"></button>
                <button onclick="c.getSelection().bringDown()"><img src="icons/icons8-scroll_down.png"></button>

                <button onclick="c.getSelection().toLayer(0)">0</button>
                <button onclick="c.getSelection().toLayer(1)"><img src="icons/icons8-1.png"></button>
                <button onclick="c.getSelection().toLayer(2)"><img src="icons/icons8-2.png"></button>
                <button onclick="c.getSelection().toLayer(3)"><img src="icons/icons8-3.png"></button>
                <button onclick="c.getSelection().toLayer(4)"><img src="icons/icons8-4.png"></button>

            </div>
            <select id="layers" multiple style="width: 200px; height: 500px;"></select>
        </td>
    </tr>
</table>

<div id="selectionPanel" class="panel" style="display: none">
    <button onclick="c.copy()" value="copy"><img src="icons/icons8-copy_to_clipboard.png"></button>
    <button onclick="c.cut()" value="cut"><img src="icons/icons8-cut.png"></button>
    <button onclick="c.duplicate()" value="duplicate"><img src="icons/icons8-duplicate.png"></button>
    <button id="deleteBtn" onclick="c.remove()"><img src="icons/icons8-trash_can.png"></button>
    <img src="icons/icons8-color_dropper.png">
    <input id="color" type="color" onchange="c.getSelection().setColor(this.value)"/>
    <img src="icons/icons8-opacity.png">
    <input id="alpha" type="range" min="0.0" max="1.0" step="0.1" oninput="c.getSelection().setAlpha(this.value)"/>
    <img src="icons/icons8-gallery.png">
    <input id="shadow" type="range" min="0.0" max="100.0" step="1.0" oninput="c.getSelection().setShadow(this.value)"/>
</div>
<div id="panel3d" class="panel" style="display: none">
    <button onclick="c.preview.setFills('green', 0)"><img src="icons/icons8-30_degrees.png"></button>
    <button onclick="c.preview.setFills('green', 1)"><img src="icons/icons8-60_degrees.png"></button>
    <button onclick="c.preview.setFills('green', 2)"><img src="icons/icons8-90_degrees.png"></button>
    <button onclick="c.preview.setFills('green', 0, 1)"><img src="icons/icons8-150_degrees.png"></button>
    <button onclick="c.preview.setFills('green', 0, 2)"><img src="icons/icons8-180_degree.png"></button>
    <button onclick="c.preview.setFills('green', 1, 2)"><img src="icons/icons8-270_degrees.png"></button>
    <button onclick="c.preview.setFills('green', 0, 1, 2)"><img src="icons/icons8-360_degrees.png"></button>
    <button onclick="c.preview.clearFills()"><img src="icons/icons8-0_degrees.png"></button>

</div>
<div id="imagePanel" class="panel" style="display: none">
    <button onclick="c.getSelection().addFilter(Filter.INVERT)"><img src="icons/icons8-invert_selection.png"></button>
    <button onclick="c.getSelection().addFilter(Filter.GRAYSCALE)"><img src="icons/icons8-black_and_white.png"></button>
    <button onclick="c.getSelection().addFilter(Filter.BRIGHTNESS)"><img src="icons/icons8-sun.png"></button>
    <button onclick="c.getSelection().addFilter(Filter.BLUR)"><img src="icons/icons8-blur.png"></button>
    <button onclick="c.getSelection().addFilter(Filter.SHARPEN)"><img src="icons/icons8-starburst_shape.png"></button>
    <button onclick="c.getSelection().addFilter(Filter.EMBOSS)"><img src="icons/icons8-bubble.png"></button>
    <button onclick="c.getSelection().resetFilters()"><img src="icons/icons8-clear_filters.png"></button>
</div>
<div id="textPanel" class="panel" style="display: none">
    <button onclick="c.getSelection().setBold(true)" value="bold"><img src="icons/icons8-bold.png"></button>
    <button onclick="c.getSelection().setItalic(true)" value="italic"><img src="icons/icons8-italic.png"></button>
    <button onclick="c.getSelection().setTextDecoration(TextDecoration.UNDERLINE)"><img
            src="icons/icons8-underline.png"></button>
    <input type="button" onclick="c.getSelection().setFontFamily('Times')" value="times"/>
    <input type="button" onclick="c.getSelection().setFontFamily('Lobster')" value="Lobster"/>
    <input type="button" onclick="c.getSelection().setFontFamily('Oranienbaum')" value="Oranienbaum"/>
    <input type="button" onclick="c.getSelection().setFontFamily('Seymour One')" value="Seymour"/>
</div>

<script>
    //Constructor.settings.localStorage.enabled = false;
    c = new Constructor(document.getElementById('container'));
    //c.setState('{"model":"mug1","sides":[{"width":600,"height":500}]}');
    preview = document.getElementById("preview");

    layers = document.getElementById("layers");
    c.onElementModification(updateLayers);

    function updateLayers(){
        layers.innerHTML = "";
        c.getActiveSide().getLayers().forEach(element => {
            let layer = document.createElement("option");
            let text = element.getIndex() + " " + element.type.getName();
            layer.innerText = element.getIndex() + " " + element.type.getName();
            layers.appendChild(layer);
            if (element === c.getSelection()){
                layers.value = text;
            }
        });
    }

    updateLayers();
</script>
<img src="" id="preview">
<script>
    selectionPanel = document.getElementById('selectionPanel');
    textPanel = document.getElementById('textPanel');
    imagePanel = document.getElementById('imagePanel');
    panel3d = document.getElementById('panel3d');

    function loadFast() {
        let s = new Date().getTime();
        c.setState('{"model":"ball","sides":[{"width":600,"height":500}]}', () => {
            console.log(new Date().getTime() - s, 'ms')
        });
    }

    color = document.getElementById("color");
    locked = document.getElementById("locked");
    alpha = document.getElementById("alpha");
    shadow = document.getElementById("shadow");
    c.onSelect(s => {
        color.value = s.getColor().toHex();
        locked.style.background = s.isLocked() ? "#bbbbbb" : null;
        alpha.value = c.getSelection().getAlpha();
        shadow.value = c.getSelection().getShadow();

        selectionPanel.style.display = null;

        if (c.getSelection().type === ElementType.TEXT) {
            textPanel.style.display = null;
        } else {
            textPanel.style.display = 'none';
        }

        if (c.getSelection().type === ElementType.IMAGE) {
            imagePanel.style.display = null;
        } else {
            imagePanel.style.display = 'none';
        }

    });
    c.onDeselect(s => {
        color.value = "#ffffff";
        locked.style.background = null;
        alpha.value = 0;
        shadow.value = 0;
        textPanel.style.display = 'none';
        selectionPanel.style.display = 'none';
        imagePanel.style.display = 'none';
    });
    c.onModeChange(() => {
        if (c.getMode() === Mode.Mode2D) {
            panel3d.style.display = 'none';
        } else {
            panel3d.style.display = null;
        }
    });
</script>

<script>
    function image() {
        c.preview.exportImage(src => {
            let image = new Image();
            image.src = src;
            let w = window.open("");
            w.document.write(image.outerHTML);
        }, 1024, ImageType.JPG)
    }

    function imageRemote() {
        let json = c.getState();
        var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance
        xmlhttp.open("POST", "http://pechat55.ru:2018/preview?width=256&height=256", true);
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                document.getElementById("preview").src = xmlhttp.responseText;
            } else {
                console.log(xmlhttp.responseText);
            }
        };
        xmlhttp.send(json);
    }

    function exportAnimation() {
        let s = new Date().getTime();
        c.preview.exportAnimation(src => {
            console.log(new Date().getTime() - s + ' ms ' + Math.round(src.length / 1024) + ' KB');
        }, 128);
    }

    document.addEventListener("keydown", keyDownTextField, false);

    function keyDownTextField(e) {
        var keyCode = e.keyCode;
        if (keyCode == 46) {
            document.getElementById("deleteBtn").click();
        }
    }
</script>
</body>
</html>
