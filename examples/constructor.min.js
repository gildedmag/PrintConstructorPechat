!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.THREE={})}(this,function(t){"use strict";function e(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),Object.assign(e.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),n=0,r=i.length;n<r;n++)i[n].call(this,t)}}}});var i,n,r,a,s,o,c,l,h,u,f,d,p,g,m,v,y,_,b,x,S=0,w=1,T=2,C=0,E=1,A=2,M=0,O=1,L=2,P=0,I=1,R=2,D=0,N=1,U=2,F=3,B=4,k=5,j=100,G=101,z=102,H=103,V=104,W=200,X=201,Y=202,q=203,K=204,Z=205,J=206,Q=207,$=208,tt=209,et=210,it=0,nt=1,rt=2,at=3,st=4,ot=5,ct=6,lt=7,ht=0,ut=1,ft=2,dt=0,pt=1,gt=2,mt=3,vt=4,yt=301,_t=302,bt=303,xt=304,St=305,wt=306,Tt=307,Ct=1e3,Et=1001,At=1002,Mt=1003,Ot=1004,Lt=1005,Pt=1006,It=1007,Rt=1008,Dt=1009,Nt=1010,Ut=1011,Ft=1012,Bt=1013,kt=1014,jt=1015,Gt=1016,zt=1017,Ht=1018,Vt=1019,Wt=1020,Xt=1021,Yt=1022,qt=1023,Kt=1024,Zt=1025,Jt=qt,Qt=1026,$t=1027,te=2001,ee=2002,ie=2003,ne=2004,re=2100,ae=2101,se=2102,oe=2103,ce=2151,le=2201,he=2300,ue=2301,fe=2400,de=2401,pe=2402,ge=0,me=1,ve=2,ye=3e3,_e=3001,be=3007,xe=3002,Se=3004,we=3005,Te=3006,Ce=3200,Ee=3201,Ae={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16).toUpperCase();return function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Ae.DEG2RAD},radToDeg:function(t){return t*Ae.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Me(t,e){this.x=t||0,this.y=e||0}function Oe(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length}function Le(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1}function Pe(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function Ie(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length}Object.defineProperties(Me.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Me.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:(i=new Me,n=new Me,function(t,e){return i.set(t,t),n.set(e,e),this.clamp(i,n)}),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*n+t.x,this.y=r*n+a*i+t.y,this}}),Object.assign(Oe.prototype,{isMatrix4:!0,set:function(t,e,i,n,r,a,s,o,c,l,h,u,f,d,p,g){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=n,m[1]=r,m[5]=a,m[9]=s,m[13]=o,m[2]=c,m[6]=l,m[10]=h,m[14]=u,m[3]=f,m[7]=d,m[11]=p,m[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Oe).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:(h=new Pe,function(t){var e=this.elements,i=t.elements,n=1/h.setFromMatrixColumn(t,0).length(),r=1/h.setFromMatrixColumn(t,1).length(),a=1/h.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,this}),makeRotationFromEuler:function(t){!t||t.isEuler;var e=this.elements,i=t.x,n=t.y,r=t.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),c=Math.sin(n),l=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){var u=a*l,f=a*h,d=s*l,p=s*h;e[0]=o*l,e[4]=-o*h,e[8]=c,e[1]=f+d*c,e[5]=u-p*c,e[9]=-s*o,e[2]=p-u*c,e[6]=d+f*c,e[10]=a*o}else if("YXZ"===t.order){var g=o*l,m=o*h,v=c*l,y=c*h;e[0]=g+y*s,e[4]=v*s-m,e[8]=a*c,e[1]=a*h,e[5]=a*l,e[9]=-s,e[2]=m*s-v,e[6]=y+g*s,e[10]=a*o}else if("ZXY"===t.order){g=o*l,m=o*h,v=c*l,y=c*h;e[0]=g-y*s,e[4]=-a*h,e[8]=v+m*s,e[1]=m+v*s,e[5]=a*l,e[9]=y-g*s,e[2]=-a*c,e[6]=s,e[10]=a*o}else if("ZYX"===t.order){u=a*l,f=a*h,d=s*l,p=s*h;e[0]=o*l,e[4]=d*c-f,e[8]=u*c+p,e[1]=o*h,e[5]=p*c+u,e[9]=f*c-d,e[2]=-c,e[6]=s*o,e[10]=a*o}else if("YZX"===t.order){var _=a*o,b=a*c,x=s*o,S=s*c;e[0]=o*l,e[4]=S-_*h,e[8]=x*h+b,e[1]=h,e[5]=a*l,e[9]=-s*l,e[2]=-c*l,e[6]=b*h+x,e[10]=_-S*h}else if("XZY"===t.order){_=a*o,b=a*c,x=s*o,S=s*c;e[0]=o*l,e[4]=-h,e[8]=c*l,e[1]=_*h+S,e[5]=a*l,e[9]=b*h-x,e[2]=x*h-b,e[6]=s*l,e[10]=S*h+_}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t._x,n=t._y,r=t._z,a=t._w,s=i+i,o=n+n,c=r+r,l=i*s,h=i*o,u=i*c,f=n*o,d=n*c,p=r*c,g=a*s,m=a*o,v=a*c;return e[0]=1-(f+p),e[4]=h-v,e[8]=u+m,e[1]=h+v,e[5]=1-(l+p),e[9]=d-g,e[2]=u-m,e[6]=d+g,e[10]=1-(l+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:(o=new Pe,c=new Pe,l=new Pe,function(t,e,i){var n=this.elements;return l.subVectors(t,e),0===l.lengthSq()&&(l.z=1),l.normalize(),o.crossVectors(i,l),0===o.lengthSq()&&(1===Math.abs(i.z)?l.x+=1e-4:l.z+=1e-4,l.normalize(),o.crossVectors(i,l)),o.normalize(),c.crossVectors(l,o),n[0]=o.x,n[4]=c.x,n[8]=l.x,n[1]=o.y,n[5]=c.y,n[9]=l.y,n[2]=o.z,n[6]=c.z,n[10]=l.z,this}),multiply:function(t,e){return void 0!==e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[4],o=i[8],c=i[12],l=i[1],h=i[5],u=i[9],f=i[13],d=i[2],p=i[6],g=i[10],m=i[14],v=i[3],y=i[7],_=i[11],b=i[15],x=n[0],S=n[4],w=n[8],T=n[12],C=n[1],E=n[5],A=n[9],M=n[13],O=n[2],L=n[6],P=n[10],I=n[14],R=n[3],D=n[7],N=n[11],U=n[15];return r[0]=a*x+s*C+o*O+c*R,r[4]=a*S+s*E+o*L+c*D,r[8]=a*w+s*A+o*P+c*N,r[12]=a*T+s*M+o*I+c*U,r[1]=l*x+h*C+u*O+f*R,r[5]=l*S+h*E+u*L+f*D,r[9]=l*w+h*A+u*P+f*N,r[13]=l*T+h*M+u*I+f*U,r[2]=d*x+p*C+g*O+m*R,r[6]=d*S+p*E+g*L+m*D,r[10]=d*w+p*A+g*P+m*N,r[14]=d*T+p*M+g*I+m*U,r[3]=v*x+y*C+_*O+b*R,r[7]=v*S+y*E+_*L+b*D,r[11]=v*w+y*A+_*P+b*N,r[15]=v*T+y*M+_*I+b*U,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:(s=new Pe,function(t){for(var e=0,i=t.count;e<i;e++)s.x=t.getX(e),s.y=t.getY(e),s.z=t.getZ(e),s.applyMatrix4(this),t.setXYZ(e,s.x,s.y,s.z);return t}),determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],s=t[5],o=t[9],c=t[13],l=t[2],h=t[6],u=t[10],f=t[14];return t[3]*(+r*o*h-n*c*h-r*s*u+i*c*u+n*s*f-i*o*f)+t[7]*(+e*o*f-e*c*u+r*a*u-n*a*f+n*c*l-r*o*l)+t[11]*(+e*c*h-e*s*f-r*a*h+i*a*f+r*s*l-i*c*l)+t[15]*(-n*s*l-e*o*h+e*s*u+n*a*h-i*a*u+i*o*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],c=n[4],l=n[5],h=n[6],u=n[7],f=n[8],d=n[9],p=n[10],g=n[11],m=n[12],v=n[13],y=n[14],_=n[15],b=d*y*u-v*p*u+v*h*g-l*y*g-d*h*_+l*p*_,x=m*p*u-f*y*u-m*h*g+c*y*g+f*h*_-c*p*_,S=f*v*u-m*d*u+m*l*g-c*v*g-f*l*_+c*d*_,w=m*d*h-f*v*h-m*l*p+c*v*p+f*l*y-c*d*y,T=r*b+a*x+s*S+o*w;if(0===T){if(!0===e)throw new Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var C=1/T;return i[0]=b*C,i[1]=(v*p*o-d*y*o-v*s*g+a*y*g+d*s*_-a*p*_)*C,i[2]=(l*y*o-v*h*o+v*s*u-a*y*u-l*s*_+a*h*_)*C,i[3]=(d*h*o-l*p*o-d*s*u+a*p*u+l*s*g-a*h*g)*C,i[4]=x*C,i[5]=(f*y*o-m*p*o+m*s*g-r*y*g-f*s*_+r*p*_)*C,i[6]=(m*h*o-c*y*o-m*s*u+r*y*u+c*s*_-r*h*_)*C,i[7]=(c*p*o-f*h*o+f*s*u-r*p*u-c*s*g+r*h*g)*C,i[8]=S*C,i[9]=(m*d*o-f*v*o-m*a*g+r*v*g+f*a*_-r*d*_)*C,i[10]=(c*v*o-m*l*o+m*a*u-r*v*u-c*a*_+r*l*_)*C,i[11]=(f*l*o-c*d*o-f*a*u+r*d*u+c*a*g-r*l*g)*C,i[12]=w*C,i[13]=(f*v*s-m*d*s+m*a*p-r*v*p-f*a*y+r*d*y)*C,i[14]=(m*l*s-c*v*s-m*a*h+r*v*h+c*a*y-r*l*y)*C,i[15]=(c*d*s-f*l*s+f*a*h-r*d*h-c*a*p+r*l*p)*C,this},scale:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,a=t.x,s=t.y,o=t.z,c=r*a,l=r*s;return this.set(c*a+i,c*s-n*o,c*o+n*s,0,c*s+n*o,l*s+i,l*o-n*a,0,c*o-n*s,l*o+n*a,r*o*o+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:(r=new Pe,a=new Oe,function(t,e,i){var n=this.elements,s=r.set(n[0],n[1],n[2]).length(),o=r.set(n[4],n[5],n[6]).length(),c=r.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],a.copy(this);var l=1/s,h=1/o,u=1/c;return a.elements[0]*=l,a.elements[1]*=l,a.elements[2]*=l,a.elements[4]*=h,a.elements[5]*=h,a.elements[6]*=h,a.elements[8]*=u,a.elements[9]*=u,a.elements[10]*=u,e.setFromRotationMatrix(a),i.x=s,i.y=o,i.z=c,this}),makePerspective:function(t,e,i,n,r,a){var s=this.elements,o=2*r/(e-t),c=2*r/(i-n),l=(e+t)/(e-t),h=(i+n)/(i-n),u=-(a+r)/(a-r),f=-2*a*r/(a-r);return s[0]=o,s[4]=0,s[8]=l,s[12]=0,s[1]=0,s[5]=c,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=f,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,i,n,r,a){var s=this.elements,o=1/(e-t),c=1/(i-n),l=1/(a-r),h=(e+t)*o,u=(i+n)*c,f=(a+r)*l;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-f,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),Object.assign(Le,{slerp:function(t,e,i,n){return i.copy(t).slerp(e,n)},slerpFlat:function(t,e,i,n,r,a,s){var o=i[n+0],c=i[n+1],l=i[n+2],h=i[n+3],u=r[a+0],f=r[a+1],d=r[a+2],p=r[a+3];if(h!==p||o!==u||c!==f||l!==d){var g=1-s,m=o*u+c*f+l*d+h*p,v=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,m*v);g=Math.sin(g*b)/_,s=Math.sin(s*b)/_}var x=s*v;if(o=o*g+u*x,c=c*g+f*x,l=l*g+d*x,h=h*g+p*x,g===1-s){var S=1/Math.sqrt(o*o+c*c+l*l+h*h);o*=S,c*=S,l*=S,h*=S}}t[e]=o,t[e+1]=c,t[e+2]=l,t[e+3]=h}}),Object.defineProperties(Le.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(Le.prototype,{set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,n=t._y,r=t._z,a=t.order,s=Math.cos,o=Math.sin,c=s(i/2),l=s(n/2),h=s(r/2),u=o(i/2),f=o(n/2),d=o(r/2);return"XYZ"===a?(this._x=u*l*h+c*f*d,this._y=c*f*h-u*l*d,this._z=c*l*d+u*f*h,this._w=c*l*h-u*f*d):"YXZ"===a?(this._x=u*l*h+c*f*d,this._y=c*f*h-u*l*d,this._z=c*l*d-u*f*h,this._w=c*l*h+u*f*d):"ZXY"===a?(this._x=u*l*h-c*f*d,this._y=c*f*h+u*l*d,this._z=c*l*d+u*f*h,this._w=c*l*h-u*f*d):"ZYX"===a?(this._x=u*l*h-c*f*d,this._y=c*f*h+u*l*d,this._z=c*l*d-u*f*h,this._w=c*l*h+u*f*d):"YZX"===a?(this._x=u*l*h+c*f*d,this._y=c*f*h+u*l*d,this._z=c*l*d-u*f*h,this._w=c*l*h-u*f*d):"XZY"===a&&(this._x=u*l*h-c*f*d,this._y=c*f*h-u*l*d,this._z=c*l*d+u*f*h,this._w=c*l*h+u*f*d),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,n=i[0],r=i[4],a=i[8],s=i[1],o=i[5],c=i[9],l=i[2],h=i[6],u=i[10],f=n+o+u;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(h-c)*e,this._y=(a-l)*e,this._z=(s-r)*e):n>o&&n>u?(e=2*Math.sqrt(1+n-o-u),this._w=(h-c)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(a+l)/e):o>u?(e=2*Math.sqrt(1+o-n-u),this._w=(a-l)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(c+h)/e):(e=2*Math.sqrt(1+u-n-o),this._w=(s-r)/e,this._x=(a+l)/e,this._y=(c+h)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:(f=new Pe,function(t,e){return void 0===f&&(f=new Pe),(u=t.dot(e)+1)<1e-6?(u=0,Math.abs(t.x)>Math.abs(t.z)?f.set(-t.y,t.x,0):f.set(0,-t.z,t.y)):f.crossVectors(t,e),this._x=f.x,this._y=f.y,this._z=f.z,this._w=u,this.normalize()}),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,a=t._w,s=e._x,o=e._y,c=e._z,l=e._w;return this._x=i*l+a*s+n*c-r*o,this._y=n*l+a*o+r*s-i*c,this._z=r*l+a*c+i*o-n*s,this._w=a*l-i*s-n*o-r*c,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,a=this._w,s=a*t._w+i*t._x+n*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=a,this._x=i,this._y=n,this._z=r,this;var o=Math.sqrt(1-s*s);if(Math.abs(o)<.001)return this._w=.5*(a+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var c=Math.atan2(o,s),l=Math.sin((1-e)*c)/o,h=Math.sin(e*c)/o;return this._w=a*l+this._w*h,this._x=i*l+this._x*h,this._y=n*l+this._y*h,this._z=r*l+this._z*h,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Pe.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(b=new Le,function(t){return!t||t.isEuler,this.applyQuaternion(b.setFromEuler(t))}),applyAxisAngle:(_=new Le,function(t,e){return this.applyQuaternion(_.setFromAxisAngle(t,e))}),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*a,this},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,s=t.z,o=t.w,c=o*e+a*n-s*i,l=o*i+s*e-r*n,h=o*n+r*i-a*e,u=-r*e-a*i-s*n;return this.x=c*o+u*-r+l*-s-h*-a,this.y=l*o+u*-a+h*-r-c*-s,this.z=h*o+u*-s+c*-a-l*-r,this},project:(y=new Oe,function(t){return y.multiplyMatrices(t.projectionMatrix,y.getInverse(t.matrixWorld)),this.applyMatrix4(y)}),unproject:(v=new Oe,function(t){return v.multiplyMatrices(t.matrixWorld,v.getInverse(t.projectionMatrix)),this.applyMatrix4(v)}),transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:(g=new Pe,m=new Pe,function(t,e){return g.set(t,t,t),m.set(e,e,e),this.clamp(g,m)}),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){return void 0!==e?this.crossVectors(t,e):this.crossVectors(this,t)},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,a=e.x,s=e.y,o=e.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(p=new Pe,function(t){return p.copy(this).projectOnVector(t),this.sub(p)}),reflect:(d=new Pe,function(t){return this.sub(d.copy(t).multiplyScalar(2*this.dot(t)))}),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(Ae.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(Ie.prototype,{isMatrix3:!0,set:function(t,e,i,n,r,a,s,o,c){var l=this.elements;return l[0]=t,l[1]=n,l[2]=s,l[3]=e,l[4]=r,l[5]=o,l[6]=i,l[7]=a,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:(x=new Pe,function(t){for(var e=0,i=t.count;e<i;e++)x.x=t.getX(e),x.y=t.getY(e),x.z=t.getZ(e),x.applyMatrix3(this),t.setXYZ(e,x.x,x.y,x.z);return t}),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[3],o=i[6],c=i[1],l=i[4],h=i[7],u=i[2],f=i[5],d=i[8],p=n[0],g=n[3],m=n[6],v=n[1],y=n[4],_=n[7],b=n[2],x=n[5],S=n[8];return r[0]=a*p+s*v+o*b,r[3]=a*g+s*y+o*x,r[6]=a*m+s*_+o*S,r[1]=c*p+l*v+h*b,r[4]=c*g+l*y+h*x,r[7]=c*m+l*_+h*S,r[2]=u*p+f*v+d*b,r[5]=u*g+f*y+d*x,r[8]=u*m+f*_+d*S,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],c=t[7],l=t[8];return e*a*l-e*s*c-i*r*l+i*s*o+n*r*c-n*a*o},getInverse:function(t,e){t&&t.isMatrix4;var i=t.elements,n=this.elements,r=i[0],a=i[1],s=i[2],o=i[3],c=i[4],l=i[5],h=i[6],u=i[7],f=i[8],d=f*c-l*u,p=l*h-f*o,g=u*o-c*h,m=r*d+a*p+s*g;if(0===m){if(!0===e)throw new Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return this.identity()}var v=1/m;return n[0]=d*v,n[1]=(s*u-f*a)*v,n[2]=(l*a-s*c)*v,n[3]=p*v,n[4]=(f*r-s*h)*v,n[5]=(s*o-l*r)*v,n[6]=g*v,n[7]=(a*h-u*r)*v,n[8]=(c*r-a*o)*v,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,i,n,r,a,s){var o=Math.cos(r),c=Math.sin(r);this.set(i*o,i*c,-i*(o*a+c*s)+a+t,-n*c,n*o,-n*(-c*a+o*s)+s+e,0,0,1)},scale:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],a=n[3],s=n[6],o=n[1],c=n[4],l=n[7];return n[0]=e*r+i*o,n[3]=e*a+i*c,n[6]=e*s+i*l,n[1]=-i*r+e*o,n[4]=-i*a+e*c,n[7]=-i*s+e*l,this},translate:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}});var Re,De,Ne=0;function Ue(t,e,i,n,r,a,s,o,c,l){Object.defineProperty(this,"id",{value:Ne++}),this.uuid=Ae.generateUUID(),this.name="",this.image=void 0!==t?t:Ue.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Ue.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:Et,this.wrapT=void 0!==n?n:Et,this.magFilter=void 0!==r?r:Pt,this.minFilter=void 0!==a?a:Rt,this.anisotropy=void 0!==c?c:1,this.format=void 0!==s?s:qt,this.type=void 0!==o?o:Dt,this.offset=new Me(0,0),this.repeat=new Me(1,1),this.center=new Me(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ie,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:ye,this.version=0,this.onUpdate=null}function Fe(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1}function Be(t,e,i){this.uuid=Ae.generateUUID(),this.width=t,this.height=e,this.scissor=new Fe(0,0,t,e),this.scissorTest=!1,this.viewport=new Fe(0,0,t,e),void 0===(i=i||{}).minFilter&&(i.minFilter=Pt),this.texture=new Ue(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function ke(t,e,i){Be.call(this,t,e,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function je(t,e,i,n,r,a,s,o,c,l,h,u){Ue.call(this,null,a,s,o,c,l,n,r,h,u),this.image={data:t,width:e,height:i},this.magFilter=void 0!==c?c:Mt,this.minFilter=void 0!==l?l:Mt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Ge(t,e,i,n,r,a,s,o,c,l){t=void 0!==t?t:[],e=void 0!==e?e:yt,Ue.call(this,t,e,i,n,r,a,s,o,c,l),this.flipY=!1}Ue.DEFAULT_IMAGE=void 0,Ue.DEFAULT_MAPPING=300,Ue.prototype=Object.assign(Object.create(e.prototype),{constructor:Ue,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;void 0===n.uuid&&(n.uuid=Ae.generateUUID()),e||void 0!==t.images[n.uuid]||(t.images[n.uuid]={uuid:n.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var i=e.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(n)}),i.image=n.uuid}return e||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ct:t.x=t.x-Math.floor(t.x);break;case Et:t.x=t.x<0?0:1;break;case At:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Ct:t.y=t.y-Math.floor(t.y);break;case Et:t.y=t.y<0?0:1;break;case At:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.defineProperty(Ue.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Fe.prototype,{isVector4:!0,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,r,a=t.elements,s=a[0],o=a[4],c=a[8],l=a[1],h=a[5],u=a[9],f=a[2],d=a[6],p=a[10];if(Math.abs(o-l)<.01&&Math.abs(c-f)<.01&&Math.abs(u-d)<.01){if(Math.abs(o+l)<.1&&Math.abs(c+f)<.1&&Math.abs(u+d)<.1&&Math.abs(s+h+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var g=(s+1)/2,m=(h+1)/2,v=(p+1)/2,y=(o+l)/4,_=(c+f)/4,b=(u+d)/4;return g>m&&g>v?g<.01?(i=0,n=.707106781,r=.707106781):(n=y/(i=Math.sqrt(g)),r=_/i):m>v?m<.01?(i=.707106781,n=0,r=.707106781):(i=y/(n=Math.sqrt(m)),r=b/n):v<.01?(i=.707106781,n=.707106781,r=0):(i=_/(r=Math.sqrt(v)),n=b/r),this.set(i,n,r,e),this}var x=Math.sqrt((d-u)*(d-u)+(c-f)*(c-f)+(l-o)*(l-o));return Math.abs(x)<.001&&(x=1),this.x=(d-u)/x,this.y=(c-f)/x,this.z=(l-o)/x,this.w=Math.acos((s+h+p-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return void 0===Re&&(Re=new Fe,De=new Fe),Re.set(t,t,t,t),De.set(e,e,e,e),this.clamp(Re,De)},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),Be.prototype=Object.assign(Object.create(e.prototype),{constructor:Be,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ke.prototype=Object.create(Be.prototype),ke.prototype.constructor=ke,ke.prototype.isWebGLRenderTargetCube=!0,je.prototype=Object.create(Ue.prototype),je.prototype.constructor=je,je.prototype.isDataTexture=!0,Ge.prototype=Object.create(Ue.prototype),Ge.prototype.constructor=Ge,Ge.prototype.isCubeTexture=!0,Object.defineProperty(Ge.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var ze=new Ue,He=new Ge;function Ve(){this.seq=[],this.map={}}var We=[],Xe=[],Ye=new Float32Array(16),qe=new Float32Array(9);function Ke(t,e,i){var n=t[0];if(n<=0||n>0)return t;var r=e*i,a=We[r];if(void 0===a&&(a=new Float32Array(r),We[r]=a),0!==e){n.toArray(a,0);for(var s=1,o=0;s!==e;++s)o+=i,t[s].toArray(a,o)}return a}function Ze(t,e){var i=Xe[e];void 0===i&&(i=new Int32Array(e),Xe[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocTextureUnit();return i}function Je(t,e){t.uniform1f(this.addr,e)}function Qe(t,e){t.uniform1i(this.addr,e)}function $e(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function ti(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function ei(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function ii(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function ni(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(qe.set(e.elements),t.uniformMatrix3fv(this.addr,!1,qe))}function ri(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(Ye.set(e.elements),t.uniformMatrix4fv(this.addr,!1,Ye))}function ai(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTexture2D(e||ze,n)}function si(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTextureCube(e||He,n)}function oi(t,e){t.uniform2iv(this.addr,e)}function ci(t,e){t.uniform3iv(this.addr,e)}function li(t,e){t.uniform4iv(this.addr,e)}function hi(t,e){t.uniform1fv(this.addr,e)}function ui(t,e){t.uniform1iv(this.addr,e)}function fi(t,e){t.uniform2fv(this.addr,Ke(e,this.size,2))}function di(t,e){t.uniform3fv(this.addr,Ke(e,this.size,3))}function pi(t,e){t.uniform4fv(this.addr,Ke(e,this.size,4))}function gi(t,e){t.uniformMatrix2fv(this.addr,!1,Ke(e,this.size,4))}function mi(t,e){t.uniformMatrix3fv(this.addr,!1,Ke(e,this.size,9))}function vi(t,e){t.uniformMatrix4fv(this.addr,!1,Ke(e,this.size,16))}function yi(t,e,i){var n=e.length,r=Ze(i,n);t.uniform1iv(this.addr,r);for(var a=0;a!==n;++a)i.setTexture2D(e[a]||ze,r[a])}function _i(t,e,i){var n=e.length,r=Ze(i,n);t.uniform1iv(this.addr,r);for(var a=0;a!==n;++a)i.setTextureCube(e[a]||He,r[a])}function bi(t,e,i){this.id=t,this.addr=i,this.setValue=function(t){switch(t){case 5126:return Je;case 35664:return $e;case 35665:return ti;case 35666:return ei;case 35674:return ii;case 35675:return ni;case 35676:return ri;case 35678:case 36198:return ai;case 35680:return si;case 5124:case 35670:return Qe;case 35667:case 35671:return oi;case 35668:case 35672:return ci;case 35669:case 35673:return li}}(e.type)}function xi(t,e,i){this.id=t,this.addr=i,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return hi;case 35664:return fi;case 35665:return di;case 35666:return pi;case 35674:return gi;case 35675:return mi;case 35676:return vi;case 35678:return yi;case 35680:return _i;case 5124:case 35670:return ui;case 35667:case 35671:return oi;case 35668:case 35672:return ci;case 35669:case 35673:return li}}(e.type)}function Si(t){this.id=t,Ve.call(this)}Si.prototype.setValue=function(t,e){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var a=i[n];a.setValue(t,e[a.id])}};var wi=/([\w\d_]+)(\])?(\[|\.)?/g;function Ti(t,e){t.seq.push(e),t.map[e.id]=e}function Ci(t,e,i){var n=t.name,r=n.length;for(wi.lastIndex=0;;){var a=wi.exec(n),s=wi.lastIndex,o=a[1],c="]"===a[2],l=a[3];if(c&&(o|=0),void 0===l||"["===l&&s+2===r){Ti(i,void 0===l?new bi(o,t,e):new xi(o,t,e));break}var h=i.map[o];void 0===h&&Ti(i,h=new Si(o)),i=h}}function Ei(t,e,i){Ve.call(this),this.renderer=i;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;++r){var a=t.getActiveUniform(e,r),s=a.name;Ci(a,t.getUniformLocation(e,s),this)}}Ei.prototype.setValue=function(t,e,i){var n=this.map[e];void 0!==n&&n.setValue(t,i,this.renderer)},Ei.prototype.setOptional=function(t,e,i){var n=e[i];void 0!==n&&this.setValue(t,i,n)},Ei.upload=function(t,e,i,n){for(var r=0,a=e.length;r!==a;++r){var s=e[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,n)}},Ei.seqWithValue=function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var a=t[n];a.id in e&&i.push(a)}return i};var Ai={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Mi(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}Object.assign(Mi.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,n){if(e=Ae.euclideanModulo(e,1),i=Ae.clamp(i,0,1),n=Ae.clamp(n,0,1),0===i)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+i):n+i-n*i,a=2*n-r;this.r=t(a,r,e+1/3),this.g=t(a,r,e),this.b=t(a,r,e-1/3)}return this}}(),setStyle:function(t){function e(t){void 0!==t&&parseFloat(t)}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var s=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,c=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(s,o,c)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l,h=(l=i[1]).length;if(3===h)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}t&&t.length>0&&(void 0!==(l=Ai[t])&&this.setHex(l));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,i,n=t||{h:0,s:0,l:0},r=this.r,a=this.g,s=this.b,o=Math.max(r,a,s),c=Math.min(r,a,s),l=(c+o)/2;if(c===o)e=0,i=0;else{var h=o-c;switch(i=l<=.5?h/(o+c):h/(2-o-c),o){case r:e=(a-s)/h+(a<s?6:0);break;case a:e=(s-r)/h+2;break;case s:e=(r-a)/h+4}e/=6}return n.h=e,n.s=i,n.l=l,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){var n=this.getHSL();return n.h+=t,n.s+=e,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var Oi,Li,Pi={common:{diffuse:{value:new Mi(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ie},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Me(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Mi(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Mi(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Ie}}},Ii={merge:function(t){for(var e={},i=0;i<t.length;i++){var n=this.clone(t[i]);for(var r in n)e[r]=n[r]}return e},clone:function(t){var e={};for(var i in t)for(var n in e[i]={},t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}return e}},Ri={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},Di={basic:{uniforms:Ii.merge([Pi.common,Pi.specularmap,Pi.envmap,Pi.aomap,Pi.lightmap,Pi.fog]),vertexShader:Ri.meshbasic_vert,fragmentShader:Ri.meshbasic_frag},lambert:{uniforms:Ii.merge([Pi.common,Pi.specularmap,Pi.envmap,Pi.aomap,Pi.lightmap,Pi.emissivemap,Pi.fog,Pi.lights,{emissive:{value:new Mi(0)}}]),vertexShader:Ri.meshlambert_vert,fragmentShader:Ri.meshlambert_frag},phong:{uniforms:Ii.merge([Pi.common,Pi.specularmap,Pi.envmap,Pi.aomap,Pi.lightmap,Pi.emissivemap,Pi.bumpmap,Pi.normalmap,Pi.displacementmap,Pi.gradientmap,Pi.fog,Pi.lights,{emissive:{value:new Mi(0)},specular:{value:new Mi(1118481)},shininess:{value:30}}]),vertexShader:Ri.meshphong_vert,fragmentShader:Ri.meshphong_frag},standard:{uniforms:Ii.merge([Pi.common,Pi.envmap,Pi.aomap,Pi.lightmap,Pi.emissivemap,Pi.bumpmap,Pi.normalmap,Pi.displacementmap,Pi.roughnessmap,Pi.metalnessmap,Pi.fog,Pi.lights,{emissive:{value:new Mi(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ri.meshphysical_vert,fragmentShader:Ri.meshphysical_frag},points:{uniforms:Ii.merge([Pi.points,Pi.fog]),vertexShader:Ri.points_vert,fragmentShader:Ri.points_frag},dashed:{uniforms:Ii.merge([Pi.common,Pi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ri.linedashed_vert,fragmentShader:Ri.linedashed_frag},depth:{uniforms:Ii.merge([Pi.common,Pi.displacementmap]),vertexShader:Ri.depth_vert,fragmentShader:Ri.depth_frag},normal:{uniforms:Ii.merge([Pi.common,Pi.bumpmap,Pi.normalmap,Pi.displacementmap,{opacity:{value:1}}]),vertexShader:Ri.normal_vert,fragmentShader:Ri.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ri.cube_vert,fragmentShader:Ri.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ri.equirect_vert,fragmentShader:Ri.equirect_frag},distanceRGBA:{uniforms:Ii.merge([Pi.common,Pi.displacementmap,{referencePosition:{value:new Pe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ri.distanceRGBA_vert,fragmentShader:Ri.distanceRGBA_frag},shadow:{uniforms:Ii.merge([Pi.lights,Pi.fog,{color:{value:new Mi(0)},opacity:{value:1}}]),vertexShader:Ri.shadow_vert,fragmentShader:Ri.shadow_frag}};function Ni(t,e){this.min=void 0!==t?t:new Me(1/0,1/0),this.max=void 0!==e?e:new Me(-1/0,-1/0)}function Ui(t,e,i,n,r){var a,s,o,c,l,h,u,f;function d(){var t,n,d,p,g,m=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),v=new Uint16Array([0,1,2,0,2,3]);a=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,v,e.STATIC_DRAW),u=e.createTexture(),f=e.createTexture(),i.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),i.bindTexture(e.TEXTURE_2D,f),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),o={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position;","\tif ( renderType == 2 ) {","\t\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\t\tvVisibility =        visibility.r / 9.0;","\t\tvVisibility *= 1.0 - visibility.g / 9.0;","\t\tvVisibility *=       visibility.b / 9.0;","\t\tvVisibility *= 1.0 - visibility.a / 9.0;","\t\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\t\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\t}","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else if ( renderType == 1 ) {","\t\tgl_FragColor = texture2D( map, vUV );","\t} else {","\t\tvec4 texture = texture2D( map, vUV );","\t\ttexture.a *= opacity * vVisibility;","\t\tgl_FragColor = texture;","\t\tgl_FragColor.rgb *= color;","\t}","}"].join("\n")},t=o,n=e.createProgram(),d=e.createShader(e.FRAGMENT_SHADER),p=e.createShader(e.VERTEX_SHADER),g="precision "+r.precision+" float;\n",e.shaderSource(d,g+t.fragmentShader),e.shaderSource(p,g+t.vertexShader),e.compileShader(d),e.compileShader(p),e.attachShader(n,d),e.attachShader(n,p),e.linkProgram(n),c=n,l={vertex:e.getAttribLocation(c,"position"),uv:e.getAttribLocation(c,"uv")},h={renderType:e.getUniformLocation(c,"renderType"),map:e.getUniformLocation(c,"map"),occlusionMap:e.getUniformLocation(c,"occlusionMap"),opacity:e.getUniformLocation(c,"opacity"),color:e.getUniformLocation(c,"color"),scale:e.getUniformLocation(c,"scale"),rotation:e.getUniformLocation(c,"rotation"),screenPosition:e.getUniformLocation(c,"screenPosition")}}this.render=function(t,r,o,p){if(0!==t.length){var g=new Pe,m=p.w/p.z,v=.5*p.z,y=.5*p.w,_=16/p.w,b=new Me(_*m,_),x=new Pe(1,1,0),S=new Me(1,1),w=new Ni;w.min.set(p.x,p.y),w.max.set(p.x+(p.z-16),p.y+(p.w-16)),void 0===c&&d(),i.useProgram(c),i.initAttributes(),i.enableAttribute(l.vertex),i.enableAttribute(l.uv),i.disableUnusedAttributes(),e.uniform1i(h.occlusionMap,0),e.uniform1i(h.map,1),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(l.vertex,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(l.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),i.disable(e.CULL_FACE),i.buffers.depth.setMask(!1);for(var T=0,C=t.length;T<C;T++){_=16/p.w,b.set(_*m,_);var E=t[T];if(g.set(E.matrixWorld.elements[12],E.matrixWorld.elements[13],E.matrixWorld.elements[14]),g.applyMatrix4(o.matrixWorldInverse),g.applyMatrix4(o.projectionMatrix),x.copy(g),S.x=p.x+x.x*v+v-8,S.y=p.y+x.y*y+y-8,!0===w.containsPoint(S)){i.activeTexture(e.TEXTURE0),i.bindTexture(e.TEXTURE_2D,null),i.activeTexture(e.TEXTURE1),i.bindTexture(e.TEXTURE_2D,u),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,S.x,S.y,16,16,0),e.uniform1i(h.renderType,0),e.uniform2f(h.scale,b.x,b.y),e.uniform3f(h.screenPosition,x.x,x.y,x.z),i.disable(e.BLEND),i.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),i.activeTexture(e.TEXTURE0),i.bindTexture(e.TEXTURE_2D,f),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,S.x,S.y,16,16,0),e.uniform1i(h.renderType,1),i.disable(e.DEPTH_TEST),i.activeTexture(e.TEXTURE1),i.bindTexture(e.TEXTURE_2D,u),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),E.positionScreen.copy(x),E.customUpdateCallback?E.customUpdateCallback(E):E.updateLensFlares(),e.uniform1i(h.renderType,2),i.enable(e.BLEND);for(var A=0,M=E.lensFlares.length;A<M;A++){var O=E.lensFlares[A];O.opacity>.001&&O.scale>.001&&(x.x=O.x,x.y=O.y,x.z=O.z,_=O.size*O.scale/p.w,b.x=_*m,b.y=_,e.uniform3f(h.screenPosition,x.x,x.y,x.z),e.uniform2f(h.scale,b.x,b.y),e.uniform1f(h.rotation,O.rotation),e.uniform1f(h.opacity,O.opacity),e.uniform3f(h.color,O.color.r,O.color.g,O.color.b),i.setBlending(O.blending,O.blendEquation,O.blendSrc,O.blendDst),n.setTexture2D(O.texture,1),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}}}i.enable(e.CULL_FACE),i.enable(e.DEPTH_TEST),i.buffers.depth.setMask(!0),i.reset()}}}function Fi(t,e,i,n,r,a,s,o,c){Ue.call(this,t,e,i,n,r,a,s,o,c),this.needsUpdate=!0}function Bi(t,e,i,n,r){var a,s,o,c,l,h,u=new Pe,f=new Le,d=new Pe;function p(){var t,i,n,u=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),f=new Uint16Array([0,1,2,0,2,3]);a=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,u,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,f,e.STATIC_DRAW),t=e.createProgram(),i=e.createShader(e.VERTEX_SHADER),n=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(i,["precision "+r.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = position * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),e.shaderSource(n,["precision "+r.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),e.compileShader(i),e.compileShader(n),e.attachShader(t,i),e.attachShader(t,n),e.linkProgram(t),o=t,c={position:e.getAttribLocation(o,"position"),uv:e.getAttribLocation(o,"uv")},l={uvOffset:e.getUniformLocation(o,"uvOffset"),uvScale:e.getUniformLocation(o,"uvScale"),rotation:e.getUniformLocation(o,"rotation"),scale:e.getUniformLocation(o,"scale"),color:e.getUniformLocation(o,"color"),map:e.getUniformLocation(o,"map"),opacity:e.getUniformLocation(o,"opacity"),modelViewMatrix:e.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(o,"projectionMatrix"),fogType:e.getUniformLocation(o,"fogType"),fogDensity:e.getUniformLocation(o,"fogDensity"),fogNear:e.getUniformLocation(o,"fogNear"),fogFar:e.getUniformLocation(o,"fogFar"),fogColor:e.getUniformLocation(o,"fogColor"),fogDepth:e.getUniformLocation(o,"fogDepth"),alphaTest:e.getUniformLocation(o,"alphaTest")};var d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");d.width=8,d.height=8;var p=d.getContext("2d");p.fillStyle="white",p.fillRect(0,0,8,8),h=new Fi(d)}function g(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(r,m,v){if(0!==r.length){void 0===o&&p(),i.useProgram(o),i.initAttributes(),i.enableAttribute(c.position),i.enableAttribute(c.uv),i.disableUnusedAttributes(),i.disable(e.CULL_FACE),i.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(c.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(c.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.uniformMatrix4fv(l.projectionMatrix,!1,v.projectionMatrix.elements),i.activeTexture(e.TEXTURE0),e.uniform1i(l.map,0);var y=0,_=0,b=m.fog;b?(e.uniform3f(l.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(e.uniform1f(l.fogNear,b.near),e.uniform1f(l.fogFar,b.far),e.uniform1i(l.fogType,1),y=1,_=1):b.isFogExp2&&(e.uniform1f(l.fogDensity,b.density),e.uniform1i(l.fogType,2),y=2,_=2)):(e.uniform1i(l.fogType,0),y=0,_=0);for(var x=0,S=r.length;x<S;x++){(T=r[x]).modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,T.matrixWorld),T.z=-T.modelViewMatrix.elements[14]}r.sort(g);var w=[];for(x=0,S=r.length;x<S;x++){var T,C=(T=r[x]).material;if(!1!==C.visible){T.onBeforeRender(t,m,v,void 0,C,void 0),e.uniform1f(l.alphaTest,C.alphaTest),e.uniformMatrix4fv(l.modelViewMatrix,!1,T.modelViewMatrix.elements),T.matrixWorld.decompose(u,f,d),w[0]=d.x,w[1]=d.y;var E=0;m.fog&&C.fog&&(E=_),y!==E&&(e.uniform1i(l.fogType,E),y=E),null!==C.map?(e.uniform2f(l.uvOffset,C.map.offset.x,C.map.offset.y),e.uniform2f(l.uvScale,C.map.repeat.x,C.map.repeat.y)):(e.uniform2f(l.uvOffset,0,0),e.uniform2f(l.uvScale,1,1)),e.uniform1f(l.opacity,C.opacity),e.uniform3f(l.color,C.color.r,C.color.g,C.color.b),e.uniform1f(l.rotation,C.rotation),e.uniform2fv(l.scale,w),i.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst,C.blendEquationAlpha,C.blendSrcAlpha,C.blendDstAlpha,C.premultipliedAlpha),i.buffers.depth.setTest(C.depthTest),i.buffers.depth.setMask(C.depthWrite),i.buffers.color.setMask(C.colorWrite),n.setTexture2D(C.map||h,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),T.onAfterRender(t,m,v,void 0,C,void 0)}}i.enable(e.CULL_FACE),i.reset()}}}Di.physical={uniforms:Ii.merge([Di.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ri.meshphysical_vert,fragmentShader:Ri.meshphysical_frag},Object.assign(Ni.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:(Li=new Me,function(t,e){var i=Li.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){var e=t||new Me;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new Me;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return(e||new Me).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return(e||new Me).copy(t).clamp(this.min,this.max)},distanceToPoint:(Oi=new Me,function(t){return Oi.copy(t).clamp(this.min,this.max).sub(t).length()}),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Fi.prototype=Object.create(Ue.prototype),Fi.prototype.constructor=Fi;var ki,ji,Gi,zi,Hi,Vi,Wi,Xi,Yi,qi,Ki,Zi,Ji,Qi,$i,tn,en,nn=0;function rn(){Object.defineProperty(this,"id",{value:nn++}),this.uuid=Ae.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=N,this.side=M,this.flatShading=!1,this.vertexColors=P,this.opacity=1,this.transparent=!1,this.blendSrc=K,this.blendDst=Z,this.blendEquation=j,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=at,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function an(t){rn.call(this),this.type="MeshDepthMaterial",this.depthPacking=Ce,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function sn(t){rn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Pe,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function on(t,e){this.min=void 0!==t?t:new Pe(1/0,1/0,1/0),this.max=void 0!==e?e:new Pe(-1/0,-1/0,-1/0)}function cn(t,e){this.center=void 0!==t?t:new Pe,this.radius=void 0!==e?e:0}function ln(t,e){this.normal=void 0!==t?t:new Pe(1,0,0),this.constant=void 0!==e?e:0}function hn(t,e,i,n,r,a){this.planes=[void 0!==t?t:new ln,void 0!==e?e:new ln,void 0!==i?i:new ln,void 0!==n?n:new ln,void 0!==r?r:new ln,void 0!==a?a:new ln]}function un(t,e,i){for(var n=new hn,r=new Oe,a=new Me,s=new Me(i,i),o=new Pe,c=new Pe,l=1,h=2,u=1+(l|h),f=new Array(u),d=new Array(u),p={},g=[new Pe(1,0,0),new Pe(-1,0,0),new Pe(0,0,1),new Pe(0,0,-1),new Pe(0,1,0),new Pe(0,-1,0)],m=[new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,0,1),new Pe(0,0,-1)],v=[new Fe,new Fe,new Fe,new Fe,new Fe,new Fe],y=0;y!==u;++y){var _=0!=(y&l),b=0!=(y&h),x=new an({depthPacking:Ee,morphTargets:_,skinning:b});f[y]=x;var S=new sn({morphTargets:_,skinning:b});d[y]=S}var w=this;function T(e,i,n,r,a,s){var o=e.geometry,c=null,u=f,g=e.customDepthMaterial;if(n&&(u=d,g=e.customDistanceMaterial),g)c=g;else{var m=!1;i.morphTargets&&(o&&o.isBufferGeometry?m=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0:o&&o.isGeometry&&(m=o.morphTargets&&o.morphTargets.length>0)),e.isSkinnedMesh&&i.skinning;var v=e.isSkinnedMesh&&i.skinning,y=0;m&&(y|=l),v&&(y|=h),c=u[y]}if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var _=c.uuid,b=i.uuid,x=p[_];void 0===x&&(x={},p[_]=x);var S=x[b];void 0===S&&(S=c.clone(),x[b]=S),c=S}c.visible=i.visible,c.wireframe=i.wireframe;var T=i.side;return w.renderSingleSided&&T==L&&(T=M),w.renderReverseSided&&(T===M?T=O:T===O&&(T=M)),c.side=T,c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,n&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(r),c.nearDistance=a,c.farDistance=s),c}function C(i,r,a,s){if(!1!==i.visible){if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);var o=e.update(i),l=i.material;if(Array.isArray(l))for(var h=o.groups,u=0,f=h.length;u<f;u++){var d=h[u],p=l[d.materialIndex];if(p&&p.visible){var g=T(i,p,s,c,a.near,a.far);t.renderBufferDirect(a,null,o,g,i,d)}}else if(l.visible){g=T(i,l,s,c,a.near,a.far);t.renderBufferDirect(a,null,o,g,i,null)}}for(var m=i.children,v=0,y=m.length;v<y;v++)C(m[v],r,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=E,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(e,i,l){if(!1!==w.enabled&&(!1!==w.autoUpdate||!1!==w.needsUpdate)&&0!==e.length){var h,u=t.context,f=t.state;f.disable(u.BLEND),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var d=0,p=e.length;d<p;d++){var y=e[d],_=y.shadow,b=y&&y.isPointLight;if(void 0!==_){var x=_.camera;if(a.copy(_.mapSize),a.min(s),b){var S=a.x,T=a.y;v[0].set(2*S,T,S,T),v[1].set(0,T,S,T),v[2].set(3*S,T,S,T),v[3].set(S,T,S,T),v[4].set(3*S,0,S,T),v[5].set(S,0,S,T),a.x*=4,a.y*=2}if(null===_.map){var E={minFilter:Mt,magFilter:Mt,format:qt};_.map=new Be(a.x,a.y,E),_.map.texture.name=y.name+".shadowMap",x.updateProjectionMatrix()}_.isSpotLightShadow&&_.update(y);var A=_.map,M=_.matrix;c.setFromMatrixPosition(y.matrixWorld),x.position.copy(c),b?(h=6,M.makeTranslation(-c.x,-c.y,-c.z)):(h=1,o.setFromMatrixPosition(y.target.matrixWorld),x.lookAt(o),x.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(x.projectionMatrix),M.multiply(x.matrixWorldInverse)),t.setRenderTarget(A),t.clear();for(var O=0;O<h;O++){if(b){o.copy(x.position),o.add(g[O]),x.up.copy(m[O]),x.lookAt(o),x.updateMatrixWorld();var L=v[O];f.viewport(L)}r.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),n.setFromMatrix(r),C(i,l,x,b)}}}w.needsUpdate=!1}}}function fn(t){var e={};return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e[t.uuid]},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var n=e[i.uuid];n&&(t.deleteBuffer(n.buffer),delete e[i.uuid])},update:function(i,n){i.isInterleavedBufferAttribute&&(i=i.data);var r,a,s,o,c,l=e[i.uuid];void 0===l?e[i.uuid]=function(e,i){var n=e.array,r=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,a=t.createBuffer();t.bindBuffer(i,a),t.bufferData(i,n,r),e.onUploadCallback();var s=t.FLOAT;return n instanceof Float32Array?s=t.FLOAT:n instanceof Float64Array||(n instanceof Uint16Array?s=t.UNSIGNED_SHORT:n instanceof Int16Array?s=t.SHORT:n instanceof Uint32Array?s=t.UNSIGNED_INT:n instanceof Int32Array?s=t.INT:n instanceof Int8Array?s=t.BYTE:n instanceof Uint8Array&&(s=t.UNSIGNED_BYTE)),{buffer:a,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(i,n):l.version<i.version&&(r=l.buffer,s=n,o=(a=i).array,c=a.updateRange,t.bindBuffer(s,r),!1===a.dynamic?t.bufferData(s,o,t.STATIC_DRAW):-1===c.count?t.bufferSubData(s,0,o):0===c.count||(t.bufferSubData(s,c.offset*o.BYTES_PER_ELEMENT,o.subarray(c.offset,c.offset+c.count)),c.count=-1),l.version=i.version)}}}function dn(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||dn.DefaultOrder}function pn(){this.mask=1}rn.prototype=Object.assign(Object.create(e.prototype),{constructor:rn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i)if("shading"!==e){var n=this[e];void 0!==n&&(n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]="overdraw"===e?Number(i):i)}else this.flatShading=1===i}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==N&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==M&&(i.side=this.side),this.vertexColors!==P&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,0!==this.rotation&&(i.rotation=this.rotation),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){var r=n(t.textures),a=n(t.images);r.length>0&&(i.textures=r),a.length>0&&(i.images=a)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,i=null;if(null!==e){var n=e.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),an.prototype=Object.create(rn.prototype),an.prototype.constructor=an,an.prototype.isMeshDepthMaterial=!0,an.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},sn.prototype=Object.create(rn.prototype),sn.prototype.constructor=sn,sn.prototype.isMeshDistanceMaterial=!0,sn.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},Object.assign(on.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0,o=0,c=t.length;o<c;o+=3){var l=t[o],h=t[o+1],u=t[o+2];l<e&&(e=l),h<i&&(i=h),u<n&&(n=u),l>r&&(r=l),h>a&&(a=h),u>s&&(s=u)}return this.min.set(e,i,n),this.max.set(r,a,s),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0,o=0,c=t.count;o<c;o++){var l=t.getX(o),h=t.getY(o),u=t.getZ(o);l<e&&(e=l),h<i&&(i=h),u<n&&(n=u),l>r&&(r=l),h>a&&(a=h),u>s&&(s=u)}return this.min.set(e,i,n),this.max.set(r,a,s),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:(Hi=new Pe,function(t,e){var i=Hi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){var e=t||new Pe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new Pe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t,e,i,n=new Pe;function r(r){var a=r.geometry;if(void 0!==a)if(a.isGeometry){var s=a.vertices;for(e=0,i=s.length;e<i;e++)n.copy(s[e]),n.applyMatrix4(r.matrixWorld),t.expandByPoint(n)}else if(a.isBufferGeometry){var o=a.attributes.position;if(void 0!==o)for(e=0,i=o.count;e<i;e++)n.fromBufferAttribute(o,e).applyMatrix4(r.matrixWorld),t.expandByPoint(n)}}return function(e){return t=this,e.updateMatrixWorld(!0),e.traverse(r),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new Pe).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(zi=new Pe,function(t){return this.clampPoint(t.center,zi),zi.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){var e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant},clampPoint:function(t,e){return(e||new Pe).copy(t).clamp(this.min,this.max)},distanceToPoint:(Gi=new Pe,function(t){return Gi.copy(t).clamp(this.min,this.max).sub(t).length()}),getBoundingSphere:(ji=new Pe,function(t){var e=t||new cn;return this.getCenter(e.center),e.radius=.5*this.getSize(ji).length(),e}),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(ki=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],function(t){return this.isEmpty()?this:(ki[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ki[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ki[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ki[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ki[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ki[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ki[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ki[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ki),this)}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(cn.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(Vi=new on,function(t,e){var i=this.center;void 0!==e?i.copy(e):Vi.setFromPoints(t).getCenter(i);for(var n=0,r=0,a=t.length;r<a;r++)n=Math.max(n,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(n),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),n=e||new Pe;return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){var e=t||new on;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(ln.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:(qi=new Pe,Ki=new Pe,function(t,e,i){var n=qi.subVectors(i,e).cross(Ki.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return(e||new Pe).copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:(Yi=new Pe,function(t,e){var i=e||new Pe,n=t.delta(Yi),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/r;return a<0||a>1?void 0:i.copy(n).multiplyScalar(a).add(t.start)}),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new Pe).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:(Wi=new Pe,Xi=new Ie,function(t,e){var i=e||Xi.getNormalMatrix(t),n=this.coplanarPoint(Wi).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(hn.prototype,{set:function(t,e,i,n,r,a){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],c=i[5],l=i[6],h=i[7],u=i[8],f=i[9],d=i[10],p=i[11],g=i[12],m=i[13],v=i[14],y=i[15];return e[0].setComponents(s-n,h-o,p-u,y-g).normalize(),e[1].setComponents(s+n,h+o,p+u,y+g).normalize(),e[2].setComponents(s+r,h+c,p+f,y+m).normalize(),e[3].setComponents(s-r,h-c,p-f,y-m).normalize(),e[4].setComponents(s-a,h-l,p-d,y-v).normalize(),e[5].setComponents(s+a,h+l,p+d,y+v).normalize(),this},intersectsObject:($i=new cn,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),$i.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere($i)}),intersectsSprite:(Qi=new cn,function(t){return Qi.center.set(0,0,0),Qi.radius=.7071067811865476,Qi.applyMatrix4(t.matrixWorld),this.intersectsSphere(Qi)}),intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(i)<n)return!1}return!0},intersectsBox:(Zi=new Pe,Ji=new Pe,function(t){for(var e=this.planes,i=0;i<6;i++){var n=e[i];Zi.x=n.normal.x>0?t.min.x:t.max.x,Ji.x=n.normal.x>0?t.max.x:t.min.x,Zi.y=n.normal.y>0?t.min.y:t.max.y,Ji.y=n.normal.y>0?t.max.y:t.min.y,Zi.z=n.normal.z>0?t.min.z:t.max.z,Ji.z=n.normal.z>0?t.max.z:t.min.z;var r=n.distanceToPoint(Zi),a=n.distanceToPoint(Ji);if(r<0&&a<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}),dn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],dn.DefaultOrder="XYZ",Object.defineProperties(dn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(dn.prototype,{isEuler:!0,set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=Ae.clamp,r=t.elements,a=r[0],s=r[4],o=r[8],c=r[1],l=r[5],h=r[9],u=r[2],f=r[6],d=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(f,l),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(o,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-u,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(c,a))):"ZYX"===e?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(f,d),this._z=Math.atan2(c,a)):(this._x=0,this._z=Math.atan2(-s,l))):"YZX"===e?(this._z=Math.asin(n(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(o,d))):"XZY"===e&&(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(f,l),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-h,d),this._y=0)),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:(en=new Oe,function(t,e,i){return en.makeRotationFromQuaternion(t),this.setFromRotationMatrix(en,e,i)}),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(tn=new Le,function(t){return tn.setFromEuler(this),this.setFromQuaternion(tn,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Pe(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(pn.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var gn,mn,vn,yn,_n,bn,xn,Sn,wn,Tn,Cn,En,An,Mn,On,Ln,Pn,In,Rn,Dn=0;function Nn(){Object.defineProperty(this,"id",{value:Dn++}),this.uuid=Ae.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Nn.DefaultUp.clone();var t=new Pe,e=new dn,i=new Le,n=new Pe(1,1,1);e.onChange(function(){i.setFromEuler(e,!1)}),i.onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new Oe},normalMatrix:{value:new Ie}}),this.matrix=new Oe,this.matrixWorld=new Oe,this.matrixAutoUpdate=Nn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new pn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Un(){Nn.call(this),this.type="Camera",this.matrixWorldInverse=new Oe,this.projectionMatrix=new Oe}function Fn(t,e,i,n,r,a){Un.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function Bn(t,e,i,n,r,a){this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new Pe,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new Mi,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}Nn.DefaultUp=new Pe(0,1,0),Nn.DefaultMatrixAutoUpdate=!0,Nn.prototype=Object.assign(Object.create(e.prototype),{constructor:Nn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:(In=new Le,function(t,e){return In.setFromAxisAngle(t,e),this.quaternion.multiply(In),this}),rotateOnWorldAxis:(Pn=new Le,function(t,e){return Pn.setFromAxisAngle(t,e),this.quaternion.premultiply(Pn),this}),rotateX:(Ln=new Pe(1,0,0),function(t){return this.rotateOnAxis(Ln,t)}),rotateY:(On=new Pe(0,1,0),function(t){return this.rotateOnAxis(On,t)}),rotateZ:(Mn=new Pe(0,0,1),function(t){return this.rotateOnAxis(Mn,t)}),translateOnAxis:(An=new Pe,function(t,e){return An.copy(t).applyQuaternion(this.quaternion),this.position.add(An.multiplyScalar(e)),this}),translateX:(En=new Pe(1,0,0),function(t){return this.translateOnAxis(En,t)}),translateY:(Cn=new Pe(0,1,0),function(t){return this.translateOnAxis(Cn,t)}),translateZ:(Tn=new Pe(0,0,1),function(t){return this.translateOnAxis(Tn,t)}),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(wn=new Oe,function(t){return t.applyMatrix4(wn.getInverse(this.matrixWorld))}),lookAt:(xn=new Oe,Sn=new Pe,function(t,e,i){t.isVector3?Sn.copy(t):Sn.set(t,e,i),this.isCamera?xn.lookAt(this.position,Sn,this.up):xn.lookAt(Sn,this.position,this.up),this.quaternion.setFromRotationMatrix(xn)}),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?this:(t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var i=this.children.indexOf(t);return-1!==i&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){var e=t||new Pe;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(_n=new Pe,bn=new Pe,function(t){var e=t||new Le;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(_n,e,bn),e}),getWorldRotation:(yn=new Le,function(t){var e=t||new dn;return this.getWorldQuaternion(yn),e.setFromQuaternion(yn,this.rotation.order,!1)}),getWorldScale:(mn=new Pe,vn=new Le,function(t){var e=t||new Pe;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(mn,vn,e),e}),getWorldDirection:(gn=new Le,function(t){var e=t||new Pe;return this.getWorldQuaternion(gn),e.set(0,0,1).applyQuaternion(gn)}),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry){n.geometry=r(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var s=a.shapes;if(Array.isArray(s))for(var o=0,c=s.length;o<c;o++){var l=s[o];r(t.shapes,l)}else r(t.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var h=[];for(o=0,c=this.material.length;o<c;o++)h.push(r(t.materials,this.material[o]));n.material=h}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(e){var u=g(t.geometries),f=g(t.materials),d=g(t.textures),p=g(t.images);s=g(t.shapes);u.length>0&&(i.geometries=u),f.length>0&&(i.materials=f),d.length>0&&(i.textures=d),p.length>0&&(i.images=p),s.length>0&&(i.shapes=s)}return i.object=n,i;function g(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i=0;i<t.children.length;i++){var n=t.children[i];this.add(n.clone())}return this}}),Un.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Un,isCamera:!0,copy:function(t,e){return Nn.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:(Rn=new Le,function(t){var e=t||new Pe;return this.getWorldQuaternion(Rn),e.set(0,0,-1).applyQuaternion(Rn)}),updateMatrixWorld:function(t){Nn.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Fn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Fn,isOrthographicCamera:!0,copy:function(t,e){return Un.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,n,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,a=i+t,s=n+e,o=n-e;if(null!==this.view&&this.view.enabled){var c=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),h=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;a=(r+=h*(this.view.offsetX/c))+h*(this.view.width/c),o=(s-=u*(this.view.offsetY/l))-u*(this.view.height/l)}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far)},toJSON:function(t){var e=Nn.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Object.assign(Bn.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var kn,jn,Gn,zn,Hn,Vn,Wn=0;function Xn(){Object.defineProperty(this,"id",{value:Wn+=2}),this.uuid=Ae.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Yn(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=Ae.generateUUID(),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function qn(t,e,i){Yn.call(this,new Int8Array(t),e,i)}function Kn(t,e,i){Yn.call(this,new Uint8Array(t),e,i)}function Zn(t,e,i){Yn.call(this,new Uint8ClampedArray(t),e,i)}function Jn(t,e,i){Yn.call(this,new Int16Array(t),e,i)}function Qn(t,e,i){Yn.call(this,new Uint16Array(t),e,i)}function $n(t,e,i){Yn.call(this,new Int32Array(t),e,i)}function tr(t,e,i){Yn.call(this,new Uint32Array(t),e,i)}function er(t,e,i){Yn.call(this,new Float32Array(t),e,i)}function ir(t,e,i){Yn.call(this,new Float64Array(t),e,i)}function nr(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function rr(t){if(0===t.length)return-1/0;for(var e=t[0],i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}Xn.prototype=Object.assign(Object.create(e.prototype),{constructor:Xn,isGeometry:!0,applyMatrix:function(t){for(var e=(new Ie).getNormalMatrix(t),i=0,n=this.vertices.length;i<n;i++){this.vertices[i].applyMatrix4(t)}for(i=0,n=this.faces.length;i<n;i++){var r=this.faces[i];r.normal.applyMatrix3(e).normalize();for(var a=0,s=r.vertexNormals.length;a<s;a++)r.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:(Vn=new Oe,function(t){return Vn.makeRotationX(t),this.applyMatrix(Vn),this}),rotateY:(Hn=new Oe,function(t){return Hn.makeRotationY(t),this.applyMatrix(Hn),this}),rotateZ:(zn=new Oe,function(t){return zn.makeRotationZ(t),this.applyMatrix(zn),this}),translate:(Gn=new Oe,function(t,e,i){return Gn.makeTranslation(t,e,i),this.applyMatrix(Gn),this}),scale:(jn=new Oe,function(t,e,i){return jn.makeScale(t,e,i),this.applyMatrix(jn),this}),lookAt:(kn=new Nn,function(t){kn.lookAt(t),kn.updateMatrix(),this.applyMatrix(kn.matrix)}),fromBufferGeometry:function(t){var e=this,i=null!==t.index?t.index.array:void 0,n=t.attributes,r=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,o=void 0!==n.uv?n.uv.array:void 0,c=void 0!==n.uv2?n.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var l=[],h=[],u=[],f=0,d=0;f<r.length;f+=3,d+=2)e.vertices.push(new Pe(r[f],r[f+1],r[f+2])),void 0!==a&&l.push(new Pe(a[f],a[f+1],a[f+2])),void 0!==s&&e.colors.push(new Mi(s[f],s[f+1],s[f+2])),void 0!==o&&h.push(new Me(o[d],o[d+1])),void 0!==c&&u.push(new Me(c[d],c[d+1]));function p(t,i,n,r){var f=new Bn(t,i,n,void 0!==a?[l[t].clone(),l[i].clone(),l[n].clone()]:[],void 0!==s?[e.colors[t].clone(),e.colors[i].clone(),e.colors[n].clone()]:[],r);e.faces.push(f),void 0!==o&&e.faceVertexUvs[0].push([h[t].clone(),h[i].clone(),h[n].clone()]),void 0!==c&&e.faceVertexUvs[1].push([u[t].clone(),u[i].clone(),u[n].clone()])}var g=t.groups;if(g.length>0)for(f=0;f<g.length;f++)for(var m=g[f],v=m.start,y=(d=v,v+m.count);d<y;d+=3)void 0!==i?p(i[d],i[d+1],i[d+2],m.materialIndex):p(d,d+1,d+2,m.materialIndex);else if(void 0!==i)for(f=0;f<i.length;f+=3)p(i[f],i[f+1],i[f+2]);else for(f=0;f<r.length/3;f+=3)p(f,f+1,f+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,n=new Oe;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new Pe,e=new Pe,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],a=this.vertices[r.a],s=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,s),e.subVectors(a,s),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){var e,i,n,r,a,s;for(void 0===t&&(t=!0),s=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)s[e]=new Pe;if(t){var o,c,l,h=new Pe,u=new Pe;for(n=0,r=this.faces.length;n<r;n++)a=this.faces[n],o=this.vertices[a.a],c=this.vertices[a.b],l=this.vertices[a.c],h.subVectors(l,c),u.subVectors(o,c),h.cross(u),s[a.a].add(h),s[a.b].add(h),s[a.c].add(h)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)s[(a=this.faces[n]).a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(e=0,i=this.vertices.length;e<i;e++)s[e].normalize();for(n=0,r=this.faces.length;n<r;n++){var f=(a=this.faces[n]).vertexNormals;3===f.length?(f[0].copy(s[a.a]),f[1].copy(s[a.b]),f[2].copy(s[a.c])):(f[0]=s[a.a].clone(),f[1]=s[a.b].clone(),f[2]=s[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(i=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for((r=this.faces[i]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var a=new Xn;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)c=new Pe,l={a:new Pe,b:new Pe,c:new Pe},s.push(c),o.push(l)}var c,l,h=this.morphNormals[t];for(a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),i=0,n=this.faces.length;i<n;i++)r=this.faces[i],c=h.faceNormals[i],l=h.vertexNormals[i],c.copy(r.normal),l.a.copy(r.vertexNormals[0]),l.b.copy(r.vertexNormals[1]),l.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var t=0,e=this.vertices,i=0,n=e.length;i<n;i++)i>0&&(t+=e[i].distanceTo(e[i-1])),this.lineDistances[i]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new on),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new cn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(t&&t.isGeometry){var n,r=this.vertices.length,a=this.vertices,s=t.vertices,o=this.faces,c=t.faces,l=this.faceVertexUvs[0],h=t.faceVertexUvs[0],u=this.colors,f=t.colors;void 0===i&&(i=0),void 0!==e&&(n=(new Ie).getNormalMatrix(e));for(var d=0,p=s.length;d<p;d++){var g=s[d].clone();void 0!==e&&g.applyMatrix4(e),a.push(g)}for(d=0,p=f.length;d<p;d++)u.push(f[d].clone());for(d=0,p=c.length;d<p;d++){var m,v,y,_=c[d],b=_.vertexNormals,x=_.vertexColors;(m=new Bn(_.a+r,_.b+r,_.c+r)).normal.copy(_.normal),void 0!==n&&m.normal.applyMatrix3(n).normalize();for(var S=0,w=b.length;S<w;S++)v=b[S].clone(),void 0!==n&&v.applyMatrix3(n).normalize(),m.vertexNormals.push(v);m.color.copy(_.color);for(S=0,w=x.length;S<w;S++)y=x[S],m.vertexColors.push(y.clone());m.materialIndex=_.materialIndex+i,o.push(m)}for(d=0,p=h.length;d<p;d++){var T=h[d],C=[];if(void 0!==T){for(S=0,w=T.length;S<w;S++)C.push(T[S].clone());l.push(C)}}}},mergeMesh:function(t){t&&t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,e,i,n,r,a,s,o,c={},l=[],h=[],u=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)t=this.vertices[i],void 0===c[e=Math.round(t.x*u)+"_"+Math.round(t.y*u)+"_"+Math.round(t.z*u)]?(c[e]=i,l.push(this.vertices[i]),h[i]=l.length-1):h[i]=h[c[e]];var f=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=h[r.a],r.b=h[r.b],r.c=h[r.c],a=[r.a,r.b,r.c];for(var d=0;d<3;d++)if(a[d]===a[(d+1)%3]){f.push(i);break}}for(i=f.length-1;i>=0;i--){var p=f[i];for(this.faces.splice(p,1),s=0,o=this.faceVertexUvs.length;s<o;s++)this.faceVertexUvs[s].splice(p,1)}var g=this.vertices.length-l.length;return this.vertices=l,g},setFromPoints:function(t){this.vertices=[];for(var e=0,i=t.length;e<i;e++){var n=t[e];this.vertices.push(new Pe(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,r,a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===e&&(n=[]),s&&s.length===e&&(r=[]);for(i=0;i<e;i++){var o=t[i]._id;n&&n.push(a[o]),r&&r.push(s[o])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}for(var n=[],r=0;r<this.vertices.length;r++){var a=this.vertices[r];n.push(a.x,a.y,a.z)}var s=[],o=[],c={},l=[],h={},u=[],f={};for(r=0;r<this.faces.length;r++){var d=this.faces[r],p=void 0!==this.faceVertexUvs[0][r],g=d.normal.length()>0,m=d.vertexNormals.length>0,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,_=0;if(_=w(_=w(_=w(_=w(_=w(_=w(_=w(_=w(_,0,0),1,!0),2,!1),3,p),4,g),5,m),6,v),7,y),s.push(_),s.push(d.a,d.b,d.c),s.push(d.materialIndex),p){var b=this.faceVertexUvs[0][r];s.push(E(b[0]),E(b[1]),E(b[2]))}if(g&&s.push(T(d.normal)),m){var x=d.vertexNormals;s.push(T(x[0]),T(x[1]),T(x[2]))}if(v&&s.push(C(d.color)),y){var S=d.vertexColors;s.push(C(S[0]),C(S[1]),C(S[2]))}}function w(t,e,i){return i?t|1<<e:t&~(1<<e)}function T(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==c[e]?c[e]:(c[e]=o.length/3,o.push(t.x,t.y,t.z),c[e])}function C(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==h[e]?h[e]:(h[e]=l.length,l.push(t.getHex()),h[e])}function E(t){var e=t.x.toString()+t.y.toString();return void 0!==f[e]?f[e]:(f[e]=u.length/2,u.push(t.x,t.y),f[e])}return t.data={},t.data.vertices=n,t.data.normals=o,l.length>0&&(t.data.colors=l),u.length>0&&(t.data.uvs=[u]),t.data.faces=s,t},clone:function(){return(new Xn).copy(this)},copy:function(t){var e,i,n,r,a,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var o=t.vertices;for(e=0,i=o.length;e<i;e++)this.vertices.push(o[e].clone());var c=t.colors;for(e=0,i=c.length;e<i;e++)this.colors.push(c[e].clone());var l=t.faces;for(e=0,i=l.length;e<i;e++)this.faces.push(l[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var h=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,r=h.length;n<r;n++){var u=h[n],f=[];for(a=0,s=u.length;a<s;a++){var d=u[a];f.push(d.clone())}this.faceVertexUvs[e].push(f)}}var p=t.morphTargets;for(e=0,i=p.length;e<i;e++){var g={};if(g.name=p[e].name,void 0!==p[e].vertices)for(g.vertices=[],n=0,r=p[e].vertices.length;n<r;n++)g.vertices.push(p[e].vertices[n].clone());if(void 0!==p[e].normals)for(g.normals=[],n=0,r=p[e].normals.length;n<r;n++)g.normals.push(p[e].normals[n].clone());this.morphTargets.push(g)}var m=t.morphNormals;for(e=0,i=m.length;e<i;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],n=0,r=m[e].vertexNormals.length;n<r;n++){var y=m[e].vertexNormals[n],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),v.vertexNormals.push(_)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],n=0,r=m[e].faceNormals.length;n<r;n++)v.faceNormals.push(m[e].faceNormals[n].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,i=b.length;e<i;e++)this.skinWeights.push(b[e].clone());var x=t.skinIndices;for(e=0,i=x.length;e<i;e++)this.skinIndices.push(x[e].clone());var S=t.lineDistances;for(e=0,i=S.length;e<i;e++)this.lineDistances.push(S[e]);var w=t.boundingBox;null!==w&&(this.boundingBox=w.clone());var T=t.boundingSphere;return null!==T&&(this.boundingSphere=T.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Yn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Yn.prototype,{isBufferAttribute:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(a=new Mi),e[i++]=a.r,e[i++]=a.g,e[i++]=a.b}return this},copyIndicesArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];e[i++]=a.a,e[i++]=a.b,e[i++]=a.c}return this},copyVector2sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(a=new Me),e[i++]=a.x,e[i++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(a=new Pe),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(a=new Fe),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),qn.prototype=Object.create(Yn.prototype),qn.prototype.constructor=qn,Kn.prototype=Object.create(Yn.prototype),Kn.prototype.constructor=Kn,Zn.prototype=Object.create(Yn.prototype),Zn.prototype.constructor=Zn,Jn.prototype=Object.create(Yn.prototype),Jn.prototype.constructor=Jn,Qn.prototype=Object.create(Yn.prototype),Qn.prototype.constructor=Qn,$n.prototype=Object.create(Yn.prototype),$n.prototype.constructor=$n,tr.prototype=Object.create(Yn.prototype),tr.prototype.constructor=tr,er.prototype=Object.create(Yn.prototype),er.prototype.constructor=er,ir.prototype=Object.create(Yn.prototype),ir.prototype.constructor=ir,Object.assign(nr.prototype,{computeGroups:function(t){for(var e,i=[],n=void 0,r=t.faces,a=0;a<r.length;a++){var s=r[a];s.materialIndex!==n&&(n=s.materialIndex,void 0!==e&&(e.count=3*a-e.start,i.push(e)),e={start:3*a,materialIndex:n})}void 0!==e&&(e.count=3*a-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e,i=t.faces,n=t.vertices,r=t.faceVertexUvs,a=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,o=t.morphTargets,c=o.length;if(c>0){e=[];for(var l=0;l<c;l++)e[l]=[];this.morphTargets.position=e}var h,u=t.morphNormals,f=u.length;if(f>0){h=[];for(l=0;l<f;l++)h[l]=[];this.morphTargets.normal=h}var d=t.skinIndices,p=t.skinWeights,g=d.length===n.length,m=p.length===n.length;for(l=0;l<i.length;l++){var v=i[l];this.vertices.push(n[v.a],n[v.b],n[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=v.normal;this.normals.push(_,_,_)}var b,x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var S=v.color;this.colors.push(S,S,S)}if(!0===a)void 0!==(b=r[0][l])?this.uvs.push(b[0],b[1],b[2]):this.uvs.push(new Me,new Me,new Me);if(!0===s)void 0!==(b=r[1][l])?this.uvs2.push(b[0],b[1],b[2]):this.uvs2.push(new Me,new Me,new Me);for(var w=0;w<c;w++){var T=o[w].vertices;e[w].push(T[v.a],T[v.b],T[v.c])}for(w=0;w<f;w++){var C=u[w].vertexNormals[l];h[w].push(C.a,C.b,C.c)}g&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),m&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var ar,sr,or,cr,lr,hr,ur,fr,dr,pr,gr,mr,vr,yr,_r,br,xr,Sr,wr,Tr,Cr,Er,Ar,Mr,Or,Lr,Pr,Ir,Rr,Dr,Nr,Ur,Fr,Br=1;function kr(){Object.defineProperty(this,"id",{value:Br+=2}),this.uuid=Ae.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function jr(t,e,i,n,r,a){Xn.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a},this.fromBufferGeometry(new Gr(t,e,i,n,r,a)),this.mergeVertices()}function Gr(t,e,i,n,r,a){kr.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};var s=this;t=t||1,e=e||1,i=i||1,n=Math.floor(n)||1,r=Math.floor(r)||1;var o=[],c=[],l=[],h=[],u=0,f=0;function d(t,e,i,n,r,a,d,p,g,m,v){var y,_,b=a/g,x=d/m,S=a/2,w=d/2,T=p/2,C=g+1,E=m+1,A=0,M=0,O=new Pe;for(_=0;_<E;_++){var L=_*x-w;for(y=0;y<C;y++){var P=y*b-S;O[t]=P*n,O[e]=L*r,O[i]=T,c.push(O.x,O.y,O.z),O[t]=0,O[e]=0,O[i]=p>0?1:-1,l.push(O.x,O.y,O.z),h.push(y/g),h.push(1-_/m),A+=1}}for(_=0;_<m;_++)for(y=0;y<g;y++){var I=u+y+C*_,R=u+y+C*(_+1),D=u+(y+1)+C*(_+1),N=u+(y+1)+C*_;o.push(I,R,N),o.push(R,D,N),M+=6}s.addGroup(f,M,v),f+=M,u+=A}d("z","y","x",-1,-1,i,e,t,a=Math.floor(a)||1,r,0),d("z","y","x",1,-1,i,e,-t,a,r,1),d("x","z","y",1,1,t,i,e,n,a,2),d("x","z","y",1,-1,t,i,-e,n,a,3),d("x","y","z",1,-1,t,e,i,n,r,4),d("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.addAttribute("position",new er(c,3)),this.addAttribute("normal",new er(l,3)),this.addAttribute("uv",new er(h,2))}function zr(t,e,i,n){Xn.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new Hr(t,e,i,n)),this.mergeVertices()}function Hr(t,e,i,n){kr.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};var r,a,s=(t=t||1)/2,o=(e=e||1)/2,c=Math.floor(i)||1,l=Math.floor(n)||1,h=c+1,u=l+1,f=t/c,d=e/l,p=[],g=[],m=[],v=[];for(a=0;a<u;a++){var y=a*d-o;for(r=0;r<h;r++){var _=r*f-s;g.push(_,-y,0),m.push(0,0,1),v.push(r/c),v.push(1-a/l)}}for(a=0;a<l;a++)for(r=0;r<c;r++){var b=r+h*a,x=r+h*(a+1),S=r+1+h*(a+1),w=r+1+h*a;p.push(b,x,w),p.push(x,S,w)}this.setIndex(p),this.addAttribute("position",new er(g,3)),this.addAttribute("normal",new er(m,3)),this.addAttribute("uv",new er(v,2))}function Vr(t){rn.call(this),this.type="MeshBasicMaterial",this.color=new Mi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ht,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Wr(t){rn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(t.attributes,this.setValues(t))}function Xr(t,e){this.origin=void 0!==t?t:new Pe,this.direction=void 0!==e?e:new Pe}function Yr(t,e){this.start=void 0!==t?t:new Pe,this.end=void 0!==e?e:new Pe}function qr(t,e,i){this.a=void 0!==t?t:new Pe,this.b=void 0!==e?e:new Pe,this.c=void 0!==i?i:new Pe}function Kr(t,e){Nn.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new kr,this.material=void 0!==e?e:new Vr({color:16777215*Math.random()}),this.drawMode=ge,this.updateMorphTargets()}function Zr(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Jr(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Qr(){var t={};return{get:function(e,i){var n=e.id+","+i.id,r=t[n];return void 0===r&&(r=new function(){var t=[],e=0,i=[],n=[];return{opaque:i,transparent:n,init:function(){e=0,i.length=0,n.length=0},push:function(r,a,s,o,c){var l=t[e];void 0===l?(l={id:r.id,object:r,geometry:a,material:s,program:s.program,renderOrder:r.renderOrder,z:o,group:c},t[e]=l):(l.id=r.id,l.object=r,l.geometry=a,l.material=s,l.program=s.program,l.renderOrder=r.renderOrder,l.z=o,l.group=c),(!0===s.transparent?n:i).push(l),e++},sort:function(){i.length>1&&i.sort(Zr),n.length>1&&n.sort(Jr)}}},t[n]=r),r},dispose:function(){t={}}}}function $r(t,e){return Math.abs(e[1])-Math.abs(t[1])}function ta(){var t=new function(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var i;switch(e.type){case"DirectionalLight":i={direction:new Pe,color:new Mi,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Me};break;case"SpotLight":i={position:new Pe,direction:new Pe,color:new Mi,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Me};break;case"PointLight":i={position:new Pe,color:new Mi,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Me,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new Pe,skyColor:new Mi,groundColor:new Mi};break;case"RectAreaLight":i={color:new Mi,position:new Pe,halfWidth:new Pe,halfHeight:new Pe}}return t[e.id]=i,i}}},e={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new Pe,n=new Oe,r=new Oe;return{setup:function(a,s,o){for(var c=0,l=0,h=0,u=0,f=0,d=0,p=0,g=0,m=o.matrixWorldInverse,v=0,y=a.length;v<y;v++){var _=a[v],b=_.color,x=_.intensity,S=_.distance,w=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)c+=b.r*x,l+=b.g*x,h+=b.b*x;else if(_.isDirectionalLight){if((C=t.get(_)).color.copy(_.color).multiplyScalar(_.intensity),C.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(m),C.shadow=_.castShadow,_.castShadow){var T=_.shadow;C.shadowBias=T.bias,C.shadowRadius=T.radius,C.shadowMapSize=T.mapSize}e.directionalShadowMap[u]=w,e.directionalShadowMatrix[u]=_.shadow.matrix,e.directional[u]=C,u++}else if(_.isSpotLight)(C=t.get(_)).position.setFromMatrixPosition(_.matrixWorld),C.position.applyMatrix4(m),C.color.copy(b).multiplyScalar(x),C.distance=S,C.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(m),C.coneCos=Math.cos(_.angle),C.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),C.decay=0===_.distance?0:_.decay,C.shadow=_.castShadow,_.castShadow&&(T=_.shadow,C.shadowBias=T.bias,C.shadowRadius=T.radius,C.shadowMapSize=T.mapSize),e.spotShadowMap[d]=w,e.spotShadowMatrix[d]=_.shadow.matrix,e.spot[d]=C,d++;else if(_.isRectAreaLight)(C=t.get(_)).color.copy(b).multiplyScalar(x/(_.width*_.height)),C.position.setFromMatrixPosition(_.matrixWorld),C.position.applyMatrix4(m),r.identity(),n.copy(_.matrixWorld),n.premultiply(m),r.extractRotation(n),C.halfWidth.set(.5*_.width,0,0),C.halfHeight.set(0,.5*_.height,0),C.halfWidth.applyMatrix4(r),C.halfHeight.applyMatrix4(r),e.rectArea[p]=C,p++;else if(_.isPointLight)(C=t.get(_)).position.setFromMatrixPosition(_.matrixWorld),C.position.applyMatrix4(m),C.color.copy(_.color).multiplyScalar(_.intensity),C.distance=_.distance,C.decay=0===_.distance?0:_.decay,C.shadow=_.castShadow,_.castShadow&&(T=_.shadow,C.shadowBias=T.bias,C.shadowRadius=T.radius,C.shadowMapSize=T.mapSize,C.shadowCameraNear=T.camera.near,C.shadowCameraFar=T.camera.far),e.pointShadowMap[f]=w,e.pointShadowMatrix[f]=_.shadow.matrix,e.point[f]=C,f++;else if(_.isHemisphereLight){var C;(C=t.get(_)).direction.setFromMatrixPosition(_.matrixWorld),C.direction.transformDirection(m),C.direction.normalize(),C.skyColor.copy(_.color).multiplyScalar(x),C.groundColor.copy(_.groundColor).multiplyScalar(x),e.hemi[g]=C,g++}}e.ambient[0]=c,e.ambient[1]=l,e.ambient[2]=h,e.directional.length=u,e.spot.length=d,e.rectArea.length=p,e.point.length=f,e.hemi.length=g,e.hash=u+","+f+","+d+","+p+","+g+","+s.length},state:e}}function ea(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS),t.getShaderInfoLog(n),n}kr.prototype=Object.assign(Object.create(e.prototype),{constructor:kr,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(rr(t)>65535?tr:Qn)(t,1):this.index=t},addAttribute:function(t,e){if(e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute){if("index"!==t)return this.attributes[t]=e,this;this.setIndex(e)}else this.addAttribute(t,new Yn(arguments[1],arguments[2]))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new Ie).getNormalMatrix(t).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:(dr=new Oe,function(t){return dr.makeRotationX(t),this.applyMatrix(dr),this}),rotateY:(fr=new Oe,function(t){return fr.makeRotationY(t),this.applyMatrix(fr),this}),rotateZ:(ur=new Oe,function(t){return ur.makeRotationZ(t),this.applyMatrix(ur),this}),translate:(hr=new Oe,function(t,e,i){return hr.makeTranslation(t,e,i),this.applyMatrix(hr),this}),scale:(lr=new Oe,function(t,e,i){return lr.makeScale(t,e,i),this.applyMatrix(lr),this}),lookAt:(cr=new Nn,function(t){cr.lookAt(t),cr.updateMatrix(),this.applyMatrix(cr.matrix)}),center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new er(3*e.vertices.length,3),n=new er(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new er(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];e.push(r.x,r.y,r.z||0)}return this.addAttribute("position",new er(e,3)),this},updateFromObject:function(t){var e,i=t.geometry;if(t.isMesh){var n=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(n=void 0,i.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(i);n.verticesNeedUpdate=i.verticesNeedUpdate,n.normalsNeedUpdate=i.normalsNeedUpdate,n.colorsNeedUpdate=i.colorsNeedUpdate,n.uvsNeedUpdate=i.uvsNeedUpdate,n.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=n}return!0===i.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(i.vertices),e.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(i.normals),e.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(i.colors),e.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(i.uvs),e.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(i.lineDistances),e.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(t.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new nr).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new Yn(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new Yn(i,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new Yn(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new Yn(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new Yn(a,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var s=new(rr(t.indices)>65535?Uint32Array:Uint16Array)(3*t.indices.length);this.setIndex(new Yn(s,1).copyIndicesArray(t.indices))}for(var o in this.groups=t.groups,t.morphTargets){for(var c=[],l=t.morphTargets[o],h=0,u=l.length;h<u;h++){var f=l[h],d=new er(3*f.length,3);c.push(d.copyVector3sArray(f))}this.morphAttributes[o]=c}if(t.skinIndices.length>0){var p=new er(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var g=new er(4*t.skinWeights.length,4);this.addAttribute("skinWeight",g.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new on);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)},computeBoundingSphere:(sr=new on,or=new Pe,function(){null===this.boundingSphere&&(this.boundingSphere=new cn);var t=this.attributes.position;if(t){var e=this.boundingSphere.center;sr.setFromBufferAttribute(t),sr.getCenter(e);for(var i=0,n=0,r=t.count;n<r;n++)or.x=t.getX(n),or.y=t.getY(n),or.z=t.getZ(n),i=Math.max(i,e.distanceToSquared(or));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)}}),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new Yn(new Float32Array(n.length),3));else for(var r=e.normal.array,a=0,s=r.length;a<s;a++)r[a]=0;var o,c,l,h=e.normal.array,u=new Pe,f=new Pe,d=new Pe,p=new Pe,g=new Pe;if(t){var m=t.array;0===i.length&&this.addGroup(0,m.length);for(var v=0,y=i.length;v<y;++v){var _=i[v],b=_.start;for(a=b,s=b+_.count;a<s;a+=3)o=3*m[a+0],c=3*m[a+1],l=3*m[a+2],u.fromArray(n,o),f.fromArray(n,c),d.fromArray(n,l),p.subVectors(d,f),g.subVectors(u,f),p.cross(g),h[o]+=p.x,h[o+1]+=p.y,h[o+2]+=p.z,h[c]+=p.x,h[c+1]+=p.y,h[c+2]+=p.z,h[l]+=p.x,h[l+1]+=p.y,h[l+2]+=p.z}}else for(a=0,s=n.length;a<s;a+=9)u.fromArray(n,a),f.fromArray(n,a+3),d.fromArray(n,a+6),p.subVectors(d,f),g.subVectors(u,f),p.cross(g),h[a]=p.x,h[a+1]=p.y,h[a+2]=p.z,h[a+3]=p.x,h[a+4]=p.y,h[a+5]=p.z,h[a+6]=p.x,h[a+7]=p.y,h[a+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0);var i=this.attributes;for(var n in i)if(void 0!==t.attributes[n])for(var r=i[n].array,a=t.attributes[n],s=a.array,o=0,c=a.itemSize*e;o<s.length;o++,c++)r[c]=s[o];return this}},normalizeNormals:(ar=new Pe,function(){for(var t=this.attributes.normal,e=0,i=t.count;e<i;e++)ar.x=t.getX(e),ar.y=t.getY(e),ar.z=t.getZ(e),ar.normalize(),t.setXYZ(e,ar.x,ar.y,ar.z)}),toNonIndexed:function(){if(null===this.index)return this;var t=new kr,e=this.index.array,i=this.attributes;for(var n in i){for(var r=i[n],a=r.array,s=r.itemSize,o=new a.constructor(e.length*s),c=0,l=0,h=0,u=e.length;h<u;h++){c=e[h]*s;for(var f=0;f<s;f++)o[l++]=a[c++]}t.addAttribute(n,new Yn(o,s))}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var r=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:r}}var a=this.attributes;for(var i in a){var s=a[i];r=Array.prototype.slice.call(s.array);t.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:r,normalized:s.normalized}}var o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));var c=this.boundingSphere;return null!==c&&(t.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),t},clone:function(){return(new kr).copy(this)},copy:function(t){var e,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var a=t.attributes;for(e in a){var s=a[e];this.addAttribute(e,s.clone())}var o=t.morphAttributes;for(e in o){var c=[],l=o[e];for(i=0,n=l.length;i<n;i++)c.push(l[i].clone());this.morphAttributes[e]=c}var h=t.groups;for(i=0,n=h.length;i<n;i++){var u=h[i];this.addGroup(u.start,u.count,u.materialIndex)}var f=t.boundingBox;null!==f&&(this.boundingBox=f.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),jr.prototype=Object.create(Xn.prototype),jr.prototype.constructor=jr,Gr.prototype=Object.create(kr.prototype),Gr.prototype.constructor=Gr,zr.prototype=Object.create(Xn.prototype),zr.prototype.constructor=zr,Hr.prototype=Object.create(kr.prototype),Hr.prototype.constructor=Hr,Vr.prototype=Object.create(rn.prototype),Vr.prototype.constructor=Vr,Vr.prototype.isMeshBasicMaterial=!0,Vr.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},Wr.prototype=Object.create(rn.prototype),Wr.prototype.constructor=Wr,Wr.prototype.isShaderMaterial=!0,Wr.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ii.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Wr.prototype.toJSON=function(t){var e=rn.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Object.assign(Xr.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new Pe).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:(Tr=new Pe,function(t){return this.origin.copy(this.at(t,Tr)),this}),closestPointToPoint:function(t,e){var i=e||new Pe;i.subVectors(t,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:(wr=new Pe,function(t){var e=wr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(wr.copy(this.direction).multiplyScalar(e).add(this.origin),wr.distanceToSquared(t))}),distanceSqToSegment:(br=new Pe,xr=new Pe,Sr=new Pe,function(t,e,i,n){br.copy(t).add(e).multiplyScalar(.5),xr.copy(e).sub(t).normalize(),Sr.copy(this.origin).sub(br);var r,a,s,o,c=.5*t.distanceTo(e),l=-this.direction.dot(xr),h=Sr.dot(this.direction),u=-Sr.dot(xr),f=Sr.lengthSq(),d=Math.abs(1-l*l);if(d>0)if(a=l*h-u,o=c*d,(r=l*u-h)>=0)if(a>=-o)if(a<=o){var p=1/d;s=(r*=p)*(r+l*(a*=p)+2*h)+a*(l*r+a+2*u)+f}else a=c,s=-(r=Math.max(0,-(l*a+h)))*r+a*(a+2*u)+f;else a=-c,s=-(r=Math.max(0,-(l*a+h)))*r+a*(a+2*u)+f;else a<=-o?s=-(r=Math.max(0,-(-l*c+h)))*r+(a=r>0?-c:Math.min(Math.max(-c,-u),c))*(a+2*u)+f:a<=o?(r=0,s=(a=Math.min(Math.max(-c,-u),c))*(a+2*u)+f):s=-(r=Math.max(0,-(l*c+h)))*r+(a=r>0?c:Math.min(Math.max(-c,-u),c))*(a+2*u)+f;else a=l>0?-c:c,s=-(r=Math.max(0,-(l*a+h)))*r+a*(a+2*u)+f;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(xr).multiplyScalar(a).add(br),s}),intersectSphere:(_r=new Pe,function(t,e){_r.subVectors(t.center,this.origin);var i=_r.dot(this.direction),n=_r.dot(_r)-i*i,r=t.radius*t.radius;if(n>r)return null;var a=Math.sqrt(r-n),s=i-a,o=i+a;return s<0&&o<0?null:s<0?this.at(o,e):this.at(s,e)}),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var i,n,r,a,s,o,c=1/this.direction.x,l=1/this.direction.y,h=1/this.direction.z,u=this.origin;return c>=0?(i=(t.min.x-u.x)*c,n=(t.max.x-u.x)*c):(i=(t.max.x-u.x)*c,n=(t.min.x-u.x)*c),l>=0?(r=(t.min.y-u.y)*l,a=(t.max.y-u.y)*l):(r=(t.max.y-u.y)*l,a=(t.min.y-u.y)*l),i>a||r>n?null:((r>i||i!=i)&&(i=r),(a<n||n!=n)&&(n=a),h>=0?(s=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(s=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),i>o||s>n?null:((s>i||i!=i)&&(i=s),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))},intersectsBox:(yr=new Pe,function(t){return null!==this.intersectBox(t,yr)}),intersectTriangle:(pr=new Pe,gr=new Pe,mr=new Pe,vr=new Pe,function(t,e,i,n,r){gr.subVectors(e,t),mr.subVectors(i,t),vr.crossVectors(gr,mr);var a,s=this.direction.dot(vr);if(s>0){if(n)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}pr.subVectors(this.origin,t);var o=a*this.direction.dot(mr.crossVectors(pr,mr));if(o<0)return null;var c=a*this.direction.dot(gr.cross(pr));if(c<0)return null;if(o+c>s)return null;var l=-a*pr.dot(vr);return l<0?null:this.at(l/s,r)}),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Yr.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return(t||new Pe).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new Pe).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new Pe;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(Cr=new Pe,Er=new Pe,function(t,e){Cr.subVectors(t,this.start),Er.subVectors(this.end,this.start);var i=Er.dot(Er),n=Er.dot(Cr)/i;return e&&(n=Ae.clamp(n,0,1)),n}),closestPointToPoint:function(t,e,i){var n=this.closestPointToPointParameter(t,e),r=i||new Pe;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(qr,{normal:(Pr=new Pe,function(t,e,i,n){var r=n||new Pe;r.subVectors(i,e),Pr.subVectors(t,e),r.cross(Pr);var a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}),barycoordFromPoint:(Mr=new Pe,Or=new Pe,Lr=new Pe,function(t,e,i,n,r){Mr.subVectors(n,e),Or.subVectors(i,e),Lr.subVectors(t,e);var a=Mr.dot(Mr),s=Mr.dot(Or),o=Mr.dot(Lr),c=Or.dot(Or),l=Or.dot(Lr),h=a*c-s*s,u=r||new Pe;if(0===h)return u.set(-2,-1,-1);var f=1/h,d=(c*o-s*l)*f,p=(a*l-s*o)*f;return u.set(1-d-p,p,d)}),containsPoint:(Ar=new Pe,function(t,e,i,n){var r=qr.barycoordFromPoint(t,e,i,n,Ar);return r.x>=0&&r.y>=0&&r.x+r.y<=1})}),Object.assign(qr.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:(Ur=new Pe,Fr=new Pe,function(){return Ur.subVectors(this.c,this.b),Fr.subVectors(this.a,this.b),.5*Ur.cross(Fr).length()}),midpoint:function(t){return(t||new Pe).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return qr.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new ln).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return qr.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return qr.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:(Ir=new ln,Rr=[new Yr,new Yr,new Yr],Dr=new Pe,Nr=new Pe,function(t,e){var i=e||new Pe,n=1/0;if(Ir.setFromCoplanarPoints(this.a,this.b,this.c),Ir.projectPoint(t,Dr),!0===this.containsPoint(Dr))i.copy(Dr);else{Rr[0].set(this.a,this.b),Rr[1].set(this.b,this.c),Rr[2].set(this.c,this.a);for(var r=0;r<Rr.length;r++){Rr[r].closestPointToPoint(Dr,!0,Nr);var a=Dr.distanceToSquared(Nr);a<n&&(n=a,i.copy(Nr))}}return i}),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Kr.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Kr,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return Nn.prototype.copy.call(this,t),this.drawMode=t.drawMode,void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,i,n=this.geometry;if(n.isBufferGeometry){var r=n.morphAttributes,a=Object.keys(r);if(a.length>0){var s=r[a[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)i=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}else{var o=n.morphTargets;if(void 0!==o&&o.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)i=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}},raycast:function(){var t=new Oe,e=new Xr,i=new cn,n=new Pe,r=new Pe,a=new Pe,s=new Pe,o=new Pe,c=new Pe,l=new Me,h=new Me,u=new Me,f=new Pe,d=new Pe,p=new Pe;function g(t,e,i,n,r,a,s){return qr.barycoordFromPoint(t,e,i,n,f),r.multiplyScalar(f.x),a.multiplyScalar(f.y),s.multiplyScalar(f.z),r.add(a).add(s),r.clone()}function m(t,e,i,n,r,a,s,o){if(null===(e.side===O?n.intersectTriangle(s,a,r,!0,o):n.intersectTriangle(r,a,s,e.side!==L,o)))return null;p.copy(o),p.applyMatrix4(t.matrixWorld);var c=i.ray.origin.distanceTo(p);return c<i.near||c>i.far?null:{distance:c,point:p.clone(),object:t}}function v(t,e,i,s,o,c,f,p){n.fromBufferAttribute(s,c),r.fromBufferAttribute(s,f),a.fromBufferAttribute(s,p);var v=m(t,t.material,e,i,n,r,a,d);return v&&(o&&(l.fromBufferAttribute(o,c),h.fromBufferAttribute(o,f),u.fromBufferAttribute(o,p),v.uv=g(d,n,r,a,l,h,u)),v.face=new Bn(c,f,p,qr.normal(n,r,a)),v.faceIndex=c),v}return function(f,p){var y,_=this.geometry,b=this.material,x=this.matrixWorld;if(void 0!==b&&(null===_.boundingSphere&&_.computeBoundingSphere(),i.copy(_.boundingSphere),i.applyMatrix4(x),!1!==f.ray.intersectsSphere(i)&&(t.getInverse(x),e.copy(f.ray).applyMatrix4(t),null===_.boundingBox||!1!==e.intersectsBox(_.boundingBox))))if(_.isBufferGeometry){var S,w,T,C,E,A=_.index,M=_.attributes.position,O=_.attributes.uv;if(null!==A)for(C=0,E=A.count;C<E;C+=3)S=A.getX(C),w=A.getX(C+1),T=A.getX(C+2),(y=v(this,f,e,M,O,S,w,T))&&(y.faceIndex=Math.floor(C/3),p.push(y));else if(void 0!==M)for(C=0,E=M.count;C<E;C+=3)(y=v(this,f,e,M,O,S=C,w=C+1,T=C+2))&&(y.index=S,p.push(y))}else if(_.isGeometry){var L,P,I,R,D=Array.isArray(b),N=_.vertices,U=_.faces,F=_.faceVertexUvs[0];F.length>0&&(R=F);for(var B=0,k=U.length;B<k;B++){var j=U[B],G=D?b[j.materialIndex]:b;if(void 0!==G){if(L=N[j.a],P=N[j.b],I=N[j.c],!0===G.morphTargets){var z=_.morphTargets,H=this.morphTargetInfluences;n.set(0,0,0),r.set(0,0,0),a.set(0,0,0);for(var V=0,W=z.length;V<W;V++){var X=H[V];if(0!==X){var Y=z[V].vertices;n.addScaledVector(s.subVectors(Y[j.a],L),X),r.addScaledVector(o.subVectors(Y[j.b],P),X),a.addScaledVector(c.subVectors(Y[j.c],I),X)}}n.add(L),r.add(P),a.add(I),L=n,P=r,I=a}if(y=m(this,G,f,e,L,P,I,d)){if(R&&R[B]){var q=R[B];l.copy(q[0]),h.copy(q[1]),u.copy(q[2]),y.uv=g(d,L,P,I,l,h,u)}y.face=j,y.faceIndex=B,p.push(y)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ia,na,ra,aa,sa,oa,ca,la,ha,ua,fa,da,pa,ga,ma=0;function va(t){switch(t){case ye:return["Linear","( value )"];case _e:return["sRGB","( value )"];case xe:return["RGBE","( value )"];case Se:return["RGBM","( value, 7.0 )"];case we:return["RGBM","( value, 16.0 )"];case Te:return["RGBD","( value, 256.0 )"];case be:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function ya(t,e){var i=va(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function _a(t){return""!==t}function ba(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function xa(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(t,e){var i=Ri[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return xa(i)})}function Sa(t){return t.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,i,n){for(var r="",a=parseInt(e);a<parseInt(i);a++)r+=n.replace(/\[ i \]/g,"[ "+a+" ]");return r})}function wa(t,e,i,n,r,a){var s=t.context,o=n.defines,c=r.vertexShader,l=r.fragmentShader,h="SHADOWMAP_TYPE_BASIC";a.shadowMapType===E?h="SHADOWMAP_TYPE_PCF":a.shadowMapType===A&&(h="SHADOWMAP_TYPE_PCF_SOFT");var u="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",d="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(n.envMap.mapping){case yt:case _t:u="ENVMAP_TYPE_CUBE";break;case wt:case Tt:u="ENVMAP_TYPE_CUBE_UV";break;case bt:case xt:u="ENVMAP_TYPE_EQUIREC";break;case St:u="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case _t:case xt:f="ENVMAP_MODE_REFRACTION"}switch(n.combine){case ht:d="ENVMAP_BLENDING_MULTIPLY";break;case ut:d="ENVMAP_BLENDING_MIX";break;case ft:d="ENVMAP_BLENDING_ADD"}}var p,g,m,v,y,_,b,x,S=t.gammaFactor>0?t.gammaFactor:1,w=(p=n.extensions,g=a,m=e,[(p=p||{}).derivatives||g.envMapCubeUV||g.bumpMap||g.normalMap||g.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(p.fragDepth||g.logarithmicDepthBuffer)&&m.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",p.drawBuffers&&m.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(p.shaderTextureLOD||g.envMap)&&m.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_a).join("\n")),T=function(t){var e=[];for(var i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(o),C=s.createProgram();n.isRawShaderMaterial?((v=[T].filter(_a).join("\n")).length>0&&(v+="\n"),(y=[w,T].filter(_a).join("\n")).length>0&&(y+="\n")):(v=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+r.name,T,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+S,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+a.numClippingPlanes,a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(_a).join("\n"),y=[w,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+r.name,T,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"","#define GAMMA_FACTOR "+S,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+u:"",a.envMap?"#define "+f:"",a.envMap?"#define "+d:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+a.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(a.numClippingPlanes-a.numClipIntersection),a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+h:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&e.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==dt?"#define TONE_MAPPING":"",a.toneMapping!==dt?Ri.tonemapping_pars_fragment:"",a.toneMapping!==dt?function(t,e){var i;switch(e){case pt:i="Linear";break;case gt:i="Reinhard";break;case mt:i="Uncharted2";break;case vt:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Ri.encodings_pars_fragment:"",a.mapEncoding?ya("mapTexelToLinear",a.mapEncoding):"",a.envMapEncoding?ya("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?ya("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(_="linearToOutputTexel",b=a.outputEncoding,x=va(b),"vec4 "+_+"( vec4 value ) { return LinearTo"+x[0]+x[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(_a).join("\n")),c=ba(c=xa(c),a),l=ba(l=xa(l),a),n.isShaderMaterial||(c=Sa(c),l=Sa(l));var M=v+c,O=y+l,L=ea(s,s.VERTEX_SHADER,M),P=ea(s,s.FRAGMENT_SHADER,O);s.attachShader(C,L),s.attachShader(C,P),void 0!==n.index0AttributeName?s.bindAttribLocation(C,0,n.index0AttributeName):!0===a.morphTargets&&s.bindAttribLocation(C,0,"position"),s.linkProgram(C);var I,R,D=s.getProgramInfoLog(C),N=s.getShaderInfoLog(L),U=s.getShaderInfoLog(P),F=!0,B=!0;return!1===s.getProgramParameter(C,s.LINK_STATUS)?F=!1:""!==D||""!==N&&""!==U||(B=!1),B&&(this.diagnostics={runnable:F,material:n,programLog:D,vertexShader:{log:N,prefix:v},fragmentShader:{log:U,prefix:y}}),s.deleteShader(L),s.deleteShader(P),this.getUniforms=function(){return void 0===I&&(I=new Ei(s,C,t)),I},this.getAttributes=function(){return void 0===R&&(R=function(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var a=t.getActiveAttrib(e,r).name;i[a]=t.getAttribLocation(e,a)}return i}(s,C)),R},this.destroy=function(){s.deleteProgram(C),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return this.getUniforms()}},attributes:{get:function(){return this.getAttributes()}}}),this.id=ma++,this.code=i,this.usedTimes=1,this.program=C,this.vertexShader=L,this.fragmentShader=P,this}function Ta(t,e,i){var n=[],r={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(t,e){var i;return t?t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(i=t.texture.encoding):i=ye,i===ye&&e&&(i=be),i}this.getParameters=function(e,n,a,o,c,l,h){var u=r[e.type],f=h.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(i.floatVertexTextures)return 1024;var n=i.maxVertexUniforms,r=Math.floor((n-20)/4),a=Math.min(r,e.length);return a<e.length?0:a}(h):0,d=i.precision;null!==e.precision&&(d=i.getMaxPrecision(e.precision),e.precision);var p=t.getRenderTarget();return{shaderID:u,precision:d,supportsVertexTextures:i.vertexTextures,outputEncoding:s(p?p.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:s(e.map,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:s(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===wt||e.envMap.mapping===Tt),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:s(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!o,useFog:e.fog,fogExp:o&&o.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:e.skinning&&f>0,maxBones:f,useVertexTexture:i.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:c,numClipIntersection:l,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.receiveShadow&&a.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===L,flipSided:e.side===O,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);for(var s=0;s<a.length;s++)n.push(i[a[s]]);return n.push(e.onBeforeCompile.toString()),n.push(t.gammaOutput),n.join()},this.acquireProgram=function(i,r,a,s){for(var o,c=0,l=n.length;c<l;c++){var h=n[c];if(h.code===s){++(o=h).usedTimes;break}}return void 0===o&&(o=new wa(t,e,s,i,r,a),n.push(o)),o},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function Ca(t,e,i,n,r,a,s){var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext,c={};function l(t,e){if(t.width>e||t.height>e){var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),n}return t}function h(t){return Ae.isPowerOfTwo(t.width)&&Ae.isPowerOfTwo(t.height)}function u(t,e){return t.generateMipmaps&&e&&t.minFilter!==Mt&&t.minFilter!==Pt}function f(e){return e===Mt||e===Ot||e===Lt?t.NEAREST:t.LINEAR}function d(e){var i=e.target;i.removeEventListener("dispose",d),function(e){var i=n.get(e);if(e.image&&i.__image__webglTextureCube)t.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture)}n.remove(e)}(i),i.isVideoTexture&&delete c[i.id],s.textures--}function p(e){var i=e.target;i.removeEventListener("dispose",p),function(e){var i=n.get(e),r=n.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var a=0;a<6;a++)t.deleteFramebuffer(i.__webglFramebuffer[a]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[a]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer);n.remove(e.texture),n.remove(e)}(i),s.textures--}function g(e,f){var p=n.get(e);if(e.version>0&&p.__version!==e.version){var g=e.image;if(void 0===g);else if(!1!==g.complete)return void function(e,n,f){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",d),e.__webglTexture=t.createTexture(),n.isVideoTexture&&(c[n.id]=n),s.textures++);i.activeTexture(t.TEXTURE0+f),i.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment);var p=l(n.image,r.maxTextureSize);g=n,(g.wrapS!==Et||g.wrapT!==Et||g.minFilter!==Mt&&g.minFilter!==Pt)&&!1===h(p)&&(p=function(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageBitmap){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.width=Ae.floorPowerOfTwo(t.width),e.height=Ae.floorPowerOfTwo(t.height),e.getContext("2d").drawImage(t,0,0,e.width,e.height),e}return t}(p));var g;var v=h(p),y=a.convert(n.format),_=a.convert(n.type);m(t.TEXTURE_2D,n,v);var b,x=n.mipmaps;if(n.isDepthTexture){var S=t.DEPTH_COMPONENT;if(n.type===jt){if(!o)throw new Error("Float Depth Texture only supported in WebGL2.0");S=t.DEPTH_COMPONENT32F}else o&&(S=t.DEPTH_COMPONENT16);n.format===Qt&&S===t.DEPTH_COMPONENT&&n.type!==Ft&&n.type!==kt&&(n.type=Ft,_=a.convert(n.type)),n.format===$t&&(S=t.DEPTH_STENCIL,n.type!==Wt&&(n.type=Wt,_=a.convert(n.type))),i.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,y,_,null)}else if(n.isDataTexture)if(x.length>0&&v){for(var w=0,T=x.length;w<T;w++)b=x[w],i.texImage2D(t.TEXTURE_2D,w,y,b.width,b.height,0,y,_,b.data);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,y,p.width,p.height,0,y,_,p.data);else if(n.isCompressedTexture)for(var w=0,T=x.length;w<T;w++)b=x[w],n.format!==qt&&n.format!==Yt?i.getCompressedTextureFormats().indexOf(y)>-1&&i.compressedTexImage2D(t.TEXTURE_2D,w,y,b.width,b.height,0,b.data):i.texImage2D(t.TEXTURE_2D,w,y,b.width,b.height,0,y,_,b.data);else if(x.length>0&&v){for(var w=0,T=x.length;w<T;w++)b=x[w],i.texImage2D(t.TEXTURE_2D,w,y,y,_,b);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,y,y,_,p);u(n,v)&&t.generateMipmap(t.TEXTURE_2D);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(p,e,f)}i.activeTexture(t.TEXTURE0+f),i.bindTexture(t.TEXTURE_2D,p.__webglTexture)}function m(i,s,o){var c;if(o?(t.texParameteri(i,t.TEXTURE_WRAP_S,a.convert(s.wrapS)),t.texParameteri(i,t.TEXTURE_WRAP_T,a.convert(s.wrapT)),t.texParameteri(i,t.TEXTURE_MAG_FILTER,a.convert(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,a.convert(s.minFilter))):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s.wrapS!==Et||s.wrapT,t.texParameteri(i,t.TEXTURE_MAG_FILTER,f(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,f(s.minFilter)),s.minFilter!==Mt&&s.minFilter),c=e.get("EXT_texture_filter_anisotropic")){if(s.type===jt&&null===e.get("OES_texture_float_linear"))return;if(s.type===Gt&&null===e.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function v(e,r,s,o){var c=a.convert(r.texture.format),l=a.convert(r.texture.type);i.texImage2D(o,0,c,r.width,r.height,0,c,l,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,s,o,n.get(r.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function y(e,i){t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):i.depthBuffer&&i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,i.width,i.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}function _(e){var i=n.get(e),r=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),g(i.depthTexture,0);var r=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Qt)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0);else{if(i.depthTexture.format!==$t)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0)}}(i.__webglFramebuffer,e)}else if(r){i.__webglDepthbuffer=[];for(var a=0;a<6;a++)t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[a]),i.__webglDepthbuffer[a]=t.createRenderbuffer(),y(i.__webglDepthbuffer[a],e)}else t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),y(i.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}this.setTexture2D=g,this.setTextureCube=function(e,o){var c=n.get(e);if(6===e.image.length)if(e.version>0&&c.__version!==e.version){c.__image__webglTextureCube||(e.addEventListener("dispose",d),c.__image__webglTextureCube=t.createTexture(),s.textures++),i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var f=e&&e.isCompressedTexture,p=e.image[0]&&e.image[0].isDataTexture,g=[],v=0;v<6;v++)g[v]=f||p?p?e.image[v].image:e.image[v]:l(e.image[v],r.maxCubemapSize);var y=h(g[0]),_=a.convert(e.format),b=a.convert(e.type);for(m(t.TEXTURE_CUBE_MAP,e,y),v=0;v<6;v++)if(f)for(var x,S=g[v].mipmaps,w=0,T=S.length;w<T;w++)x=S[w],e.format!==qt&&e.format!==Yt?i.getCompressedTextureFormats().indexOf(_)>-1&&i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,w,_,x.width,x.height,0,x.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,w,_,x.width,x.height,0,_,b,x.data);else p?i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,_,g[v].width,g[v].height,0,_,b,g[v].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,_,_,b,g[v]);u(e,y)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),c.__version=e.version,e.onUpdate&&e.onUpdate(e)}else i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,r){i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,n.get(e).__webglTexture)},this.setupRenderTarget=function(e){var r=n.get(e),a=n.get(e.texture);e.addEventListener("dispose",p),a.__webglTexture=t.createTexture(),s.textures++;var o=!0===e.isWebGLRenderTargetCube,c=h(e);if(o){r.__webglFramebuffer=[];for(var l=0;l<6;l++)r.__webglFramebuffer[l]=t.createFramebuffer()}else r.__webglFramebuffer=t.createFramebuffer();if(o){for(i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture),m(t.TEXTURE_CUBE_MAP,e.texture,c),l=0;l<6;l++)v(r.__webglFramebuffer[l],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+l);u(e.texture,c)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),i.bindTexture(t.TEXTURE_CUBE_MAP,null)}else i.bindTexture(t.TEXTURE_2D,a.__webglTexture),m(t.TEXTURE_2D,e.texture,c),v(r.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),u(e.texture,c)&&t.generateMipmap(t.TEXTURE_2D),i.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&_(e)},this.updateRenderTargetMipmap=function(e){var r=e.texture;if(u(r,h(e))){var a=e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(r).__webglTexture;i.bindTexture(a,s),t.generateMipmap(a),i.bindTexture(a,null)}},this.updateVideoTextures=function(){for(var t in c)c[t].update()}}function Ea(t,e,i,n){Un.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Aa(t){Ea.call(this),this.cameras=t||[]}function Ma(t){var e=this,i=null,n=null,r=null;"undefined"!=typeof window&&"VRFrameData"in window&&(n=new window.VRFrameData);var a=new Oe,s=new Ea;s.bounds=new Fe(0,0,.5,1),s.layers.enable(1);var o=new Ea;o.bounds=new Fe(.5,0,.5,1),o.layers.enable(2);var c,l,h=new Aa([s,o]);function u(){if(null!==i&&i.isPresenting){var n=i.getEyeParameters("left"),r=n.renderWidth,a=n.renderHeight;l=t.getPixelRatio(),c=t.getSize(),t.setDrawingBufferSize(2*r,a,1)}else e.enabled&&t.setDrawingBufferSize(c.width,c.height,l)}h.layers.enable(1),h.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",u,!1),this.enabled=!1,this.getDevice=function(){return i},this.setDevice=function(t){void 0!==t&&(i=t)},this.setPoseTarget=function(t){void 0!==t&&(r=t)},this.getCamera=function(t){if(null===i)return t;i.depthNear=t.near,i.depthFar=t.far,i.getFrameData(n);var e=n.pose,c=null!==r?r:t;if(null!==e.position?c.position.fromArray(e.position):c.position.set(0,0,0),null!==e.orientation&&c.quaternion.fromArray(e.orientation),c.updateMatrixWorld(),!1===i.isPresenting)return t;s.near=t.near,o.near=t.near,s.far=t.far,o.far=t.far,h.matrixWorld.copy(t.matrixWorld),h.matrixWorldInverse.copy(t.matrixWorldInverse),s.matrixWorldInverse.fromArray(n.leftViewMatrix),o.matrixWorldInverse.fromArray(n.rightViewMatrix);var l=c.parent;null!==l&&(a.getInverse(l.matrixWorld),s.matrixWorldInverse.multiply(a),o.matrixWorldInverse.multiply(a)),s.matrixWorld.getInverse(s.matrixWorldInverse),o.matrixWorld.getInverse(o.matrixWorldInverse),s.projectionMatrix.fromArray(n.leftProjectionMatrix),o.projectionMatrix.fromArray(n.rightProjectionMatrix),h.projectionMatrix.copy(s.projectionMatrix);var u=i.getLayers();if(u.length){var f=u[0];null!==f.leftBounds&&4===f.leftBounds.length&&s.bounds.fromArray(f.leftBounds),null!==f.rightBounds&&4===f.rightBounds.length&&o.bounds.fromArray(f.rightBounds)}return h},this.submitFrame=function(){i&&i.isPresenting&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",u)}}function Oa(t,e){return{convert:function(i){var n;if(i===Ct)return t.REPEAT;if(i===Et)return t.CLAMP_TO_EDGE;if(i===At)return t.MIRRORED_REPEAT;if(i===Mt)return t.NEAREST;if(i===Ot)return t.NEAREST_MIPMAP_NEAREST;if(i===Lt)return t.NEAREST_MIPMAP_LINEAR;if(i===Pt)return t.LINEAR;if(i===It)return t.LINEAR_MIPMAP_NEAREST;if(i===Rt)return t.LINEAR_MIPMAP_LINEAR;if(i===Dt)return t.UNSIGNED_BYTE;if(i===zt)return t.UNSIGNED_SHORT_4_4_4_4;if(i===Ht)return t.UNSIGNED_SHORT_5_5_5_1;if(i===Vt)return t.UNSIGNED_SHORT_5_6_5;if(i===Nt)return t.BYTE;if(i===Ut)return t.SHORT;if(i===Ft)return t.UNSIGNED_SHORT;if(i===Bt)return t.INT;if(i===kt)return t.UNSIGNED_INT;if(i===jt)return t.FLOAT;if(i===Gt&&null!==(n=e.get("OES_texture_half_float")))return n.HALF_FLOAT_OES;if(i===Xt)return t.ALPHA;if(i===Yt)return t.RGB;if(i===qt)return t.RGBA;if(i===Kt)return t.LUMINANCE;if(i===Zt)return t.LUMINANCE_ALPHA;if(i===Qt)return t.DEPTH_COMPONENT;if(i===$t)return t.DEPTH_STENCIL;if(i===j)return t.FUNC_ADD;if(i===G)return t.FUNC_SUBTRACT;if(i===z)return t.FUNC_REVERSE_SUBTRACT;if(i===W)return t.ZERO;if(i===X)return t.ONE;if(i===Y)return t.SRC_COLOR;if(i===q)return t.ONE_MINUS_SRC_COLOR;if(i===K)return t.SRC_ALPHA;if(i===Z)return t.ONE_MINUS_SRC_ALPHA;if(i===J)return t.DST_ALPHA;if(i===Q)return t.ONE_MINUS_DST_ALPHA;if(i===$)return t.DST_COLOR;if(i===tt)return t.ONE_MINUS_DST_COLOR;if(i===et)return t.SRC_ALPHA_SATURATE;if((i===te||i===ee||i===ie||i===ne)&&null!==(n=e.get("WEBGL_compressed_texture_s3tc"))){if(i===te)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===ee)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===ie)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===ne)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((i===re||i===ae||i===se||i===oe)&&null!==(n=e.get("WEBGL_compressed_texture_pvrtc"))){if(i===re)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===ae)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===se)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===oe)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===ce&&null!==(n=e.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((i===H||i===V)&&null!==(n=e.get("EXT_blend_minmax"))){if(i===H)return n.MIN_EXT;if(i===V)return n.MAX_EXT}return i===Wt&&null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:0}}}function La(t){var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",h=[],u=[],f=null,d=[],p=[];this.domElement=e,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=pt,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var g,m,v,y,_,b,x,E,A,M,I,R,j,G,z,H,V,W,X,Y=this,q=!1,K=null,Z=null,J=-1,Q="",$=null,tt=null,et=new Fe,ht=new Fe,ut=null,ft=0,dt=e.width,gt=e.height,mt=1,vt=new Fe(0,0,dt,gt),yt=new Fe(0,0,dt,gt),_t=!1,bt=new hn,xt=new function(){var t=this,e=null,i=0,n=!1,r=!1,a=new ln,s=new Ie,o={value:null,needsUpdate:!1};function c(){o.value!==e&&(o.value=e,o.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function l(e,i,n,r){var c=null!==e?e.length:0,l=null;if(0!==c){if(l=o.value,!0!==r||null===l){var h=n+4*c,u=i.matrixWorldInverse;s.getNormalMatrix(u),(null===l||l.length<h)&&(l=new Float32Array(h));for(var f=0,d=n;f!==c;++f,d+=4)a.copy(e[f]).applyMatrix4(u,s),a.normal.toArray(l,d),l[d+3]=a.constant}o.value=l,o.needsUpdate=!0}return t.numPlanes=c,l}this.uniform=o,this.numPlanes=0,this.numIntersection=0,this.init=function(t,r,a){var s=0!==t.length||r||0!==i||n;return n=r,e=l(t,a,0),i=t.length,s},this.beginShadows=function(){r=!0,l(null)},this.endShadows=function(){r=!1,c()},this.setState=function(t,a,s,h,u,f){if(!n||null===t||0===t.length||r&&!s)r?l(null):c();else{var d=r?0:i,p=4*d,g=u.clippingState||null;o.value=g,g=l(t,h,p,f);for(var m=0;m!==p;++m)g[m]=e[m];u.clippingState=g,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=d}}},St=!1,wt=!1,Tt=new Oe,Ct=new Pe,Et={geometries:0,textures:0},At={frame:0,calls:0,vertices:0,faces:0,points:0};function Mt(){return null===K?mt:1}this.info={render:At,memory:Et,programs:null};try{var Ot={alpha:n,depth:r,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:c,powerPreference:l};if(e.addEventListener("webglcontextlost",Rt,!1),e.addEventListener("webglcontextrestored",Nt,!1),null===(g=i||e.getContext("webgl",Ot)||e.getContext("experimental-webgl",Ot)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===g.getShaderPrecisionFormat&&(g.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){}function Lt(){(m=new function(t){var e={};return{get:function(i){if(void 0!==e[i])return e[i];var n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=t.getExtension("WEBGL_compressed_texture_etc1");break;default:n=t.getExtension(i)}return e[i]=n,n}}}(g)).get("WEBGL_depth_texture"),m.get("OES_texture_float"),m.get("OES_texture_float_linear"),m.get("OES_texture_half_float"),m.get("OES_texture_half_float_linear"),m.get("OES_standard_derivatives"),m.get("OES_element_index_uint"),m.get("ANGLE_instanced_arrays"),X=new Oa(g,m),v=new function(t,e,i){var n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a=void 0!==i.precision?i.precision:"highp",s=r(a);s!==a&&(a=s);var o=!0===i.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),l=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_TEXTURE_SIZE),u=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),d=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),p=t.getParameter(t.MAX_VARYING_VECTORS),g=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),m=l>0,v=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==n)return n;var i=e.get("EXT_texture_filter_anisotropic");return n=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:o,maxTextures:c,maxVertexTextures:l,maxTextureSize:h,maxCubemapSize:u,maxAttributes:f,maxVertexUniforms:d,maxVaryings:p,maxFragmentUniforms:g,vertexTextures:m,floatFragmentTextures:v,floatVertexTextures:m&&v}}(g,m,t),(y=new function(t,e,i){var n=new function(){var e=!1,i=new Fe,n=null,r=new Fe(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,a,s,o){!0===o&&(e*=s,n*=s,a*=s),i.set(e,n,a,s),!1===r.equals(i)&&(t.clearColor(e,n,a,s),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},r=new function(){var e=!1,i=null,n=null,r=null;return{setTest:function(e){e?X(t.DEPTH_TEST):Y(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case it:t.depthFunc(t.NEVER);break;case nt:t.depthFunc(t.ALWAYS);break;case rt:t.depthFunc(t.LESS);break;case at:t.depthFunc(t.LEQUAL);break;case st:t.depthFunc(t.EQUAL);break;case ot:t.depthFunc(t.GEQUAL);break;case ct:t.depthFunc(t.GREATER);break;case lt:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},a=new function(){var e=!1,i=null,n=null,r=null,a=null,s=null,o=null,c=null,l=null;return{setTest:function(e){e?X(t.STENCIL_TEST):Y(t.STENCIL_TEST)},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,s){n===e&&r===i&&a===s||(t.stencilFunc(e,i,s),n=e,r=i,a=s)},setOp:function(e,i,n){s===e&&o===i&&c===n||(t.stencilOp(e,i,n),s=e,o=i,c=n)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,i=null,n=null,r=null,a=null,s=null,o=null,c=null,l=null}}},s=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=new Uint8Array(s),c=new Uint8Array(s),l=new Uint8Array(s),h={},u=null,f=null,d=null,p=null,g=null,m=null,v=null,y=null,_=null,b=!1,x=null,C=null,E=null,A=null,M=null,P=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),I=parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),R=parseFloat(I)>=1,j=null,G={},z=new Fe,H=new Fe;function V(e,i,n){var r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var s=0;s<n;s++)t.texImage2D(i+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return a}var W={};function X(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function Y(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}function q(e,n,r,a,s,o,c,l){if(e!==D?X(t.BLEND):Y(t.BLEND),e!==k){if(e!==d||l!==b)switch(e){case U:l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE));break;case F:l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR));break;case B:l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR));break;default:l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA))}p=null,g=null,m=null,v=null,y=null,_=null}else s=s||n,o=o||r,c=c||a,n===p&&s===v||(t.blendEquationSeparate(i.convert(n),i.convert(s)),p=n,v=s),r===g&&a===m&&o===y&&c===_||(t.blendFuncSeparate(i.convert(r),i.convert(a),i.convert(o),i.convert(c)),g=r,m=a,y=o,_=c);d=e,b=l}function K(e){x!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),x=e)}function Z(e){e!==S?(X(t.CULL_FACE),e!==C&&(e===w?t.cullFace(t.BACK):e===T?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):Y(t.CULL_FACE),C=e}function J(e,i,n){e?(X(t.POLYGON_OFFSET_FILL),A===i&&M===n||(t.polygonOffset(i,n),A=i,M=n)):Y(t.POLYGON_OFFSET_FILL)}function Q(e){void 0===e&&(e=t.TEXTURE0+P-1),j!==e&&(t.activeTexture(e),j=e)}return W[t.TEXTURE_2D]=V(t.TEXTURE_2D,t.TEXTURE_2D,1),W[t.TEXTURE_CUBE_MAP]=V(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),r.setClear(1),a.setClear(0),X(t.DEPTH_TEST),r.setFunc(at),K(!1),Z(w),X(t.CULL_FACE),X(t.BLEND),q(N),{buffers:{color:n,depth:r,stencil:a},initAttributes:function(){for(var t=0,e=o.length;t<e;t++)o[t]=0},enableAttribute:function(i){o[i]=1,0===c[i]&&(t.enableVertexAttribArray(i),c[i]=1),0!==l[i]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),l[i]=0)},enableAttributeAndDivisor:function(i,n){o[i]=1,0===c[i]&&(t.enableVertexAttribArray(i),c[i]=1),l[i]!==n&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,n),l[i]=n)},disableUnusedAttributes:function(){for(var e=0,i=c.length;e!==i;++e)c[e]!==o[e]&&(t.disableVertexAttribArray(e),c[e]=0)},enable:X,disable:Y,getCompressedTextureFormats:function(){if(null===u&&(u=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var i=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<i.length;n++)u.push(i[n]);return u},useProgram:function(e){return f!==e&&(t.useProgram(e),f=e,!0)},setBlending:q,setMaterial:function(e,i){e.side===L?Y(t.CULL_FACE):X(t.CULL_FACE);var a=e.side===O;i&&(a=!a),K(a),!0===e.transparent?q(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):q(D),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),n.setMask(e.colorWrite),J(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:K,setCullFace:Z,setLineWidth:function(e){e!==E&&(R&&t.lineWidth(e),E=e)},setPolygonOffset:J,setScissorTest:function(e){e?X(t.SCISSOR_TEST):Y(t.SCISSOR_TEST)},activeTexture:Q,bindTexture:function(e,i){null===j&&Q();var n=G[j];void 0===n&&(n={type:void 0,texture:void 0},G[j]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||W[e]),n.type=e,n.texture=i)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){}},scissor:function(e){!1===z.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),z.copy(e))},viewport:function(e){!1===H.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),H.copy(e))},reset:function(){for(var e=0;e<c.length;e++)1===c[e]&&(t.disableVertexAttribArray(e),c[e]=0);h={},u=null,j=null,G={},f=null,d=null,x=null,C=null,n.reset(),r.reset(),a.reset()}}}(g,m,X)).scissor(ht.copy(yt).multiplyScalar(mt)),y.viewport(et.copy(vt).multiplyScalar(mt)),_=new function(){var t={};return{get:function(e){var i=e.uuid,n=t[i];return void 0===n&&(n={},t[i]=n),n},remove:function(e){delete t[e.uuid]},clear:function(){t={}}}},b=new Ca(g,m,y,_,v,X,Et),x=new fn(g),E=new function(t,e,i){var n={},r={};function a(t){var s=t.target,o=n[s.id];for(var c in null!==o.index&&e.remove(o.index),o.attributes)e.remove(o.attributes[c]);s.removeEventListener("dispose",a),delete n[s.id];var l=r[s.id];l&&(e.remove(l),delete r[s.id]),(l=r[o.id])&&(e.remove(l),delete r[o.id]),i.geometries--}return{get:function(t,e){var r=n[e.id];return r||(e.addEventListener("dispose",a),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new kr).setFromObject(t)),r=e._bufferGeometry),n[e.id]=r,i.geometries++,r)},update:function(i){var n=i.index,r=i.attributes;for(var a in null!==n&&e.update(n,t.ELEMENT_ARRAY_BUFFER),r)e.update(r[a],t.ARRAY_BUFFER);var s=i.morphAttributes;for(var a in s)for(var o=s[a],c=0,l=o.length;c<l;c++)e.update(o[c],t.ARRAY_BUFFER)},getWireframeAttribute:function(i){var n=r[i.id];if(n)return n;var a,s=[],o=i.index,c=i.attributes;if(null!==o)for(var l=0,h=(a=o.array).length;l<h;l+=3){var u=a[l+0],f=a[l+1],d=a[l+2];s.push(u,f,f,d,d,u)}else for(l=0,h=(a=c.position.array).length/3-1;l<h;l+=3)u=l+0,f=l+1,d=l+2,s.push(u,f,f,d,d,u);return n=new(rr(s)>65535?tr:Qn)(s,1),e.update(n,t.ELEMENT_ARRAY_BUFFER),r[i.id]=n,n}}}(g,x,Et),A=new function(t,e){var i={};return{update:function(n){var r=e.frame,a=n.geometry,s=t.get(n,a);return i[s.id]!==r&&(a.isGeometry&&s.updateFromObject(n),t.update(s),i[s.id]=r),s},clear:function(){i={}}}}(E,At),G=new function(t){var e={},i=new Float32Array(8);return{update:function(n,r,a,s){var o=n.morphTargetInfluences,c=o.length,l=e[r.id];if(void 0===l){l=[];for(var h=0;h<c;h++)l[h]=[h,0];e[r.id]=l}var u=a.morphTargets&&r.morphAttributes.position,f=a.morphNormals&&r.morphAttributes.normal;for(h=0;h<c;h++)0!==(d=l[h])[1]&&(u&&r.removeAttribute("morphTarget"+h),f&&r.removeAttribute("morphNormal"+h));for(h=0;h<c;h++)(d=l[h])[0]=h,d[1]=o[h];for(l.sort($r),h=0;h<8;h++){var d;if(d=l[h]){var p=d[0],g=d[1];if(g){u&&r.addAttribute("morphTarget"+h,u[p]),f&&r.addAttribute("morphNormal"+h,f[p]),i[h]=g;continue}}i[h]=0}s.getUniforms().setValue(t,"morphTargetInfluences",i)}}}(g),I=new Ta(Y,m,v),M=new ta,R=new Qr,j=new function(t,e,i,n){var r,a,s,o=new Mi(0),c=0;function l(t,i){e.buffers.color.setClear(t.r,t.g,t.b,i,n)}return{getClearColor:function(){return o},setClearColor:function(t,e){o.set(t),l(o,c=void 0!==e?e:1)},getClearAlpha:function(){return c},setClearAlpha:function(t){l(o,c=t)},render:function(e,n,h,u){var f=n.background;null===f?l(o,c):f&&f.isColor&&(l(f,1),u=!0),(t.autoClear||u)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&f.isCubeTexture?(void 0===s&&((s=new Kr(new Gr(1,1,1),new Wr({uniforms:Di.cube.uniforms,vertexShader:Di.cube.vertexShader,fragmentShader:Di.cube.fragmentShader,side:O,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},i.update(s.geometry)),s.material.uniforms.tCube.value=f,e.push(s,s.geometry,s.material,0,null)):f&&f.isTexture&&(void 0===r&&(r=new Fn(-1,1,1,-1,0,1),a=new Kr(new Hr(2,2),new Vr({depthTest:!1,depthWrite:!1,fog:!1})),i.update(a.geometry)),a.material.map=f,t.renderBufferDirect(r,null,a.geometry,a.material,a,null))}}}(Y,y,E,o),z=new function(t,e,i){var n;this.setMode=function(t){n=t},this.render=function(e,r){t.drawArrays(n,e,r),i.calls++,i.vertices+=r,n===t.TRIANGLES?i.faces+=r/3:n===t.POINTS&&(i.points+=r)},this.renderInstances=function(r,a,s){var o=e.get("ANGLE_instanced_arrays");if(null!==o){var c=r.attributes.position;c.isInterleavedBufferAttribute?(s=c.data.count,o.drawArraysInstancedANGLE(n,0,s,r.maxInstancedCount)):o.drawArraysInstancedANGLE(n,a,s,r.maxInstancedCount),i.calls++,i.vertices+=s*r.maxInstancedCount,n===t.TRIANGLES?i.faces+=r.maxInstancedCount*s/3:n===t.POINTS&&(i.points+=r.maxInstancedCount*s)}}}(g,m,At),H=new function(t,e,i){var n,r,a;this.setMode=function(t){n=t},this.setIndex=function(t){r=t.type,a=t.bytesPerElement},this.render=function(e,s){t.drawElements(n,s,r,e*a),i.calls++,i.vertices+=s,n===t.TRIANGLES?i.faces+=s/3:n===t.POINTS&&(i.points+=s)},this.renderInstances=function(s,o,c){var l=e.get("ANGLE_instanced_arrays");null!==l&&(l.drawElementsInstancedANGLE(n,c,r,o*a,s.maxInstancedCount),i.calls++,i.vertices+=c*s.maxInstancedCount,n===t.TRIANGLES?i.faces+=s.maxInstancedCount*c/3:n===t.POINTS&&(i.points+=s.maxInstancedCount*c))}}(g,m,At),V=new Ui(Y,g,y,b,v),W=new Bi(Y,g,y,b,v),Y.info.programs=I.programs,Y.context=g,Y.capabilities=v,Y.extensions=m,Y.properties=_,Y.renderLists=R,Y.state=y}Lt();var Pt=new Ma(Y);this.vr=Pt;var It=new un(Y,A,v.maxTextureSize);function Rt(t){t.preventDefault(),q=!0}function Nt(){q=!1,Lt()}function Ut(t){var e,i=t.target;i.removeEventListener("dispose",Ut),Ft(e=i),_.remove(e)}function Ft(t){var e=_.get(t).program;t.program=void 0,void 0!==e&&I.releaseProgram(e)}this.shadowMap=It,this.getContext=function(){return g},this.getContextAttributes=function(){return g.getContextAttributes()},this.forceContextLoss=function(){var t=m.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=m.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return mt},this.setPixelRatio=function(t){void 0!==t&&(mt=t,this.setSize(dt,gt,!1))},this.getSize=function(){return{width:dt,height:gt}},this.setSize=function(t,i,n){var r=Pt.getDevice();r&&r.isPresenting||(dt=t,gt=i,e.width=t*mt,e.height=i*mt,!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(){return{width:dt*mt,height:gt*mt}},this.setDrawingBufferSize=function(t,i,n){dt=t,gt=i,mt=n,e.width=t*n,e.height=i*n,this.setViewport(0,0,t,i)},this.setViewport=function(t,e,i,n){vt.set(t,gt-e-n,i,n),y.viewport(et.copy(vt).multiplyScalar(mt))},this.setScissor=function(t,e,i,n){yt.set(t,gt-e-n,i,n),y.scissor(ht.copy(yt).multiplyScalar(mt))},this.setScissorTest=function(t){y.setScissorTest(_t=t)},this.getClearColor=function(){return j.getClearColor()},this.setClearColor=function(){j.setClearColor.apply(j,arguments)},this.getClearAlpha=function(){return j.getClearAlpha()},this.setClearAlpha=function(){j.setClearAlpha.apply(j,arguments)},this.clear=function(t,e,i){var n=0;(void 0===t||t)&&(n|=g.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=g.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=g.STENCIL_BUFFER_BIT),g.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,i,n){this.setRenderTarget(t),this.clear(e,i,n)},this.dispose=function(){e.removeEventListener("webglcontextlost",Rt,!1),e.removeEventListener("webglcontextrestored",Nt,!1),R.dispose(),Pt.dispose()},this.renderBufferImmediate=function(t,e,i){y.initAttributes();var n=_.get(t);t.hasPositions&&!n.position&&(n.position=g.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=g.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=g.createBuffer()),t.hasColors&&!n.color&&(n.color=g.createBuffer());var r=e.getAttributes();if(t.hasPositions&&(g.bindBuffer(g.ARRAY_BUFFER,n.position),g.bufferData(g.ARRAY_BUFFER,t.positionArray,g.DYNAMIC_DRAW),y.enableAttribute(r.position),g.vertexAttribPointer(r.position,3,g.FLOAT,!1,0,0)),t.hasNormals){if(g.bindBuffer(g.ARRAY_BUFFER,n.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&!0===i.flatShading)for(var a=0,s=3*t.count;a<s;a+=9){var o=t.normalArray,c=(o[a+0]+o[a+3]+o[a+6])/3,l=(o[a+1]+o[a+4]+o[a+7])/3,h=(o[a+2]+o[a+5]+o[a+8])/3;o[a+0]=c,o[a+1]=l,o[a+2]=h,o[a+3]=c,o[a+4]=l,o[a+5]=h,o[a+6]=c,o[a+7]=l,o[a+8]=h}g.bufferData(g.ARRAY_BUFFER,t.normalArray,g.DYNAMIC_DRAW),y.enableAttribute(r.normal),g.vertexAttribPointer(r.normal,3,g.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(g.bindBuffer(g.ARRAY_BUFFER,n.uv),g.bufferData(g.ARRAY_BUFFER,t.uvArray,g.DYNAMIC_DRAW),y.enableAttribute(r.uv),g.vertexAttribPointer(r.uv,2,g.FLOAT,!1,0,0)),t.hasColors&&i.vertexColors!==P&&(g.bindBuffer(g.ARRAY_BUFFER,n.color),g.bufferData(g.ARRAY_BUFFER,t.colorArray,g.DYNAMIC_DRAW),y.enableAttribute(r.color),g.vertexAttribPointer(r.color,3,g.FLOAT,!1,0,0)),y.disableUnusedAttributes(),g.drawArrays(g.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,n,r,a){var s=r.isMesh&&r.matrixWorld.determinant()<0;y.setMaterial(n,s);var o=Zt(t,e,n,r),c=i.id+"_"+o.id+"_"+(!0===n.wireframe),l=!1;c!==Q&&(Q=c,l=!0),r.morphTargetInfluences&&(G.update(r,i,n,o),l=!0);var h,u=i.index,f=i.attributes.position,d=1;!0===n.wireframe&&(u=E.getWireframeAttribute(i),d=2);var p=z;null!==u&&(h=x.get(u),(p=H).setIndex(h)),l&&(!function(t,e,i,n){if(i&&i.isInstancedBufferGeometry&&null===m.get("ANGLE_instanced_arrays"))return;void 0===n&&(n=0);y.initAttributes();var r=i.attributes,a=e.getAttributes(),s=t.defaultAttributeValues;for(var o in a){var c=a[o];if(c>=0){var l=r[o];if(void 0!==l){var h=l.normalized,u=l.itemSize,f=x.get(l);if(void 0===f)continue;var d=f.buffer,p=f.type,v=f.bytesPerElement;if(l.isInterleavedBufferAttribute){var _=l.data,b=_.stride,S=l.offset;_&&_.isInstancedInterleavedBuffer?(y.enableAttributeAndDivisor(c,_.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=_.meshPerAttribute*_.count)):y.enableAttribute(c),g.bindBuffer(g.ARRAY_BUFFER,d),g.vertexAttribPointer(c,u,p,h,b*v,(n*b+S)*v)}else l.isInstancedBufferAttribute?(y.enableAttributeAndDivisor(c,l.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=l.meshPerAttribute*l.count)):y.enableAttribute(c),g.bindBuffer(g.ARRAY_BUFFER,d),g.vertexAttribPointer(c,u,p,h,0,n*u*v)}else if(void 0!==s){var w=s[o];if(void 0!==w)switch(w.length){case 2:g.vertexAttrib2fv(c,w);break;case 3:g.vertexAttrib3fv(c,w);break;case 4:g.vertexAttrib4fv(c,w);break;default:g.vertexAttrib1fv(c,w)}}}}y.disableUnusedAttributes()}(n,o,i),null!==u&&g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h.buffer));var v=0;null!==u?v=u.count:void 0!==f&&(v=f.count);var _=i.drawRange.start*d,b=i.drawRange.count*d,S=null!==a?a.start*d:0,w=null!==a?a.count*d:1/0,T=Math.max(_,S),C=Math.min(v,_+b,S+w)-1,A=Math.max(0,C-T+1);if(0!==A){if(r.isMesh)if(!0===n.wireframe)y.setLineWidth(n.wireframeLinewidth*Mt()),p.setMode(g.LINES);else switch(r.drawMode){case ge:p.setMode(g.TRIANGLES);break;case me:p.setMode(g.TRIANGLE_STRIP);break;case ve:p.setMode(g.TRIANGLE_FAN)}else if(r.isLine){var M=n.linewidth;void 0===M&&(M=1),y.setLineWidth(M*Mt()),r.isLineSegments?p.setMode(g.LINES):r.isLineLoop?p.setMode(g.LINE_LOOP):p.setMode(g.LINE_STRIP)}else r.isPoints&&p.setMode(g.POINTS);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&p.renderInstances(i,T,A):p.render(T,A)}},this.compile=function(t,e){h.length=0,u.length=0,t.traverse(function(t){t.isLight&&(h.push(t),t.castShadow&&u.push(t))}),M.setup(h,u,e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var i=0;i<e.material.length;i++)Kt(e.material[i],t.fog,e);else Kt(e.material,t.fog,e)})};var Bt,kt,zt,Ht=!1,Vt=null;function Wt(t){null!==Vt&&Vt(t);var e=Pt.getDevice();e&&e.isPresenting?e.requestAnimationFrame(Wt):window.requestAnimationFrame(Wt)}function Xt(t,e,i,n){for(var r=0,a=t.length;r<a;r++){var s=t[r],o=s.object,c=s.geometry,l=void 0===n?s.material:n,h=s.group;if(i.isArrayCamera){tt=i;for(var u=i.cameras,f=0,d=u.length;f<d;f++){var p=u[f];if(o.layers.test(p.layers)){var g=p.bounds,m=g.x*dt,v=g.y*gt,_=g.z*dt,b=g.w*gt;y.viewport(et.set(m,v,_,b).multiplyScalar(mt)),Yt(o,e,p,c,l,h)}}}else tt=null,Yt(o,e,i,c,l,h)}}function Yt(t,e,i,n,r,a){if(t.onBeforeRender(Y,e,i,n,r,a),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var s=t.isMesh&&t.matrixWorld.determinant()<0;y.setMaterial(r,s);var o=Zt(i,e.fog,r,t);Q="",c=o,l=r,t.render(function(t){Y.renderBufferImmediate(t,c,l)})}else Y.renderBufferDirect(i,e.fog,n,r,t,a);var c,l;t.onAfterRender(Y,e,i,n,r,a)}function Kt(t,e,i){var n=_.get(t),r=I.getParameters(t,M.state,u,e,xt.numPlanes,xt.numIntersection,i),a=I.getProgramCode(t,r),s=n.program,o=!0;if(void 0===s)t.addEventListener("dispose",Ut);else if(s.code!==a)Ft(t);else{if(void 0!==r.shaderID)return;o=!1}if(o){if(r.shaderID){var c=Di[r.shaderID];n.shader={name:t.type,uniforms:Ii.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader),s=I.acquireProgram(t,n.shader,r,a),n.program=s,t.program=s}var l=s.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var h=0;h<Y.maxMorphTargets;h++)l["morphTarget"+h]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(h=0;h<Y.maxMorphNormals;h++)l["morphNormal"+h]>=0&&t.numSupportedMorphNormals++}var f=n.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=xt.numPlanes,n.numIntersection=xt.numIntersection,f.clippingPlanes=xt.uniform),n.fog=e,n.lightsHash=M.state.hash,t.lights&&(f.ambientLightColor.value=M.state.ambient,f.directionalLights.value=M.state.directional,f.spotLights.value=M.state.spot,f.rectAreaLights.value=M.state.rectArea,f.pointLights.value=M.state.point,f.hemisphereLights.value=M.state.hemi,f.directionalShadowMap.value=M.state.directionalShadowMap,f.directionalShadowMatrix.value=M.state.directionalShadowMatrix,f.spotShadowMap.value=M.state.spotShadowMap,f.spotShadowMatrix.value=M.state.spotShadowMatrix,f.pointShadowMap.value=M.state.pointShadowMap,f.pointShadowMatrix.value=M.state.pointShadowMatrix);var d=n.program.getUniforms(),p=Ei.seqWithValue(d.seq,f);n.uniformsList=p}function Zt(t,e,i,n){ft=0;var r=_.get(i);if(St&&(wt||t!==$)){var a=t===$&&i.id===J;xt.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,r,a)}!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==e?i.needsUpdate=!0:i.lights&&r.lightsHash!==M.state.hash?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===xt.numPlanes&&r.numIntersection===xt.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(Kt(i,e,n),i.needsUpdate=!1);var s,o,c,l,h,u,f,d,p,m,b,x,S,w,T,C,E=!1,A=!1,O=!1,L=r.program,P=L.getUniforms(),I=r.shader.uniforms;if(y.useProgram(L.program)&&(E=!0,A=!0,O=!0),i.id!==J&&(J=i.id,A=!0),E||t!==$){if(P.setValue(g,"projectionMatrix",t.projectionMatrix),v.logarithmicDepthBuffer&&P.setValue(g,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),$!==(tt||t)&&($=tt||t,A=!0,O=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var R=P.map.cameraPosition;void 0!==R&&R.setValue(g,Ct.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&P.setValue(g,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){P.setOptional(g,n,"bindMatrix"),P.setOptional(g,n,"bindMatrixInverse");var D=n.skeleton;if(D){var N=D.bones;if(v.floatVertexTextures){if(void 0===D.boneTexture){var U=Math.sqrt(4*N.length);U=Ae.ceilPowerOfTwo(U),U=Math.max(U,4);var F=new Float32Array(U*U*4);F.set(D.boneMatrices);var B=new je(F,U,U,qt,jt);D.boneMatrices=F,D.boneTexture=B,D.boneTextureSize=U}P.setValue(g,"boneTexture",D.boneTexture),P.setValue(g,"boneTextureSize",D.boneTextureSize)}else P.setOptional(g,D,"boneMatrices")}}return A&&(P.setValue(g,"toneMappingExposure",Y.toneMappingExposure),P.setValue(g,"toneMappingWhitePoint",Y.toneMappingWhitePoint),i.lights&&(C=O,(T=I).ambientLightColor.needsUpdate=C,T.directionalLights.needsUpdate=C,T.pointLights.needsUpdate=C,T.spotLights.needsUpdate=C,T.rectAreaLights.needsUpdate=C,T.hemisphereLights.needsUpdate=C),e&&i.fog&&(w=e,(S=I).fogColor.value=w.color,w.isFog?(S.fogNear.value=w.near,S.fogFar.value=w.far):w.isFogExp2&&(S.fogDensity.value=w.density)),i.isMeshBasicMaterial?Jt(I,i):i.isMeshLambertMaterial?(Jt(I,i),b=I,(x=i).emissiveMap&&(b.emissiveMap.value=x.emissiveMap)):i.isMeshPhongMaterial?(Jt(I,i),i.isMeshToonMaterial?(Qt(p=I,m=i),m.gradientMap&&(p.gradientMap.value=m.gradientMap)):Qt(I,i)):i.isMeshStandardMaterial?(Jt(I,i),i.isMeshPhysicalMaterial?(d=i,(f=I).clearCoat.value=d.clearCoat,f.clearCoatRoughness.value=d.clearCoatRoughness,$t(f,d)):$t(I,i)):i.isMeshDepthMaterial?(Jt(I,i),h=I,(u=i).displacementMap&&(h.displacementMap.value=u.displacementMap,h.displacementScale.value=u.displacementScale,h.displacementBias.value=u.displacementBias)):i.isMeshDistanceMaterial?(Jt(I,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(I,i)):i.isMeshNormalMaterial?(Jt(I,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(I,i)):i.isLineBasicMaterial?(l=i,(c=I).diffuse.value=l.color,c.opacity.value=l.opacity,i.isLineDashedMaterial&&(o=i,(s=I).dashSize.value=o.dashSize,s.totalSize.value=o.dashSize+o.gapSize,s.scale.value=o.scale)):i.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*mt,t.scale.value=.5*gt,t.map.value=e.map,null!==e.map){if(!0===e.map.matrixAutoUpdate){var i=e.map.offset,n=e.map.repeat,r=e.map.rotation,a=e.map.center;e.map.matrix.setUvTransform(i.x,i.y,n.x,n.y,r,a.x,a.y)}t.uvTransform.value.copy(e.map.matrix)}}(I,i):i.isShadowMaterial&&(I.color.value=i.color,I.opacity.value=i.opacity),void 0!==I.ltcMat&&(I.ltcMat.value=Pi.LTC_MAT_TEXTURE),void 0!==I.ltcMag&&(I.ltcMag.value=Pi.LTC_MAG_TEXTURE),Ei.upload(g,r.uniformsList,I,Y)),P.setValue(g,"modelViewMatrix",n.modelViewMatrix),P.setValue(g,"normalMatrix",n.normalMatrix),P.setValue(g,"modelMatrix",n.matrixWorld),L}function Jt(t,e){var i;if(t.opacity.value=e.opacity,e.color&&(t.diffuse.value=e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap),void 0!==i){if(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate){var n=i.offset,r=i.repeat,a=i.rotation,s=i.center;i.matrix.setUvTransform(n.x,n.y,r.x,r.y,a,s.x,s.y)}t.uvTransform.value.copy(i.matrix)}}function Qt(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function $t(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}this.animate=function(t){Vt=t,function(){if(!Ht){var t=Pt.getDevice();t&&t.isPresenting?t.requestAnimationFrame(Wt):window.requestAnimationFrame(Wt),Ht=!0}}()},this.render=function(t,e,i,n){if(e&&e.isCamera&&!q){Q="",J=-1,$=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),Pt.enabled&&(e=Pt.getCamera(e)),Tt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),bt.setFromMatrix(Tt),h.length=0,u.length=0,d.length=0,p.length=0,wt=this.localClippingEnabled,St=xt.init(this.clippingPlanes,wt,e),(f=R.get(t,e)).init(),function t(e,i,n){if(!1===e.visible)return;var r=e.layers.test(i.layers);if(r)if(e.isLight)h.push(e),e.castShadow&&u.push(e);else if(e.isSprite)e.frustumCulled&&!bt.intersectsSprite(e)||d.push(e);else if(e.isLensFlare)p.push(e);else if(e.isImmediateRenderObject)n&&Ct.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Tt),f.push(e,null,e.material,Ct.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||bt.intersectsObject(e))){n&&Ct.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Tt);var a=A.update(e),s=e.material;if(Array.isArray(s))for(var o=a.groups,c=0,l=o.length;c<l;c++){var g=o[c],m=s[g.materialIndex];m&&m.visible&&f.push(e,a,m,Ct.z,g)}else s.visible&&f.push(e,a,s,Ct.z,null)}var v=e.children;for(var c=0,l=v.length;c<l;c++)t(v[c],i,n)}(t,e,Y.sortObjects),!0===Y.sortObjects&&f.sort(),b.updateVideoTextures(),St&&xt.beginShadows(),It.render(u,t,e),M.setup(h,u,e),St&&xt.endShadows(),At.frame++,At.calls=0,At.vertices=0,At.faces=0,At.points=0,void 0===i&&(i=null),this.setRenderTarget(i),j.render(f,t,e,n);var r=f.opaque,a=f.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;r.length&&Xt(r,t,e,s),a.length&&Xt(a,t,e,s)}else r.length&&Xt(r,t,e),a.length&&Xt(a,t,e);W.render(d,t,e),V.render(p,t,e,et),i&&b.updateRenderTargetMipmap(i),y.buffers.depth.setTest(!0),y.buffers.depth.setMask(!0),y.buffers.color.setMask(!0),y.setPolygonOffset(!1),Pt.enabled&&Pt.submitFrame()}},this.setFaceCulling=function(t,e){y.setCullFace(t),y.setFlipSided(e===C)},this.allocTextureUnit=function(){var t=ft;return v.maxTextures,ft+=1,t},this.setTexture2D=(Bt=!1,function(t,e){t&&t.isWebGLRenderTarget&&(Bt||(Bt=!0),t=t.texture),b.setTexture2D(t,e)}),this.setTexture=(kt=!1,function(t,e){kt||(kt=!0),b.setTexture2D(t,e)}),this.setTextureCube=(zt=!1,function(t,e){t&&t.isWebGLRenderTargetCube&&(zt||(zt=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?b.setTextureCube(t,e):b.setTextureCubeDynamic(t,e)}),this.getRenderTarget=function(){return K},this.setRenderTarget=function(t){K=t,t&&void 0===_.get(t).__webglFramebuffer&&b.setupRenderTarget(t);var e=null,i=!1;if(t){var n=_.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(e=n[t.activeCubeFace],i=!0):e=n,et.copy(t.viewport),ht.copy(t.scissor),ut=t.scissorTest}else et.copy(vt).multiplyScalar(mt),ht.copy(yt).multiplyScalar(mt),ut=_t;if(Z!==e&&(g.bindFramebuffer(g.FRAMEBUFFER,e),Z=e),y.viewport(et),y.scissor(ht),y.setScissorTest(ut),i){var r=_.get(t.texture);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,i,n,r,a){if(t&&t.isWebGLRenderTarget){var s=_.get(t).__webglFramebuffer;if(s){var o=!1;s!==Z&&(g.bindFramebuffer(g.FRAMEBUFFER,s),o=!0);try{var c=t.texture,l=c.format,h=c.type;if(l!==qt&&X.convert(l)!==g.getParameter(g.IMPLEMENTATION_COLOR_READ_FORMAT))return;if(!(h===Dt||X.convert(h)===g.getParameter(g.IMPLEMENTATION_COLOR_READ_TYPE)||h===jt&&(m.get("OES_texture_float")||m.get("WEBGL_color_buffer_float"))||h===Gt&&m.get("EXT_color_buffer_half_float")))return;g.checkFramebufferStatus(g.FRAMEBUFFER)===g.FRAMEBUFFER_COMPLETE&&e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&g.readPixels(e,i,n,r,X.convert(l),X.convert(h),a)}finally{o&&g.bindFramebuffer(g.FRAMEBUFFER,Z)}}}}}function Pa(t,e){this.name="",this.color=new Mi(t),this.density=void 0!==e?e:25e-5}function Ia(t,e,i){this.name="",this.color=new Mi(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}function Ra(){Nn.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Da(t,e,i,n,r){Nn.call(this),this.lensFlares=[],this.positionScreen=new Pe,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,i,n,r)}function Na(t){rn.call(this),this.type="SpriteMaterial",this.color=new Mi(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Ua(t){Nn.call(this),this.type="Sprite",this.material=void 0!==t?t:new Na}function Fa(){Nn.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Ba(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{this.boneInverses=[];for(var i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new Oe)}}function ka(){Nn.call(this),this.type="Bone"}function ja(t,e){Kr.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Oe,this.bindMatrixInverse=new Oe;var i=new Ba(this.initBones());this.bind(i,this.matrixWorld),this.normalizeSkinWeights()}function Ga(t){rn.call(this),this.type="LineBasicMaterial",this.color=new Mi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function za(t,e,i){if(1===i)return new Ha(t,e);Nn.call(this),this.type="Line",this.geometry=void 0!==t?t:new kr,this.material=void 0!==e?e:new Ga({color:16777215*Math.random()})}function Ha(t,e){za.call(this,t,e),this.type="LineSegments"}function Va(t,e){za.call(this,t,e),this.type="LineLoop"}function Wa(t){rn.call(this),this.type="PointsMaterial",this.color=new Mi(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function Xa(t,e){Nn.call(this),this.type="Points",this.geometry=void 0!==t?t:new kr,this.material=void 0!==e?e:new Wa({color:16777215*Math.random()})}function Ya(){Nn.call(this),this.type="Group"}function qa(t,e,i,n,r,a,s,o,c){Ue.call(this,t,e,i,n,r,a,s,o,c),this.generateMipmaps=!1;var l=this;t.addEventListener("loadeddata",function e(){t.removeEventListener("loadeddata",e,!1),l.needsUpdate=!0},!1)}function Ka(t,e,i,n,r,a,s,o,c,l,h,u){Ue.call(this,null,a,s,o,c,l,n,r,h,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Za(t,e,i,n,r,a,s,o,c,l){if((l=void 0!==l?l:Qt)!==Qt&&l!==$t)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&l===Qt&&(i=Ft),void 0===i&&l===$t&&(i=Wt),Ue.call(this,null,n,r,a,s,o,l,i,c),this.image={width:t,height:e},this.magFilter=void 0!==s?s:Mt,this.minFilter=void 0!==o?o:Mt,this.flipY=!1,this.generateMipmaps=!1}function Ja(t){kr.call(this),this.type="WireframeGeometry";var e,i,n,r,a,s,o,c,l,h,u=[],f=[0,0],d={},p=["a","b","c"];if(t&&t.isGeometry){var g=t.faces;for(e=0,n=g.length;e<n;e++){var m=g[e];for(i=0;i<3;i++)o=m[p[i]],c=m[p[(i+1)%3]],f[0]=Math.min(o,c),f[1]=Math.max(o,c),void 0===d[l=f[0]+","+f[1]]&&(d[l]={index1:f[0],index2:f[1]})}for(l in d)s=d[l],h=t.vertices[s.index1],u.push(h.x,h.y,h.z),h=t.vertices[s.index2],u.push(h.x,h.y,h.z)}else if(t&&t.isBufferGeometry){var v,y,_,b,x,S,w;if(h=new Pe,null!==t.index){for(v=t.attributes.position,y=t.index,0===(_=t.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),r=0,a=_.length;r<a;++r)for(e=x=(b=_[r]).start,n=x+b.count;e<n;e+=3)for(i=0;i<3;i++)o=y.getX(e+i),c=y.getX(e+(i+1)%3),f[0]=Math.min(o,c),f[1]=Math.max(o,c),void 0===d[l=f[0]+","+f[1]]&&(d[l]={index1:f[0],index2:f[1]});for(l in d)s=d[l],h.fromBufferAttribute(v,s.index1),u.push(h.x,h.y,h.z),h.fromBufferAttribute(v,s.index2),u.push(h.x,h.y,h.z)}else for(e=0,n=(v=t.attributes.position).count/3;e<n;e++)for(i=0;i<3;i++)S=3*e+i,h.fromBufferAttribute(v,S),u.push(h.x,h.y,h.z),w=3*e+(i+1)%3,h.fromBufferAttribute(v,w),u.push(h.x,h.y,h.z)}this.addAttribute("position",new er(u,3))}function Qa(t,e,i){Xn.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new $a(t,e,i)),this.mergeVertices()}function $a(t,e,i){kr.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};var n,r,a=[],s=[],o=[],c=[],l=new Pe,h=new Pe,u=new Pe,f=new Pe,d=new Pe,p=e+1;for(n=0;n<=i;n++){var g=n/i;for(r=0;r<=e;r++){var m=r/e;h=t(m,g,h),s.push(h.x,h.y,h.z),m-1e-5>=0?(u=t(m-1e-5,g,u),f.subVectors(h,u)):(u=t(m+1e-5,g,u),f.subVectors(u,h)),g-1e-5>=0?(u=t(m,g-1e-5,u),d.subVectors(h,u)):(u=t(m,g+1e-5,u),d.subVectors(u,h)),l.crossVectors(f,d).normalize(),o.push(l.x,l.y,l.z),c.push(m,g)}}for(n=0;n<i;n++)for(r=0;r<e;r++){var v=n*p+r,y=n*p+r+1,_=(n+1)*p+r+1,b=(n+1)*p+r;a.push(v,y,b),a.push(y,_,b)}this.setIndex(a),this.addAttribute("position",new er(s,3)),this.addAttribute("normal",new er(o,3)),this.addAttribute("uv",new er(c,2))}function ts(t,e,i,n){Xn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},this.fromBufferGeometry(new es(t,e,i,n)),this.mergeVertices()}function es(t,e,i,n){kr.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},i=i||1;var r=[],a=[];function s(t,e,i,n){var r,a,s=Math.pow(2,n),c=[];for(r=0;r<=s;r++){c[r]=[];var l=t.clone().lerp(i,r/s),h=e.clone().lerp(i,r/s),u=s-r;for(a=0;a<=u;a++)c[r][a]=0===a&&r===s?l:l.clone().lerp(h,a/u)}for(r=0;r<s;r++)for(a=0;a<2*(s-r)-1;a++){var f=Math.floor(a/2);a%2==0?(o(c[r][f+1]),o(c[r+1][f]),o(c[r][f])):(o(c[r][f+1]),o(c[r+1][f+1]),o(c[r+1][f]))}}function o(t){r.push(t.x,t.y,t.z)}function c(e,i){var n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function l(t,e,i,n){n<0&&1===t.x&&(a[e]=t.x-1),0===i.x&&0===i.z&&(a[e]=n/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){for(var i=new Pe,n=new Pe,r=new Pe,a=0;a<e.length;a+=3)c(e[a+0],i),c(e[a+1],n),c(e[a+2],r),s(i,n,r,t)}(n=n||0),function(t){for(var e=new Pe,i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){for(var t=new Pe,e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];var i=h(t)/2/Math.PI+.5,n=(s=t,Math.atan2(-s.y,Math.sqrt(s.x*s.x+s.z*s.z))/Math.PI+.5);a.push(i,1-n)}var s;(function(){for(var t=new Pe,e=new Pe,i=new Pe,n=new Pe,s=new Me,o=new Me,c=new Me,u=0,f=0;u<r.length;u+=9,f+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),s.set(a[f+0],a[f+1]),o.set(a[f+2],a[f+3]),c.set(a[f+4],a[f+5]),n.copy(t).add(e).add(i).divideScalar(3);var d=h(n);l(s,f+0,t,d),l(o,f+2,e,d),l(c,f+4,i,d)}})(),function(){for(var t=0;t<a.length;t+=6){var e=a[t+0],i=a[t+2],n=a[t+4],r=Math.max(e,i,n),s=Math.min(e,i,n);r>.9&&s<.1&&(e<.2&&(a[t+0]+=1),i<.2&&(a[t+2]+=1),n<.2&&(a[t+4]+=1))}}()}(),this.addAttribute("position",new er(r,3)),this.addAttribute("normal",new er(r.slice(),3)),this.addAttribute("uv",new er(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function is(t,e){Xn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ns(t,e)),this.mergeVertices()}function ns(t,e){es.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function rs(t,e){Xn.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new as(t,e)),this.mergeVertices()}function as(t,e){es.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ss(t,e){Xn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new os(t,e)),this.mergeVertices()}function os(t,e){var i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];es.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function cs(t,e){Xn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ls(t,e)),this.mergeVertices()}function ls(t,e){var i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n];es.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function hs(t,e,i,n,r,a){if(Xn.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},void 0!==a)var s=new us(t,e,i,n,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function us(t,e,i,n,r){kr.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},e=e||64,i=i||1,n=n||8,r=r||!1;var a=t.computeFrenetFrames(e,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var s,o,c=new Pe,l=new Pe,h=new Me,u=new Pe,f=[],d=[],p=[],g=[];function m(r){u=t.getPointAt(r/e,u);var s=a.normals[r],h=a.binormals[r];for(o=0;o<=n;o++){var p=o/n*Math.PI*2,g=Math.sin(p),m=-Math.cos(p);l.x=m*s.x+g*h.x,l.y=m*s.y+g*h.y,l.z=m*s.z+g*h.z,l.normalize(),d.push(l.x,l.y,l.z),c.x=u.x+i*l.x,c.y=u.y+i*l.y,c.z=u.z+i*l.z,f.push(c.x,c.y,c.z)}}!function(){for(s=0;s<e;s++)m(s);m(!1===r?e:0),function(){for(s=0;s<=e;s++)for(o=0;o<=n;o++)h.x=s/e,h.y=o/n,p.push(h.x,h.y)}(),function(){for(o=1;o<=e;o++)for(s=1;s<=n;s++){var t=(n+1)*(o-1)+(s-1),i=(n+1)*o+(s-1),r=(n+1)*o+s,a=(n+1)*(o-1)+s;g.push(t,i,a),g.push(i,r,a)}}()}(),this.setIndex(g),this.addAttribute("position",new er(f,3)),this.addAttribute("normal",new er(d,3)),this.addAttribute("uv",new er(p,2))}function fs(t,e,i,n,r,a,s){Xn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:a},void 0!==s&&this.fromBufferGeometry(new ds(t,e,i,n,r,a)),this.mergeVertices()}function ds(t,e,i,n,r,a){kr.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:a},t=t||1,e=e||.4,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,a=a||3;var s,o,c=[],l=[],h=[],u=[],f=new Pe,d=new Pe,p=new Pe,g=new Pe,m=new Pe,v=new Pe,y=new Pe;for(s=0;s<=i;++s){var _=s/i*r*Math.PI*2;for(A(_,r,a,t,p),A(_+.01,r,a,t,g),v.subVectors(g,p),y.addVectors(g,p),m.crossVectors(v,y),y.crossVectors(m,v),m.normalize(),y.normalize(),o=0;o<=n;++o){var b=o/n*Math.PI*2,x=-e*Math.cos(b),S=e*Math.sin(b);f.x=p.x+(x*y.x+S*m.x),f.y=p.y+(x*y.y+S*m.y),f.z=p.z+(x*y.z+S*m.z),l.push(f.x,f.y,f.z),d.subVectors(f,p).normalize(),h.push(d.x,d.y,d.z),u.push(s/i),u.push(o/n)}}for(o=1;o<=i;o++)for(s=1;s<=n;s++){var w=(n+1)*(o-1)+(s-1),T=(n+1)*o+(s-1),C=(n+1)*o+s,E=(n+1)*(o-1)+s;c.push(w,T,E),c.push(T,C,E)}function A(t,e,i,n,r){var a=Math.cos(t),s=Math.sin(t),o=i/e*t,c=Math.cos(o);r.x=n*(2+c)*.5*a,r.y=n*(2+c)*s*.5,r.z=n*Math.sin(o)*.5}this.setIndex(c),this.addAttribute("position",new er(l,3)),this.addAttribute("normal",new er(h,3)),this.addAttribute("uv",new er(u,2))}function ps(t,e,i,n,r){Xn.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new gs(t,e,i,n,r)),this.mergeVertices()}function gs(t,e,i,n,r){kr.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},t=t||1,e=e||.4,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var a,s,o=[],c=[],l=[],h=[],u=new Pe,f=new Pe,d=new Pe;for(a=0;a<=i;a++)for(s=0;s<=n;s++){var p=s/n*r,g=a/i*Math.PI*2;f.x=(t+e*Math.cos(g))*Math.cos(p),f.y=(t+e*Math.cos(g))*Math.sin(p),f.z=e*Math.sin(g),c.push(f.x,f.y,f.z),u.x=t*Math.cos(p),u.y=t*Math.sin(p),d.subVectors(f,u).normalize(),l.push(d.x,d.y,d.z),h.push(s/n),h.push(a/i)}for(a=1;a<=i;a++)for(s=1;s<=n;s++){var m=(n+1)*a+s-1,v=(n+1)*(a-1)+s-1,y=(n+1)*(a-1)+s,_=(n+1)*a+s;o.push(m,v,_),o.push(v,y,_)}this.setIndex(o),this.addAttribute("position",new er(c,3)),this.addAttribute("normal",new er(l,3)),this.addAttribute("uv",new er(h,2))}Ea.prototype=Object.assign(Object.create(Un.prototype),{constructor:Ea,isPerspectiveCamera:!0,copy:function(t,e){return Un.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*Ae.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Ae.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Ae.RAD2DEG*Math.atan(Math.tan(.5*Ae.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Ae.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){var s=a.fullWidth,o=a.fullHeight;r+=a.offsetX*n/s,e-=a.offsetY*i/o,n*=a.width/s,i*=a.height/o}var c=this.filmOffset;0!==c&&(r+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far)},toJSON:function(t){var e=Nn.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Aa.prototype=Object.assign(Object.create(Ea.prototype),{constructor:Aa,isArrayCamera:!0}),Pa.prototype.isFogExp2=!0,Pa.prototype.clone=function(){return new Pa(this.color.getHex(),this.density)},Pa.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Ia.prototype.isFog=!0,Ia.prototype.clone=function(){return new Ia(this.color.getHex(),this.near,this.far)},Ia.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Ra.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Ra,copy:function(t,e){return Nn.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=Nn.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),Da.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Da,isLensFlare:!0,copy:function(t){Nn.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,i=t.lensFlares.length;e<i;e++)this.lensFlares.push(t.lensFlares[e]);return this},add:function(t,e,i,n,r,a){void 0===e&&(e=-1),void 0===i&&(i=0),void 0===a&&(a=1),void 0===r&&(r=new Mi(16777215)),void 0===n&&(n=N),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:r,blending:n})},updateLensFlares:function(){var t,e,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(t=0;t<i;t++)(e=this.lensFlares[t]).x=this.positionScreen.x+n*e.distance,e.y=this.positionScreen.y+r*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)}}),Na.prototype=Object.create(rn.prototype),Na.prototype.constructor=Na,Na.prototype.isSpriteMaterial=!0,Na.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},Ua.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Ua,isSprite:!0,raycast:(ia=new Pe,na=new Pe,ra=new Pe,function(t,e){na.setFromMatrixPosition(this.matrixWorld),t.ray.closestPointToPoint(na,ia),ra.setFromMatrixScale(this.matrixWorld);var i=ra.x*ra.y/4;if(!(na.distanceToSquared(ia)>i)){var n=t.ray.origin.distanceTo(ia);n<t.near||n>t.far||e.push({distance:n,point:ia.clone(),face:null,object:this})}}),clone:function(){return new this.constructor(this.material).copy(this)}}),Fa.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Fa,copy:function(t){Nn.prototype.copy.call(this,t,!1);for(var e=t.levels,i=0,n=e.length;i<n;i++){var r=e[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var i=this.levels,n=0;n<i.length&&!(e<i[n].distance);n++);i.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object},raycast:(oa=new Pe,function(t,e){oa.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(oa);this.getObjectForDistance(i).raycast(t,e)}),update:(aa=new Pe,sa=new Pe,function(t){var e=this.levels;if(e.length>1){aa.setFromMatrixPosition(t.matrixWorld),sa.setFromMatrixPosition(this.matrixWorld);var i=aa.distanceTo(sa);e[0].object.visible=!0;for(var n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(;n<r;n++)e[n].object.visible=!1}}),toJSON:function(t){var e=Nn.prototype.toJSON.call(this,t);e.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var a=i[n];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}}),Object.assign(Ba.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new Oe;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){var t,e,i;for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(ca=new Oe,la=new Oe,function(){for(var t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture,r=0,a=t.length;r<a;r++){var s=t[r]?t[r].matrixWorld:la;ca.multiplyMatrices(s,e[r]),ca.toArray(i,16*r)}void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new Ba(this.bones,this.boneInverses)}}),ka.prototype=Object.assign(Object.create(Nn.prototype),{constructor:ka,isBone:!0}),ja.prototype=Object.assign(Object.create(Kr.prototype),{constructor:ja,isSkinnedMesh:!0,initBones:function(){var t,e,i,n,r=[];if(this.geometry&&void 0!==this.geometry.bones){for(i=0,n=this.geometry.bones.length;i<n;i++)e=this.geometry.bones[i],t=new ka,r.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(i=0,n=this.geometry.bones.length;i<n;i++)-1!==(e=this.geometry.bones[i]).parent&&null!==e.parent&&void 0!==r[e.parent]?r[e.parent].add(r[i]):this.add(r[i])}return this.updateMatrixWorld(!0),r},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var i=this.geometry.skinWeights[e];(t=1/i.manhattanLength())!==1/0?i.multiplyScalar(t):i.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new Fe,r=this.geometry.attributes.skinWeight;for(e=0;e<r.count;e++)n.x=r.getX(e),n.y=r.getY(e),n.z=r.getZ(e),n.w=r.getW(e),(t=1/n.manhattanLength())!==1/0?n.multiplyScalar(t):n.set(1,0,0,0),r.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){Kr.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode&&this.bindMatrixInverse.getInverse(this.bindMatrix)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ga.prototype=Object.create(rn.prototype),Ga.prototype.constructor=Ga,Ga.prototype.isLineBasicMaterial=!0,Ga.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},za.prototype=Object.assign(Object.create(Nn.prototype),{constructor:za,isLine:!0,raycast:(ha=new Oe,ua=new Xr,fa=new cn,function(t,e){var i=t.linePrecision,n=i*i,r=this.geometry,a=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),fa.copy(r.boundingSphere),fa.applyMatrix4(a),!1!==t.ray.intersectsSphere(fa)){ha.getInverse(a),ua.copy(t.ray).applyMatrix4(ha);var s=new Pe,o=new Pe,c=new Pe,l=new Pe,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var u=r.index,f=r.attributes.position.array;if(null!==u)for(var d=u.array,p=0,g=d.length-1;p<g;p+=h){var m=d[p],v=d[p+1];s.fromArray(f,3*m),o.fromArray(f,3*v),ua.distanceSqToSegment(s,o,l,c)>n||(l.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(l))<t.near||b>t.far||e.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}else for(p=0,g=f.length/3-1;p<g;p+=h)s.fromArray(f,3*p),o.fromArray(f,3*p+3),ua.distanceSqToSegment(s,o,l,c)>n||(l.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(l))<t.near||b>t.far||e.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}else if(r.isGeometry){var y=r.vertices,_=y.length;for(p=0;p<_-1;p+=h){var b;ua.distanceSqToSegment(y[p],y[p+1],l,c)>n||(l.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(l))<t.near||b>t.far||e.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this}))}}}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ha.prototype=Object.assign(Object.create(za.prototype),{constructor:Ha,isLineSegments:!0}),Va.prototype=Object.assign(Object.create(za.prototype),{constructor:Va,isLineLoop:!0}),Wa.prototype=Object.create(rn.prototype),Wa.prototype.constructor=Wa,Wa.prototype.isPointsMaterial=!0,Wa.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},Xa.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Xa,isPoints:!0,raycast:(da=new Oe,pa=new Xr,ga=new cn,function(t,e){var i=this,n=this.geometry,r=this.matrixWorld,a=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),ga.copy(n.boundingSphere),ga.applyMatrix4(r),ga.radius+=a,!1!==t.ray.intersectsSphere(ga)){da.getInverse(r),pa.copy(t.ray).applyMatrix4(da);var s=a/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,c=new Pe;if(n.isBufferGeometry){var l=n.index,h=n.attributes.position.array;if(null!==l)for(var u=l.array,f=0,d=u.length;f<d;f++){var p=u[f];c.fromArray(h,3*p),v(c,p)}else{f=0;for(var g=h.length/3;f<g;f++)c.fromArray(h,3*f),v(c,f)}}else{var m=n.vertices;for(f=0,g=m.length;f<g;f++)v(m[f],f)}}function v(n,a){var s=pa.distanceSqToPoint(n);if(s<o){var c=pa.closestPointToPoint(n);c.applyMatrix4(r);var l=t.ray.origin.distanceTo(c);if(l<t.near||l>t.far)return;e.push({distance:l,distanceToRay:Math.sqrt(s),point:c.clone(),index:a,face:null,object:i})}}}),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ya.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Ya,isGroup:!0}),qa.prototype=Object.assign(Object.create(Ue.prototype),{constructor:qa,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Ka.prototype=Object.create(Ue.prototype),Ka.prototype.constructor=Ka,Ka.prototype.isCompressedTexture=!0,Za.prototype=Object.create(Ue.prototype),Za.prototype.constructor=Za,Za.prototype.isDepthTexture=!0,Ja.prototype=Object.create(kr.prototype),Ja.prototype.constructor=Ja,Qa.prototype=Object.create(Xn.prototype),Qa.prototype.constructor=Qa,$a.prototype=Object.create(kr.prototype),$a.prototype.constructor=$a,ts.prototype=Object.create(Xn.prototype),ts.prototype.constructor=ts,es.prototype=Object.create(kr.prototype),es.prototype.constructor=es,is.prototype=Object.create(Xn.prototype),is.prototype.constructor=is,ns.prototype=Object.create(es.prototype),ns.prototype.constructor=ns,rs.prototype=Object.create(Xn.prototype),rs.prototype.constructor=rs,as.prototype=Object.create(es.prototype),as.prototype.constructor=as,ss.prototype=Object.create(Xn.prototype),ss.prototype.constructor=ss,os.prototype=Object.create(es.prototype),os.prototype.constructor=os,cs.prototype=Object.create(Xn.prototype),cs.prototype.constructor=cs,ls.prototype=Object.create(es.prototype),ls.prototype.constructor=ls,hs.prototype=Object.create(Xn.prototype),hs.prototype.constructor=hs,us.prototype=Object.create(kr.prototype),us.prototype.constructor=us,fs.prototype=Object.create(Xn.prototype),fs.prototype.constructor=fs,ds.prototype=Object.create(kr.prototype),ds.prototype.constructor=ds,ps.prototype=Object.create(Xn.prototype),ps.prototype.constructor=ps,gs.prototype=Object.create(kr.prototype),gs.prototype.constructor=gs;var ms=function(t,e,i){i=i||2;var n,r,a,s,o,c,l,h=e&&e.length,u=h?e[0]*i:t.length,f=vs(t,0,u,i,!0),d=[];if(!f)return d;if(h&&(f=function(t,e,i,n){var r,a,s,o,c,l=[];for(r=0,a=e.length;r<a;r++)s=e[r]*n,o=r<a-1?e[r+1]*n:t.length,(c=vs(t,s,o,n,!1))===c.next&&(c.steiner=!0),l.push(As(c));for(l.sort(Ts),r=0;r<l.length;r++)Cs(l[r],i),i=ys(i,i.next);return i}(t,e,f,i)),t.length>80*i){n=a=t[0],r=s=t[1];for(var p=i;p<u;p+=i)o=t[p],c=t[p+1],o<n&&(n=o),c<r&&(r=c),o>a&&(a=o),c>s&&(s=c);l=0!==(l=Math.max(a-n,s-r))?1/l:0}return _s(f,d,i,n,r,l),d};function vs(t,e,i,n,r){var a,s;if(r===function(t,e,i,n){for(var r=0,a=e,s=i-n;a<i;a+=n)r+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return r}(t,e,i,n)>0)for(a=e;a<i;a+=n)s=Ds(a,t[a],t[a+1],s);else for(a=i-n;a>=e;a-=n)s=Ds(a,t[a],t[a+1],s);return s&&Ls(s,s.next)&&(Ns(s),s=s.next),s}function ys(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!Ls(n,n.next)&&0!==Os(n.prev,n,n.next))n=n.next;else{if(Ns(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function _s(t,e,i,n,r,a,s){if(t){!s&&a&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=Es(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,a,s,o,c,l=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,n=i,o=0,e=0;e<l&&(o++,n=n.nextZ);e++);for(c=l;o>0||c>0&&n;)0!==o&&(0===c||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,c--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,l*=2}while(s>1)}(r)}(t,n,r,a);for(var o,c,l=t;t.prev!==t.next;)if(o=t.prev,c=t.next,a?xs(t,n,r,a):bs(t))e.push(o.i/i),e.push(t.i/i),e.push(c.i/i),Ns(t),t=c.next,l=c.next;else if((t=c)===l){s?1===s?_s(t=Ss(t,e,i),e,i,n,r,a,2):2===s&&ws(t,e,i,n,r,a):_s(ys(t),e,i,n,r,a,1);break}}}function bs(t){var e=t.prev,i=t,n=t.next;if(Os(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Ms(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Os(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function xs(t,e,i,n){var r=t.prev,a=t,s=t.next;if(Os(r,a,s)>=0)return!1;for(var o=r.x<a.x?r.x<s.x?r.x:s.x:a.x<s.x?a.x:s.x,c=r.y<a.y?r.y<s.y?r.y:s.y:a.y<s.y?a.y:s.y,l=r.x>a.x?r.x>s.x?r.x:s.x:a.x>s.x?a.x:s.x,h=r.y>a.y?r.y>s.y?r.y:s.y:a.y>s.y?a.y:s.y,u=Es(o,c,e,i,n),f=Es(l,h,e,i,n),d=t.nextZ;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&Ms(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Os(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&Ms(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Os(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function Ss(t,e,i){var n=t;do{var r=n.prev,a=n.next.next;!Ls(r,a)&&Ps(r,n,n.next,a)&&Is(r,a)&&Is(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),Ns(n),Ns(n.next),n=t=a),n=n.next}while(n!==t);return n}function ws(t,e,i,n,r,a){var s,o,c=t;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&(o=l,(s=c).next.i!==o.i&&s.prev.i!==o.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ps(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(s,o)&&Is(s,o)&&Is(o,s)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(s,o))){var h=Rs(c,l);return c=ys(c,c.next),h=ys(h,h.next),_s(c,e,i,n,r,a),void _s(h,e,i,n,r,a)}l=l.next}c=c.next}while(c!==t)}function Ts(t,e){return t.x-e.x}function Cs(t,e){if(e=function(t,e){var i,n=e,r=t.x,a=t.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&o>s){if(s=o,o===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===s)return i.prev;var c,l=i,h=i.x,u=i.y,f=1/0;n=i.next;for(;n!==l;)r>=n.x&&n.x>=h&&r!==n.x&&Ms(a<u?r:s,a,h,u,a<u?s:r,a,n.x,n.y)&&((c=Math.abs(a-n.y)/(r-n.x))<f||c===f&&n.x>i.x)&&Is(n,t)&&(i=n,f=c),n=n.next;return i}(t,e)){var i=Rs(e,t);ys(i,i.next)}}function Es(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function As(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function Ms(t,e,i,n,r,a,s,o){return(r-s)*(e-o)-(t-s)*(a-o)>=0&&(t-s)*(n-o)-(i-s)*(e-o)>=0&&(i-s)*(a-o)-(r-s)*(n-o)>=0}function Os(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Ls(t,e){return t.x===e.x&&t.y===e.y}function Ps(t,e,i,n){return!!(Ls(t,e)&&Ls(i,n)||Ls(t,n)&&Ls(i,e))||Os(t,e,i)>0!=Os(t,e,n)>0&&Os(i,n,t)>0!=Os(i,n,e)>0}function Is(t,e){return Os(t.prev,t,t.next)<0?Os(t,e,t.next)>=0&&Os(t,t.prev,e)>=0:Os(t,e,t.prev)<0||Os(t,t.next,e)<0}function Rs(t,e){var i=new Us(t.i,t.x,t.y),n=new Us(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function Ds(t,e,i,n){var r=new Us(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Ns(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Us(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Fs={area:function(t){for(var e=t.length,i=0,n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},isClockWise:function(t){return Fs.area(t)<0},triangulateShape:function(t,e){function i(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function n(t,e){for(var i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}var r=[],a=[],s=[];i(t),n(r,t);var o=t.length;for(e.forEach(i),l=0;l<e.length;l++)a.push(o),o+=e[l].length,n(r,e[l]);for(var c=ms(r,a),l=0;l<c.length;l+=3)s.push(c.slice(l,l+3));return s}};function Bs(t,e){Xn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new ks(t,e)),this.mergeVertices()}function ks(t,e){void 0!==t&&(kr.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function js(t,e){Xn.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Gs(t,e)),this.mergeVertices()}function Gs(t,e){var i=(e=e||{}).font;if(!i||!i.isFont)return new Xn;var n=i.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),ks.call(this,n,e),this.type="TextBufferGeometry"}function zs(t,e,i,n,r,a,s){Xn.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new Hs(t,e,i,n,r,a,s)),this.mergeVertices()}function Hs(t,e,i,n,r,a,s){kr.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},t=t||1,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var o,c,l=(a=void 0!==a?a:0)+(s=void 0!==s?s:Math.PI),h=0,u=[],f=new Pe,d=new Pe,p=[],g=[],m=[],v=[];for(c=0;c<=i;c++){var y=[],_=c/i;for(o=0;o<=e;o++){var b=o/e;f.x=-t*Math.cos(n+b*r)*Math.sin(a+_*s),f.y=t*Math.cos(a+_*s),f.z=t*Math.sin(n+b*r)*Math.sin(a+_*s),g.push(f.x,f.y,f.z),d.set(f.x,f.y,f.z).normalize(),m.push(d.x,d.y,d.z),v.push(b,1-_),y.push(h++)}u.push(y)}for(c=0;c<i;c++)for(o=0;o<e;o++){var x=u[c][o+1],S=u[c][o],w=u[c+1][o],T=u[c+1][o+1];(0!==c||a>0)&&p.push(x,S,T),(c!==i-1||l<Math.PI)&&p.push(S,w,T)}this.setIndex(p),this.addAttribute("position",new er(g,3)),this.addAttribute("normal",new er(m,3)),this.addAttribute("uv",new er(v,2))}function Vs(t,e,i,n,r,a){Xn.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new Ws(t,e,i,n,r,a)),this.mergeVertices()}function Ws(t,e,i,n,r,a){kr.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},t=t||.5,e=e||1,r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var s,o,c,l=[],h=[],u=[],f=[],d=t,p=(e-t)/(n=void 0!==n?Math.max(1,n):1),g=new Pe,m=new Me;for(o=0;o<=n;o++){for(c=0;c<=i;c++)s=r+c/i*a,g.x=d*Math.cos(s),g.y=d*Math.sin(s),h.push(g.x,g.y,g.z),u.push(0,0,1),m.x=(g.x/e+1)/2,m.y=(g.y/e+1)/2,f.push(m.x,m.y);d+=p}for(o=0;o<n;o++){var v=o*(i+1);for(c=0;c<i;c++){var y=s=c+v,_=s+i+1,b=s+i+2,x=s+1;l.push(y,_,x),l.push(_,b,x)}}this.setIndex(l),this.addAttribute("position",new er(h,3)),this.addAttribute("normal",new er(u,3)),this.addAttribute("uv",new er(f,2))}function Xs(t,e,i,n){Xn.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},this.fromBufferGeometry(new Ys(t,e,i,n)),this.mergeVertices()}function Ys(t,e,i,n){kr.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e)||12,i=i||0,n=n||2*Math.PI,n=Ae.clamp(n,0,2*Math.PI);var r,a,s,o=[],c=[],l=[],h=1/e,u=new Pe,f=new Me;for(a=0;a<=e;a++){var d=i+a*h*n,p=Math.sin(d),g=Math.cos(d);for(s=0;s<=t.length-1;s++)u.x=t[s].x*p,u.y=t[s].y,u.z=t[s].x*g,c.push(u.x,u.y,u.z),f.x=a/e,f.y=s/(t.length-1),l.push(f.x,f.y)}for(a=0;a<e;a++)for(s=0;s<t.length-1;s++){var m=r=s+a*t.length,v=r+t.length,y=r+t.length+1,_=r+1;o.push(m,v,_),o.push(v,y,_)}if(this.setIndex(o),this.addAttribute("position",new er(c,3)),this.addAttribute("uv",new er(l,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,x=new Pe,S=new Pe,w=new Pe;for(r=e*t.length*3,a=0,s=0;a<t.length;a++,s+=3)x.x=b[s+0],x.y=b[s+1],x.z=b[s+2],S.x=b[r+s+0],S.y=b[r+s+1],S.z=b[r+s+2],w.addVectors(x,S).normalize(),b[s+0]=b[r+s+0]=w.x,b[s+1]=b[r+s+1]=w.y,b[s+2]=b[r+s+2]=w.z}}function qs(t,e){Xn.call(this),this.type="ShapeGeometry","object"==typeof e&&(e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Ks(t,e)),this.mergeVertices()}function Ks(t,e){kr.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var i=[],n=[],r=[],a=[],s=0,o=0;if(!1===Array.isArray(t))l(t);else for(var c=0;c<t.length;c++)l(t[c]),this.addGroup(s,o,c),s+=o,o=0;function l(t){var s,c,l,h=n.length/3,u=t.extractPoints(e),f=u.shape,d=u.holes;if(!1===Fs.isClockWise(f))for(f=f.reverse(),s=0,c=d.length;s<c;s++)l=d[s],!0===Fs.isClockWise(l)&&(d[s]=l.reverse());var p=Fs.triangulateShape(f,d);for(s=0,c=d.length;s<c;s++)l=d[s],f=f.concat(l);for(s=0,c=f.length;s<c;s++){var g=f[s];n.push(g.x,g.y,0),r.push(0,0,1),a.push(g.x,g.y)}for(s=0,c=p.length;s<c;s++){var m=p[s],v=m[0]+h,y=m[1]+h,_=m[2]+h;i.push(v,y,_),o+=3}}this.setIndex(i),this.addAttribute("position",new er(n,3)),this.addAttribute("normal",new er(r,3)),this.addAttribute("uv",new er(a,2))}function Zs(t,e){if(e.shapes=[],Array.isArray(t))for(var i=0,n=t.length;i<n;i++){var r=t[i];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}function Js(t,e){kr.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var i,n,r,a,s=[],o=Math.cos(Ae.DEG2RAD*e),c=[0,0],l={},h=["a","b","c"];t.isBufferGeometry?(a=new Xn).fromBufferGeometry(t):a=t.clone(),a.mergeVertices(),a.computeFaceNormals();for(var u=a.vertices,f=a.faces,d=0,p=f.length;d<p;d++)for(var g=f[d],m=0;m<3;m++)i=g[h[m]],n=g[h[(m+1)%3]],c[0]=Math.min(i,n),c[1]=Math.max(i,n),void 0===l[r=c[0]+","+c[1]]?l[r]={index1:c[0],index2:c[1],face1:d,face2:void 0}:l[r].face2=d;for(r in l){var v=l[r];if(void 0===v.face2||f[v.face1].normal.dot(f[v.face2].normal)<=o){var y=u[v.index1];s.push(y.x,y.y,y.z),y=u[v.index2],s.push(y.x,y.y,y.z)}}this.addAttribute("position",new er(s,3))}function Qs(t,e,i,n,r,a,s,o){Xn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o},this.fromBufferGeometry(new $s(t,e,i,n,r,a,s,o)),this.mergeVertices()}function $s(t,e,i,n,r,a,s,o){kr.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o};var c=this;t=void 0!==t?t:1,e=void 0!==e?e:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,a=void 0!==a&&a,s=void 0!==s?s:0,o=void 0!==o?o:2*Math.PI;var l=[],h=[],u=[],f=[],d=0,p=[],g=i/2,m=0;function v(i){var r,a,p,v=new Me,y=new Pe,_=0,b=!0===i?t:e,x=!0===i?1:-1;for(a=d,r=1;r<=n;r++)h.push(0,g*x,0),u.push(0,x,0),f.push(.5,.5),d++;for(p=d,r=0;r<=n;r++){var S=r/n*o+s,w=Math.cos(S),T=Math.sin(S);y.x=b*T,y.y=g*x,y.z=b*w,h.push(y.x,y.y,y.z),u.push(0,x,0),v.x=.5*w+.5,v.y=.5*T*x+.5,f.push(v.x,v.y),d++}for(r=0;r<n;r++){var C=a+r,E=p+r;!0===i?l.push(E,E+1,C):l.push(E+1,E,C),_+=3}c.addGroup(m,_,!0===i?1:2),m+=_}!function(){var a,v,y=new Pe,_=new Pe,b=0,x=(e-t)/i;for(v=0;v<=r;v++){var S=[],w=v/r,T=w*(e-t)+t;for(a=0;a<=n;a++){var C=a/n,E=C*o+s,A=Math.sin(E),M=Math.cos(E);_.x=T*A,_.y=-w*i+g,_.z=T*M,h.push(_.x,_.y,_.z),y.set(A,x,M).normalize(),u.push(y.x,y.y,y.z),f.push(C,1-w),S.push(d++)}p.push(S)}for(a=0;a<n;a++)for(v=0;v<r;v++){var O=p[v][a],L=p[v+1][a],P=p[v+1][a+1],I=p[v][a+1];l.push(O,L,I),l.push(L,P,I),b+=6}c.addGroup(m,b,0),m+=b}(),!1===a&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.addAttribute("position",new er(h,3)),this.addAttribute("normal",new er(u,3)),this.addAttribute("uv",new er(f,2))}function to(t,e,i,n,r,a,s){Qs.call(this,0,t,e,i,n,r,a,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}function eo(t,e,i,n,r,a,s){$s.call(this,0,t,e,i,n,r,a,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}function io(t,e,i,n){Xn.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new no(t,e,i,n)),this.mergeVertices()}function no(t,e,i,n){kr.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var r,a,s=[],o=[],c=[],l=[],h=new Pe,u=new Me;for(o.push(0,0,0),c.push(0,0,1),l.push(.5,.5),a=0,r=3;a<=e;a++,r+=3){var f=i+a/e*n;h.x=t*Math.cos(f),h.y=t*Math.sin(f),o.push(h.x,h.y,h.z),c.push(0,0,1),u.x=(o[r]/t+1)/2,u.y=(o[r+1]/t+1)/2,l.push(u.x,u.y)}for(r=1;r<=e;r++)s.push(r,r+1,0);this.setIndex(s),this.addAttribute("position",new er(o,3)),this.addAttribute("normal",new er(c,3)),this.addAttribute("uv",new er(l,2))}Bs.prototype=Object.create(Xn.prototype),Bs.prototype.constructor=Bs,ks.prototype=Object.create(kr.prototype),ks.prototype.constructor=ks,ks.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],i=this.getAttribute("uv"),n=i?Array.prototype.slice.call(i.array):[],r=this.index;return{position:e,uv:n,index:r?Array.prototype.slice.call(r.array):[]}},ks.prototype.addShapeList=function(t,e){var i=t.length;e.arrays=this.getArrays();for(var n=0;n<i;n++){var r=t[n];this.addShape(r,e)}this.setIndex(e.arrays.index),this.addAttribute("position",new er(e.arrays.position,3)),this.addAttribute("uv",new er(e.arrays.uv,2))},ks.prototype.addShape=function(t,e){var i,n,r,a,s,o,c,l,h=e.arrays?e.arrays:this.getArrays(),u=h.position,f=h.index,d=h.uv,p=[],g=void 0!==e.amount?e.amount:100,m=void 0!==e.bevelThickness?e.bevelThickness:6,v=void 0!==e.bevelSize?e.bevelSize:m-2,y=void 0!==e.bevelSegments?e.bevelSegments:3,_=void 0===e.bevelEnabled||e.bevelEnabled,b=void 0!==e.curveSegments?e.curveSegments:12,x=void 0!==e.steps?e.steps:1,S=e.extrudePath,w=!1,T=void 0!==e.UVGenerator?e.UVGenerator:Bs.WorldUVGenerator;S&&(i=S.getSpacedPoints(x),w=!0,_=!1,n=void 0!==e.frames?e.frames:S.computeFrenetFrames(x,!1),r=new Pe,a=new Pe,s=new Pe),_||(y=0,m=0,v=0);var C=this,E=t.extractPoints(b),A=E.shape,M=E.holes;if(!Fs.isClockWise(A))for(A=A.reverse(),c=0,l=M.length;c<l;c++)o=M[c],Fs.isClockWise(o)&&(M[c]=o.reverse());var O=Fs.triangulateShape(A,M),L=A;for(c=0,l=M.length;c<l;c++)o=M[c],A=A.concat(o);function P(t,e,i){if(!e)return e.clone().multiplyScalar(i).add(t)}var I,R,D,N,U,F,B=A.length,k=O.length;function j(t,e,i){var n,r,a,s=t.x-e.x,o=t.y-e.y,c=i.x-t.x,l=i.y-t.y,h=s*s+o*o,u=s*l-o*c;if(Math.abs(u)>Number.EPSILON){var f=Math.sqrt(h),d=Math.sqrt(c*c+l*l),p=e.x-o/f,g=e.y+s/f,m=((i.x-l/d-p)*l-(i.y+c/d-g)*c)/(s*l-o*c),v=(n=p+s*m-t.x)*n+(r=g+o*m-t.y)*r;if(v<=2)return new Me(n,r);a=Math.sqrt(v/2)}else{var y=!1;s>Number.EPSILON?c>Number.EPSILON&&(y=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(y=!0):Math.sign(o)===Math.sign(l)&&(y=!0),y?(n=-o,r=s,a=Math.sqrt(h)):(n=s,r=o,a=Math.sqrt(h/2))}return new Me(n/a,r/a)}for(var G=[],z=0,H=L.length,V=H-1,W=z+1;z<H;z++,V++,W++)V===H&&(V=0),W===H&&(W=0),G[z]=j(L[z],L[V],L[W]);var X,Y,q=[],K=G.concat();for(c=0,l=M.length;c<l;c++){for(o=M[c],X=[],z=0,V=(H=o.length)-1,W=z+1;z<H;z++,V++,W++)V===H&&(V=0),W===H&&(W=0),X[z]=j(o[z],o[V],o[W]);q.push(X),K=K.concat(X)}for(I=0;I<y;I++){for(D=I/y,N=m*Math.cos(D*Math.PI/2),R=v*Math.sin(D*Math.PI/2),z=0,H=L.length;z<H;z++)J((U=P(L[z],G[z],R)).x,U.y,-N);for(c=0,l=M.length;c<l;c++)for(o=M[c],X=q[c],z=0,H=o.length;z<H;z++)J((U=P(o[z],X[z],R)).x,U.y,-N)}for(R=v,z=0;z<B;z++)U=_?P(A[z],K[z],R):A[z],w?(a.copy(n.normals[0]).multiplyScalar(U.x),r.copy(n.binormals[0]).multiplyScalar(U.y),s.copy(i[0]).add(a).add(r),J(s.x,s.y,s.z)):J(U.x,U.y,0);for(Y=1;Y<=x;Y++)for(z=0;z<B;z++)U=_?P(A[z],K[z],R):A[z],w?(a.copy(n.normals[Y]).multiplyScalar(U.x),r.copy(n.binormals[Y]).multiplyScalar(U.y),s.copy(i[Y]).add(a).add(r),J(s.x,s.y,s.z)):J(U.x,U.y,g/x*Y);for(I=y-1;I>=0;I--){for(D=I/y,N=m*Math.cos(D*Math.PI/2),R=v*Math.sin(D*Math.PI/2),z=0,H=L.length;z<H;z++)J((U=P(L[z],G[z],R)).x,U.y,g+N);for(c=0,l=M.length;c<l;c++)for(o=M[c],X=q[c],z=0,H=o.length;z<H;z++)U=P(o[z],X[z],R),w?J(U.x,U.y+i[x-1].y,i[x-1].x+N):J(U.x,U.y,g+N)}function Z(t,e){var i,n;for(z=t.length;--z>=0;){i=z,(n=z-1)<0&&(n=t.length-1);var r=0,a=x+2*y;for(r=0;r<a;r++){var s=B*r,o=B*(r+1);$(e+i+s,e+n+s,e+n+o,e+i+o)}}}function J(t,e,i){p.push(t),p.push(e),p.push(i)}function Q(t,e,i){tt(t),tt(e),tt(i);var n=u.length/3,r=T.generateTopUV(C,u,n-3,n-2,n-1);et(r[0]),et(r[1]),et(r[2])}function $(t,e,i,n){tt(t),tt(e),tt(n),tt(e),tt(i),tt(n);var r=u.length/3,a=T.generateSideWallUV(C,u,r-6,r-3,r-2,r-1);et(a[0]),et(a[1]),et(a[3]),et(a[1]),et(a[2]),et(a[3])}function tt(t){f.push(u.length/3),u.push(p[3*t+0]),u.push(p[3*t+1]),u.push(p[3*t+2])}function et(t){d.push(t.x),d.push(t.y)}!function(){var t=u.length/3;if(_){var i=0,n=B*i;for(z=0;z<k;z++)Q((F=O[z])[2]+n,F[1]+n,F[0]+n);for(n=B*(i=x+2*y),z=0;z<k;z++)Q((F=O[z])[0]+n,F[1]+n,F[2]+n)}else{for(z=0;z<k;z++)Q((F=O[z])[2],F[1],F[0]);for(z=0;z<k;z++)Q((F=O[z])[0]+B*x,F[1]+B*x,F[2]+B*x)}C.addGroup(t,u.length/3-t,void 0!==e.material?e.material:0)}(),function(){var t=u.length/3,i=0;for(Z(L,i),i+=L.length,c=0,l=M.length;c<l;c++)Z(o=M[c],i),i+=o.length;C.addGroup(t,u.length/3-t,void 0!==e.extrudeMaterial?e.extrudeMaterial:1)}(),e.arrays||(this.setIndex(f),this.addAttribute("position",new er(u,3)),this.addAttribute("uv",new er(d,2)))},Bs.WorldUVGenerator={generateTopUV:function(t,e,i,n,r){var a=e[3*i],s=e[3*i+1],o=e[3*n],c=e[3*n+1],l=e[3*r],h=e[3*r+1];return[new Me(a,s),new Me(o,c),new Me(l,h)]},generateSideWallUV:function(t,e,i,n,r,a){var s=e[3*i],o=e[3*i+1],c=e[3*i+2],l=e[3*n],h=e[3*n+1],u=e[3*n+2],f=e[3*r],d=e[3*r+1],p=e[3*r+2],g=e[3*a],m=e[3*a+1],v=e[3*a+2];return Math.abs(o-h)<.01?[new Me(s,1-c),new Me(l,1-u),new Me(f,1-p),new Me(g,1-v)]:[new Me(o,1-c),new Me(h,1-u),new Me(d,1-p),new Me(m,1-v)]}},js.prototype=Object.create(Xn.prototype),js.prototype.constructor=js,Gs.prototype=Object.create(ks.prototype),Gs.prototype.constructor=Gs,zs.prototype=Object.create(Xn.prototype),zs.prototype.constructor=zs,Hs.prototype=Object.create(kr.prototype),Hs.prototype.constructor=Hs,Vs.prototype=Object.create(Xn.prototype),Vs.prototype.constructor=Vs,Ws.prototype=Object.create(kr.prototype),Ws.prototype.constructor=Ws,Xs.prototype=Object.create(Xn.prototype),Xs.prototype.constructor=Xs,Ys.prototype=Object.create(kr.prototype),Ys.prototype.constructor=Ys,qs.prototype=Object.create(Xn.prototype),qs.prototype.constructor=qs,qs.prototype.toJSON=function(){var t=Xn.prototype.toJSON.call(this);return Zs(this.parameters.shapes,t)},Ks.prototype=Object.create(kr.prototype),Ks.prototype.constructor=Ks,Ks.prototype.toJSON=function(){var t=kr.prototype.toJSON.call(this);return Zs(this.parameters.shapes,t)},Js.prototype=Object.create(kr.prototype),Js.prototype.constructor=Js,Qs.prototype=Object.create(Xn.prototype),Qs.prototype.constructor=Qs,$s.prototype=Object.create(kr.prototype),$s.prototype.constructor=$s,to.prototype=Object.create(Qs.prototype),to.prototype.constructor=to,eo.prototype=Object.create($s.prototype),eo.prototype.constructor=eo,io.prototype=Object.create(Xn.prototype),io.prototype.constructor=io,no.prototype=Object.create(kr.prototype),no.prototype.constructor=no;var ro=Object.freeze({WireframeGeometry:Ja,ParametricGeometry:Qa,ParametricBufferGeometry:$a,TetrahedronGeometry:is,TetrahedronBufferGeometry:ns,OctahedronGeometry:rs,OctahedronBufferGeometry:as,IcosahedronGeometry:ss,IcosahedronBufferGeometry:os,DodecahedronGeometry:cs,DodecahedronBufferGeometry:ls,PolyhedronGeometry:ts,PolyhedronBufferGeometry:es,TubeGeometry:hs,TubeBufferGeometry:us,TorusKnotGeometry:fs,TorusKnotBufferGeometry:ds,TorusGeometry:ps,TorusBufferGeometry:gs,TextGeometry:js,TextBufferGeometry:Gs,SphereGeometry:zs,SphereBufferGeometry:Hs,RingGeometry:Vs,RingBufferGeometry:Ws,PlaneGeometry:zr,PlaneBufferGeometry:Hr,LatheGeometry:Xs,LatheBufferGeometry:Ys,ShapeGeometry:qs,ShapeBufferGeometry:Ks,ExtrudeGeometry:Bs,ExtrudeBufferGeometry:ks,EdgesGeometry:Js,ConeGeometry:to,ConeBufferGeometry:eo,CylinderGeometry:Qs,CylinderBufferGeometry:$s,CircleGeometry:io,CircleBufferGeometry:no,BoxGeometry:jr,BoxBufferGeometry:Gr});function ao(t){rn.call(this),this.type="ShadowMaterial",this.color=new Mi(0),this.opacity=1,this.lights=!0,this.transparent=!0,this.setValues(t)}function so(t){Wr.call(this,t),this.type="RawShaderMaterial"}function oo(t){rn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Mi(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function co(t){oo.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function lo(t){rn.call(this),this.type="MeshPhongMaterial",this.color=new Mi(16777215),this.specular=new Mi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ht,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ho(t){lo.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function uo(t){rn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Me(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function fo(t){rn.call(this),this.type="MeshLambertMaterial",this.color=new Mi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ht,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function po(t){Ga.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}ao.prototype=Object.create(rn.prototype),ao.prototype.constructor=ao,ao.prototype.isShadowMaterial=!0,so.prototype=Object.create(Wr.prototype),so.prototype.constructor=so,so.prototype.isRawShaderMaterial=!0,oo.prototype=Object.create(rn.prototype),oo.prototype.constructor=oo,oo.prototype.isMeshStandardMaterial=!0,oo.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},co.prototype=Object.create(oo.prototype),co.prototype.constructor=co,co.prototype.isMeshPhysicalMaterial=!0,co.prototype.copy=function(t){return oo.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},lo.prototype=Object.create(rn.prototype),lo.prototype.constructor=lo,lo.prototype.isMeshPhongMaterial=!0,lo.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},ho.prototype=Object.create(lo.prototype),ho.prototype.constructor=ho,ho.prototype.isMeshToonMaterial=!0,ho.prototype.copy=function(t){return lo.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},uo.prototype=Object.create(rn.prototype),uo.prototype.constructor=uo,uo.prototype.isMeshNormalMaterial=!0,uo.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},fo.prototype=Object.create(rn.prototype),fo.prototype.constructor=fo,fo.prototype.isMeshLambertMaterial=!0,fo.prototype.copy=function(t){return rn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},po.prototype=Object.create(Ga.prototype),po.prototype.constructor=po,po.prototype.isLineDashedMaterial=!0,po.prototype.copy=function(t){return Ga.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var go=Object.freeze({ShadowMaterial:ao,SpriteMaterial:Na,RawShaderMaterial:so,ShaderMaterial:Wr,PointsMaterial:Wa,MeshPhysicalMaterial:co,MeshStandardMaterial:oo,MeshPhongMaterial:lo,MeshToonMaterial:ho,MeshNormalMaterial:uo,MeshLambertMaterial:fo,MeshDepthMaterial:an,MeshDistanceMaterial:sn,MeshBasicMaterial:Vr,LineDashedMaterial:po,LineBasicMaterial:Ga,Material:rn}),mo={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function vo(t,e,i){var n=this,r=!1,a=0,s=0,o=void 0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){s++,!1===r&&void 0!==n.onStart&&n.onStart(t,a,s),r=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,s),a===s&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this}}var yo=new vo,_o={};function bo(t){this.manager=void 0!==t?t:yo}function xo(t){this.manager=void 0!==t?t:yo,this._parser=null}function So(t){this.manager=void 0!==t?t:yo,this._parser=null}function wo(t){this.manager=void 0!==t?t:yo}function To(t){this.manager=void 0!==t?t:yo}function Co(t){this.manager=void 0!==t?t:yo}function Eo(){this.type="Curve",this.arcLengthDivisions=200}function Ao(t,e,i,n,r,a,s,o){Eo.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=s||!1,this.aRotation=o||0}function Mo(t,e,i,n,r,a){Ao.call(this,t,e,i,i,n,r,a),this.type="ArcCurve"}function Oo(){var t=0,e=0,i=0,n=0;function r(r,a,s,o){t=r,e=s,i=-3*r+3*a-2*s-o,n=2*r-2*a+s+o}return{initCatmullRom:function(t,e,i,n,a){r(e,i,a*(i-t),a*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,a,s,o){var c=(e-t)/a-(i-t)/(a+s)+(i-e)/s,l=(i-e)/s-(n-e)/(s+o)+(n-i)/o;r(e,i,c*=s,l*=s)},calc:function(r){var a=r*r;return t+e*r+i*a+n*(a*r)}}}Object.assign(bo.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,a=mo.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;if(void 0===_o[t]){var s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var o=s[1],c=!!s[2],l=s[3];l=window.decodeURIComponent(l),c&&(l=window.atob(l));try{var h,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var f=new Uint8Array(l.length),d=0;d<l.length;d++)f[d]=l.charCodeAt(d);h="blob"===u?new Blob([f.buffer],{type:o}):f.buffer;break;case"document":var p=new DOMParser;h=p.parseFromString(l,o);break;case"json":h=JSON.parse(l);break;default:h=l}window.setTimeout(function(){e&&e(h),r.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},0)}}else{_o[t]=[],_o[t].push({onLoad:e,onProgress:i,onError:n});var g=new XMLHttpRequest;for(var m in g.open("GET",t,!0),g.addEventListener("load",function(e){var i=this.response;mo.add(t,i);var n=_o[t];if(delete _o[t],200===this.status){for(var a=0,s=n.length;a<s;a++){(o=n[a]).onLoad&&o.onLoad(i)}r.manager.itemEnd(t)}else if(0===this.status){for(a=0,s=n.length;a<s;a++){(o=n[a]).onLoad&&o.onLoad(i)}r.manager.itemEnd(t)}else{for(a=0,s=n.length;a<s;a++){var o;(o=n[a]).onError&&o.onError(e)}r.manager.itemEnd(t),r.manager.itemError(t)}},!1),g.addEventListener("progress",function(e){for(var i=_o[t],n=0,r=i.length;n<r;n++){var a=i[n];a.onProgress&&a.onProgress(e)}},!1),g.addEventListener("error",function(e){var i=_o[t];delete _o[t];for(var n=0,a=i.length;n<a;n++){var s=i[n];s.onError&&s.onError(e)}r.manager.itemEnd(t),r.manager.itemError(t)},!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)g.setRequestHeader(m,this.requestHeader[m]);g.send(null)}return r.manager.itemStart(t),g}_o[t].push({onLoad:e,onProgress:i,onError:n})},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(xo.prototype,{load:function(t,e,i,n){var r=this,a=[],s=new Ka;s.image=a;var o=new bo(this.manager);function c(c){o.load(t[c],function(t){var i=r._parser(t,!0);a[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(l+=1)&&(1===i.mipmapCount&&(s.minFilter=Pt),s.format=i.format,s.needsUpdate=!0,e&&e(s))},i,n)}if(o.setPath(this.path),o.setResponseType("arraybuffer"),Array.isArray(t))for(var l=0,h=0,u=t.length;h<u;++h)c(h);else o.load(t,function(t){var i=r._parser(t,!0);if(i.isCubemap)for(var n=i.mipmaps.length/i.mipmapCount,o=0;o<n;o++){a[o]={mipmaps:[]};for(var c=0;c<i.mipmapCount;c++)a[o].mipmaps.push(i.mipmaps[o*i.mipmapCount+c]),a[o].format=i.format,a[o].width=i.width,a[o].height=i.height}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=Pt),s.format=i.format,s.needsUpdate=!0,e&&e(s)},i,n);return s},setPath:function(t){return this.path=t,this}}),Object.assign(So.prototype,{load:function(t,e,i,n){var r=this,a=new je,s=new bo(this.manager);return s.setResponseType("arraybuffer"),s.load(t,function(t){var i=r._parser(t);i&&(void 0!==i.image?a.image=i.image:void 0!==i.data&&(a.image.width=i.width,a.image.height=i.height,a.image.data=i.data),a.wrapS=void 0!==i.wrapS?i.wrapS:Et,a.wrapT=void 0!==i.wrapT?i.wrapT:Et,a.magFilter=void 0!==i.magFilter?i.magFilter:Pt,a.minFilter=void 0!==i.minFilter?i.minFilter:Rt,a.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(a.format=i.format),void 0!==i.type&&(a.type=i.type),void 0!==i.mipmaps&&(a.mipmaps=i.mipmaps),1===i.mipmapCount&&(a.minFilter=Pt),a.needsUpdate=!0,e&&e(a,i))},i,n),a}}),Object.assign(wo.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var r=this,a=mo.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",function(){mo.add(t,this),e&&e(this),r.manager.itemEnd(t)},!1),s.addEventListener("error",function(e){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(t),s.src=t,s},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(To.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,n){var r=new Ge,a=new wo(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var s=0;function o(i){a.load(t[i],function(t){r.images[i]=t,6===++s&&(r.needsUpdate=!0,e&&e(r))},void 0,n)}for(var c=0;c<t.length;++c)o(c);return r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Co.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,n){var r=new Ue,a=new wo(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(i){r.image=i;var n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);r.format=n?Yt:qt,r.needsUpdate=!0,void 0!==e&&e(r)},i,n),r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Eo.prototype,{getPoint:function(){return null},getPointAt:function(t,e){var i=this.getUtoTmapping(t);return this.getPoint(i,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],r=this.getPoint(0),a=0;for(n.push(0),i=1;i<=t;i++)a+=(e=this.getPoint(i/t)).distanceTo(r),n.push(a),r=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i,n=this.getLengths(),r=0,a=n.length;i=e||t*n[a-1];for(var s,o=0,c=a-1;o<=c;)if((s=n[r=Math.floor(o+(c-o)/2)]-i)<0)o=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(n[r=c]===i)return r/(a-1);var l=n[r];return(r+(i-l)/(n[r+1]-l))/(a-1)},getTangent:function(t){var e=t-1e-4,i=t+1e-4;e<0&&(e=0),i>1&&(i=1);var n=this.getPoint(e);return this.getPoint(i).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var i,n,r,a=new Pe,s=[],o=[],c=[],l=new Pe,h=new Oe;for(i=0;i<=t;i++)n=i/t,s[i]=this.getTangentAt(n),s[i].normalize();o[0]=new Pe,c[0]=new Pe;var u=Number.MAX_VALUE,f=Math.abs(s[0].x),d=Math.abs(s[0].y),p=Math.abs(s[0].z);for(f<=u&&(u=f,a.set(1,0,0)),d<=u&&(u=d,a.set(0,1,0)),p<=u&&a.set(0,0,1),l.crossVectors(s[0],a).normalize(),o[0].crossVectors(s[0],l),c[0].crossVectors(s[0],o[0]),i=1;i<=t;i++)o[i]=o[i-1].clone(),c[i]=c[i-1].clone(),l.crossVectors(s[i-1],s[i]),l.length()>Number.EPSILON&&(l.normalize(),r=Math.acos(Ae.clamp(s[i-1].dot(s[i]),-1,1)),o[i].applyMatrix4(h.makeRotationAxis(l,r))),c[i].crossVectors(s[i],o[i]);if(!0===e)for(r=Math.acos(Ae.clamp(o[0].dot(o[t]),-1,1)),r/=t,s[0].dot(l.crossVectors(o[0],o[t]))>0&&(r=-r),i=1;i<=t;i++)o[i].applyMatrix4(h.makeRotationAxis(s[i],r*i)),c[i].crossVectors(s[i],o[i]);return{tangents:s,normals:o,binormals:c}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Ao.prototype=Object.create(Eo.prototype),Ao.prototype.constructor=Ao,Ao.prototype.isEllipseCurve=!0,Ao.prototype.getPoint=function(t,e){for(var i=e||new Me,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0!==this.aClockwise||a||(r===n?r=-n:r-=n);var s=this.aStartAngle+t*r,o=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var l=Math.cos(this.aRotation),h=Math.sin(this.aRotation),u=o-this.aX,f=c-this.aY;o=u*l-f*h+this.aX,c=u*h+f*l+this.aY}return i.set(o,c)},Ao.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Ao.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Ao.prototype.fromJSON=function(t){return Eo.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Mo.prototype=Object.create(Ao.prototype),Mo.prototype.constructor=Mo,Mo.prototype.isArcCurve=!0;var Lo=new Pe,Po=new Oo,Io=new Oo,Ro=new Oo;function Do(t,e,i,n){Eo.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=i||"centripetal",this.tension=n||.5}function No(t,e,i,n,r){var a=.5*(n-e),s=.5*(r-i),o=t*t;return(2*i-2*n+a+s)*(t*o)+(-3*i+3*n-2*a-s)*o+a*t+i}function Uo(t,e,i,n){return(s=1-t)*s*e+2*(1-(a=t))*a*i+(r=t)*r*n;var r,a,s}function Fo(t,e,i,n,r){return(l=1-t)*l*l*e+3*(c=1-(o=t))*c*o*i+3*(1-(s=t))*s*s*n+(a=t)*a*a*r;var a,s,o,c,l}function Bo(t,e,i,n){Eo.call(this),this.type="CubicBezierCurve",this.v0=t||new Me,this.v1=e||new Me,this.v2=i||new Me,this.v3=n||new Me}function ko(t,e,i,n){Eo.call(this),this.type="CubicBezierCurve3",this.v0=t||new Pe,this.v1=e||new Pe,this.v2=i||new Pe,this.v3=n||new Pe}function jo(t,e){Eo.call(this),this.type="LineCurve",this.v1=t||new Me,this.v2=e||new Me}function Go(t,e){Eo.call(this),this.type="LineCurve3",this.v1=t||new Pe,this.v2=e||new Pe}function zo(t,e,i){Eo.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Me,this.v1=e||new Me,this.v2=i||new Me}function Ho(t,e,i){Eo.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Pe,this.v1=e||new Pe,this.v2=i||new Pe}function Vo(t){Eo.call(this),this.type="SplineCurve",this.points=t||[]}Do.prototype=Object.create(Eo.prototype),Do.prototype.constructor=Do,Do.prototype.isCatmullRomCurve3=!0,Do.prototype.getPoint=function(t,e){var i,n,r,a,s=e||new Pe,o=this.points,c=o.length,l=(c-(this.closed?0:1))*t,h=Math.floor(l),u=l-h;if(this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/o.length)+1)*o.length:0===u&&h===c-1&&(h=c-2,u=1),this.closed||h>0?i=o[(h-1)%c]:(Lo.subVectors(o[0],o[1]).add(o[0]),i=Lo),n=o[h%c],r=o[(h+1)%c],this.closed||h+2<c?a=o[(h+2)%c]:(Lo.subVectors(o[c-1],o[c-2]).add(o[c-1]),a=Lo),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,d=Math.pow(i.distanceToSquared(n),f),p=Math.pow(n.distanceToSquared(r),f),g=Math.pow(r.distanceToSquared(a),f);p<1e-4&&(p=1),d<1e-4&&(d=p),g<1e-4&&(g=p),Po.initNonuniformCatmullRom(i.x,n.x,r.x,a.x,d,p,g),Io.initNonuniformCatmullRom(i.y,n.y,r.y,a.y,d,p,g),Ro.initNonuniformCatmullRom(i.z,n.z,r.z,a.z,d,p,g)}else"catmullrom"===this.curveType&&(Po.initCatmullRom(i.x,n.x,r.x,a.x,this.tension),Io.initCatmullRom(i.y,n.y,r.y,a.y,this.tension),Ro.initCatmullRom(i.z,n.z,r.z,a.z,this.tension));return s.set(Po.calc(u),Io.calc(u),Ro.calc(u)),s},Do.prototype.copy=function(t){Eo.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Do.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++){var n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Do.prototype.fromJSON=function(t){Eo.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push((new Pe).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Bo.prototype=Object.create(Eo.prototype),Bo.prototype.constructor=Bo,Bo.prototype.isCubicBezierCurve=!0,Bo.prototype.getPoint=function(t,e){var i=e||new Me,n=this.v0,r=this.v1,a=this.v2,s=this.v3;return i.set(Fo(t,n.x,r.x,a.x,s.x),Fo(t,n.y,r.y,a.y,s.y)),i},Bo.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Bo.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Bo.prototype.fromJSON=function(t){return Eo.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},ko.prototype=Object.create(Eo.prototype),ko.prototype.constructor=ko,ko.prototype.isCubicBezierCurve3=!0,ko.prototype.getPoint=function(t,e){var i=e||new Pe,n=this.v0,r=this.v1,a=this.v2,s=this.v3;return i.set(Fo(t,n.x,r.x,a.x,s.x),Fo(t,n.y,r.y,a.y,s.y),Fo(t,n.z,r.z,a.z,s.z)),i},ko.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},ko.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},ko.prototype.fromJSON=function(t){return Eo.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},jo.prototype=Object.create(Eo.prototype),jo.prototype.constructor=jo,jo.prototype.isLineCurve=!0,jo.prototype.getPoint=function(t,e){var i=e||new Me;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},jo.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},jo.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},jo.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},jo.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},jo.prototype.fromJSON=function(t){return Eo.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Go.prototype=Object.create(Eo.prototype),Go.prototype.constructor=Go,Go.prototype.isLineCurve3=!0,Go.prototype.getPoint=function(t,e){var i=e||new Pe;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},Go.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Go.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Go.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Go.prototype.fromJSON=function(t){return Eo.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},zo.prototype=Object.create(Eo.prototype),zo.prototype.constructor=zo,zo.prototype.isQuadraticBezierCurve=!0,zo.prototype.getPoint=function(t,e){var i=e||new Me,n=this.v0,r=this.v1,a=this.v2;return i.set(Uo(t,n.x,r.x,a.x),Uo(t,n.y,r.y,a.y)),i},zo.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},zo.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},zo.prototype.fromJSON=function(t){return Eo.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ho.prototype=Object.create(Eo.prototype),Ho.prototype.constructor=Ho,Ho.prototype.isQuadraticBezierCurve3=!0,Ho.prototype.getPoint=function(t,e){var i=e||new Pe,n=this.v0,r=this.v1,a=this.v2;return i.set(Uo(t,n.x,r.x,a.x),Uo(t,n.y,r.y,a.y),Uo(t,n.z,r.z,a.z)),i},Ho.prototype.copy=function(t){return Eo.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ho.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ho.prototype.fromJSON=function(t){return Eo.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Vo.prototype=Object.create(Eo.prototype),Vo.prototype.constructor=Vo,Vo.prototype.isSplineCurve=!0,Vo.prototype.getPoint=function(t,e){var i=e||new Me,n=this.points,r=(n.length-1)*t,a=Math.floor(r),s=r-a,o=n[0===a?a:a-1],c=n[a],l=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return i.set(No(s,o.x,c.x,l.x,h.x),No(s,o.y,c.y,l.y,h.y)),i},Vo.prototype.copy=function(t){Eo.prototype.copy.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push(n.clone())}return this},Vo.prototype.toJSON=function(){var t=Eo.prototype.toJSON.call(this);t.points=[];for(var e=0,i=this.points.length;e<i;e++){var n=this.points[e];t.points.push(n.toArray())}return t},Vo.prototype.fromJSON=function(t){Eo.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,i=t.points.length;e<i;e++){var n=t.points[e];this.points.push((new Me).fromArray(n))}return this};var Wo=Object.freeze({ArcCurve:Mo,CatmullRomCurve3:Do,CubicBezierCurve:Bo,CubicBezierCurve3:ko,EllipseCurve:Ao,LineCurve:jo,LineCurve3:Go,QuadraticBezierCurve:zo,QuadraticBezierCurve3:Ho,SplineCurve:Vo});function Xo(){Eo.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Yo(t){Xo.call(this),this.type="Path",this.currentPoint=new Me,t&&this.setFromPoints(t)}function qo(t){Yo.call(this,t),this.uuid=Ae.generateUUID(),this.type="Shape",this.holes=[]}function Ko(t,e){Nn.call(this),this.type="Light",this.color=new Mi(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Zo(t,e,i){Ko.call(this,t,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Nn.DefaultUp),this.updateMatrix(),this.groundColor=new Mi(e)}function Jo(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Me(512,512),this.map=null,this.matrix=new Oe}function Qo(){Jo.call(this,new Ea(50,1,.5,500))}function $o(t,e,i,n,r,a){Ko.call(this,t,e),this.type="SpotLight",this.position.copy(Nn.DefaultUp),this.updateMatrix(),this.target=new Nn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==a?a:1,this.shadow=new Qo}function tc(t,e,i,n){Ko.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new Jo(new Ea(90,1,.5,500))}function ec(){Jo.call(this,new Fn(-5,5,5,-5,.5,500))}function ic(t,e){Ko.call(this,t,e),this.type="DirectionalLight",this.position.copy(Nn.DefaultUp),this.updateMatrix(),this.target=new Nn,this.shadow=new ec}function nc(t,e){Ko.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function rc(t,e,i,n){Ko.call(this,t,e),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function ac(t,e,i,n){mc.call(this,t,e,i,n)}function sc(t,e,i){mc.call(this,t,e,i)}function oc(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function cc(t,e,i,n){oc.call(this,t,e,i,n)}function lc(t,e,i,n){mc.call(this,t,e,i,n)}function hc(t,e,i,n){mc.call(this,t,e,i,n)}function uc(t,e,i,n){mc.call(this,t,e,i,n)}function fc(t,e,i,n){oc.call(this,t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function dc(t,e,i,n){oc.call(this,t,e,i,n)}function pc(t,e,i,n){oc.call(this,t,e,i,n)}Xo.prototype=Object.assign(Object.create(Eo.prototype),{constructor:Xo,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new jo(e,t))},getPoint:function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=e){var r=i[n]-e,a=this.curves[n],s=a.getLength(),o=0===s?0:1-r/s;return a.getPointAt(o)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],n=0,r=this.curves;n<r.length;n++)for(var a=r[n],s=a&&a.isEllipseCurve?2*t:a&&a.isLineCurve?1:a&&a.isSplineCurve?t*a.points.length:t,o=a.getPoints(s),c=0;c<o.length;c++){var l=o[c];e&&e.equals(l)||(i.push(l),e=l)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(t){Eo.prototype.copy.call(this,t),this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Eo.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,i=this.curves.length;e<i;e++){var n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Eo.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,i=t.curves.length;e<i;e++){var n=t.curves[e];this.curves.push((new Wo[n.type]).fromJSON(n))}return this}}),Yo.prototype=Object.assign(Object.create(Xo.prototype),{constructor:Yo,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var i=new jo(this.currentPoint.clone(),new Me(t,e));this.curves.push(i),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,i,n){var r=new zo(this.currentPoint.clone(),new Me(t,e),new Me(i,n));this.curves.push(r),this.currentPoint.set(i,n)},bezierCurveTo:function(t,e,i,n,r,a){var s=new Bo(this.currentPoint.clone(),new Me(t,e),new Me(i,n),new Me(r,a));this.curves.push(s),this.currentPoint.set(r,a)},splineThru:function(t){var e=new Vo([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,i,n,r,a){var s=this.currentPoint.x,o=this.currentPoint.y;this.absarc(t+s,e+o,i,n,r,a)},absarc:function(t,e,i,n,r,a){this.absellipse(t,e,i,i,n,r,a)},ellipse:function(t,e,i,n,r,a,s,o){var c=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(t+c,e+l,i,n,r,a,s,o)},absellipse:function(t,e,i,n,r,a,s,o){var c=new Ao(t,e,i,n,r,a,s,o);if(this.curves.length>0){var l=c.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(c);var h=c.getPoint(1);this.currentPoint.copy(h)},copy:function(t){return Xo.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=Xo.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Xo.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),qo.prototype=Object.assign(Object.create(Yo.prototype),{constructor:qo,getPointsHoles:function(t){for(var e=[],i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Yo.prototype.copy.call(this,t),this.holes=[];for(var e=0,i=t.holes.length;e<i;e++){var n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){var t=Yo.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,i=this.holes.length;e<i;e++){var n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){Yo.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,i=t.holes.length;e<i;e++){var n=t.holes[e];this.holes.push((new Yo).fromJSON(n))}return this}}),Ko.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Ko,isLight:!0,copy:function(t){return Nn.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=Nn.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Zo.prototype=Object.assign(Object.create(Ko.prototype),{constructor:Zo,isHemisphereLight:!0,copy:function(t){return Ko.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Jo.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Qo.prototype=Object.assign(Object.create(Jo.prototype),{constructor:Qo,isSpotLightShadow:!0,update:function(t){var e=this.camera,i=2*Ae.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix())}}),$o.prototype=Object.assign(Object.create(Ko.prototype),{constructor:$o,isSpotLight:!0,copy:function(t){return Ko.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),tc.prototype=Object.assign(Object.create(Ko.prototype),{constructor:tc,isPointLight:!0,copy:function(t){return Ko.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),ec.prototype=Object.assign(Object.create(Jo.prototype),{constructor:ec}),ic.prototype=Object.assign(Object.create(Ko.prototype),{constructor:ic,isDirectionalLight:!0,copy:function(t){return Ko.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),nc.prototype=Object.assign(Object.create(Ko.prototype),{constructor:nc,isAmbientLight:!0}),rc.prototype=Object.assign(Object.create(Ko.prototype),{constructor:rc,isRectAreaLight:!0,copy:function(t){return Ko.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Ko.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),ac.prototype=Object.assign(Object.create(mc.prototype),{constructor:ac,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:he,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),sc.prototype=Object.assign(Object.create(mc.prototype),{constructor:sc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:he,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(oc.prototype,{evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{var a;i:{n:if(!(t<n)){for(var s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,t<(n=e[++i]))break e}a=e.length;break i}if(t>=r)break t;var o=e[1];t<o&&(i=2,r=o);for(s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,t>=(r=e[--i-1]))break e}a=i,i=0}for(;i<a;){var c=i+a>>>1;t<e[c]?a=c:i=c+1}if(n=e[i],void 0===(r=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n,a=0;a!==n;++a)e[a]=i[r+a];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(oc.prototype,{beforeStart_:oc.prototype.copySampleValue_,afterEnd_:oc.prototype.copySampleValue_}),cc.prototype=Object.assign(Object.create(oc.prototype),{constructor:cc,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,c=(i-e)/(n-e),l=o+s;o!==l;o+=4)Le.slerpFlat(r,0,a,o-s,a,o,c);return r}}),lc.prototype=Object.assign(Object.create(mc.prototype),{constructor:lc,ValueTypeName:"quaternion",DefaultInterpolation:ue,InterpolantFactoryMethodLinear:function(t){return new cc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),hc.prototype=Object.assign(Object.create(mc.prototype),{constructor:hc,ValueTypeName:"color"}),uc.prototype=Object.assign(Object.create(mc.prototype),{constructor:uc,ValueTypeName:"number"}),fc.prototype=Object.assign(Object.create(oc.prototype),{constructor:fc,DefaultSettings_:{endingStart:fe,endingEnd:fe},intervalChanged_:function(t,e,i){var n=this.parameterPositions,r=t-2,a=t+1,s=n[r],o=n[a];if(void 0===s)switch(this.getSettings_().endingStart){case de:r=t,s=2*e-i;break;case pe:s=e+n[r=n.length-2]-n[r+1];break;default:r=t,s=i}if(void 0===o)switch(this.getSettings_().endingEnd){case de:a=t,o=2*i-e;break;case pe:a=1,o=i+n[1]-n[0];break;default:a=t-1,o=e}var c=.5*(i-e),l=this.valueSize;this._weightPrev=c/(e-s),this._weightNext=c/(o-i),this._offsetPrev=r*l,this._offsetNext=a*l},interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,c=o-s,l=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,f=this._weightNext,d=(i-e)/(n-e),p=d*d,g=p*d,m=-u*g+2*u*p-u*d,v=(1+u)*g+(-1.5-2*u)*p+(-.5+u)*d+1,y=(-1-f)*g+(1.5+f)*p+.5*d,_=f*g-f*p,b=0;b!==s;++b)r[b]=m*a[l+b]+v*a[c+b]+y*a[o+b]+_*a[h+b];return r}}),dc.prototype=Object.assign(Object.create(oc.prototype),{constructor:dc,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,c=o-s,l=(i-e)/(n-e),h=1-l,u=0;u!==s;++u)r[u]=a[c+u]*h+a[o+u]*l;return r}}),pc.prototype=Object.assign(Object.create(oc.prototype),{constructor:pc,interpolate_:function(t){return this.copySampleValue_(t-1)}});var gc={arraySlice:function(t,e,i){return gc.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,i=new Array(e),n=0;n!==e;++n)i[n]=n;return i.sort(function(e,i){return t[e]-t[i]}),i},sortedArray:function(t,e,i){for(var n=t.length,r=new t.constructor(n),a=0,s=0;s!==n;++a)for(var o=i[a]*e,c=0;c!==e;++c)r[s++]=t[o+c];return r},flattenJSON:function(t,e,i,n){for(var r=1,a=t[0];void 0!==a&&void 0===a[n];)a=t[r++];if(void 0!==a){var s=a[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=a[n])&&(e.push(a.time),i.push.apply(i,s)),a=t[r++]}while(void 0!==a);else if(void 0!==s.toArray)do{void 0!==(s=a[n])&&(e.push(a.time),s.toArray(i,i.length)),a=t[r++]}while(void 0!==a);else do{void 0!==(s=a[n])&&(e.push(a.time),i.push(s)),a=t[r++]}while(void 0!==a)}}};function mc(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=gc.convertArray(e,this.TimeBufferType),this.values=gc.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function vc(t,e,i,n){mc.call(this,t,e,i,n)}function yc(t,e,i){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.uuid=Ae.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function _c(t){this.manager=void 0!==t?t:yo,this.textures={}}function bc(t){this.manager=void 0!==t?t:yo}Object.assign(mc,{parse:function(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=mc._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var i=[],n=[];gc.flattenJSON(t.keys,i,n,"value"),t.times=i,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,i=t.constructor;if(void 0!==i.toJSON)e=i.toJSON(t);else{e={name:t.name,times:gc.convertArray(t.times,Array),values:gc.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uc;case"vector":case"vector2":case"vector3":case"vector4":return vc;case"color":return hc;case"quaternion":return lc;case"bool":case"boolean":return sc;case"string":return ac}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}}),Object.assign(mc.prototype,{constructor:mc,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ue,InterpolantFactoryMethodDiscrete:function(t){return new pc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new dc(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new fc(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case he:e=this.InterpolantFactoryMethodDiscrete;break;case ue:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return he;case this.InterpolantFactoryMethodLinear:return ue;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,n=i.length,r=0,a=n-1;r!==n&&i[r]<t;)++r;for(;-1!==a&&i[a]>e;)--a;if(++a,0!==r||a!==n){r>=a&&(r=(a=Math.max(a,1))-1);var s=this.getValueSize();this.times=gc.arraySlice(i,r,a),this.values=gc.arraySlice(this.values,r*s,a*s)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(t=!1);var i=this.times,n=this.values,r=i.length;0===r&&(t=!1);for(var a=null,s=0;s!==r;s++){var o=i[s];if("number"==typeof o&&isNaN(o)){t=!1;break}if(null!==a&&a>o){t=!1;break}a=o}if(void 0!==n&&gc.isTypedArray(n)){s=0;for(var c=n.length;s!==c;++s){var l=n[s];if(isNaN(l)){t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),n=2302===this.getInterpolation(),r=1,a=t.length-1,s=1;s<a;++s){var o=!1,c=t[s];if(c!==t[s+1]&&(1!==s||c!==c[0]))if(n)o=!0;else for(var l=s*i,h=l-i,u=l+i,f=0;f!==i;++f){var d=e[l+f];if(d!==e[h+f]||d!==e[u+f]){o=!0;break}}if(o){if(s!==r){t[r]=t[s];var p=s*i,g=r*i;for(f=0;f!==i;++f)e[g+f]=e[p+f]}++r}}if(a>0){t[r]=t[a];for(p=a*i,g=r*i,f=0;f!==i;++f)e[g+f]=e[p+f];++r}return r!==t.length&&(this.times=gc.arraySlice(t,0,r),this.values=gc.arraySlice(e,0,r*i)),this}}),vc.prototype=Object.assign(Object.create(mc.prototype),{constructor:vc,ValueTypeName:"vector"}),Object.assign(yc,{parse:function(t){for(var e=[],i=t.tracks,n=1/(t.fps||1),r=0,a=i.length;r!==a;++r)e.push(mc.parse(i[r]).scale(n));return new yc(t.name,t.duration,e)},toJSON:function(t){for(var e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e},r=0,a=i.length;r!==a;++r)e.push(mc.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(t,e,i,n){for(var r=e.length,a=[],s=0;s<r;s++){var o=[],c=[];o.push((s+r-1)%r,s,(s+1)%r),c.push(0,1,0);var l=gc.getKeyframeOrder(o);o=gc.sortedArray(o,1,l),c=gc.sortedArray(c,1,l),n||0!==o[0]||(o.push(r),c.push(c[0])),a.push(new uc(".morphTargetInfluences["+e[s].name+"]",o,c).scale(1/i))}return new yc(t,-1,a)},findByName:function(t,e){var i=t;if(!Array.isArray(t)){var n=t;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,a=0,s=t.length;a<s;a++){var o=t[a],c=o.name.match(r);if(c&&c.length>1){var l=n[u=c[1]];l||(n[u]=l=[]),l.push(o)}}var h=[];for(var u in n)h.push(yc.CreateFromMorphTargetSequence(u,n[u],e,i));return h},parseAnimation:function(t,e){if(!t)return null;for(var i=function(t,e,i,n,r){if(0!==i.length){var a=[],s=[];gc.flattenJSON(i,a,s,n),0!==a.length&&r.push(new t(e,a,s))}},n=[],r=t.name||"default",a=t.length||-1,s=t.fps||30,o=t.hierarchy||[],c=0;c<o.length;c++){var l=o[c].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var h={},u=0;u<l.length;u++)if(l[u].morphTargets)for(var f=0;f<l[u].morphTargets.length;f++)h[l[u].morphTargets[f]]=-1;for(var d in h){var p=[],g=[];for(f=0;f!==l[u].morphTargets.length;++f){var m=l[u];p.push(m.time),g.push(m.morphTarget===d?1:0)}n.push(new uc(".morphTargetInfluence["+d+"]",p,g))}a=h.length*(s||1)}else{var v=".bones["+e[c].name+"]";i(vc,v+".position",l,"pos",n),i(lc,v+".quaternion",l,"rot",n),i(vc,v+".scale",l,"scl",n)}}return 0===n.length?null:new yc(r,a,n)}}),Object.assign(yc.prototype,{resetDuration:function(){for(var t=0,e=0,i=this.tracks.length;e!==i;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),Object.assign(_c.prototype,{load:function(t,e,i,n){var r=this;new bo(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function i(t){return e[t],e[t]}var n=new go[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalScale){var r=t.normalScale;!1===Array.isArray(r)&&(r=[r,r]),n.normalScale=(new Me).fromArray(r)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),n}}),Object.assign(bc.prototype,{load:function(t,e,i,n){var r=this;new bo(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},parse:function(t){var e=new kr,i=t.data.index;if(void 0!==i){var n=new Cc[i.type](i.array);e.setIndex(new Yn(n,1))}var r=t.data.attributes;for(var a in r){var s=r[a];n=new Cc[s.type](s.array);e.addAttribute(a,new Yn(n,s.itemSize,s.normalized))}var o=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==o)for(var c=0,l=o.length;c!==l;++c){var h=o[c];e.addGroup(h.start,h.count,h.materialIndex)}var u=t.data.boundingSphere;if(void 0!==u){var f=new Pe;void 0!==u.center&&f.fromArray(u.center),e.boundingSphere=new cn(f,u.radius)}return e}});var xc,Sc,wc,Tc,Cc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ec(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}Ec.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,i=0,n=e.length;i<n;i+=2){var r=e[i],a=e[i+1];if(r.test(t))return a}return null}},Object.assign(Ec.prototype,{crossOrigin:void 0,initMaterials:function(t,e,i){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e,i);return n},createMaterial:(xc={NoBlending:D,NormalBlending:N,AdditiveBlending:U,SubtractiveBlending:F,MultiplyBlending:B,CustomBlending:k},Sc=new Mi,wc=new Co,Tc=new _c,function(t,e,i){var n={};function r(t,r,a,s,o){var c,l=e+t,h=Ec.Handlers.get(l);null!==h?c=h.load(l):(wc.setCrossOrigin(i),c=wc.load(l)),void 0!==r&&(c.repeat.fromArray(r),1!==r[0]&&(c.wrapS=Ct),1!==r[1]&&(c.wrapT=Ct)),void 0!==a&&c.offset.fromArray(a),void 0!==s&&("repeat"===s[0]&&(c.wrapS=Ct),"mirror"===s[0]&&(c.wrapS=At),"repeat"===s[1]&&(c.wrapT=Ct),"mirror"===s[1]&&(c.wrapT=At)),void 0!==o&&(c.anisotropy=o);var u=Ae.generateUUID();return n[u]=c,u}var a={uuid:Ae.generateUUID(),type:"MeshLambertMaterial"};for(var s in t){var o=t[s];switch(s){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":a.name=o;break;case"blending":a.blending=xc[o];break;case"colorAmbient":case"mapAmbient":break;case"colorDiffuse":a.color=Sc.fromArray(o).getHex();break;case"colorSpecular":a.specular=Sc.fromArray(o).getHex();break;case"colorEmissive":a.emissive=Sc.fromArray(o).getHex();break;case"specularCoef":a.shininess=o;break;case"shading":"basic"===o.toLowerCase()&&(a.type="MeshBasicMaterial"),"phong"===o.toLowerCase()&&(a.type="MeshPhongMaterial"),"standard"===o.toLowerCase()&&(a.type="MeshStandardMaterial");break;case"mapDiffuse":a.map=r(o,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":a.emissiveMap=r(o,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":a.lightMap=r(o,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":a.aoMap=r(o,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":a.bumpMap=r(o,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":a.bumpScale=o;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":a.normalMap=r(o,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":a.normalScale=[o,o];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":a.specularMap=r(o,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":a.metalnessMap=r(o,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":a.roughnessMap=r(o,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":a.alphaMap=r(o,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":a.side=O;break;case"doubleSided":a.side=L;break;case"transparency":a.opacity=o;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":a[s]=o;break;case"vertexColors":!0===o&&(a.vertexColors=R),"face"===o&&(a.vertexColors=I)}}return"MeshBasicMaterial"===a.type&&delete a.emissive,"MeshPhongMaterial"!==a.type&&delete a.specular,a.opacity<1&&(a.transparent=!0),Tc.setTextures(n),Tc.parse(a)})});var Ac,Mc={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);return e},extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")}};function Oc(t){"boolean"==typeof t&&(t=void 0),this.manager=void 0!==t?t:yo,this.withCredentials=!1}function Lc(t){this.manager=void 0!==t?t:yo,this.texturePath=""}Object.assign(Oc.prototype,{load:function(t,e,i,n){var r=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Mc.extractUrlBase(t),s=new bo(this.manager);s.setWithCredentials(this.withCredentials),s.load(t,function(t){var i=JSON.parse(t),n=i.metadata;if(void 0!==n){var s=n.type;if(void 0!==s){if("object"===s.toLowerCase())return;if("scene"===s.toLowerCase())return}}var o=r.parse(i,a);e(o.geometry,o.materials)},i,n)},setTexturePath:function(t){this.texturePath=t},parse:function(){return function(t,e){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var i=new Xn;return function(t,e){function i(t,e){return t&1<<e}var n,r,a,s,o,c,l,h,u,f,d,p,g,m,v,y,_,b,x,S,w,T,C,E,A,M=t.faces,O=t.vertices,L=t.normals,P=t.colors,I=t.scale,R=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&R++;for(n=0;n<R;n++)e.faceVertexUvs[n]=[]}for(s=0,o=O.length;s<o;)(b=new Pe).x=O[s++]*I,b.y=O[s++]*I,b.z=O[s++]*I,e.vertices.push(b);for(s=0,o=M.length;s<o;)if(d=i(f=M[s++],0),p=i(f,1),g=i(f,3),m=i(f,4),v=i(f,5),y=i(f,6),_=i(f,7),d){if((S=new Bn).a=M[s],S.b=M[s+1],S.c=M[s+3],(w=new Bn).a=M[s+1],w.b=M[s+2],w.c=M[s+3],s+=4,p&&(u=M[s++],S.materialIndex=u,w.materialIndex=u),a=e.faces.length,g)for(n=0;n<R;n++)for(E=t.uvs[n],e.faceVertexUvs[n][a]=[],e.faceVertexUvs[n][a+1]=[],r=0;r<4;r++)A=new Me(E[2*(h=M[s++])],E[2*h+1]),2!==r&&e.faceVertexUvs[n][a].push(A),0!==r&&e.faceVertexUvs[n][a+1].push(A);if(m&&(l=3*M[s++],S.normal.set(L[l++],L[l++],L[l]),w.normal.copy(S.normal)),v)for(n=0;n<4;n++)l=3*M[s++],C=new Pe(L[l++],L[l++],L[l]),2!==n&&S.vertexNormals.push(C),0!==n&&w.vertexNormals.push(C);if(y&&(T=P[c=M[s++]],S.color.setHex(T),w.color.setHex(T)),_)for(n=0;n<4;n++)T=P[c=M[s++]],2!==n&&S.vertexColors.push(new Mi(T)),0!==n&&w.vertexColors.push(new Mi(T));e.faces.push(S),e.faces.push(w)}else{if((x=new Bn).a=M[s++],x.b=M[s++],x.c=M[s++],p&&(u=M[s++],x.materialIndex=u),a=e.faces.length,g)for(n=0;n<R;n++)for(E=t.uvs[n],e.faceVertexUvs[n][a]=[],r=0;r<3;r++)A=new Me(E[2*(h=M[s++])],E[2*h+1]),e.faceVertexUvs[n][a].push(A);if(m&&(l=3*M[s++],x.normal.set(L[l++],L[l++],L[l])),v)for(n=0;n<3;n++)l=3*M[s++],C=new Pe(L[l++],L[l++],L[l]),x.vertexNormals.push(C);if(y&&(c=M[s++],x.color.setHex(P[c])),_)for(n=0;n<3;n++)c=M[s++],x.vertexColors.push(new Mi(P[c]));e.faces.push(x)}}(t,i),function(t,e){var i=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,r=t.skinWeights.length;n<r;n+=i){var a=t.skinWeights[n],s=i>1?t.skinWeights[n+1]:0,o=i>2?t.skinWeights[n+2]:0,c=i>3?t.skinWeights[n+3]:0;e.skinWeights.push(new Fe(a,s,o,c))}if(t.skinIndices)for(n=0,r=t.skinIndices.length;n<r;n+=i){var l=t.skinIndices[n],h=i>1?t.skinIndices[n+1]:0,u=i>2?t.skinIndices[n+2]:0,f=i>3?t.skinIndices[n+3]:0;e.skinIndices.push(new Fe(l,h,u,f))}e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,i),function(t,e){var i=t.scale;if(void 0!==t.morphTargets)for(var n=0,r=t.morphTargets.length;n<r;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var a=e.morphTargets[n].vertices,s=t.morphTargets[n].vertices,o=0,c=s.length;o<c;o+=3){var l=new Pe;l.x=s[o]*i,l.y=s[o+1]*i,l.z=s[o+2]*i,a.push(l)}}if(void 0!==t.morphColors&&t.morphColors.length>0){var h=e.faces,u=t.morphColors[0].colors;for(n=0,r=h.length;n<r;n++)h[n].color.fromArray(u,3*n)}}(t,i),function(t,e){var i=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var r=0;r<n.length;r++){var a=yc.parseAnimation(n[r],e.bones);a&&i.push(a)}if(e.morphTargets){var s=yc.CreateClipsFromMorphTargetSequences(e.morphTargets,10);i=i.concat(s)}i.length>0&&(e.animations=i)}(t,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:i}:{geometry:i,materials:Ec.prototype.initMaterials(t.materials,e,this.crossOrigin)}}}()}),Object.assign(Lc.prototype,{load:function(t,e,i,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var r=this;new bo(r.manager).load(t,function(t){var i=null;try{i=JSON.parse(t)}catch(t){return void(void 0!==n&&n(t))}var a=i.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()&&r.parse(i,e)},i,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var i=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,i),r=this.parseImages(t.images,function(){void 0!==e&&e(o)}),a=this.parseTextures(t.textures,r),s=this.parseMaterials(t.materials,a),o=this.parseObject(t.object,n,s);return t.animations&&(o.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(o),o},parseShape:function(t){var e={};if(void 0!==t)for(var i=0,n=t.length;i<n;i++){var r=(new qo).fromJSON(t[i]);e[r.uuid]=r}return e},parseGeometries:function(t,e){var i={};if(void 0!==t)for(var n=new Oc,r=new bc,a=0,s=t.length;a<s;a++){var o,c=t[a];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new ro[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new ro[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new ro[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new ro[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new ro[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new ro[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new ro[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new ro[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new ro[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new ro[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":o=new ro[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new ro[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var l=[];for(a=0,s=c.shapes.length;a<s;a++){var h=e[c.shapes[a]];l.push(h)}o=new ro[c.type](l,c.curveSegments);break;case"BufferGeometry":o=r.parse(c);break;case"Geometry":o=n.parse(c,this.texturePath).geometry;break;default:continue}o.uuid=c.uuid,void 0!==c.name&&(o.name=c.name),i[c.uuid]=o}return i},parseMaterials:function(t,e){var i={};if(void 0!==t){var n=new _c;n.setTextures(e);for(var r=0,a=t.length;r<a;r++){var s=t[r];if("MultiMaterial"===s.type){for(var o=[],c=0;c<s.materials.length;c++)o.push(n.parse(s.materials[c]));i[s.uuid]=o}else i[s.uuid]=n.parse(s)}}return i},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var n=yc.parse(t[i]);e.push(n)}return e},parseImages:function(t,e){var i=this,n={};function r(t){return i.manager.itemStart(t),a.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemEnd(t),i.manager.itemError(t)})}if(void 0!==t&&t.length>0){var a=new wo(new vo(e));a.setCrossOrigin(this.crossOrigin);for(var s=0,o=t.length;s<o;s++){var c=t[s],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.texturePath+c.url;n[c.uuid]=r(l)}}return n},parseTextures:function(t,e){function i(t,e){return"number"==typeof t?t:e[t]}var n={};if(void 0!==t)for(var r=0,a=t.length;r<a;r++){var s=t[r];s.image,e[s.image];var o=new Ue(e[s.image]);o.needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=i(s.mapping,Ic)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=i(s.wrap[0],Rc),o.wrapT=i(s.wrap[1],Rc)),void 0!==s.minFilter&&(o.minFilter=i(s.minFilter,Dc)),void 0!==s.magFilter&&(o.magFilter=i(s.magFilter,Dc)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),n[s.uuid]=o}return n},parseObject:(Ac=new Oe,function(t,e,i){var n;function r(t){return e[t],e[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,r=t.length;n<r;n++){var a=t[n];i[a],e.push(i[a])}return e}return i[t],i[t]}}switch(t.type){case"Scene":n=new Ra,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new Mi(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Ia(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new Pa(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new Ea(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new Fn(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":n=new nc(t.color,t.intensity);break;case"DirectionalLight":n=new ic(t.color,t.intensity);break;case"PointLight":n=new tc(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new rc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new $o(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new Zo(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":case"Mesh":var s=r(t.geometry),o=a(t.material);n=s.bones&&s.bones.length>0?new ja(s,o):new Kr(s,o);break;case"LOD":n=new Fa;break;case"Line":n=new za(r(t.geometry),a(t.material),t.mode);break;case"LineLoop":n=new Va(r(t.geometry),a(t.material));break;case"LineSegments":n=new Ha(r(t.geometry),a(t.material));break;case"PointCloud":case"Points":n=new Xa(r(t.geometry),a(t.material));break;case"Sprite":n=new Ua(a(t.material));break;case"Group":n=new Ya;break;default:n=new Nn}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(Ac.fromArray(t.matrix),Ac.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var c=t.children,l=0;l<c.length;l++)n.add(this.parseObject(c[l],e,i));if("LOD"===t.type)for(var h=t.levels,u=0;u<h.length;u++){var f=h[u],d=n.getObjectByProperty("uuid",f.object);void 0!==d&&n.addLevel(d,f.distance)}return n})});var Pc,Ic={UVMapping:300,CubeReflectionMapping:yt,CubeRefractionMapping:_t,EquirectangularReflectionMapping:bt,EquirectangularRefractionMapping:xt,SphericalReflectionMapping:St,CubeUVReflectionMapping:wt,CubeUVRefractionMapping:Tt},Rc={RepeatWrapping:Ct,ClampToEdgeWrapping:Et,MirroredRepeatWrapping:At},Dc={NearestFilter:Mt,NearestMipMapNearestFilter:Ot,NearestMipMapLinearFilter:Lt,LinearFilter:Pt,LinearMipMapNearestFilter:It,LinearMipMapLinearFilter:Rt};function Nc(t){this.manager=void 0!==t?t:yo,this.options=void 0}function Uc(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function Fc(t){this.type="Font",this.data=t}function Bc(t){this.manager=void 0!==t?t:yo}Nc.prototype={constructor:Nc,setOptions:function(t){return this.options=t,this},load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,a=mo.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;fetch(t).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,r.options)}).then(function(i){mo.add(t,i),e&&e(i),r.manager.itemEnd(t)}).catch(function(e){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)})},setCrossOrigin:function(){return this},setPath:function(t){return this.path=t,this}},Object.assign(Uc.prototype,{moveTo:function(t,e){this.currentPath=new Yo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){this.currentPath.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,a){this.currentPath.bezierCurveTo(t,e,i,n,r,a)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function i(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i],a=new qo;a.curves=r.curves,e.push(a)}return e}function n(t,e){for(var i=e.length,n=!1,r=i-1,a=0;a<i;r=a++){var s=e[r],o=e[a],c=o.x-s.x,l=o.y-s.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(s=e[a],c=-c,o=e[r],l=-l),t.y<s.y||t.y>o.y)continue;if(t.y===s.y){if(t.x===s.x)return!0}else{var h=l*(t.x-s.x)-c*(t.y-s.y);if(0===h)return!0;if(h<0)continue;n=!n}}else{if(t.y!==s.y)continue;if(o.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=o.x)return!0}}return n}var r=Fs.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return i(a);var s,o,c,l=[];if(1===a.length)return o=a[0],(c=new qo).curves=o.curves,l.push(c),l;var h=!r(a[0].getPoints());h=t?!h:h;var u,f,d=[],p=[],g=[],m=0;p[m]=void 0,g[m]=[];for(var v=0,y=a.length;v<y;v++)s=r(u=(o=a[v]).getPoints()),(s=t?!s:s)?(!h&&p[m]&&m++,p[m]={s:new qo,p:u},p[m].s.curves=o.curves,h&&m++,g[m]=[]):g[m].push({h:o,p:u[0]});if(!p[0])return i(a);if(p.length>1){for(var _=!1,b=[],x=0,S=p.length;x<S;x++)d[x]=[];for(x=0,S=p.length;x<S;x++)for(var w=g[x],T=0;T<w.length;T++){for(var C=w[T],E=!0,A=0;A<p.length;A++)n(C.p,p[A].p)&&(x!==A&&b.push({froms:x,tos:A,hole:T}),E?(E=!1,d[A].push(C)):_=!0);E&&d[x].push(C)}b.length>0&&(_||(g=d))}v=0;for(var M=p.length;v<M;v++){c=p[v].s,l.push(c);for(var O=0,L=(f=g[v]).length;O<L;O++)c.holes.push(f[O].h)}return l}}),Object.assign(Fc.prototype,{isFont:!0,generateShapes:function(t,e,i){function n(t,e,i,n){var a=r.glyphs[t]||r.glyphs["?"];if(a){var s,o,c,l,h,u,f,d,p,g=new Uc,m=[];if(a.o)for(var v=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),y=0,_=v.length;y<_;){switch(v[y++]){case"m":s=v[y++]*e+i,o=v[y++]*e+n,g.moveTo(s,o);break;case"l":s=v[y++]*e+i,o=v[y++]*e+n,g.lineTo(s,o);break;case"q":c=v[y++]*e+i,l=v[y++]*e+n,h=v[y++]*e+i,u=v[y++]*e+n,g.quadraticCurveTo(h,u,c,l),(p=m[m.length-1])&&(p.x,p.y);break;case"b":c=v[y++]*e+i,l=v[y++]*e+n,h=v[y++]*e+i,u=v[y++]*e+n,f=v[y++]*e+i,d=v[y++]*e+n,g.bezierCurveTo(h,u,f,d,c,l),(p=m[m.length-1])&&(p.x,p.y)}}return{offsetX:a.ha*e,path:g}}}void 0===e&&(e=100),void 0===i&&(i=4);for(var r=this.data,a=function(t){for(var i=String(t).split(""),a=e/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*a,o=0,c=0,l=[],h=0;h<i.length;h++){var u=i[h];if("\n"===u)o=0,c-=s;else{var f=n(u,a,o,c);o+=f.offsetX,l.push(f.path)}}return l}(t),s=[],o=0,c=a.length;o<c;o++)Array.prototype.push.apply(s,a[o].toShapes());return s}}),Object.assign(Bc.prototype,{load:function(t,e,i,n){var r=this,a=new bo(this.manager);a.setPath(this.path),a.load(t,function(t){var i;try{i=JSON.parse(t)}catch(e){i=JSON.parse(t.substring(65,t.length-2))}var n=r.parse(i);e&&e(n)},i,n)},parse:function(t){return new Fc(t)},setPath:function(t){return this.path=t,this}});var kc,jc,Gc,zc,Hc,Vc,Wc,Xc,Yc,qc,Kc,Zc,Jc,Qc,$c,tl,el,il,nl,rl,al,sl,ol,cl,ll,hl,ul,fl,dl,pl,gl,ml,vl,yl,_l,bl,xl,Sl,wl,Tl={getContext:function(){return void 0===Pc&&(Pc=new(window.AudioContext||window.webkitAudioContext)),Pc},setContext:function(t){Pc=t}};function Cl(t){this.manager=void 0!==t?t:yo}function El(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ea,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ea,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Al(t,e,i){Nn.call(this),this.type="CubeCamera";var n=new Ea(90,1,t,e);n.up.set(0,-1,0),n.lookAt(new Pe(1,0,0)),this.add(n);var r=new Ea(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new Pe(-1,0,0)),this.add(r);var a=new Ea(90,1,t,e);a.up.set(0,0,1),a.lookAt(new Pe(0,1,0)),this.add(a);var s=new Ea(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new Pe(0,-1,0)),this.add(s);var o=new Ea(90,1,t,e);o.up.set(0,-1,0),o.lookAt(new Pe(0,0,1)),this.add(o);var c=new Ea(90,1,t,e);c.up.set(0,-1,0),c.lookAt(new Pe(0,0,-1)),this.add(c);var l={format:Yt,magFilter:Pt,minFilter:Pt};this.renderTarget=new ke(i,i,l),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,l=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,t.render(e,n,i),i.activeCubeFace=1,t.render(e,r,i),i.activeCubeFace=2,t.render(e,a,i),i.activeCubeFace=3,t.render(e,s,i),i.activeCubeFace=4,t.render(e,o,i),i.texture.generateMipmaps=l,i.activeCubeFace=5,t.render(e,c,i),t.setRenderTarget(null)},this.clear=function(t,e,i,n){for(var r=this.renderTarget,a=0;a<6;a++)r.activeCubeFace=a,t.setRenderTarget(r),t.clear(e,i,n);t.setRenderTarget(null)}}function Ml(){Nn.call(this),this.type="AudioListener",this.context=Tl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Ol(t){Nn.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Ll(t){Ol.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Pl(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function Il(t,e,i){this.binding=t,this.valueSize=i;var n,r=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Rl(t,e,i){var n=i||Dl.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function Dl(t,e,i){this.path=e,this.parsedPath=i||Dl.parseTrackName(e),this.node=Dl.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function Nl(){this.uuid=Ae.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function Ul(t,e,i){this._mixer=t,this._clip=e,this._localRoot=i||null;for(var n=e.tracks,r=n.length,a=new Array(r),s={endingStart:fe,endingEnd:fe},o=0;o!==r;++o){var c=n[o].createInterpolant(null);a[o]=c,c.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=le,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Fl(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Bl(t){"string"==typeof t&&(t=arguments[1]),this.value=t}function kl(){kr.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function jl(t,e,i,n){this.uuid=Ae.generateUUID(),this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}function Gl(t,e){this.uuid=Ae.generateUUID(),this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function zl(t,e,i){Gl.call(this,t,e),this.meshPerAttribute=i||1}function Hl(t,e,i){Yn.call(this,t,e),this.meshPerAttribute=i||1}function Vl(t,e,i,n){this.ray=new Xr(t,e),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return this.Points}}})}function Wl(t,e){return t.distance-e.distance}function Xl(t,e,i,n){if(!1!==t.visible&&(t.raycast(e,i),!0===n))for(var r=t.children,a=0,s=r.length;a<s;a++)Xl(r[a],e,i,!0)}function Yl(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function ql(t,e,i){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0,this}function Kl(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}function Zl(t){Nn.call(this),this.material=t,this.render=function(){}}function Jl(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16711680,a=void 0!==n?n:1,s=0,o=this.object.geometry;o&&o.isGeometry?s=3*o.faces.length:o&&o.isBufferGeometry&&(s=o.attributes.normal.count);var c=new kr,l=new er(2*s*3,3);c.addAttribute("position",l),Ha.call(this,c,new Ga({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Ql(t,e){Nn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var i=new kr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,a=1;r<32;r++,a++){var s=r/32*Math.PI*2,o=a/32*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(o),Math.sin(o),1)}i.addAttribute("position",new er(n,3));var c=new Ga({fog:!1});this.cone=new Ha(i,c),this.add(this.cone),this.update()}function $l(t){for(var e=function t(e){var i=[];e&&e.isBone&&i.push(e);for(var n=0;n<e.children.length;n++)i.push.apply(i,t(e.children[n]));return i}(t),i=new kr,n=[],r=[],a=new Mi(0,0,1),s=new Mi(0,1,0),o=0;o<e.length;o++){var c=e[o];c.parent&&c.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(a.r,a.g,a.b),r.push(s.r,s.g,s.b))}i.addAttribute("position",new er(n,3)),i.addAttribute("color",new er(r,3));var l=new Ga({vertexColors:R,depthTest:!1,depthWrite:!1,transparent:!0});Ha.call(this,i,l),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function th(t,e,i){this.light=t,this.light.updateMatrixWorld(),this.color=i;var n=new Hs(e,4,2),r=new Vr({wireframe:!0,fog:!1});Kr.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function eh(t,e){Nn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var i=new Ga({fog:!1}),n=new kr;n.addAttribute("position",new Yn(new Float32Array(15),3)),this.line=new za(n,i),this.add(this.line),this.update()}function ih(t,e,i){Nn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var n=new as(e);n.rotateY(.5*Math.PI),this.material=new Vr({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=R);var r=n.getAttribute("position"),a=new Float32Array(3*r.count);n.addAttribute("color",new Yn(a,3)),this.add(new Kr(n,this.material)),this.update()}function nh(t,e,i,n){t=t||10,e=e||10,i=new Mi(void 0!==i?i:4473924),n=new Mi(void 0!==n?n:8947848);for(var r=e/2,a=t/e,s=t/2,o=[],c=[],l=0,h=0,u=-s;l<=e;l++,u+=a){o.push(-s,0,u,s,0,u),o.push(u,0,-s,u,0,s);var f=l===r?i:n;f.toArray(c,h),h+=3,f.toArray(c,h),h+=3,f.toArray(c,h),h+=3,f.toArray(c,h),h+=3}var d=new kr;d.addAttribute("position",new er(o,3)),d.addAttribute("color",new er(c,3));var p=new Ga({vertexColors:R});Ha.call(this,d,p)}function rh(t,e,i,n,r,a){t=t||10,e=e||16,i=i||8,n=n||64,r=new Mi(void 0!==r?r:4473924),a=new Mi(void 0!==a?a:8947848);var s,o,c,l,h,u,f,d=[],p=[];for(l=0;l<=e;l++)c=l/e*(2*Math.PI),s=Math.sin(c)*t,o=Math.cos(c)*t,d.push(0,0,0),d.push(s,0,o),f=1&l?r:a,p.push(f.r,f.g,f.b),p.push(f.r,f.g,f.b);for(l=0;l<=i;l++)for(f=1&l?r:a,u=t-t/i*l,h=0;h<n;h++)c=h/n*(2*Math.PI),s=Math.sin(c)*u,o=Math.cos(c)*u,d.push(s,0,o),p.push(f.r,f.g,f.b),c=(h+1)/n*(2*Math.PI),s=Math.sin(c)*u,o=Math.cos(c)*u,d.push(s,0,o),p.push(f.r,f.g,f.b);var g=new kr;g.addAttribute("position",new er(d,3)),g.addAttribute("color",new er(p,3));var m=new Ga({vertexColors:R});Ha.call(this,g,m)}function ah(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16776960,a=void 0!==n?n:1,s=0,o=this.object.geometry;o&&o.isGeometry&&(s=o.faces.length);var c=new kr,l=new er(2*s*3,3);c.addAttribute("position",l),Ha.call(this,c,new Ga({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function sh(t,e,i){Nn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);var n=new kr;n.addAttribute("position",new er([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var r=new Ga({fog:!1});this.lightPlane=new za(n,r),this.add(this.lightPlane),(n=new kr).addAttribute("position",new er([0,0,0,0,0,1],3)),this.targetLine=new za(n,r),this.add(this.targetLine),this.update()}function oh(t){var e=new kr,i=new Ga({color:16777215,vertexColors:I}),n=[],r=[],a={},s=new Mi(16755200),o=new Mi(16711680),c=new Mi(43775),l=new Mi(16777215),h=new Mi(3355443);function u(t,e,i){f(t,i),f(e,i)}function f(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}u("n1","n2",s),u("n2","n4",s),u("n4","n3",s),u("n3","n1",s),u("f1","f2",s),u("f2","f4",s),u("f4","f3",s),u("f3","f1",s),u("n1","f1",s),u("n2","f2",s),u("n3","f3",s),u("n4","f4",s),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",c),u("u2","u3",c),u("u3","u1",c),u("c","t",l),u("p","c",h),u("cn1","cn2",h),u("cn3","cn4",h),u("cf1","cf2",h),u("cf3","cf4",h),e.addAttribute("position",new er(n,3)),e.addAttribute("color",new er(r,3)),Ha.call(this,e,i),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function ch(t,e){this.object=t,void 0===e&&(e=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new kr;r.setIndex(new Yn(i,1)),r.addAttribute("position",new Yn(n,3)),Ha.call(this,r,new Ga({color:e})),this.matrixAutoUpdate=!1,this.update()}function lh(t,e){this.type="Box3Helper",this.box=t;var i=void 0!==e?e:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new kr;r.setIndex(new Yn(n,1)),r.addAttribute("position",new er([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Ha.call(this,r,new Ga({color:i})),this.geometry.computeBoundingSphere()}function hh(t,e,i){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==i?i:16776960,r=new kr;r.addAttribute("position",new er([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),za.call(this,r,new Ga({color:n}));var a=new kr;a.addAttribute("position",new er([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Kr(a,new Vr({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}function uh(t,e,i,n,r,a){Nn.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),void 0===r&&(r=.2*i),void 0===a&&(a=.2*r),void 0===bl&&((bl=new kr).addAttribute("position",new er([0,0,0,0,1,0],3)),(xl=new $s(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new za(bl,new Ga({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Kr(xl,new Vr({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,a)}function fh(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new kr;i.addAttribute("position",new er(e,3)),i.addAttribute("color",new er([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new Ga({vertexColors:R});Ha.call(this,i,n)}Object.assign(Cl.prototype,{load:function(t,e,i,n){var r=new bo(this.manager);r.setResponseType("arraybuffer"),r.load(t,function(t){Tl.getContext().decodeAudioData(t,function(t){e(t)})},i,n)}}),Object.assign(El.prototype,{update:(Yc=new Oe,qc=new Oe,function(t){if(kc!==this||jc!==t.focus||Gc!==t.fov||zc!==t.aspect*this.aspect||Hc!==t.near||Vc!==t.far||Wc!==t.zoom||Xc!==this.eyeSep){kc=this,jc=t.focus,Gc=t.fov,zc=t.aspect*this.aspect,Hc=t.near,Vc=t.far,Wc=t.zoom;var e,i,n=t.projectionMatrix.clone(),r=(Xc=this.eyeSep/2)*Hc/jc,a=Hc*Math.tan(Ae.DEG2RAD*Gc*.5)/Wc;qc.elements[12]=-Xc,Yc.elements[12]=Xc,e=-a*zc+r,i=a*zc+r,n.elements[0]=2*Hc/(i-e),n.elements[8]=(i+e)/(i-e),this.cameraL.projectionMatrix.copy(n),e=-a*zc-r,i=a*zc-r,n.elements[0]=2*Hc/(i-e),n.elements[8]=(i+e)/(i-e),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(qc),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Yc)})}),Al.prototype=Object.create(Nn.prototype),Al.prototype.constructor=Al,Ml.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Ml,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:(Kc=new Pe,Zc=new Le,Jc=new Pe,Qc=new Pe,function(t){Nn.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,i=this.up;this.matrixWorld.decompose(Kc,Zc,Jc),Qc.set(0,0,-1).applyQuaternion(Zc),e.positionX?(e.positionX.setValueAtTime(Kc.x,this.context.currentTime),e.positionY.setValueAtTime(Kc.y,this.context.currentTime),e.positionZ.setValueAtTime(Kc.z,this.context.currentTime),e.forwardX.setValueAtTime(Qc.x,this.context.currentTime),e.forwardY.setValueAtTime(Qc.y,this.context.currentTime),e.forwardZ.setValueAtTime(Qc.z,this.context.currentTime),e.upX.setValueAtTime(i.x,this.context.currentTime),e.upY.setValueAtTime(i.y,this.context.currentTime),e.upZ.setValueAtTime(i.z,this.context.currentTime)):(e.setPosition(Kc.x,Kc.y,Kc.z),e.setOrientation(Qc.x,Qc.y,Qc.z,i.x,i.y,i.z))})}),Ol.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Ol,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying&&!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,t.start(this.startTime,this.offset),this.isPlaying=!0,this.source=t,this.connect()}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1!==this.hasPlaybackControl&&this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),Ll.prototype=Object.assign(Object.create(Ol.prototype),{constructor:Ll,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:($c=new Pe,function(t){Nn.prototype.updateMatrixWorld.call(this,t),$c.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition($c.x,$c.y,$c.z)})}),Object.assign(Pl.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}}),Object.assign(Il.prototype,{accumulate:function(t,e){var i=this.buffer,n=this.valueSize,r=t*n+n,a=this.cumulativeWeight;if(0===a){for(var s=0;s!==n;++s)i[r+s]=i[s];a=e}else{var o=e/(a+=e);this._mixBufferRegion(i,r,0,o,n)}this.cumulativeWeight=a},apply:function(t){var e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,r<1){var s=3*e;this._mixBufferRegion(i,n,s,1-r,e)}for(var o=e,c=e+e;o!==c;++o)if(i[o]!==i[o+e]){a.setValue(i,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,i=this.valueSize,n=3*i;t.getValue(e,n);for(var r=i,a=n;r!==a;++r)e[r]=e[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,i,n,r){if(n>=.5)for(var a=0;a!==r;++a)t[e+a]=t[i+a]},_slerp:function(t,e,i,n){Le.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,n,r){for(var a=1-n,s=0;s!==r;++s){var o=e+s;t[o]=t[o]*a+t[i+s]*n}}}),Object.assign(Rl.prototype,{getValue:function(t,e){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}),Object.assign(Dl,{Composite:Rl,create:function(t,e,i){return t&&t.isAnimationObjectGroup?new Dl.Composite(t,e,i):new Dl(t,e,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:(tl=new RegExp("^"+/((?:[\w-]+[\/:])*)/.source+/([\w-\.]+)?/.source+/(?:\.([\w-]+)(?:\[(.+)\])?)?/.source+/\.([\w-]+)(?:\[(.+)\])?/.source+"$"),el=["material","materials","bones"],function(t){var e=tl.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var r=i.nodeName.substring(n+1);-1!==el.indexOf(r)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var i=function(t){for(var i=0;i<t.bones.length;i++){var n=t.bones[i];if(n.name===e)return n}return null}(t.skeleton);if(i)return i}if(t.children){var n=function(t){for(var i=0;i<t.length;i++){var r=t[i];if(r.name===e||r.uuid===e)return r;var a=n(r.children);if(a)return a}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(Dl.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)t[e++]=i[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;if(t||(t=Dl.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var a=e.objectIndex;switch(i){case"materials":if(!t.material)return;if(!t.material.materials)return;t=t.material.materials;break;case"bones":if(!t.skeleton)return;t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===a){a=s;break}break;default:if(void 0===t[i])return;t=t[i]}if(void 0!==a){if(void 0===t[a])return;t=t[a]}}var o=t[n];if(void 0!==o){var c=this.Versioning.None;void 0!==t.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var l=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return;if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return;for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(t.geometry.morphAttributes.position[s].name===r){r=s;break}}else{if(!t.geometry.morphTargets)return;for(s=0;s<this.node.geometry.morphTargets.length;s++)if(t.geometry.morphTargets[s].name===r){r=s;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var h=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+n+" but it wasn't found.",t)}}},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Dl.prototype,{_getValue_unbound:Dl.prototype.getValue,_setValue_unbound:Dl.prototype.setValue}),Object.assign(Nl.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._paths,a=this._parsedPaths,s=this._bindings,o=s.length,c=0,l=arguments.length;c!==l;++c){var h=arguments[c],u=h.uuid,f=n[u],d=void 0;if(void 0===f){f=e++,n[u]=f,t.push(h);for(var p=0,g=o;p!==g;++p)s[p].push(new Dl(h,r[p],a[p]))}else if(f<i){d=t[f];var m=--i,v=t[m];n[v.uuid]=f,t[f]=v,n[u]=m,t[m]=h;for(p=0,g=o;p!==g;++p){var y=s[p],_=y[m],b=y[f];y[f]=_,void 0===b&&(b=new Dl(h,r[p],a[p])),y[m]=b}}else t[f]!==d&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,r=n.length,a=0,s=arguments.length;a!==s;++a){var o=arguments[a],c=o.uuid,l=i[c];if(void 0!==l&&l>=e){var h=e++,u=t[h];i[u.uuid]=l,t[l]=u,i[c]=h,t[h]=o;for(var f=0,d=r;f!==d;++f){var p=n[f],g=p[h],m=p[l];p[l]=g,p[h]=m}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,a=r.length,s=0,o=arguments.length;s!==o;++s){var c=arguments[s].uuid,l=n[c];if(void 0!==l)if(delete n[c],l<i){var h=--i,u=t[h],f=t[v=--e];n[u.uuid]=l,t[l]=u,n[f.uuid]=h,t[h]=f,t.pop();for(var d=0,p=a;d!==p;++d){var g=(y=r[d])[h],m=y[v];y[l]=g,y[h]=m,y.pop()}}else{var v;n[(f=t[v=--e]).uuid]=l,t[l]=f,t.pop();for(d=0,p=a;d!==p;++d){var y;(y=r[d])[l]=y[v],y.pop()}}}this.nCachedObjects_=i},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,n=i[t],r=this._bindings;if(void 0!==n)return r[n];var a=this._paths,s=this._parsedPaths,o=this._objects,c=o.length,l=this.nCachedObjects_,h=new Array(c);n=r.length,i[t]=n,a.push(t),s.push(e),r.push(h);for(var u=l,f=o.length;u!==f;++u){var d=o[u];h[u]=new Dl(d,t,e)}return h},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){var n=this._paths,r=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];e[t[s]]=i,a[i]=o,a.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}}),Object.assign(Ul.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){var n=this._clip.duration,r=t._clip.duration,a=r/n,s=n/r;t.warp(1,a,e),this.warp(s,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var n=this._mixer,r=n.time,a=this._timeScaleInterpolant,s=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var o=a.parameterPositions,c=a.sampleValues;return o[0]=r,o[1]=r+i,c[0]=t/s,c[1]=e/s,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,n){if(this.enabled){var r=this._startTime;if(null!==r){var a=(t-r)*i;if(a<0||0===i)return;this._startTime=null,e=i*a}e*=this._updateTimeScale(t);var s=this._updateTime(e),o=this._updateWeight(t);if(o>0)for(var c=this._interpolants,l=this._propertyBindings,h=0,u=c.length;h!==u;++h)c[h].evaluate(s),l[h].accumulate(n,o)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=i)e=i;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var a=2202===n;if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),e>=i||e<0){var s=Math.floor(e/i);e-=i*s,r+=Math.abs(s);var o=this.repetitions-r;if(o<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(0===o){var c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(a&&1==(1&r))return this.time=e,i-e}return this.time=e,e},_setEndings:function(t,e,i){var n=this._interpolantSettings;i?(n.endingStart=de,n.endingEnd=de):(n.endingStart=t?this.zeroSlopeAtStart?de:fe:pe,n.endingEnd=e?this.zeroSlopeAtEnd?de:fe:pe)},_scheduleFading:function(t,e,i){var n=this._mixer,r=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var s=a.parameterPositions,o=a.sampleValues;return s[0]=r,o[0]=e,s[1]=r+t,o[1]=i,this}}),Fl.prototype=Object.assign(Object.create(e.prototype),{constructor:Fl,_bindAction:function(t,e){var i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,a=t._propertyBindings,s=t._interpolants,o=i.uuid,c=this._bindingsByRootAndName,l=c[o];void 0===l&&(l={},c[o]=l);for(var h=0;h!==r;++h){var u=n[h],f=u.name,d=l[f];if(void 0!==d)a[h]=d;else{if(void 0!==(d=a[h])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,o,f));continue}var p=e&&e._propertyBindings[h].binding.parsedPath;++(d=new Il(Dl.create(i,f,p),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(d,o,f),a[h]=d}s[h].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}for(var r=t._propertyBindings,a=0,s=r.length;a!==s;++a){var o=r[a];0==o.useCount++&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){var n=this._actions,r=this._actionsByClip,a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{var s=a.knownActions;t._byClipCacheIndex=s.length,s.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,a=this._actionsByClip,s=a[r],o=s.knownActions,c=o[o.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,o[l]=c,o.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete a[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_addInactiveBinding:function(t,e,i){var n=this._bindingsByRootAndName,r=n[e],a=this._bindings;void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,a=this._bindingsByRootAndName,s=a[n],o=e[e.length-1],c=t._cacheIndex;o._cacheIndex=c,e[c]=o,e.pop(),delete s[r];t:{for(var l in s)break t;delete a[n]}},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return void 0===i&&((i=new dc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?yc.findByName(i,t):t,a=null!==r?r.uuid:t,s=this._actionsByClip[a],o=null;if(void 0!==s){var c=s.actionByRoot[n];if(void 0!==c)return c;o=s.knownActions[0],null===r&&(r=o._clip)}if(null===r)return null;var l=new Ul(this,r,e);return this._bindAction(l,o),this._addInactiveAction(l,a,n),l},existingAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?yc.findByName(i,t):t,a=r?r.uuid:t,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==e;++r)t[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1,s=0;s!==i;++s){e[s]._update(n,t,r,a)}var o=this._bindings,c=this._nActiveBindings;for(s=0;s!==c;++s)o[s].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var a=r.knownActions,s=0,o=a.length;s!==o;++s){var c=a[s];this._deactivateAction(c);var l=c._cacheIndex,h=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=l,e[l]=h,e.pop(),this._removeInactiveBindingsForAction(c)}delete n[i]}},uncacheRoot:function(t){var e=t.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[e];if(void 0!==a)for(var s in a){var o=a[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}},uncacheAction:function(t,e){var i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),Bl.prototype.clone=function(){return new Bl(void 0===this.value.clone?this.value:this.value.clone())},kl.prototype=Object.assign(Object.create(kr.prototype),{constructor:kl,isInstancedBufferGeometry:!0,copy:function(t){return kr.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(jl.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(jl.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}}),Object.defineProperty(Gl.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Gl.prototype,{isInterleavedBuffer:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),zl.prototype=Object.assign(Object.create(Gl.prototype),{constructor:zl,isInstancedInterleavedBuffer:!0,copy:function(t){return Gl.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Hl.prototype=Object.assign(Object.create(Yn.prototype),{constructor:Hl,isInstancedBufferAttribute:!0,copy:function(t){return Yn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Vl.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld))},intersectObject:function(t,e){var i=[];return Xl(t,this,i,e),i.sort(Wl),i},intersectObjects:function(t,e){var i=[];if(!1===Array.isArray(t))return i;for(var n=0,r=t.length;n<r;n++)Xl(t[n],this,i,e);return i.sort(Wl),i}}),Object.assign(Yl.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Object.assign(ql.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Ae.clamp(t.y/this.radius,-1,1))),this}}),Object.assign(Kl.prototype,{set:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),Zl.prototype=Object.create(Nn.prototype),Zl.prototype.constructor=Zl,Zl.prototype.isImmediateRenderObject=!0,Jl.prototype=Object.create(Ha.prototype),Jl.prototype.constructor=Jl,Jl.prototype.update=(il=new Pe,nl=new Pe,rl=new Ie,function(){var t=["a","b","c"];this.object.updateMatrixWorld(!0),rl.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,i=this.geometry.attributes.position,n=this.object.geometry;if(n&&n.isGeometry)for(var r=n.vertices,a=n.faces,s=0,o=0,c=a.length;o<c;o++)for(var l=a[o],h=0,u=l.vertexNormals.length;h<u;h++){var f=r[l[t[h]]],d=l.vertexNormals[h];il.copy(f).applyMatrix4(e),nl.copy(d).applyMatrix3(rl).normalize().multiplyScalar(this.size).add(il),i.setXYZ(s,il.x,il.y,il.z),s+=1,i.setXYZ(s,nl.x,nl.y,nl.z),s+=1}else if(n&&n.isBufferGeometry){var p=n.attributes.position,g=n.attributes.normal;for(s=0,h=0,u=p.count;h<u;h++)il.set(p.getX(h),p.getY(h),p.getZ(h)).applyMatrix4(e),nl.set(g.getX(h),g.getY(h),g.getZ(h)),nl.applyMatrix3(rl).normalize().multiplyScalar(this.size).add(il),i.setXYZ(s,il.x,il.y,il.z),s+=1,i.setXYZ(s,nl.x,nl.y,nl.z),s+=1}i.needsUpdate=!0}),Ql.prototype=Object.create(Nn.prototype),Ql.prototype.constructor=Ql,Ql.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ql.prototype.update=(al=new Pe,sl=new Pe,function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),al.setFromMatrixPosition(this.light.matrixWorld),sl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(sl.sub(al)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}),$l.prototype=Object.create(Ha.prototype),$l.prototype.constructor=$l,$l.prototype.updateMatrixWorld=(ol=new Pe,cl=new Oe,ll=new Oe,function(t){var e=this.bones,i=this.geometry,n=i.getAttribute("position");ll.getInverse(this.root.matrixWorld);for(var r=0,a=0;r<e.length;r++){var s=e[r];s.parent&&s.parent.isBone&&(cl.multiplyMatrices(ll,s.matrixWorld),ol.setFromMatrixPosition(cl),n.setXYZ(a,ol.x,ol.y,ol.z),cl.multiplyMatrices(ll,s.parent.matrixWorld),ol.setFromMatrixPosition(cl),n.setXYZ(a+1,ol.x,ol.y,ol.z),a+=2)}i.getAttribute("position").needsUpdate=!0,Nn.prototype.updateMatrixWorld.call(this,t)}),th.prototype=Object.create(Kr.prototype),th.prototype.constructor=th,th.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},th.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},eh.prototype=Object.create(Nn.prototype),eh.prototype.constructor=eh,eh.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},eh.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,i=this.line.geometry.attributes.position,n=i.array;n[0]=t,n[1]=-e,n[2]=0,n[3]=t,n[4]=e,n[5]=0,n[6]=-t,n[7]=e,n[8]=0,n[9]=-t,n[10]=-e,n[11]=0,n[12]=t,n[13]=-e,n[14]=0,i.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},ih.prototype=Object.create(Nn.prototype),ih.prototype.constructor=ih,ih.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},ih.prototype.update=(hl=new Pe,ul=new Mi,fl=new Mi,function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");ul.copy(this.light.color),fl.copy(this.light.groundColor);for(var i=0,n=e.count;i<n;i++){var r=i<n/2?ul:fl;e.setXYZ(i,r.r,r.g,r.b)}e.needsUpdate=!0}t.lookAt(hl.setFromMatrixPosition(this.light.matrixWorld).negate())}),nh.prototype=Object.create(Ha.prototype),nh.prototype.constructor=nh,rh.prototype=Object.create(Ha.prototype),rh.prototype.constructor=rh,ah.prototype=Object.create(Ha.prototype),ah.prototype.constructor=ah,ah.prototype.update=(dl=new Pe,pl=new Pe,gl=new Ie,function(){this.object.updateMatrixWorld(!0),gl.getNormalMatrix(this.object.matrixWorld);for(var t=this.object.matrixWorld,e=this.geometry.attributes.position,i=this.object.geometry,n=i.vertices,r=i.faces,a=0,s=0,o=r.length;s<o;s++){var c=r[s],l=c.normal;dl.copy(n[c.a]).add(n[c.b]).add(n[c.c]).divideScalar(3).applyMatrix4(t),pl.copy(l).applyMatrix3(gl).normalize().multiplyScalar(this.size).add(dl),e.setXYZ(a,dl.x,dl.y,dl.z),a+=1,e.setXYZ(a,pl.x,pl.y,pl.z),a+=1}e.needsUpdate=!0}),sh.prototype=Object.create(Nn.prototype),sh.prototype.constructor=sh,sh.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},sh.prototype.update=(ml=new Pe,vl=new Pe,yl=new Pe,function(){ml.setFromMatrixPosition(this.light.matrixWorld),vl.setFromMatrixPosition(this.light.target.matrixWorld),yl.subVectors(vl,ml),this.lightPlane.lookAt(yl),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(yl),this.targetLine.scale.z=yl.length()}),oh.prototype=Object.create(Ha.prototype),oh.prototype.constructor=oh,oh.prototype.update=function(){var t,e,i=new Pe,n=new Un;function r(r,a,s,o){i.set(a,s,o).unproject(n);var c=e[r];if(void 0!==c)for(var l=t.getAttribute("position"),h=0,u=c.length;h<u;h++)l.setXYZ(c[h],i.x,i.y,i.z)}return function(){t=this.geometry,e=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),ch.prototype=Object.create(Ha.prototype),ch.prototype.constructor=ch,ch.prototype.update=(_l=new on,function(t){if(void 0!==this.object&&_l.setFromObject(this.object),!_l.isEmpty()){var e=_l.min,i=_l.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}),ch.prototype.setFromObject=function(t){return this.object=t,this.update(),this},lh.prototype=Object.create(Ha.prototype),lh.prototype.constructor=lh,lh.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),Nn.prototype.updateMatrixWorld.call(this,t))},hh.prototype=Object.create(za.prototype),hh.prototype.constructor=hh,hh.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),Nn.prototype.updateMatrixWorld.call(this,t)},uh.prototype=Object.create(Nn.prototype),uh.prototype.constructor=uh,uh.prototype.setDirection=(wl=new Pe,function(t){t.y>.99999?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(wl.set(t.z,0,-t.x).normalize(),Sl=Math.acos(t.y),this.quaternion.setFromAxisAngle(wl,Sl))}),uh.prototype.setLength=function(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()},uh.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},fh.prototype=Object.create(Ha.prototype),fh.prototype.constructor=fh;var dh={createMultiMaterialObject:function(t,e){for(var i=new Ya,n=0,r=e.length;n<r;n++)i.add(new Kr(t,e[n]));return i},detach:function(t,e,i){t.applyMatrix(e.matrixWorld),e.remove(t),i.add(t)},attach:function(t,e,i){t.applyMatrix((new Oe).getInverse(i.matrixWorld)),e.remove(t),i.add(t)}};var ph;function gh(t){Do.call(this,t),this.type="catmullrom",this.closed=!0}function mh(t){Do.call(this,t),this.type="catmullrom"}function vh(t){Do.call(this,t),this.type="catmullrom"}Eo.create=function(t,e){return t.prototype=Object.create(Eo.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(Xo.prototype,{createPointsGeometry:function(t){var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){for(var e=new Xn,i=0,n=t.length;i<n;i++){var r=t[i];e.vertices.push(new Pe(r.x,r.y,r.z||0))}return e}}),Object.assign(Yo.prototype,{fromPoints:function(t){this.setFromPoints(t)}}),gh.prototype=Object.create(Do.prototype),mh.prototype=Object.create(Do.prototype),vh.prototype=Object.create(Do.prototype),Object.assign(vh.prototype,{initFromArray:function(){},getControlPointsArray:function(){},reparametrizeByArcLength:function(){}}),nh.prototype.setColors=function(){},$l.prototype.update=function(){},Object.assign(Ec.prototype,{extractUrlBase:function(t){return Mc.extractUrlBase(t)}}),Object.assign(Ni.prototype,{center:function(t){return this.getCenter(t)},empty:function(){return this.isEmpty()},isIntersectionBox:function(t){return this.intersectsBox(t)},size:function(t){return this.getSize(t)}}),Object.assign(on.prototype,{center:function(t){return this.getCenter(t)},empty:function(){return this.isEmpty()},isIntersectionBox:function(t){return this.intersectsBox(t)},isIntersectionSphere:function(t){return this.intersectsSphere(t)},size:function(t){return this.getSize(t)}}),Yr.prototype.center=function(t){return this.getCenter(t)},Object.assign(Ae,{random16:function(){return Math.random()},nearestPowerOfTwo:function(t){return Ae.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return Ae.ceilPowerOfTwo(t)}}),Object.assign(Ie.prototype,{flattenToArrayOffset:function(t,e){return this.toArray(t,e)},multiplyVector3:function(t){return t.applyMatrix3(this)},multiplyVector3Array:function(){},applyToBuffer:function(t){return this.applyToBufferAttribute(t)},applyToVector3Array:function(){}}),Object.assign(Oe.prototype,{extractPosition:function(t){return this.copyPosition(t)},flattenToArrayOffset:function(t,e){return this.toArray(t,e)},getPosition:function(){return void 0===ph&&(ph=new Pe),ph.setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return this.makeRotationFromQuaternion(t)},multiplyToArray:function(){},multiplyVector3:function(t){return t.applyMatrix4(this)},multiplyVector4:function(t){return t.applyMatrix4(this)},multiplyVector3Array:function(){},rotateAxis:function(t){t.transformDirection(this)},crossVector:function(t){return t.applyMatrix4(this)},translate:function(){},rotateX:function(){},rotateY:function(){},rotateZ:function(){},rotateByAxis:function(){},applyToBuffer:function(t){return this.applyToBufferAttribute(t)},applyToVector3Array:function(){},makeFrustum:function(t,e,i,n,r,a){return this.makePerspective(t,e,n,i,r,a)}}),ln.prototype.isIntersectionLine=function(t){return this.intersectsLine(t)},Le.prototype.multiplyVector3=function(t){return t.applyQuaternion(this)},Object.assign(Xr.prototype,{isIntersectionBox:function(t){return this.intersectsBox(t)},isIntersectionPlane:function(t){return this.intersectsPlane(t)},isIntersectionSphere:function(t){return this.intersectsSphere(t)}}),Object.assign(qo.prototype,{extractAllPoints:function(t){return this.extractPoints(t)},extrude:function(t){return new Bs(this,t)},makeGeometry:function(t){return new qs(this,t)}}),Object.assign(Me.prototype,{fromAttribute:function(t,e,i){return this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return this.manhattanDistanceTo(t)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(Pe.prototype,{setEulerFromRotationMatrix:function(){},setEulerFromQuaternion:function(){},getPositionFromMatrix:function(t){return this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return this.setFromMatrixColumn(e,t)},applyProjection:function(t){return this.applyMatrix4(t)},fromAttribute:function(t,e,i){return this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return this.manhattanDistanceTo(t)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(Fe.prototype,{fromAttribute:function(t,e,i){return this.fromBufferAttribute(t,e,i)},lengthManhattan:function(){return this.manhattanLength()}}),Xn.prototype.computeTangents=function(){},Object.assign(Nn.prototype,{getChildByName:function(t){return this.getObjectByName(t)},renderDepth:function(){},translate:function(t,e){return this.translateOnAxis(e,t)}}),Object.defineProperties(Nn.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(t){this.rotation.order=t}},useQuaternion:{get:function(){},set:function(){}}}),Object.defineProperties(Fa.prototype,{objects:{get:function(){return this.levels}}}),Object.defineProperty(Ba.prototype,"useVertexTexture",{get:function(){},set:function(){}}),Object.defineProperty(Eo.prototype,"__arcLengthDivisions",{get:function(){return this.arcLengthDivisions},set:function(t){this.arcLengthDivisions=t}}),Ea.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Ko.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(t){this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(t){this.shadow.bias=t}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(t){this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){this.shadow.mapSize.height=t}}}),Object.defineProperties(Yn.prototype,{length:{get:function(){return this.array.length}}}),Object.assign(kr.prototype,{addIndex:function(t){this.setIndex(t)},addDrawCall:function(t,e,i){this.addGroup(t,e)},clearDrawCalls:function(){this.clearGroups()},computeTangents:function(){},computeOffsets:function(){}}),Object.defineProperties(kr.prototype,{drawcalls:{get:function(){return this.groups}},offsets:{get:function(){return this.groups}}}),Object.defineProperties(Bl.prototype,{dynamic:{set:function(){}},onUpdate:{value:function(){return this}}}),Object.defineProperties(rn.prototype,{wrapAround:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new Mi}},shading:{get:function(){},set:function(t){this.flatShading=1===t}}}),Object.defineProperties(lo.prototype,{metal:{get:function(){return!1},set:function(){}}}),Object.defineProperties(Wr.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(t){this.extensions.derivatives=t}}}),Object.assign(La.prototype,{getCurrentRenderTarget:function(){return this.getRenderTarget()},getMaxAnisotropy:function(){return this.capabilities.getMaxAnisotropy()},getPrecision:function(){return this.capabilities.precision},resetGLState:function(){return this.state.reset()},supportsFloatTextures:function(){return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){this.setScissorTest(t)},initMaterial:function(){},addPrePlugin:function(){},addPostPlugin:function(){},updateShadowMap:function(){}}),Object.defineProperties(La.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){this.shadowMap.type=t}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(t){this.shadowMap.cullFace=t}}}),Object.defineProperties(un.prototype,{cullFace:{get:function(){return this.renderReverseSided?T:w},set:function(t){var e=t!==w;this.renderReverseSided=e}}}),Object.defineProperties(Be.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(t){this.texture.wrapS=t}},wrapT:{get:function(){return this.texture.wrapT},set:function(t){this.texture.wrapT=t}},magFilter:{get:function(){return this.texture.magFilter},set:function(t){this.texture.magFilter=t}},minFilter:{get:function(){return this.texture.minFilter},set:function(t){this.texture.minFilter=t}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(t){this.texture.anisotropy=t}},offset:{get:function(){return this.texture.offset},set:function(t){this.texture.offset=t}},repeat:{get:function(){return this.texture.repeat},set:function(t){this.texture.repeat=t}},format:{get:function(){return this.texture.format},set:function(t){this.texture.format=t}},type:{get:function(){return this.texture.type},set:function(t){this.texture.type=t}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(t){this.texture.generateMipmaps=t}}}),Object.assign(Ma.prototype,{getStandingMatrix:function(){}}),Object.defineProperties(Ma.prototype,{standing:{set:function(){}}}),Ol.prototype.load=function(t){var e=this;return(new Cl).load(t,function(t){e.setBuffer(t)}),this},Pl.prototype.getData=function(){return this.getFrequencyData()},Al.prototype.updateCubeMap=function(t,e){return this.update(t,e)};var yh={crossOrigin:void 0,loadTexture:function(t,e,i,n){var r=new Co;r.setCrossOrigin(this.crossOrigin);var a=r.load(t,i,void 0,n);return e&&(a.mapping=e),a},loadTextureCube:function(t,e,i,n){var r=new To;r.setCrossOrigin(this.crossOrigin);var a=r.load(t,i,void 0,n);return e&&(a.mapping=e),a},loadCompressedTexture:function(){},loadCompressedTextureCube:function(){}};t.WebGLRenderTargetCube=ke,t.WebGLRenderTarget=Be,t.WebGLRenderer=La,t.ShaderLib=Di,t.UniformsLib=Pi,t.UniformsUtils=Ii,t.ShaderChunk=Ri,t.FogExp2=Pa,t.Fog=Ia,t.Scene=Ra,t.LensFlare=Da,t.Sprite=Ua,t.LOD=Fa,t.SkinnedMesh=ja,t.Skeleton=Ba,t.Bone=ka,t.Mesh=Kr,t.LineSegments=Ha,t.LineLoop=Va,t.Line=za,t.Points=Xa,t.Group=Ya,t.VideoTexture=qa,t.DataTexture=je,t.CompressedTexture=Ka,t.CubeTexture=Ge,t.CanvasTexture=Fi,t.DepthTexture=Za,t.Texture=Ue,t.CompressedTextureLoader=xo,t.DataTextureLoader=So,t.CubeTextureLoader=To,t.TextureLoader=Co,t.ObjectLoader=Lc,t.MaterialLoader=_c,t.BufferGeometryLoader=bc,t.DefaultLoadingManager=yo,t.LoadingManager=vo,t.JSONLoader=Oc,t.ImageLoader=wo,t.ImageBitmapLoader=Nc,t.FontLoader=Bc,t.FileLoader=bo,t.Loader=Ec,t.LoaderUtils=Mc,t.Cache=mo,t.AudioLoader=Cl,t.SpotLightShadow=Qo,t.SpotLight=$o,t.PointLight=tc,t.RectAreaLight=rc,t.HemisphereLight=Zo,t.DirectionalLightShadow=ec,t.DirectionalLight=ic,t.AmbientLight=nc,t.LightShadow=Jo,t.Light=Ko,t.StereoCamera=El,t.PerspectiveCamera=Ea,t.OrthographicCamera=Fn,t.CubeCamera=Al,t.ArrayCamera=Aa,t.Camera=Un,t.AudioListener=Ml,t.PositionalAudio=Ll,t.AudioContext=Tl,t.AudioAnalyser=Pl,t.Audio=Ol,t.VectorKeyframeTrack=vc,t.StringKeyframeTrack=ac,t.QuaternionKeyframeTrack=lc,t.NumberKeyframeTrack=uc,t.ColorKeyframeTrack=hc,t.BooleanKeyframeTrack=sc,t.PropertyMixer=Il,t.PropertyBinding=Dl,t.KeyframeTrack=mc,t.AnimationUtils=gc,t.AnimationObjectGroup=Nl,t.AnimationMixer=Fl,t.AnimationClip=yc,t.Uniform=Bl,t.InstancedBufferGeometry=kl,t.BufferGeometry=kr,t.Geometry=Xn,t.InterleavedBufferAttribute=jl,t.InstancedInterleavedBuffer=zl,t.InterleavedBuffer=Gl,t.InstancedBufferAttribute=Hl,t.Face3=Bn,t.Object3D=Nn,t.Raycaster=Vl,t.Layers=pn,t.EventDispatcher=e,t.Clock=Yl,t.QuaternionLinearInterpolant=cc,t.LinearInterpolant=dc,t.DiscreteInterpolant=pc,t.CubicInterpolant=fc,t.Interpolant=oc,t.Triangle=qr,t.Math=Ae,t.Spherical=ql,t.Cylindrical=Kl,t.Plane=ln,t.Frustum=hn,t.Sphere=cn,t.Ray=Xr,t.Matrix4=Oe,t.Matrix3=Ie,t.Box3=on,t.Box2=Ni,t.Line3=Yr,t.Euler=dn,t.Vector4=Fe,t.Vector3=Pe,t.Vector2=Me,t.Quaternion=Le,t.Color=Mi,t.ImmediateRenderObject=Zl,t.VertexNormalsHelper=Jl,t.SpotLightHelper=Ql,t.SkeletonHelper=$l,t.PointLightHelper=th,t.RectAreaLightHelper=eh,t.HemisphereLightHelper=ih,t.GridHelper=nh,t.PolarGridHelper=rh,t.FaceNormalsHelper=ah,t.DirectionalLightHelper=sh,t.CameraHelper=oh,t.BoxHelper=ch,t.Box3Helper=lh,t.PlaneHelper=hh,t.ArrowHelper=uh,t.AxesHelper=fh,t.Shape=qo,t.Path=Yo,t.ShapePath=Uc,t.Font=Fc,t.CurvePath=Xo,t.Curve=Eo,t.ShapeUtils=Fs,t.SceneUtils=dh,t.WebGLUtils=Oa,t.WireframeGeometry=Ja,t.ParametricGeometry=Qa,t.ParametricBufferGeometry=$a,t.TetrahedronGeometry=is,t.TetrahedronBufferGeometry=ns,t.OctahedronGeometry=rs,t.OctahedronBufferGeometry=as,t.IcosahedronGeometry=ss,t.IcosahedronBufferGeometry=os,t.DodecahedronGeometry=cs,t.DodecahedronBufferGeometry=ls,t.PolyhedronGeometry=ts,t.PolyhedronBufferGeometry=es,t.TubeGeometry=hs,t.TubeBufferGeometry=us,t.TorusKnotGeometry=fs,t.TorusKnotBufferGeometry=ds,t.TorusGeometry=ps,t.TorusBufferGeometry=gs,t.TextGeometry=js,t.TextBufferGeometry=Gs,t.SphereGeometry=zs,t.SphereBufferGeometry=Hs,t.RingGeometry=Vs,t.RingBufferGeometry=Ws,t.PlaneGeometry=zr,t.PlaneBufferGeometry=Hr,t.LatheGeometry=Xs,t.LatheBufferGeometry=Ys,t.ShapeGeometry=qs,t.ShapeBufferGeometry=Ks,t.ExtrudeGeometry=Bs,t.ExtrudeBufferGeometry=ks,t.EdgesGeometry=Js,t.ConeGeometry=to,t.ConeBufferGeometry=eo,t.CylinderGeometry=Qs,t.CylinderBufferGeometry=$s,t.CircleGeometry=io,t.CircleBufferGeometry=no,t.BoxGeometry=jr,t.BoxBufferGeometry=Gr,t.ShadowMaterial=ao,t.SpriteMaterial=Na,t.RawShaderMaterial=so,t.ShaderMaterial=Wr,t.PointsMaterial=Wa,t.MeshPhysicalMaterial=co,t.MeshStandardMaterial=oo,t.MeshPhongMaterial=lo,t.MeshToonMaterial=ho,t.MeshNormalMaterial=uo,t.MeshLambertMaterial=fo,t.MeshDepthMaterial=an,t.MeshDistanceMaterial=sn,t.MeshBasicMaterial=Vr,t.LineDashedMaterial=po,t.LineBasicMaterial=Ga,t.Material=rn,t.Float64BufferAttribute=ir,t.Float32BufferAttribute=er,t.Uint32BufferAttribute=tr,t.Int32BufferAttribute=$n,t.Uint16BufferAttribute=Qn,t.Int16BufferAttribute=Jn,t.Uint8ClampedBufferAttribute=Zn,t.Uint8BufferAttribute=Kn,t.Int8BufferAttribute=qn,t.BufferAttribute=Yn,t.ArcCurve=Mo,t.CatmullRomCurve3=Do,t.CubicBezierCurve=Bo,t.CubicBezierCurve3=ko,t.EllipseCurve=Ao,t.LineCurve=jo,t.LineCurve3=Go,t.QuadraticBezierCurve=zo,t.QuadraticBezierCurve3=Ho,t.SplineCurve=Vo,t.REVISION="89",t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},t.CullFaceNone=S,t.CullFaceBack=w,t.CullFaceFront=T,t.CullFaceFrontBack=3,t.FrontFaceDirectionCW=C,t.FrontFaceDirectionCCW=1,t.BasicShadowMap=0,t.PCFShadowMap=E,t.PCFSoftShadowMap=A,t.FrontSide=M,t.BackSide=O,t.DoubleSide=L,t.FlatShading=1,t.SmoothShading=2,t.NoColors=P,t.FaceColors=I,t.VertexColors=R,t.NoBlending=D,t.NormalBlending=N,t.AdditiveBlending=U,t.SubtractiveBlending=F,t.MultiplyBlending=B,t.CustomBlending=k,t.AddEquation=j,t.SubtractEquation=G,t.ReverseSubtractEquation=z,t.MinEquation=H,t.MaxEquation=V,t.ZeroFactor=W,t.OneFactor=X,t.SrcColorFactor=Y,t.OneMinusSrcColorFactor=q,t.SrcAlphaFactor=K,t.OneMinusSrcAlphaFactor=Z,t.DstAlphaFactor=J,t.OneMinusDstAlphaFactor=Q,t.DstColorFactor=$,t.OneMinusDstColorFactor=tt,t.SrcAlphaSaturateFactor=et,t.NeverDepth=it,t.AlwaysDepth=nt,t.LessDepth=rt,t.LessEqualDepth=at,t.EqualDepth=st,t.GreaterEqualDepth=ot,t.GreaterDepth=ct,t.NotEqualDepth=lt,t.MultiplyOperation=ht,t.MixOperation=ut,t.AddOperation=ft,t.NoToneMapping=dt,t.LinearToneMapping=pt,t.ReinhardToneMapping=gt,t.Uncharted2ToneMapping=mt,t.CineonToneMapping=vt,t.UVMapping=300,t.CubeReflectionMapping=yt,t.CubeRefractionMapping=_t,t.EquirectangularReflectionMapping=bt,t.EquirectangularRefractionMapping=xt,t.SphericalReflectionMapping=St,t.CubeUVReflectionMapping=wt,t.CubeUVRefractionMapping=Tt,t.RepeatWrapping=Ct,t.ClampToEdgeWrapping=Et,t.MirroredRepeatWrapping=At,t.NearestFilter=Mt,t.NearestMipMapNearestFilter=Ot,t.NearestMipMapLinearFilter=Lt,t.LinearFilter=Pt,t.LinearMipMapNearestFilter=It,t.LinearMipMapLinearFilter=Rt,t.UnsignedByteType=Dt,t.ByteType=Nt,t.ShortType=Ut,t.UnsignedShortType=Ft,t.IntType=Bt,t.UnsignedIntType=kt,t.FloatType=jt,t.HalfFloatType=Gt,t.UnsignedShort4444Type=zt,t.UnsignedShort5551Type=Ht,t.UnsignedShort565Type=Vt,t.UnsignedInt248Type=Wt,t.AlphaFormat=Xt,t.RGBFormat=Yt,t.RGBAFormat=qt,t.LuminanceFormat=Kt,t.LuminanceAlphaFormat=Zt,t.RGBEFormat=Jt,t.DepthFormat=Qt,t.DepthStencilFormat=$t,t.RGB_S3TC_DXT1_Format=te,t.RGBA_S3TC_DXT1_Format=ee,t.RGBA_S3TC_DXT3_Format=ie,t.RGBA_S3TC_DXT5_Format=ne,t.RGB_PVRTC_4BPPV1_Format=re,t.RGB_PVRTC_2BPPV1_Format=ae,t.RGBA_PVRTC_4BPPV1_Format=se,t.RGBA_PVRTC_2BPPV1_Format=oe,t.RGB_ETC1_Format=ce,t.LoopOnce=2200,t.LoopRepeat=le,t.LoopPingPong=2202,t.InterpolateDiscrete=he,t.InterpolateLinear=ue,t.InterpolateSmooth=2302,t.ZeroCurvatureEnding=fe,t.ZeroSlopeEnding=de,t.WrapAroundEnding=pe,t.TrianglesDrawMode=ge,t.TriangleStripDrawMode=me,t.TriangleFanDrawMode=ve,t.LinearEncoding=ye,t.sRGBEncoding=_e,t.GammaEncoding=be,t.RGBEEncoding=xe,t.LogLuvEncoding=3003,t.RGBM7Encoding=Se,t.RGBM16Encoding=we,t.RGBDEncoding=Te,t.BasicDepthPacking=Ce,t.RGBADepthPacking=Ee,t.CubeGeometry=jr,t.Face4=function(t,e,i,n,r,a,s){return new Bn(t,e,i,r,a,s)},t.LineStrip=0,t.LinePieces=1,t.MeshFaceMaterial=function(t){return t},t.MultiMaterial=function(t){return void 0===t&&(t=[]),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.PointCloud=function(t,e){return new Xa(t,e)},t.Particle=function(t){return new Ua(t)},t.ParticleSystem=function(t,e){return new Xa(t,e)},t.PointCloudMaterial=function(t){return new Wa(t)},t.ParticleBasicMaterial=function(t){return new Wa(t)},t.ParticleSystemMaterial=function(t){return new Wa(t)},t.Vertex=function(t,e,i){return new Pe(t,e,i)},t.DynamicBufferAttribute=function(t,e){return new Yn(t,e).setDynamic(!0)},t.Int8Attribute=function(t,e){return new qn(t,e)},t.Uint8Attribute=function(t,e){return new Kn(t,e)},t.Uint8ClampedAttribute=function(t,e){return new Zn(t,e)},t.Int16Attribute=function(t,e){return new Jn(t,e)},t.Uint16Attribute=function(t,e){return new Qn(t,e)},t.Int32Attribute=function(t,e){return new $n(t,e)},t.Uint32Attribute=function(t,e){return new tr(t,e)},t.Float32Attribute=function(t,e){return new er(t,e)},t.Float64Attribute=function(t,e){return new ir(t,e)},t.ClosedSplineCurve3=gh,t.SplineCurve3=mh,t.Spline=vh,t.AxisHelper=function(t){return new fh(t)},t.BoundingBoxHelper=function(t,e){return new ch(t,e)},t.EdgesHelper=function(t,e){return new Ha(new Js(t.geometry),new Ga({color:void 0!==e?e:16777215}))},t.WireframeHelper=function(t,e){return new Ha(new Ja(t.geometry),new Ga({color:void 0!==e?e:16777215}))},t.XHRLoader=function(t){return new bo(t)},t.BinaryTextureLoader=function(t){return new So(t)},t.GeometryUtils={merge:function(t,e,i){var n;e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,i)},center:function(t){return t.center()}},t.ImageUtils=yh,t.Projector=function(){this.projectVector=function(t,e){t.project(e)},this.unprojectVector=function(t,e){t.unproject(e)},this.pickingRay=function(){}},t.CanvasRenderer=function(){this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},Object.defineProperty(t,"__esModule",{value:!0})}),THREE.OrbitControls=function(t,e){var i,n,r,a,s;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(c),o.update(),f=u.NONE},this.update=(i=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(t.up,new THREE.Vector3(0,1,0)),r=n.clone().inverse(),a=new THREE.Vector3,s=new THREE.Quaternion,function(){var t=o.object.position;return i.copy(t).sub(o.target),i.applyQuaternion(n),p.setFromVector3(i),o.autoRotate&&f===u.NONE&&O(2*Math.PI/60/60*o.autoRotateSpeed),p.theta+=g.theta,p.phi+=g.phi,p.theta=Math.max(o.minAzimuthAngle,Math.min(o.maxAzimuthAngle,p.theta)),p.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=m,p.radius=Math.max(o.minDistance,Math.min(o.maxDistance,p.radius)),o.target.add(v),i.setFromSpherical(p),i.applyQuaternion(r),t.copy(o.target).add(i),o.object.lookAt(o.target),!0===o.enableDamping?(g.theta*=1-o.dampingFactor,g.phi*=1-o.dampingFactor):g.set(0,0,0),m=1,v.set(0,0,0),!!(y||a.distanceToSquared(o.object.position)>d||8*(1-s.dot(o.object.quaternion))>d)&&(o.dispatchEvent(c),a.copy(o.object.position),s.copy(o.object.quaternion),y=!1,!0)}),this.dollyIn=F,this.dollyOut=B,this.dispose=function(){o.domElement.removeEventListener("contextmenu",Y,!1),o.domElement.removeEventListener("mousedown",k,!1),o.domElement.removeEventListener("wheel",z,!1),o.domElement.removeEventListener("touchstart",V,!1),o.domElement.removeEventListener("touchend",X,!1),o.domElement.removeEventListener("touchmove",W,!1),document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",G,!1),window.removeEventListener("keydown",H,!1)};var o=this,c={type:"change"},l={type:"start"},h={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},f=u.NONE,d=1e-6,p=new THREE.Spherical,g=new THREE.Spherical,m=1,v=new THREE.Vector3,y=!1,_=new THREE.Vector2,b=new THREE.Vector2,x=new THREE.Vector2,S=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,C=new THREE.Vector2,E=new THREE.Vector2,A=new THREE.Vector2;function M(){return Math.pow(.95,o.zoomSpeed)}function O(t){g.theta-=t}function L(t){g.phi-=t}var P,I,R,D=(P=new THREE.Vector3,function(t,e){P.setFromMatrixColumn(e,0),P.multiplyScalar(-t),v.add(P)}),N=(I=new THREE.Vector3,function(t,e){I.setFromMatrixColumn(e,1),I.multiplyScalar(t),v.add(I)}),U=(R=new THREE.Vector3,function(t,e){var i=o.domElement===document?o.domElement.body:o.domElement;if(o.object instanceof THREE.PerspectiveCamera){var n=o.object.position;R.copy(n).sub(o.target);var r=R.length();r*=Math.tan(o.object.fov/2*Math.PI/180),D(2*t*r/i.clientHeight,o.object.matrix),N(2*e*r/i.clientHeight,o.object.matrix)}else o.object instanceof THREE.OrthographicCamera?(D(t*(o.object.right-o.object.left)/o.object.zoom/i.clientWidth,o.object.matrix),N(e*(o.object.top-o.object.bottom)/o.object.zoom/i.clientHeight,o.object.matrix)):o.enablePan=!1});function F(t){o.object instanceof THREE.PerspectiveCamera?m/=t:o.object instanceof THREE.OrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom*t)),o.object.updateProjectionMatrix(),y=!0):o.enableZoom=!1}function B(t){o.object instanceof THREE.PerspectiveCamera?m*=t:o.object instanceof THREE.OrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/t)),o.object.updateProjectionMatrix(),y=!0):o.enableZoom=!1}function k(t){if(!1!==o.enabled){if(t.preventDefault(),t.button===o.mouseButtons.ORBIT){if(!1===o.enableRotate)return;n=t,_.set(n.clientX,n.clientY),f=u.ROTATE}else if(t.button===o.mouseButtons.ZOOM){if(!1===o.enableZoom)return;i=t,C.set(i.clientX,i.clientY),f=u.DOLLY}else if(t.button===o.mouseButtons.PAN){if(!1===o.enablePan)return;e=t,S.set(e.clientX,e.clientY),f=u.PAN}var e,i,n;f!==u.NONE&&(document.addEventListener("mousemove",j,!1),document.addEventListener("mouseup",G,!1),o.dispatchEvent(l))}}function j(t){var e,i;if(!1!==o.enabled)if(t.preventDefault(),f===u.ROTATE){if(!1===o.enableRotate)return;!function(t){b.set(t.clientX,t.clientY),x.subVectors(b,_);var e=o.domElement===document?o.domElement.body:o.domElement;O(2*Math.PI*x.x/e.clientWidth*o.rotateSpeed),L(2*Math.PI*x.y/e.clientHeight*o.rotateSpeed),_.copy(b),o.update()}(t)}else if(f===u.DOLLY){if(!1===o.enableZoom)return;i=t,E.set(i.clientX,i.clientY),A.subVectors(E,C),A.y>0?F(M()):A.y<0&&B(M()),C.copy(E),o.update()}else if(f===u.PAN){if(!1===o.enablePan)return;e=t,w.set(e.clientX,e.clientY),T.subVectors(w,S),U(T.x,T.y),S.copy(w),o.update()}}function G(t){!1!==o.enabled&&(document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",G,!1),o.dispatchEvent(h),f=u.NONE)}function z(t){var e;!1===o.enabled||!1===o.enableZoom||f!==u.NONE&&f!==u.ROTATE||(t.preventDefault(),t.stopPropagation(),(e=t).deltaY<0?B(M()):e.deltaY>0&&F(M()),o.update(),o.dispatchEvent(l),o.dispatchEvent(h))}function H(t){!1!==o.enabled&&!1!==o.enableKeys&&!1!==o.enablePan&&function(t){switch(t.keyCode){case o.keys.UP:U(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:U(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:U(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:U(-o.keyPanSpeed,0),o.update()}}(t)}function V(t){if(!1!==o.enabled){switch(t.touches.length){case 1:if(!1===o.enableRotate)return;s=t,_.set(s.touches[0].pageX,s.touches[0].pageY),f=u.TOUCH_ROTATE;break;case 2:if(!1===o.enableZoom)return;n=(i=t).touches[0].pageX-i.touches[1].pageX,r=i.touches[0].pageY-i.touches[1].pageY,a=Math.sqrt(n*n+r*r),C.set(0,a),f=u.TOUCH_DOLLY;break;case 3:if(!1===o.enablePan)return;e=t,S.set(e.touches[0].pageX,e.touches[0].pageY),f=u.TOUCH_PAN;break;default:f=u.NONE}var e,i,n,r,a,s;f!==u.NONE&&o.dispatchEvent(l)}}function W(t){var e,i,n,r,a;if(!1!==o.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===o.enableRotate)return;if(f!==u.TOUCH_ROTATE)return;!function(t){b.set(t.touches[0].pageX,t.touches[0].pageY),x.subVectors(b,_);var e=o.domElement===document?o.domElement.body:o.domElement;O(2*Math.PI*x.x/e.clientWidth*o.rotateSpeed),L(2*Math.PI*x.y/e.clientHeight*o.rotateSpeed),_.copy(b),o.update()}(t);break;case 2:if(!1===o.enableZoom)return;if(f!==u.TOUCH_DOLLY)return;n=(i=t).touches[0].pageX-i.touches[1].pageX,r=i.touches[0].pageY-i.touches[1].pageY,a=Math.sqrt(n*n+r*r),E.set(0,a),A.subVectors(E,C),A.y>0?B(M()):A.y<0&&F(M()),C.copy(E),o.update();break;case 3:if(!1===o.enablePan)return;if(f!==u.TOUCH_PAN)return;e=t,w.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(w,S),U(T.x,T.y),S.copy(w),o.update();break;default:f=u.NONE}}function X(t){!1!==o.enabled&&(o.dispatchEvent(h),f=u.NONE)}function Y(t){t.preventDefault()}o.domElement.addEventListener("contextmenu",Y,!1),o.domElement.addEventListener("mousedown",k,!1),o.domElement.addEventListener("wheel",z,!1),o.domElement.addEventListener("touchstart",V,!1),o.domElement.addEventListener("touchend",X,!1),o.domElement.addEventListener("touchmove",W,!1),window.addEventListener("keydown",H,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return this.target}},noZoom:{get:function(){return!this.enableZoom},set:function(t){this.enableZoom=!t}},noRotate:{get:function(){return!this.enableRotate},set:function(t){this.enableRotate=!t}},noPan:{get:function(){return!this.enablePan},set:function(t){this.enablePan=!t}},noKeys:{get:function(){return!this.enableKeys},set:function(t){this.enableKeys=!t}},staticMoving:{get:function(){return!this.enableDamping},set:function(t){this.enableDamping=!t}},dynamicDampingFactor:{get:function(){return this.dampingFactor},set:function(t){this.dampingFactor=t}}});var fabric=fabric||{version:"3.6.3"};if("undefined"!=typeof exports?exports.fabric=fabric:"function"==typeof define&&define.amd&&define([],function(){return fabric}),"undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?fabric.document=document:fabric.document=document.implementation.createHTMLDocument(""),fabric.window=window;else{var jsdom=require("jsdom"),virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;fabric.document=virtualWindow.document,fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=virtualWindow,DOMParser=fabric.window.DOMParser}function resizeCanvasIfNeeded(t){var e=t.targetCanvas,i=e.width,n=e.height,r=t.destinationWidth,a=t.destinationHeight;i===r&&n===a||(e.width=r,e.height=a)}function copyGLTo2DDrawImage(t,e){var i=t.canvas,n=e.targetCanvas,r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1);var a=i.height-n.height;r.drawImage(i,0,a,n.width,n.height,0,0,n.width,n.height)}function copyGLTo2DPutImageData(t,e){var i=e.targetCanvas.getContext("2d"),n=e.destinationWidth,r=e.destinationHeight,a=n*r*4,s=new Uint8Array(this.imageBuffer,0,a),o=new Uint8ClampedArray(this.imageBuffer,0,a);t.readPixels(0,0,n,r,t.RGBA,t.UNSIGNED_BYTE,s);var c=new ImageData(o,n,r);i.putImageData(c,0,0)}fabric.isTouchSupported="ontouchstart"in fabric.window||"ontouchstart"in fabric.document||fabric.window&&fabric.window.navigator&&fabric.window.navigator.maxTouchPoints>0,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,fabric.reNonWord=/[ \n\.,;!\?\-]/,fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.svgNS="http://www.w3.org/2000/svg",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.disableStyleCopyPaste=!1,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.arcToSegmentsCache={},fabric.boundsOfCurveCache={},fabric.cachesBoundsOfCurve=!0,fabric.forceGLPutImageData=!1,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=fabric),function(){function t(t,e){if(this.__eventListeners[t]){var i=this.__eventListeners[t];e?i[i.indexOf(e)]=!1:fabric.util.array.fill(i,!1)}}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(!this.__eventListeners)return this;if(0===arguments.length)for(e in this.__eventListeners)t.call(this,e);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}function n(t,e){if(!this.__eventListeners)return this;var i=this.__eventListeners[t];if(!i)return this;for(var n=0,r=i.length;n<r;n++)i[n]&&i[n].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(t,e,i){var n=this._objects;return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var t,e=this._objects,i=!1,n=0,r=arguments.length;n<r;n++)-1!==(t=e.indexOf(arguments[n]))&&(i=!0,e.splice(t,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=0,r=i.length;n<r;n++)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects.concat():this._objects.filter(function(e){return e.type===t})},item:function(t){return this._objects[t]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(t){return this._objects.indexOf(t)>-1},complexity:function(){return this._objects.reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},fabric.CommonMethods={_setOptions:function(t){for(var e in t)this.set(e,t[e])},_initGradient:function(t,e){!t||!t.colorStops||t instanceof fabric.Gradient||this.set(e,new fabric.Gradient(t))},_initPattern:function(t,e,i){!t||!t.source||t instanceof fabric.Pattern?i&&i():this.set(e,new fabric.Pattern(t,i))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var e=fabric.util.getFunctionBody(t.clipTo);void 0!==e&&(this.clipTo=new Function("ctx",e))}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,e){this[t]=e},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},get:function(t){return this[t]}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.pow,r=Math.PI/180,a=Math.PI/2;fabric.util={cos:function(t){if(0===t)return 1;switch(t<0&&(t=-t),t/a){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},sin:function(t){if(0===t)return 0;var e=1;switch(t<0&&(e=-1),t/a){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(t)},removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*r},radiansToDegrees:function(t){return t/r},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=fabric.util.rotateVector(t,i);return new fabric.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=fabric.util.sin(e),n=fabric.util.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t,e){if(e)for(var i=0;i<t.length;i++)t[i]=fabric.util.transformPoint(t[i],e);var n=[t[0].x,t[1].x,t[2].x,t[3].x],r=fabric.util.array.min(n),a=fabric.util.array.max(n)-r,s=[t[0].y,t[1].y,t[2].y,t[3].y],o=fabric.util.array.min(s);return{left:r,top:o,width:a,height:fabric.util.array.max(s)-o}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},resolveNamespace:function(e){if(!e)return fabric;var i,n=e.split("."),r=n.length,a=t||fabric.window;for(i=0;i<r;++i)a=a[n[i]];return a},loadImage:function(t,e,i,n){if(t){var r=fabric.util.createImage(),a=function(){e&&e.call(i,r),r=r.onload=r.onerror=null};r.onload=a,r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),"data:image/svg"===t.substring(0,14)&&(r.onload=null,fabric.util.loadImageInDom(r,a)),r.src=t}else e&&e.call(i,t)},loadImageInDom:function(t,e){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(t),fabric.document.querySelector("body").appendChild(i),t.onload=function(){e(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(t,e,i,n){var r=[],a=0,s=(t=t||[]).length;function o(){++a===s&&e&&e(r.filter(function(t){return t}))}s?t.forEach(function(t,e){t&&t.type?fabric.util.getKlass(t.type,i).fromObject(t,function(i,a){a||(r[e]=i),n&&n(t,i,a),o()}):o()}):e&&e(r)},enlivenPatterns:function(t,e){function i(){++r===a&&e&&e(n)}var n=[],r=0,a=(t=t||[]).length;a?t.forEach(function(t,e){t&&t.source?new fabric.Pattern(t,function(t){n[e]=t,i()}):(n[e]=t,i())}):e&&e(n)},groupSVGElements:function(t,e,i){var n;return t&&1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),n=new fabric.Group(t,e),void 0!==i&&(n.sourcePath=i),n)},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;n<r;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,a,s,o){var c=a-n,l=s-r,h=e(c*c+l*l),u=i(l,c),f=o.length,d=0,p=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;h>n;)(n+=o[d++%f])>h&&(n=h),t[p?"lineTo":"moveTo"](n,0),p=!p;t.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(t){var e=fabric.util.createCanvasElement();return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e},toDataURL:function(t,e,i){return t.toDataURL("image/"+e,i)},createImage:function(){return fabric.document.createElement("img")},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var a=i(t[1],t[0]),s=n(t[0],2)+n(t[1],2),o=e(s),c=(t[0]*t[3]-t[2]*t[1])/o,l=i(t[0]*t[2]+t[1]*t[3],s);return{angle:a/r,scaleX:o,scaleY:c,skewX:l/r,skewY:0,translateX:t[4],translateY:t[5]}},calcRotateMatrix:function(t){if(!t.angle)return fabric.iMatrix.concat();var e=fabric.util.degreesToRadians(t.angle),i=fabric.util.cos(e),n=fabric.util.sin(e);return[i,n,-n,i,0,0]},calcDimensionsMatrix:function(t){var e=void 0===t.scaleX?1:t.scaleX,i=void 0===t.scaleY?1:t.scaleY,n=[t.flipX?-e:e,0,0,t.flipY?-i:i,0,0],r=fabric.util.multiplyTransformMatrices,a=fabric.util.degreesToRadians;return t.skewX&&(n=r(n,[1,0,Math.tan(a(t.skewX)),1],!0)),t.skewY&&(n=r(n,[1,Math.tan(a(t.skewY)),0,1],!0)),n},composeMatrix:function(t){var e=[1,0,0,1,t.translateX||0,t.translateY||0],i=fabric.util.multiplyTransformMatrices;return t.angle&&(e=i(e,fabric.util.calcRotateMatrix(t))),(t.scaleX||t.scaleY||t.skewX||t.skewY||t.flipX||t.flipY)&&(e=i(e,fabric.util.calcDimensionsMatrix(t))),e},customTransformMatrix:function(t,e,i){return fabric.util.composeMatrix({scaleX:t,scaleY:e,skewX:i})},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},saveObjectTransform:function(t){return{scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);var r,a=!0,s=t.getImageData(e,i,2*n||1,2*n||1),o=s.data.length;for(r=3;r<o&&!1!==(a=s.data[r]<=0);r+=4);return s=null,a},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n=t.split(" ");return n&&n.length&&("meet"!==(i=n.pop())&&"slice"!==i?(e=i,i="meet"):n.length&&(e=n.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){(t=(t||"").toLowerCase())?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}},limitDimsByArea:function(t,e){var i=Math.sqrt(e*t),n=Math.floor(e/i);return{x:Math.floor(i),y:n}},capValue:function(t,e,i){return Math.max(t,Math.min(e,i))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)},matrixToSVG:function(t){return"matrix("+t.map(function(t){return fabric.util.toFixed(t,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}}("undefined"!=typeof exports?exports:this),function(){var t=Array.prototype.join;function e(e,n,r,a,s,o,c){var l=t.call(arguments);if(fabric.arcToSegmentsCache[l])return fabric.arcToSegmentsCache[l];var h=Math.PI,u=c*h/180,f=fabric.util.sin(u),d=fabric.util.cos(u),p=0,g=0,m=-d*e*.5-f*n*.5,v=-d*n*.5+f*e*.5,y=(r=Math.abs(r))*r,_=(a=Math.abs(a))*a,b=v*v,x=m*m,S=y*_-y*b-_*x,w=0;if(S<0){var T=Math.sqrt(1-S/(y*_));r*=T,a*=T}else w=(s===o?-1:1)*Math.sqrt(S/(y*b+_*x));var C=w*r*v/a,E=-w*a*m/r,A=d*C-f*E+.5*e,M=f*C+d*E+.5*n,O=i(1,0,(m-C)/r,(v-E)/a),L=i((m-C)/r,(v-E)/a,(-m-C)/r,(-v-E)/a);0===o&&L>0?L-=2*h:1===o&&L<0&&(L+=2*h);for(var P,I,R,D,N,U,F,B,k,j,G,z,H,V,W,X,Y,q=Math.ceil(Math.abs(L/h*2)),K=[],Z=L/q,J=8/3*Math.sin(Z/4)*Math.sin(Z/4)/Math.sin(Z/2),Q=O+Z,$=0;$<q;$++)K[$]=(P=O,I=Q,R=d,D=f,N=r,U=a,F=A,B=M,k=J,j=p,G=g,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,z=fabric.util.cos(P),H=fabric.util.sin(P),V=fabric.util.cos(I),W=fabric.util.sin(I),[j+k*(-R*N*H-D*U*z),G+k*(-D*N*H+R*U*z),(X=R*N*V-D*U*W+F)+k*(R*N*W+D*U*V),(Y=D*N*V+R*U*W+B)+k*(D*N*W-R*U*V),X,Y]),p=K[$][4],g=K[$][5],O=Q,Q+=Z;return fabric.arcToSegmentsCache[l]=K,K}function i(t,e,i,n){var r=Math.atan2(e,t),a=Math.atan2(n,i);return a>=r?a-r:2*Math.PI-(r-a)}function n(e,i,n,r,a,s,o,c){var l;if(fabric.cachesBoundsOfCurve&&(l=t.call(arguments),fabric.boundsOfCurveCache[l]))return fabric.boundsOfCurveCache[l];var h,u,f,d,p,g,m,v,y=Math.sqrt,_=Math.min,b=Math.max,x=Math.abs,S=[],w=[[],[]];u=6*e-12*n+6*a,h=-3*e+9*n-9*a+3*o,f=3*n-3*e;for(var T=0;T<2;++T)if(T>0&&(u=6*i-12*r+6*s,h=-3*i+9*r-9*s+3*c,f=3*r-3*i),x(h)<1e-12){if(x(u)<1e-12)continue;0<(d=-f/u)&&d<1&&S.push(d)}else(m=u*u-4*f*h)<0||(0<(p=(-u+(v=y(m)))/(2*h))&&p<1&&S.push(p),0<(g=(-u-v)/(2*h))&&g<1&&S.push(g));for(var C,E,A,M=S.length,O=M;M--;)C=(A=1-(d=S[M]))*A*A*e+3*A*A*d*n+3*A*d*d*a+d*d*d*o,w[0][M]=C,E=A*A*A*i+3*A*A*d*r+3*A*d*d*s+d*d*d*c,w[1][M]=E;w[0][O]=e,w[1][O]=i,w[0][O+1]=o,w[1][O+1]=c;var L=[{x:_.apply(null,w[0]),y:_.apply(null,w[1])},{x:b.apply(null,w[0]),y:b.apply(null,w[1])}];return fabric.cachesBoundsOfCurve&&(fabric.boundsOfCurveCache[l]=L),L}fabric.util.drawArc=function(t,i,n,r){for(var a=r[0],s=r[1],o=r[2],c=r[3],l=r[4],h=[[],[],[],[]],u=e(r[5]-i,r[6]-n,a,s,c,l,o),f=0,d=u.length;f<d;f++)h[f][0]=u[f][0]+i,h[f][1]=u[f][1]+n,h[f][2]=u[f][2]+i,h[f][3]=u[f][3]+n,h[f][4]=u[f][4]+i,h[f][5]=u[f][5]+n,t.bezierCurveTo.apply(t,h[f])},fabric.util.getBoundsOfArc=function(t,i,r,a,s,o,c,l,h){for(var u,f=0,d=0,p=[],g=e(l-t,h-i,r,a,o,c,s),m=0,v=g.length;m<v;m++)u=n(f,d,g[m][0],g[m][1],g[m][2],g[m][3],g[m][4],g[m][5]),p.push({x:u[0].x+t,y:u[0].y+i}),p.push({x:u[1].x+t,y:u[1].y+i}),f=g[m][4],d=g[m][5];return p},fabric.util.getBoundsOfCurve=n}(),function(){var t=Array.prototype.slice;function e(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(e,i){for(var n=t.call(arguments,2),r=[],a=0,s=e.length;a<s;a++)r[a]=n.length?e[a][i].apply(e[a],n):e[a][i].call(e[a]);return r},min:function(t,i){return e(t,i,function(t,e){return t<e})},max:function(t,i){return e(t,i,function(t,e){return t>=e})}}}(),function(){function t(e,i,n){if(n)if(!fabric.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var r=0,a=i.length;r<a;r++)e[r]=t({},i[r],n)}else if(i&&"object"==typeof i)for(var s in i)"canvas"===s?e[s]=t({},i[s]):i.hasOwnProperty(s)&&(e[s]=t({},i[s],n));else e=i;else for(var s in i)e[s]=i[s];return e}fabric.util.object={extend:t,clone:function(e,i){return t({},e,i)}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function t(t,e){var i=t.charCodeAt(e);if(isNaN(i))return"";if(i<55296||i>57343)return t.charAt(e);if(55296<=i&&i<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";var n=t.charCodeAt(e+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var r=t.charCodeAt(e-1);if(55296>r||r>56319)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(e){var i,n=0,r=[];for(n=0;n<e.length;n++)!1!==(i=t(e,n))&&r.push(i);return r}}}(),function(){var t=Array.prototype.slice,e=function(){},i=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),n=function(t,e,n){for(var r in e)r in t.prototype&&"function"==typeof t.prototype[r]&&(e[r]+"").indexOf("callSuper")>-1?t.prototype[r]=function(t){return function(){var i=this.constructor.superclass;this.constructor.superclass=n;var r=e[t].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==t)return r}}(r):t.prototype[r]=e[r],i&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};function r(){}function a(e){for(var i=null,n=this;n.constructor.superclass;){var r=n.constructor.superclass.prototype[e];if(n[e]!==r){i=r;break}n=n.constructor.superclass.prototype}return i?arguments.length>1?i.apply(this,t.call(arguments,1)):i.call(this):console.log("tried to callSuper "+e+", method not found in prototype chain",this)}fabric.util.createClass=function(){var i=null,s=t.call(arguments,0);function o(){this.initialize.apply(this,arguments)}"function"==typeof s[0]&&(i=s.shift()),o.superclass=i,o.subclasses=[],i&&(r.prototype=i.prototype,o.prototype=new r,i.subclasses.push(o));for(var c=0,l=s.length;c<l;c++)n(o,s[c],i);return o.prototype.initialize||(o.prototype.initialize=e),o.prototype.constructor=o,o.prototype.callSuper=a,o}}(),function(){var t=!!fabric.document.createElement("div").attachEvent;fabric.util.addListener=function(e,i,n,r){e&&e.addEventListener(i,n,!t&&r)},fabric.util.removeListener=function(e,i,n,r){e&&e.removeEventListener(i,n,!t&&r)},fabric.util.getPointer=function(t){var e,i,n=t.target,r=fabric.util.getScrollLeftTop(n),a=(i=(e=t).changedTouches)&&i[0]?i[0]:e;return{x:a.clientX+r.left,y:a.clientY+r.top}}}(),function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,n=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,r=function(t){return t};e?r=function(t,e){return t.style.opacity=e,t}:i&&(r=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),n.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(n,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?r(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"===n?r(t,e[n]):i["float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n]=e[n];return t}}(),function(){var t=Array.prototype.slice;var e,i,n=function(e){return t.call(e,0)};try{e=n(fabric.document.childNodes)instanceof Array}catch(t){}function r(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function a(t){for(var e=0,i=0,n=fabric.document.documentElement,r=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=r.scrollLeft||n.scrollLeft||0,i=r.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:i}}e||(n=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),i=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){var t=fabric.document.documentElement.style,e="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),e?t.style[e]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),e?t.style[e]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}}(),function(){fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}}(),fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=n,fabric.util.makeElement=r,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=r(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},fabric.util.getScrollLeftTop=a,fabric.util.getElementOffset=function(t){var e,n,r=t&&t.ownerDocument,s={left:0,top:0},o={left:0,top:0},c={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return o;for(var l in c)o[c[l]]+=parseInt(i(t,l),10)||0;return e=r.documentElement,void 0!==t.getBoundingClientRect&&(s=t.getBoundingClientRect()),n=a(t),{left:s.left+n.left-(e.clientLeft||0)+o.left,top:s.top+n.top-(e.clientTop||0)+o.top}},fabric.util.getElementStyle=i,fabric.util.getNodeCanvas=function(t){var e=fabric.jsdomImplForWrapper(t);return e._canvas||e._image},fabric.util.cleanUpJsdomNode=function(t){if(fabric.isLikelyNode){var e=fabric.jsdomImplForWrapper(t);e&&(e._image=null,e._canvas=null,e._currentSrc=null,e._attributes=null,e._classList=null)}}}(),function(){function t(){}fabric.util.request=function(e,i){i||(i={});var n,r,a=i.method?i.method.toUpperCase():"GET",s=i.onComplete||function(){},o=new fabric.window.XMLHttpRequest,c=i.body||i.parameters;return o.onreadystatechange=function(){4===o.readyState&&(s(o),o.onreadystatechange=t)},"GET"===a&&(c=null,"string"==typeof i.parameters&&(n=e,r=i.parameters,e=n+(/\?/.test(n)?"&":"?")+r)),o.open(a,e,!0),"POST"!==a&&"PUT"!==a||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(c),o}}(),fabric.log=console.log,fabric.warn=console.warn,function(){function t(){return!1}function e(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){return fabric.window.setTimeout(t,1e3/60)},n=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function r(){return i.apply(fabric.window,arguments)}fabric.util.animate=function(i){r(function(n){i||(i={});var a,s=n||+new Date,o=i.duration||500,c=s+o,l=i.onChange||t,h=i.abort||t,u=i.onComplete||t,f=i.easing||e,d="startValue"in i?i.startValue:0,p="endValue"in i?i.endValue:100,g=i.byValue||p-d;i.onStart&&i.onStart(),function t(e){var i=(a=e||+new Date)>c?o:a-s,n=i/o,m=f(i,d,g,o),v=Math.abs((m-d)/g);if(!h())return a>c?(l(p,1,1),void u(p,1,1)):(l(m,v,n),void r(t));u(p,1,1)}(s)})},fabric.util.requestAnimFrame=r,fabric.util.cancelAnimFrame=function(){return n.apply(fabric.window,arguments)}}(),function(){fabric.util.animateColor=function(t,e,i,n){var r=new fabric.Color(t).getSource(),a=new fabric.Color(e).getSource();n=n||{},fabric.util.animate(fabric.util.object.extend(n,{duration:i||500,startValue:r,endValue:a,byValue:a,easing:function(t,e,i,r){var a,s,o,c,l=n.colorEasing?n.colorEasing(t,r):1-Math.cos(t/r*(Math.PI/2));return a=e,s=i,o=l,c="rgba("+parseInt(a[0]+o*(s[0]-a[0]),10)+","+parseInt(a[1]+o*(s[1]-a[1]),10)+","+parseInt(a[2]+o*(s[2]-a[2]),10),c+=","+(a&&s?parseFloat(a[3]+o*(s[3]-a[3])):1),c+=")"}}))}}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function i(t,e,i,r){return i-n(r-t,0,i,r)+e}function n(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,n){return i*(t/=n)*t*t*t+e},easeOutQuart:function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},easeOutQuint:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},easeInOutSine:function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},easeInExpo:function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},easeOutExpo:function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},easeInOutExpo:function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},easeOutCirc:function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},easeInOutCirc:function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(i,n,r,a){var s=0;return 0===i?n:1==(i/=a)?n+r:(s||(s=.3*a),-e(t(r,r,s,1.70158),i,a)+n)},easeOutElastic:function(e,i,n,r){var a=0,s=n;if(0===e)return i;if(1==(e/=r))return i+n;a||(a=.3*r);var o=t(s,n,a,1.70158);return o.a*Math.pow(2,-10*e)*Math.sin((e*r-o.s)*(2*Math.PI)/o.p)+o.c+i},easeInOutElastic:function(i,n,r,a){var s=0,o=r;if(0===i)return n;if(2==(i/=a/2))return n+r;s||(s=a*(.3*1.5));var c=t(o,r,s,1.70158);return i<1?-.5*e(c,i,a)+n:c.a*Math.pow(2,-10*(i-=1))*Math.sin((i*a-c.s)*(2*Math.PI)/c.p)*.5+c.c+n},easeInBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:i,easeOutBounce:n,easeInOutBounce:function(t,e,r,a){return t<a/2?.5*i(2*t,0,r,a)+e:.5*n(2*t-a,0,r,a)+.5*r+e}}}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,a=e.util.parseUnit,s=e.util.multiplyTransformMatrices,o={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},c={stroke:"strokeOpacity",fill:"fillOpacity"},l="font-size",h="clip-path";function u(t,i,n,r){var o,c="[object Array]"===Object.prototype.toString.call(i);if("fill"!==t&&"stroke"!==t||"none"!==i)if("vector-effect"===t)i="non-scaling-stroke"===i;else if("strokeDashArray"===t)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)i=n&&n.transformMatrix?s(n.transformMatrix,e.parseTransformAttribute(i)):e.parseTransformAttribute(i);else if("visible"===t)i="none"!==i&&"hidden"!==i,n&&!1===n.visible&&(i=!1);else if("opacity"===t)i=parseFloat(i),n&&void 0!==n.opacity&&(i*=n.opacity);else if("textAnchor"===t)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===t)o=a(i,r)/r*1e3;else if("paintFirst"===t){var l=i.indexOf("fill"),h=i.indexOf("stroke");i="fill";l>-1&&h>-1&&h<l?i="stroke":-1===l&&h>-1&&(i="stroke")}else{if("href"===t||"xlink:href"===t)return i;o=c?i.map(a):a(i,r)}else i="";return!c&&isNaN(o)?i:o}function f(t){return new RegExp("^("+t.join("|")+")\\b","i")}function d(t,e){var i,n,r,a,s=[];for(r=0,a=e.length;r<a;r++)i=e[r],n=t.getElementsByTagName(i),s=s.concat(Array.prototype.slice.call(n));return s}function p(t,e){var i,n=!0;return(i=g(t,e.pop()))&&e.length&&(n=function(t,e){var i,n=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=g(t,i);return 0===e.length}(t,e)),i&&n&&0===e.length}function g(t,e){var i,n,r=t.nodeName,a=t.getAttribute("class"),s=t.getAttribute("id");if(i=new RegExp("^"+r,"i"),e=e.replace(i,""),s&&e.length&&(i=new RegExp("#"+s+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),a&&e.length)for(n=(a=a.split(" ")).length;n--;)i=new RegExp("\\."+a[n]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"");return 0===e.length}function m(t,e){var i;if(t.getElementById&&(i=t.getElementById(e)),i)return i;var n,r,a,s=t.getElementsByTagName("*");for(r=0,a=s.length;r<a;r++)if(e===(n=s[r]).getAttribute("id"))return n}e.svgValidTagNamesRegEx=f(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),e.svgViewBoxElementsRegEx=f(["symbol","image","marker","pattern","view","svg"]),e.svgInvalidAncestorsRegEx=f(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),e.svgValidParentsRegEx=f(["symbol","g","a","svg","clipPath","defs"]),e.cssRules={},e.gradientDefs={},e.clipPaths={},e.parseTransformAttribute=function(){function t(t,i,n){t[n]=Math.tan(e.util.degreesToRadians(i[0]))}var i=e.iMatrix,n=e.reNum,r="(?:\\s+,?\\s*|,\\s*)",a="(?:"+("(?:(matrix)\\s*\\(\\s*("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")"+r+"("+n+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+n+")(?:"+r+"("+n+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+n+")(?:"+r+"("+n+")"+r+"("+n+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))")+")",s=new RegExp("^\\s*(?:"+("(?:"+a+"(?:"+r+"*"+a+")*)")+"?)\\s*$"),o=new RegExp(a,"g");return function(n){var r=i.concat(),c=[];if(!n||n&&!s.test(n))return r;n.replace(o,function(n){var s,o,l,h,u,f,d,p,g,m,v,y,_=new RegExp(a).exec(n).filter(function(t){return!!t}),b=_[1],x=_.slice(2).map(parseFloat);switch(b){case"translate":y=x,(v=r)[4]=y[0],2===y.length&&(v[5]=y[1]);break;case"rotate":x[0]=e.util.degreesToRadians(x[0]),u=r,f=x,d=e.util.cos(f[0]),p=e.util.sin(f[0]),g=0,m=0,3===f.length&&(g=f[1],m=f[2]),u[0]=d,u[1]=p,u[2]=-p,u[3]=d,u[4]=g-(d*g-p*m),u[5]=m-(p*g+d*m);break;case"scale":s=r,l=(o=x)[0],h=2===o.length?o[1]:o[0],s[0]=l,s[3]=h;break;case"skewX":t(r,x,2);break;case"skewY":t(r,x,1);break;case"matrix":r=x}c.push(r.concat()),r=i.concat()});for(var l=c[0];c.length>1;)c.shift(),l=e.util.multiplyTransformMatrices(l,c[0]);return l}}();var v=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function y(t){var i,n,r,s,o,c,l=t.getAttribute("viewBox"),h=1,u=1,f=t.getAttribute("width"),d=t.getAttribute("height"),p=t.getAttribute("x")||0,g=t.getAttribute("y")||0,m=t.getAttribute("preserveAspectRatio")||"",y=!l||!e.svgViewBoxElementsRegEx.test(t.nodeName)||!(l=l.match(v)),_=!f||!d||"100%"===f||"100%"===d,b=y&&_,x={},S="",w=0,T=0;if(x.width=0,x.height=0,x.toBeParsed=b,b)return x;if(y)return x.width=a(f),x.height=a(d),x;if(i=-parseFloat(l[1]),n=-parseFloat(l[2]),r=parseFloat(l[3]),s=parseFloat(l[4]),x.minX=i,x.minY=n,x.viewBoxWidth=r,x.viewBoxHeight=s,_?(x.width=r,x.height=s):(x.width=a(f),x.height=a(d),h=x.width/r,u=x.height/s),"none"!==(m=e.util.parsePreserveAspectRatioAttribute(m)).alignX&&("meet"===m.meetOrSlice&&(u=h=h>u?u:h),"slice"===m.meetOrSlice&&(u=h=h>u?h:u),w=x.width-r*h,T=x.height-s*h,"Mid"===m.alignX&&(w/=2),"Mid"===m.alignY&&(T/=2),"Min"===m.alignX&&(w=0),"Min"===m.alignY&&(T=0)),1===h&&1===u&&0===i&&0===n&&0===p&&0===g)return x;if((p||g)&&(S=" translate("+a(p)+" "+a(g)+") "),o=S+" matrix("+h+" 0 0 "+u+" "+(i*h+w)+" "+(n*u+T)+") ",x.viewboxTransform=e.parseTransformAttribute(o),"svg"===t.nodeName){for(c=t.ownerDocument.createElementNS(e.svgNS,"g");t.firstChild;)c.appendChild(t.firstChild);t.appendChild(c)}else o=(c=t).getAttribute("transform")+o;return c.setAttribute("transform",o),x}function _(t,e){var i="xlink:href",n=m(t,e.getAttribute(i).substr(1));if(n&&n.getAttribute(i)&&_(t,n),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(t){n&&!e.hasAttribute(t)&&n.hasAttribute(t)&&e.setAttribute(t,n.getAttribute(t))}),!e.children.length)for(var r=n.cloneNode(!0);r.firstChild;)e.appendChild(r.firstChild);e.removeAttribute(i)}e.parseSVGDocument=function(t,i,r,a){if(t){!function(t){for(var i=d(t,["use","svg:use"]),n=0;i.length&&n<i.length;){var r,a,s,o,c=i[n],l=(c.getAttribute("xlink:href")||c.getAttribute("href")).substr(1),h=c.getAttribute("x")||0,u=c.getAttribute("y")||0,f=m(t,l).cloneNode(!0),p=(f.getAttribute("transform")||"")+" translate("+h+", "+u+")",g=i.length,v=e.svgNS;if(y(f),/^svg$/i.test(f.nodeName)){var _=f.ownerDocument.createElementNS(v,"g");for(a=0,o=(s=f.attributes).length;a<o;a++)r=s.item(a),_.setAttributeNS(v,r.nodeName,r.nodeValue);for(;f.firstChild;)_.appendChild(f.firstChild);f=_}for(a=0,o=(s=c.attributes).length;a<o;a++)"x"!==(r=s.item(a)).nodeName&&"y"!==r.nodeName&&"xlink:href"!==r.nodeName&&"href"!==r.nodeName&&("transform"===r.nodeName?p=r.nodeValue+" "+p:f.setAttribute(r.nodeName,r.nodeValue));f.setAttribute("transform",p),f.setAttribute("instantiated_by_use","1"),f.removeAttribute("id"),c.parentNode.replaceChild(f,c),i.length===g&&n++}}(t);var s,o,c=e.Object.__uid++,l=y(t),h=e.util.toArray(t.getElementsByTagName("*"));if(l.crossOrigin=a&&a.crossOrigin,l.svgUid=c,0===h.length&&e.isLikelyNode){var u=[];for(s=0,o=(h=t.selectNodes('//*[name(.)!="svg"]')).length;s<o;s++)u[s]=h[s];h=u}var f=h.filter(function(t){return y(t),e.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t&&(t=t.parentNode);)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return!0;return!1}(t,e.svgInvalidAncestorsRegEx)});if(!f||f&&!f.length)i&&i([],{});else{var p={};h.filter(function(t){return"clipPath"===t.nodeName.replace("svg:","")}).forEach(function(t){var i=t.getAttribute("id");p[i]=e.util.toArray(t.getElementsByTagName("*")).filter(function(t){return e.svgValidTagNamesRegEx.test(t.nodeName.replace("svg:",""))})}),e.gradientDefs[c]=e.getGradientDefs(t),e.cssRules[c]=e.getCSSRules(t),e.clipPaths[c]=p,e.parseElements(f,function(t,n){i&&(i(t,l,n,h),delete e.gradientDefs[c],delete e.cssRules[c],delete e.clipPaths[c])},n(l),r,a)}}};var b=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");i(e,{parseFontDeclaration:function(t,e){var i=t.match(b);if(i){var n=i[1],r=i[3],s=i[4],o=i[5],c=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),s&&(e.fontSize=a(s)),c&&(e.fontFamily=c),o&&(e.lineHeight="normal"===o?1:o)}},getGradientDefs:function(t){var e,i=d(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),n=0,r={};for(n=i.length;n--;)(e=i[n]).getAttribute("xlink:href")&&_(t,e),r[e.getAttribute("id")]=e;return r},parseAttributes:function(t,n,s){if(t){var f,d,g,m={};void 0===s&&(s=t.getAttribute("svgUid")),t.parentNode&&e.svgValidParentsRegEx.test(t.parentNode.nodeName)&&(m=e.parseAttributes(t.parentNode,n,s));var v=n.reduce(function(e,i){return(f=t.getAttribute(i))&&(e[i]=f),e},{}),y=i(function(t,i){var n={};for(var r in e.cssRules[i])if(p(t,r.split(" ")))for(var a in e.cssRules[i][r])n[a]=e.cssRules[i][r][a];return n}(t,s),e.parseStyleAttribute(t));v=i(v,y),y[h]&&t.setAttribute(h,y[h]),d=g=m.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,v[l]&&(v[l]=d=a(v[l],g));var _,b,x,S={};for(var w in v)b=u(_=(x=w)in o?o[x]:x,v[w],m,d),S[_]=b;S&&S.font&&e.parseFontDeclaration(S.font,S);var T=i(m,S);return e.svgValidParentsRegEx.test(t.nodeName)?T:function(t){for(var i in c)if(void 0!==t[c[i]]&&""!==t[i]){if(void 0===t[i]){if(!e.Object.prototype[i])continue;t[i]=e.Object.prototype[i]}if(0!==t[i].indexOf("url(")){var n=new e.Color(t[i]);t[i]=n.setAlpha(r(n.getAlpha()*t[c[i]],2)).toRgba()}}return t}(T)}},parseElements:function(t,i,n,r,a){new e.ElementsParser(t,i,n,r,a).parse()},parseStyleAttribute:function(t){var e,i,n,r={},a=t.getAttribute("style");return a?("string"==typeof a?(e=r,a.replace(/;\s*$/,"").split(";").forEach(function(t){var r=t.split(":");i=r[0].trim().toLowerCase(),n=r[1].trim(),e[i]=n})):function(t,e){var i,n;for(var r in t)void 0!==t[r]&&(i=r.toLowerCase(),n=t[r],e[i]=n)}(a,r),r):r},parsePointsAttribute:function(t){if(!t)return null;var e,i,n=[];for(e=0,i=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;e<i;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){var i,n,r=t.getElementsByTagName("style"),a={};for(i=0,n=r.length;i<n;i++){var s=r[i].textContent||"";""!==(s=s.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&s.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){var r=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),s={},o=r[2].trim().replace(/;$/,"").split(/\s*;\s*/);for(i=0,n=o.length;i<n;i++){var c=o[i].split(/\s*:\s*/),l=c[0],h=c[1];s[l]=h}(t=r[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(a[t]?e.util.object.extend(a[t],s):a[t]=e.util.object.clone(s))})})}return a},loadSVGFromURL:function(t,i,n,r){t=t.replace(/^\n\s*/,"").trim(),new e.util.request(t,{method:"get",onComplete:function(t){var a=t.responseXML;a&&!a.documentElement&&e.window.ActiveXObject&&t.responseText&&((a=new ActiveXObject("Microsoft.XMLDOM")).async="false",a.loadXML(t.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));if(!a||!a.documentElement)return i&&i(null),!1;e.parseSVGDocument(a.documentElement,function(t,e,n,r){i&&i(t,e,n,r)},n,r)}})},loadSVGFromString:function(t,i,n,r){var a;if(t=t.trim(),void 0!==e.window.DOMParser){var s=new e.window.DOMParser;s&&s.parseFromString&&(a=s.parseFromString(t,"text/xml"))}else e.window.ActiveXObject&&((a=new ActiveXObject("Microsoft.XMLDOM")).async="false",a.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(a.documentElement,function(t,e,n,r){i(t,e,n,r)},n,r)}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,n,r,a){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a},function(t){t.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},t.createObjects=function(){var t=this;this.elements.forEach(function(e,i){e.setAttribute("svgUid",t.svgUid),t.createObject(e,i)})},t.findTag=function(t){return fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))]},t.createObject=function(t,e){var i=this.findTag(t);if(i&&i.fromElement)try{i.fromElement(t,this.createCallback(e,t),this.options)}catch(t){fabric.log(t)}else this.checkIfDone()},t.createCallback=function(t,e){var i=this;return function(n){var r;i.resolveGradient(n,e,"fill"),i.resolveGradient(n,e,"stroke"),n instanceof fabric.Image&&n._originalElement&&(r=n.parsePreserveAspectRatioAttribute(e)),n._removeTransformMatrix(r),i.resolveClipPath(n,e),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},t.extractPropertyDefinition=function(t,e,i){var n=t[e],r=this.regexUrl;if(r.test(n)){r.lastIndex=0;var a=r.exec(n)[1];return r.lastIndex=0,fabric[i][this.svgUid][a]}},t.resolveGradient=function(t,e,i){var n=this.extractPropertyDefinition(t,i,"gradientDefs");if(n){var r=e.getAttribute(i+"-opacity"),a=fabric.Gradient.fromElement(n,t,r,this.options);t.set(i,a)}},t.createClipPathCallback=function(t,e){return function(t){t._removeTransformMatrix(),t.fillRule=t.clipRule,e.push(t)}},t.resolveClipPath=function(t,e){var i,n,r,a,s=this.extractPropertyDefinition(t,"clipPath","clipPaths");if(s){r=[],n=fabric.util.invertTransform(t.calcTransformMatrix());for(var o=s[0].parentNode,c=e;c.parentNode&&c.getAttribute("clip-path")!==t.clipPath;)c=c.parentNode;c.parentNode.appendChild(o);for(var l=0;l<s.length;l++)i=s[l],this.findTag(i).fromElement(i,this.createClipPathCallback(t,r),this.options);s=1===r.length?r[0]:new fabric.Group(r),a=fabric.util.multiplyTransformMatrices(n,s.calcTransformMatrix()),s.clipPath&&this.resolveClipPath(s,c);var h=fabric.util.qrDecompose(a);s.flipX=!1,s.flipY=!1,s.set("scaleX",h.scaleX),s.set("scaleY",h.scaleY),s.angle=h.angle,s.skewX=h.skewX,s.skewY=0,s.setPositionByOrigin({x:h.translateX,y:h.translateY},"center","center"),t.clipPath=s}else delete t.clipPath},t.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances,this.elements))}}(fabric.ElementsParser.prototype),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}e.Point?e.warn("fabric.Point is already defined"):(e.Point=i,i.prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){this.status=t,this.points=[]}e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=i,e.Intersection.prototype={constructor:i,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},e.Intersection.intersectLineLine=function(t,n,r,a){var s,o=(a.x-r.x)*(t.y-r.y)-(a.y-r.y)*(t.x-r.x),c=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),l=(a.y-r.y)*(n.x-t.x)-(a.x-r.x)*(n.y-t.y);if(0!==l){var h=o/l,u=c/l;0<=h&&h<=1&&0<=u&&u<=1?(s=new i("Intersection")).appendPoint(new e.Point(t.x+h*(n.x-t.x),t.y+h*(n.y-t.y))):s=new i}else s=new i(0===o||0===c?"Coincident":"Parallel");return s},e.Intersection.intersectLinePolygon=function(t,e,n){var r,a,s,o,c=new i,l=n.length;for(o=0;o<l;o++)r=n[o],a=n[(o+1)%l],s=i.intersectLineLine(t,e,r,a),c.appendPoints(s.points);return c.points.length>0&&(c.status="Intersection"),c},e.Intersection.intersectPolygonPolygon=function(t,e){var n,r=new i,a=t.length;for(n=0;n<a;n++){var s=t[n],o=t[(n+1)%a],c=i.intersectLinePolygon(s,o,e);r.appendPoints(c.points)}return r.points.length>0&&(r.status="Intersection"),r},e.Intersection.intersectPolygonRectangle=function(t,n,r){var a=n.min(r),s=n.max(r),o=new e.Point(s.x,a.y),c=new e.Point(a.x,s.y),l=i.intersectLinePolygon(a,o,t),h=i.intersectLinePolygon(o,s,t),u=i.intersectLinePolygon(s,c,t),f=i.intersectLinePolygon(c,a,t),d=new i;return d.appendPoints(l.points),d.appendPoints(h.points),d.appendPoints(u.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});function i(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}e.Color?e.warn("fabric.Color is already defined."):(e.Color=i,e.Color.prototype={_tryParsingColor:function(t){var e;t in i.colorNameMap&&(t=i.colorNameMap[t]),"transparent"===t&&(e=[255,255,255,0]),e||(e=i.sourceFromHex(t)),e||(e=i.sourceFromRgb(t)),e||(e=i.sourceFromHsl(t)),e||(e=[0,0,0,1]),e&&this.setSource(e)},_rgbToHsl:function(t,i,n){t/=255,i/=255,n/=255;var r,a,s,o=e.util.array.max([t,i,n]),c=e.util.array.min([t,i,n]);if(s=(o+c)/2,o===c)r=a=0;else{var l=o-c;switch(a=s>.5?l/(2-o-c):l/(o+c),o){case t:r=(i-n)/l+(i<n?6:0);break;case i:r=(n-t)/l+2;break;case n:r=(t-i)/l+4}r/=6}return[Math.round(360*r),Math.round(100*a),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=1===(t=n[0].toString(16)).length?"0"+t:t,e=1===(e=n[1].toString(16)).length?"0"+e:e,i=1===(i=n[2].toString(16)).length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},toHexa:function(){var t,e=this.getSource();return t=1===(t=(t=Math.round(255*e[3])).toString(16)).length?"0"+t:t,this.toHex()+t.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof i||(t=new i(t));var e,n=[],r=this.getAlpha(),a=this.getSource(),s=t.getSource();for(e=0;e<3;e++)n.push(Math.round(.5*a[e]+.5*s[e]));return n[3]=r,this.setSource(n),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},e.Color.fromRgb=function(t){return i.fromSource(i.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var e=t.match(i.reRGBa);if(e){var n=parseInt(e[1],10)/(/%$/.test(e[1])?100:1)*(/%$/.test(e[1])?255:1),r=parseInt(e[2],10)/(/%$/.test(e[2])?100:1)*(/%$/.test(e[2])?255:1),a=parseInt(e[3],10)/(/%$/.test(e[3])?100:1)*(/%$/.test(e[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(a,10),e[4]?parseFloat(e[4]):1]}},e.Color.fromRgba=i.fromRgb,e.Color.fromHsl=function(t){return i.fromSource(i.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var e=t.match(i.reHSLa);if(e){var r,a,s,o=(parseFloat(e[1])%360+360)%360/360,c=parseFloat(e[2])/(/%$/.test(e[2])?100:1),l=parseFloat(e[3])/(/%$/.test(e[3])?100:1);if(0===c)r=a=s=l;else{var h=l<=.5?l*(c+1):l+c-l*c,u=2*l-h;r=n(u,h,o+1/3),a=n(u,h,o),s=n(u,h,o-1/3)}return[Math.round(255*r),Math.round(255*a),Math.round(255*s),e[4]?parseFloat(e[4]):1]}},e.Color.fromHsla=i.fromHsl,e.Color.fromHex=function(t){return i.fromSource(i.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(i.reHex)){var e=t.slice(t.indexOf("#")+1),n=3===e.length||4===e.length,r=8===e.length||4===e.length,a=n?e.charAt(0)+e.charAt(0):e.substring(0,2),s=n?e.charAt(1)+e.charAt(1):e.substring(2,4),o=n?e.charAt(2)+e.charAt(2):e.substring(4,6),c=r?n?e.charAt(3)+e.charAt(3):e.substring(6,8):"FF";return[parseInt(a,16),parseInt(s,16),parseInt(o,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var e=new i;return e.setSource(t),e})}("undefined"!=typeof exports?exports:this),function(){function t(t,e){var i,n,r,a,s=t.getAttribute("style"),o=t.getAttribute("offset")||0;if(o=(o=parseFloat(o)/(/%$/.test(o)?100:1))<0?0:o>1?1:o,s){var c=s.split(/\s*;\s*/);for(""===c[c.length-1]&&c.pop(),a=c.length;a--;){var l=c[a].split(/\s*:\s*/),h=l[0].trim(),u=l[1].trim();"stop-color"===h?i=u:"stop-opacity"===h&&(r=u)}}return i||(i=t.getAttribute("stop-color")||"rgb(0,0,0)"),r||(r=t.getAttribute("stop-opacity")),n=(i=new fabric.Color(i)).getAlpha(),r=isNaN(parseFloat(r))?1:parseFloat(r),r*=n*e,{offset:o,color:i.toRgb(),opacity:r}}var e=fabric.util.object.clone;function i(t,e,i,n){var r,a;Object.keys(e).forEach(function(t){"Infinity"===(r=e[t])?a=1:"-Infinity"===r?a=0:(a=parseFloat(e[t],10),"string"==typeof r&&/^(\d+\.\d+)%|(\d+)%$/.test(r)&&(a*=.01,"pixels"===n&&("x1"!==t&&"x2"!==t&&"r2"!==t||(a*=i.viewBoxWidth||i.width),"y1"!==t&&"y2"!==t||(a*=i.viewBoxHeight||i.height)))),e[t]=a})}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(t){t||(t={}),t.coords||(t.coords={});var e,i=this;Object.keys(t).forEach(function(e){i[e]=t[e]}),this.id?this.id+="_"+fabric.Object.__uid++:this.id=fabric.Object.__uid++,e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice()},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:parseFloat(e),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(t){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,e,t),e},toSVG:function(t,i){var n,r,a,s,o=e(this.coords,!0),c=(i=i||{},e(this.colorStops,!0)),l=o.r1>o.r2,h=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),u=-this.offsetX,f=-this.offsetY,d=!!i.additionalTransform,p="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(c.sort(function(t,e){return t.offset-e.offset}),"objectBoundingBox"===p?(u/=t.width,f/=t.height):(u+=t.width/2,f+=t.height/2),"path"===t.type&&(u-=t.pathOffset.x,f-=t.pathOffset.y),h[4]-=u,h[5]-=f,s='id="SVGID_'+this.id+'" gradientUnits="'+p+'"',s+=' gradientTransform="'+(d?i.additionalTransform+" ":"")+fabric.util.matrixToSVG(h)+'" ',"linear"===this.type?a=["<linearGradient ",s,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,'">\n']:"radial"===this.type&&(a=["<radialGradient ",s,' cx="',l?o.x1:o.x2,'" cy="',l?o.y1:o.y2,'" r="',l?o.r1:o.r2,'" fx="',l?o.x2:o.x1,'" fy="',l?o.y2:o.y1,'">\n']),"radial"===this.type){if(l)for((c=c.concat()).reverse(),n=0,r=c.length;n<r;n++)c[n].offset=1-c[n].offset;var g=Math.min(o.r1,o.r2);if(g>0){var m=g/Math.max(o.r1,o.r2);for(n=0,r=c.length;n<r;n++)c[n].offset+=m*(1-c[n].offset)}}for(n=0,r=c.length;n<r;n++){var v=c[n];a.push("<stop ",'offset="',100*v.offset+"%",'" style="stop-color:',v.color,void 0!==v.opacity?";stop-opacity: "+v.opacity:";",'"/>\n')}return a.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),a.join("")},toLive:function(t,e){var i,n,r,a=fabric.util.object.clone(this.coords),s=a.x1,o=a.y1,c=a.x2,l=a.y2,h=this.colorStops;if(this.type){for(e instanceof fabric.Text&&"percentage"===this.gradientUnits&&(s*=e.width,o*=e.height,c*=e.width,l*=e.height),"linear"===this.type?i=t.createLinearGradient(s,o,c,l):"radial"===this.type&&(i=t.createRadialGradient(s,o,a.r1,c,l,a.r2)),n=0,r=h.length;n<r;n++){var u=h[n].color,f=h[n].opacity,d=h[n].offset;void 0!==f&&(u=new fabric.Color(u).setAlpha(f).toRgba()),i.addColorStop(d,u)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(e,n,r,a){var s=parseFloat(r)/(/%$/.test(r)?100:1);s=s<0?0:s>1?1:s,isNaN(s)&&(s=1);var o,c,l,h,u,f,d=e.getElementsByTagName("stop"),p="userSpaceOnUse"===e.getAttribute("gradientUnits")?"pixels":"percentage",g=e.getAttribute("gradientTransform")||"",m=[],v=0,y=0;for("linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?(o="linear",c={x1:(f=e).getAttribute("x1")||0,y1:f.getAttribute("y1")||0,x2:f.getAttribute("x2")||"100%",y2:f.getAttribute("y2")||0}):(o="radial",c={x1:(u=e).getAttribute("fx")||u.getAttribute("cx")||"50%",y1:u.getAttribute("fy")||u.getAttribute("cy")||"50%",r1:0,x2:u.getAttribute("cx")||"50%",y2:u.getAttribute("cy")||"50%",r2:u.getAttribute("r")||"50%"}),l=d.length;l--;)m.push(t(d[l],s));return h=fabric.parseTransformAttribute(g),i(n,c,a,p),"pixels"===p&&(v=-n.left,y=-n.top),new fabric.Gradient({id:e.getAttribute("id"),type:o,coords:c,colorStops:m,gradientUnits:p,gradientTransform:h,offsetX:v,offsetY:y})},forObject:function(t,e){return e||(e={}),i(t,e.coords,e.gradientUnits,{viewBoxWidth:100,viewBoxHeight:100}),new fabric.Gradient(e)}})}(),function(){"use strict";var t=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(t,e){if(t||(t={}),this.id=fabric.Object.__uid++,this.setOptions(t),!t.source||t.source&&"string"!=typeof t.source)e&&e(this);else if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source)),e&&e(this);else{var i=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){i.source=t,e&&e(i)},null,this.crossOrigin)}},toObject:function(e){var i,n,r=fabric.Object.NUM_FRACTION_DIGITS;return"function"==typeof this.source?i=String(this.source):"string"==typeof this.source.src?i=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(i=this.source.toDataURL()),n={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:t(this.offsetX,r),offsetY:t(this.offsetY,r),patternTransform:this.patternTransform?this.patternTransform.concat():null},fabric.util.populateWithProperties(this,n,e),n},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.width,n=e.height/t.height,r=this.offsetX/t.width,a=this.offsetY/t.height,s="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(n=1,a&&(n+=Math.abs(a))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1,r&&(i+=Math.abs(r))),e.src?s=e.src:e.toDataURL&&(s=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+a+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+s+'"></image>\n</pattern>\n'},setOptions:function(t){for(var e in t)this[e]=t[e]},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(t){for(var i in"string"==typeof t&&(t=this._parseShadow(t)),t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var n=40,r=40,a=e.Object.NUM_FRACTION_DIGITS,s=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-t.angle)),o=new e.Color(this.color);return t.width&&t.height&&(n=100*i((Math.abs(s.x)+this.blur)/t.width,a)+20,r=100*i((Math.abs(s.y)+this.blur)/t.height,a)+20),t.flipX&&(s.x*=-1),t.flipY&&(s.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,a)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(s.x,a)+'" dy="'+i(s.y,a)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+o.toRgb()+'" flood-opacity="'+o.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var t={},i=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(e){this[e]!==i[e]&&(t[e]=this[e])},this),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=fabric.util.toFixed,r=fabric.util.transformPoint,a=fabric.util.invertTransform,s=fabric.util.getNodeCanvas,o=fabric.util.createCanvasElement,c=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(t,e){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var t=fabric.devicePixelRatio;this.__initRetinaScaling(t,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(t,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(t,e,i){e.setAttribute("width",this.width*t),e.setAttribute("height",this.height*t),i.scale(t,t)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){if(e){var r=new fabric.Image(e,n);this[t]=r,r.canvas=this}i&&i(e)},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,e&&(e.canvas=this),i&&i(e)),this},__setBgOverlayColor:function(t,e,i){return this[t]=e,this._initGradient(e,t),this._initPattern(e,t,i),this},_createCanvasElement:function(){var t=o();if(!t)throw c;if(t.style||(t.style={}),void 0===t.getContext)throw c;return t},_initOptions:function(t){var e=this.lowerCanvasEl;this._setOptions(t),this.width=this.width||parseInt(e.width,10)||0,this.height=this.height||parseInt(e.height,10)||0,this.lowerCanvasEl.style&&(e.width=this.width,e.height=this.height,e.style.width=this.width+"px",e.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){t&&t.getContext?this.lowerCanvasEl=t:this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;for(var n in e=e||{},t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px",this.hasLostContext=!0),e.backstoreOnly||this._setCssDimension(n,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i,n,r=this._activeObject;for(this.viewportTransform=t,i=0,n=this._objects.length;i<n;i++)(e=this._objects[i]).group||e.setCoords(!1,!0);return r&&"activeSelection"===r.type&&r.setCoords(!1,!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(t,e){var i=t,n=this.viewportTransform.slice(0);t=r(t,a(this.viewportTransform)),n[0]=e,n[3]=e;var s=r(t,n);return n[4]+=i.x-s.x,n[5]+=i.y-s.y,this.setViewportTransform(n)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var t={},e=this.width,i=this.height,n=a(this.viewportTransform);return t.tl=r({x:0,y:0},n),t.br=r({x:e,y:i},n),t.tr=new fabric.Point(t.br.x,t.tl.y),t.bl=new fabric.Point(t.tl.x,t.br.y),this.vptCoords=t,t},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(t,e){var i=this.viewportTransform,n=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(t),this.fire("before:render",{ctx:t}),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),n&&(n.canvas=this,n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t)),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render",{ctx:t})},drawClipPathOnCanvas:function(t){var e=this.viewportTransform,i=this.clipPath;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.globalCompositeOperation="destination-in",i.transform(t),t.scale(1/i.zoomX,1/i.zoomY),t.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),t.restore()},_renderObjects:function(t,e){var i,n;for(i=0,n=e.length;i<n;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"],n=this[e+"Image"],r=this.viewportTransform,a=this[e+"Vpt"];if(i||n){if(i){t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=i.toLive?i.toLive(t,this):i,a&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),t.transform(1,0,0,1,i.offsetX||0,i.offsetY||0);var s=i.gradientTransform||i.patternTransform;s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),t.fill(),t.restore()}n&&(t.save(),a&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.render(t),t.restore())}},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=a(this.viewportTransform);return r({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n=this.clipPath,r={version:fabric.version,objects:this._toObjects(e,i)};return n&&(r.clipPath=this._toObject(this.clipPath,e,i)),t(r,this.__serializeBgOverlay(e,i)),fabric.util.populateWithProperties(this,r,i),r},_toObjects:function(t,e){return this._objects.filter(function(t){return!t.excludeFromExport}).map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),r},__serializeBgOverlay:function(t,e){var i={},n=this.backgroundImage,r=this.overlayImage;return this.backgroundColor&&(i.background=this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor),this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),n&&!n.excludeFromExport&&(i.backgroundImage=this._toObject(n,t,e)),r&&!r.excludeFromExport&&(i.overlayImage=this._toObject(r,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={}),t.reviver=e;var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(i,"background"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlay"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,r=e.width||this.width,a=e.height||this.height,s='viewBox="0 0 '+this.width+" "+this.height+'" ',o=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?s='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(i=this.viewportTransform,s='viewBox="'+n(-i[4]/i[0],o)+" "+n(-i[5]/i[3],o)+" "+n(this.width/i[0],o)+" "+n(this.height/i[3],o)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',r,'" ','height="',a,'" ',s,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")},createSVGClipPathMarkup:function(t){var e=this.clipPath;return e?(e.clipPathId="CLIPPATH_"+fabric.Object.__uid++,'<clipPath id="'+e.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(t.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var t=this;return["background","overlay"].map(function(e){var i=t[e+"Color"];if(i&&i.toLive){var n=t[e+"Vpt"],r=t.viewportTransform,a={width:t.width/(n?r[0]:1),height:t.height/(n?r[3]:1)};return i.toSVG(a,{additionalTransform:n?fabric.util.matrixToSVG(r):""})}}).join("")},createSVGFontFacesMarkup:function(){var t,e,i,n,r,a,s,o,c="",l={},h=fabric.fontPaths,u=[];for(this._objects.forEach(function t(e){u.push(e),e._objects&&e._objects.forEach(t)}),s=0,o=u.length;s<o;s++)if(e=(t=u[s]).fontFamily,-1!==t.type.indexOf("text")&&!l[e]&&h[e]&&(l[e]=!0,t.styles))for(r in i=t.styles)for(a in n=i[r])!l[e=n[a].fontFamily]&&h[e]&&(l[e]=!0);for(var f in l)c+=["\t\t@font-face {\n","\t\t\tfont-family: '",f,"';\n","\t\t\tsrc: url('",h[f],"');\n","\t\t}\n"].join("");return c&&(c=['\t<style type="text/css">',"<![CDATA[\n",c,"]]>","</style>\n"].join("")),c},_setSVGObjects:function(t,e){var i,n,r,a=this._objects;for(n=0,r=a.length;n<r;n++)(i=a[n]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&!this[e].excludeFromExport&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){var i=this[e+"Color"],n=this.viewportTransform,r=this.width,a=this.height;if(i)if(i.toLive){var s=i.repeat,o=fabric.util.invertTransform(n),c=this[e+"Vpt"]?fabric.util.matrixToSVG(o):"";t.push('<rect transform="'+c+" translate(",r/2,",",a/2,')"',' x="',i.offsetX-r/2,'" y="',i.offsetY-a/2,'" ','width="',"repeat-y"===s||"no-repeat"===s?i.source.width:r,'" height="',"repeat-x"===s||"no-repeat"===s?i.source.height:a,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',i,'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,n,r,a=this._activeObject;if(t===a&&"activeSelection"===t.type)for(e=(r=a._objects).length;e--;)n=r[e],i(this._objects,n),this._objects.unshift(n);else i(this._objects,t),this._objects.unshift(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(t){if(!t)return this;var e,n,r,a=this._activeObject;if(t===a&&"activeSelection"===t.type)for(r=a._objects,e=0;e<r.length;e++)n=r[e],i(this._objects,n),this._objects.push(n);else i(this._objects,t),this._objects.push(t);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(t,e){if(!t)return this;var n,r,a,s,o,c=this._activeObject,l=0;if(t===c&&"activeSelection"===t.type)for(o=c._objects,n=0;n<o.length;n++)r=o[n],(a=this._objects.indexOf(r))>0+l&&(s=a-1,i(this._objects,r),this._objects.splice(s,0,r)),l++;else 0!==(a=this._objects.indexOf(t))&&(s=this._findNewLowerIndex(t,a,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(t,e,i){var n,r;if(i)for(n=e,r=e-1;r>=0;--r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e-1;return n},bringForward:function(t,e){if(!t)return this;var n,r,a,s,o,c=this._activeObject,l=0;if(t===c&&"activeSelection"===t.type)for(n=(o=c._objects).length;n--;)r=o[n],(a=this._objects.indexOf(r))<this._objects.length-1-l&&(s=a+1,i(this._objects,r),this._objects.splice(s,0,r)),l++;else(a=this._objects.indexOf(t))!==this._objects.length-1&&(s=this._findNewUpperIndex(t,a,e),i(this._objects,t),this._objects.splice(s,0,t));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(t,e,i){var n,r,a;if(i)for(n=e,r=e+1,a=this._objects.length;r<a;++r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,fabric.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=o();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"setLineDash":return void 0!==i.setLineDash;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var t=s(this.lowerCanvasEl);return t&&t.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){var e=s(this.lowerCanvasEl);return e&&e.createJPEGStream(t)})}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.miterLimit=this.strokeMiterLimit,t.lineJoin=this.strokeLineJoin,fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(t){var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var t=this.canvas,e=this.shadow,i=t.contextTop,n=t.getZoom();t&&t._isRetinaScaling()&&(n*=fabric.devicePixelRatio),i.shadowColor=e.color,i.shadowBlur=e.blur*n,i.shadowOffsetX=e.offsetX*n,i.shadowOffsetY=e.offsetY*n}},needsFullRender:function(){return new fabric.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{decimate:.4,initialize:function(t){this.canvas=t,this._points=[]},_drawSegment:function(t,e,i){var n=e.midPointFrom(i);return t.quadraticCurveTo(e.x,e.y,n.x,n.y),n},onMouseDown:function(t,e){this.canvas._isMainEvent(e.e)&&(this._prepareForDrawing(t),this._captureDrawingPath(t),this._render())},onMouseMove:function(t,e){if(this.canvas._isMainEvent(e.e)&&this._captureDrawingPath(t)&&this._points.length>1)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var i=this._points,n=i.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,i[n-2],i[n-1],!0),r.stroke(),r.restore()}},onMouseUp:function(t){return!this.canvas._isMainEvent(t.e)||(this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){return!(this._points.length>1&&t.eq(this._points[this._points.length-1])||(this._points.push(t),0))},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);return this._addPoint(e)},_render:function(){var t,e,i=this.canvas.contextTop,n=this._points[0],r=this._points[1];if(this._saveAndTransform(i),i.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y){var a=this.width/1e3;n=new fabric.Point(n.x,n.y),r=new fabric.Point(r.x,r.y),n.x-=a,r.x+=a}for(i.moveTo(n.x,n.y),t=1,e=this._points.length;t<e;t++)this._drawSegment(i,n,r),n=this._points[t],r=this._points[t+1];i.lineTo(n.x,n.y),i.stroke(),i.restore()},convertPointsToSVGPath:function(t){var e,i=[],n=this.width/1e3,r=new fabric.Point(t[0].x,t[0].y),a=new fabric.Point(t[1].x,t[1].y),s=t.length,o=1,c=0,l=s>2;for(l&&(o=t[2].x<a.x?-1:t[2].x===a.x?0:1,c=t[2].y<a.y?-1:t[2].y===a.y?0:1),i.push("M ",r.x-o*n," ",r.y-c*n," "),e=1;e<s;e++){if(!r.eq(a)){var h=r.midPointFrom(a);i.push("Q ",r.x," ",r.y," ",h.x," ",h.y," ")}r=t[e],e+1<t.length&&(a=t[e+1])}return l&&(o=r.x>t[e-2].x?1:r.x===t[e-2].x?0:-1,c=r.y>t[e-2].y?1:r.y===t[e-2].y?0:-1),i.push("L ",r.x+o*n," ",r.y+c*n),i},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},decimatePoints:function(t,e){if(t.length<=2)return t;var i,n=this.canvas.getZoom(),r=Math.pow(e/n,2),a=t.length-1,s=t[0],o=[s];for(i=1;i<a;i++)Math.pow(s.x-t[i].x,2)+Math.pow(s.y-t[i].y,2)>=r&&(s=t[i],o.push(s));return 1===o.length&&o.push(new fabric.Point(o[0].x,o[0].y)),o},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==t){var e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(e),this.canvas.requestRenderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e})}else this.canvas.requestRenderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;this._saveAndTransform(i),this.dot(i,e),i.restore()},dot:function(t,e){t.fillStyle=e.fill,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),t.closePath(),t.fill()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},_render:function(){var t,e,i=this.canvas.contextTop,n=this.points;for(this._saveAndTransform(i),t=0,e=n.length;t<e;t++)this.dot(i,n[t]);i.restore()},onMouseMove:function(t){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(t),this._render()):this.drawDot(t)},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(t=0,e=this.points.length;t<e;t++){var r=this.points[t],a=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&a.setShadow(this.shadow),n.push(a)}var s=new fabric.Group(n);s.canvas=this.canvas,this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseMove:function(t){this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;i<n;i++)for(var r=this.sprayChunks[i],a=0,s=r.length;a<s;a++){var o=new fabric.Rect({width:r[a].width,height:r[a].width,left:r[a].x+1,top:r[a].y+1,originX:"center",originY:"center",fill:this.color});e.push(o)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e);this.shadow&&c.setShadow(this.shadow),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var e,i,n,r={};for(i=0,n=t.length;i<n;i++)r[e=t[i].left+""+t[i].top]||(r[e]=t[i]);var a=[];for(e in r)a.push(r[e]);return a},render:function(t){var e,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),e=0,i=t.length;e<i;e++){var r=t[e];void 0!==r.opacity&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var t,e,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),t=0,e=this.sprayChunks.length;t<e;t++)this.render(this.sprayChunks[t]);i.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var e,i,n,r,a=this.width/2;for(r=0;r<this.density;r++){e=fabric.util.getRandomInt(t.x-a,t.x+a),i=fabric.util.getRandomInt(t.y-a,t.y+a),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(e,i);s.width=n,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.util.createCanvasElement(),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t),i=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs,a=fabric.StaticCanvas.supports("setLineDash");for(var s in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e,i,n=this.getActiveObjects();if(n.length>0&&!this.preserveObjectStacking){e=[],i=[];for(var r=0,a=this._objects.length;r<a;r++)t=this._objects[r],-1===n.indexOf(t)?e.push(t):i.push(t);n.length>1&&(this._activeObject._objects=i),e.push.apply(e,i)}else e=this._objects;return e},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTopLayer:function(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.renderTopLayer(t),this.fire("after:render"),this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){var n,r=i||this.getPointer(t,!0);return n=e.group&&e.group===this._activeObject&&"activeSelection"===e.group.type?this._normalizePointer(e.group,r):{x:r.x,y:r.y},e.containsPoint(n)||e._findTargetCorner(r)},_normalizePointer:function(t,e){var i=t.calcTransformMatrix(),n=fabric.util.invertTransform(i),r=this.restorePointerVpt(e);return fabric.util.transformPoint(r,n)},isTargetTransparent:function(t,e,i){if(t.shouldCache()&&t._cacheCanvas&&t!==this._activeObject){var n=this._normalizePointer(t,{x:e,y:i}),r=Math.max(t.cacheTranslationX+n.x*t.zoomX,0),a=Math.max(t.cacheTranslationY+n.y*t.zoomY,0);return fabric.util.isTransparent(t._cacheContext,Math.round(r),Math.round(a),this.targetFindTolerance)}var s=this.contextCache,o=t.selectionBackgroundColor,c=this.viewportTransform;return t.selectionBackgroundColor="",this.clearContext(s),s.save(),s.transform(c[0],c[1],c[2],c[3],c[4],c[5]),t.render(s),s.restore(),t===this._activeObject&&t._renderControls(s,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),t.selectionBackgroundColor=o,fabric.util.isTransparent(s,e,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(t){return"[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(e){return!0===t[e]}):t[this.selectionKey]},_shouldClearSelection:function(t,e){var i=this.getActiveObjects(),n=this._activeObject;return!e||e&&n&&i.length>1&&-1===i.indexOf(e)&&n!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t){if(t){var e,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?e=this.centeredScaling||t.centeredScaling:"rotate"===i.action&&(e=this.centeredRotation||t.centeredRotation),e?!i.altKey:i.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(i.y="top"),i},_getActionFromCorner:function(t,e,i){if(!e||!t)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,i,n){if(i){var r=this.getPointer(t),a=i._findTargetCorner(this.getPointer(t,!0)),s=this._getActionFromCorner(n,a,t,i),o=this._getOriginFromCorner(i,a);this._currentTransform={target:i,action:s,corner:a,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:r.x-i.left,offsetY:r.y-i.top,originX:o.x,originY:o.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey],original:fabric.util.saveObjectTransform(i)},this._currentTransform.original.originX=o.x,this._currentTransform.original.originY=o.y,this._resetCurrentTransform(),this._beforeTransform(t)}},_translateObject:function(t,e){var i=this._currentTransform,n=i.target,r=t-i.offsetX,a=e-i.offsetY,s=!n.get("lockMovementX")&&n.left!==r,o=!n.get("lockMovementY")&&n.top!==a;return s&&n.set("left",r),o&&n.set("top",a),s||o},_changeSkewTransformOrigin:function(t,e,i){var n="originX",r={0:"center"},a=e.target.skewX,s="left",o="right",c="mt"===e.corner||"ml"===e.corner?1:-1,l=1;t=t>0?1:-1,"y"===i&&(a=e.target.skewY,s="top",o="bottom",n="originY"),r[-1]=s,r[1]=o,e.target.flipX&&(l*=-1),e.target.flipY&&(l*=-1),0===a?(e.skewSign=-c*t*l,e[n]=r[-t]):(a=a>0?1:-1,e.skewSign=a,e[n]=r[a*c*l])},_skewObject:function(t,e,i){var n,r=this._currentTransform,a=r.target,s=a.get("lockSkewingX"),o=a.get("lockSkewingY");if(s&&"x"===i||o&&"y"===i)return!1;var c,l,h=a.getCenterPoint(),u=a.toLocalPoint(new fabric.Point(t,e),"center","center")[i],f=a.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[i],d=a._getTransformedDimensions();return this._changeSkewTransformOrigin(u-f,r,i),c=a.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY)[i],l=a.translateToOriginPoint(h,r.originX,r.originY),n=this._setObjectSkew(c,r,i,d),r.lastX=t,r.lastY=e,a.setPositionByOrigin(l,r.originX,r.originY),n},_setObjectSkew:function(t,e,i,n){var r,a,s,o,c,l,h,u,f,d,p=e.target,g=e.skewSign;return"x"===i?(c="y",l="Y",h="X",f=0,d=p.skewY):(c="x",l="X",h="Y",f=p.skewX,d=0),o=p._getTransformedDimensions(f,d),(u=2*Math.abs(t)-o[i])<=2?r=0:(r=g*Math.atan(u/p["scale"+h]/(o[c]/p["scale"+l])),r=fabric.util.radiansToDegrees(r)),a=p["skew"+h]!==r,p.set("skew"+h,r),0!==p["skew"+l]&&(s=p._getTransformedDimensions(),r=n[c]/s[c]*p["scale"+l],p.set("scale"+l,r)),a},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,a=r.lockScalingX,s=r.lockScalingY,o=r.lockScalingFlip;if(a&&s)return!1;var c,l=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),h=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY),u=r._getTransformedDimensions();return this._setLocalMouse(h,n),c=this._setObjectScale(h,n,a,s,i,o,u),r.setPositionByOrigin(l,n.originX,n.originY),c},_setObjectScale:function(t,e,i,n,r,a,s){var o=e.target,c=!1,l=!1,h=!1,u=t.x*o.scaleX/s.x,f=t.y*o.scaleY/s.y,d=o.scaleX!==u,p=o.scaleY!==f;if(e.newScaleX=u,e.newScaleY=f,fabric.Textbox&&"x"===r&&o instanceof fabric.Textbox){var g=o.width*(t.x/s.x);return g>=o.getMinWidth()&&(h=g!==o.width,o.set("width",g),h)}return a&&u<=0&&u<o.scaleX&&(c=!0,t.x=0),a&&f<=0&&f<o.scaleY&&(l=!0,t.y=0),"equally"!==r||i||n?r?"x"!==r||o.get("lockUniScaling")?"y"!==r||o.get("lockUniScaling")||l||n||o.set("scaleY",f)&&(h=p):c||i||o.set("scaleX",u)&&(h=d):(c||i||o.set("scaleX",u)&&(h=h||d),l||n||o.set("scaleY",f)&&(h=h||p)):h=this._scaleObjectEqually(t,o,e,s),c||l||this._flipObject(e,r),h},_scaleObjectEqually:function(t,e,i,n){var r,a,s,o=t.y+t.x,c=n.y*i.original.scaleY/e.scaleY+n.x*i.original.scaleX/e.scaleX,l=t.x<0?-1:1,h=t.y<0?-1:1;return a=l*Math.abs(i.original.scaleX*o/c),s=h*Math.abs(i.original.scaleY*o/c),r=a!==e.scaleX||s!==e.scaleY,e.set("scaleX",a),e.set("scaleY",s),r},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target,n=this.getZoom(),a=i.padding/n;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>a?t.x<0?t.x+=a:t.x-=a:t.x=0,r(t.y)>a?t.y<0?t.y+=a:t.y-=a:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform,a=r.target,s=a.translateToOriginPoint(a.getCenterPoint(),r.originX,r.originY);if(a.lockRotation)return!1;var o=n(r.ey-s.y,r.ex-s.x),c=n(e-s.y,t-s.x),l=i(c-o+r.theta),h=!0;if(a.snapAngle>0){var u=a.snapAngle,f=a.snapThreshold||u,d=Math.ceil(l/u)*u,p=Math.floor(l/u)*u;Math.abs(l-p)<f?l=p:Math.abs(l-d)<f&&(l=d)}return l<0&&(l=360+l),l%=360,a.angle===l?h=!1:(a.angle=l,a.setPositionByOrigin(s,r.originX,r.originY)),h},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_drawSelection:function(t){var e=this._groupSelector,i=e.left,n=e.top,s=r(i),o=r(n);if(this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),s,o)),this.selectionLineWidth&&this.selectionBorderColor)if(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!a){var c=e.ex+.5-(i>0?0:s),l=e.ey+.5-(n>0?0:o);t.beginPath(),fabric.util.drawDashedLine(t,c,l,c+s,l,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l+o-1,c+s,l+o-1,this.selectionDashArray),fabric.util.drawDashedLine(t,c,l,c,l+o,this.selectionDashArray),fabric.util.drawDashedLine(t,c+s-1,l,c+s-1,l+o,this.selectionDashArray),t.closePath(),t.stroke()}else fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(e.ex+.5-(i>0?0:s),e.ey+.5-(n>0?0:o),s,o)},findTarget:function(t,e){if(!this.skipTargetFind){var i,n,r=this.getPointer(t,!0),a=this._activeObject,s=this.getActiveObjects();if(this.targets=[],s.length>1&&!e&&a===this._searchPossibleTargets([a],r))return a;if(1===s.length&&a._findTargetCorner(r))return a;if(1===s.length&&a===this._searchPossibleTargets([a],r)){if(!this.preserveObjectStacking)return a;i=a,n=this.targets,this.targets=[]}var o=this._searchPossibleTargets(this._objects,r);return t[this.altSelectionKey]&&o&&i&&o!==i&&(o=i,this.targets=n),o}},_checkTarget:function(t,e,i){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,i.x,i.y))return!0}},_searchPossibleTargets:function(t,e){for(var i,n,r=t.length;r--;){var a=t[r],s=a.group&&"activeSelection"!==a.group.type?this._normalizePointer(a.group,e):e;if(this._checkTarget(s,a,e)){(i=t[r]).subTargetCheck&&i instanceof fabric.Group&&(n=this._searchPossibleTargets(i._objects,e))&&this.targets.push(n);break}}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(e,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var n,r=t(e),a=this.upperCanvasEl,s=a.getBoundingClientRect(),o=s.width||0,c=s.height||0;o&&c||("top"in s&&"bottom"in s&&(c=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(o=Math.abs(s.right-s.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,i||(r=this.restorePointerVpt(r));var l=this.getRetinaScaling();return 1!==l&&(r.x/=l,r.y/=l),n=0===o||0===c?{width:1,height:1}:{width:a.width/o,height:a.height/c},{x:r.x*n.width,y:r.y*n.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),e=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),fabric.util.addClass(i,"upper-canvas "+t),this.wrapperEl.appendChild(i),this._copyCanvasStyle(e,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.width||t.width,i=this.height||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var t=this._activeObject;return t?"activeSelection"===t.type&&t._objects?t._objects.slice(0):[t]:[]},_onObjectRemoved:function(t){t===this._activeObject&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),t===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",t)},_fireSelectionEvents:function(t,e){var i=!1,n=this.getActiveObjects(),r=[],a=[],s={e:e};t.forEach(function(t){-1===n.indexOf(t)&&(i=!0,t.fire("deselected",s),a.push(t))}),n.forEach(function(e){-1===t.indexOf(e)&&(i=!0,e.fire("selected",s),r.push(e))}),t.length>0&&n.length>0?(s.selected=r,s.deselected=a,s.updated=r[0]||a[0],s.target=this._activeObject,i&&this.fire("selection:updated",s)):n.length>0?(1===n.length&&(s.target=r[0],this.fire("object:selected",s)),s.selected=r,s.target=this._activeObject,this.fire("selection:created",s)):t.length>0&&(s.deselected=a,this.fire("selection:cleared",s))},setActiveObject:function(t,e){var i=this.getActiveObjects();return this._setActiveObject(t,e),this._fireSelectionEvents(i,e),this},_setActiveObject:function(t,e){return this._activeObject!==t&&(!!this._discardActiveObject(e,t)&&(!t.onSelect({e:e})&&(this._activeObject=t,!0)))},_discardActiveObject:function(t,e){var i=this._activeObject;if(i){if(i.onDeselect({e:t,object:e}))return!1;this._activeObject=null}return!0},discardActiveObject:function(t){var e=this.getActiveObjects(),i=this.getActiveObject();return e.length&&this.fire("before:selection:cleared",{target:i,e:t}),this._discardActiveObject(t),this._fireSelectionEvents(e,t),this},dispose:function(){var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(t){fabric.util.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this)),t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this._activeObject;e&&e._renderControls(t)},_toObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(t),r=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,n),r},_realizeGroupTransformOnObject:function(t){if(t.group&&"activeSelection"===t.group.type&&this._activeObject===t.group){var e={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(i){e[i]=t[i]}),this._activeObject.realizeTransform(t),e}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var n=this._realizeGroupTransformOnObject(e);this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,n)},setViewportTransform:function(t){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),fabric.StaticCanvas.prototype.setViewportTransform.call(this,t)}}),fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s])}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener,n={passive:!1};function r(t,e){return t.button&&t.button===e-1}fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(t,e){var i=this.upperCanvasEl,r=this._getEventPrefix();t(fabric.window,"resize",this._onResize),t(i,r+"down",this._onMouseDown),t(i,r+"move",this._onMouseMove,n),t(i,r+"out",this._onMouseOut),t(i,r+"enter",this._onMouseEnter),t(i,"wheel",this._onMouseWheel),t(i,"contextmenu",this._onContextMenu),t(i,"dblclick",this._onDoubleClick),t(i,"dragover",this._onDragOver),t(i,"dragenter",this._onDragEnter),t(i,"dragleave",this._onDragLeave),t(i,"drop",this._onDrop),this.enablePointerEvents||t(i,"touchstart",this._onTouchStart,n),"undefined"!=typeof eventjs&&e in eventjs&&(eventjs[e](i,"gesture",this._onGesture),eventjs[e](i,"drag",this._onDrag),eventjs[e](i,"orientation",this._onOrientationChange),eventjs[e](i,"shake",this._onShake),eventjs[e](i,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(i,"remove");var t=this._getEventPrefix();i(fabric.document,t+"up",this._onMouseUp),i(fabric.document,"touchend",this._onTouchEnd,n),i(fabric.document,t+"move",this._onMouseMove,n),i(fabric.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t});var i=this;this._hoveredTargets.forEach(function(n){i.fire("mouse:out",{target:e,e:t}),n&&e.fire("mouseout",{e:t})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(t){t.isEditing&&t.hiddenTextarea.focus()})},_onMouseEnter:function(t){this.currentTransform||this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onDragOver:function(t){t.preventDefault();var e=this._simpleEventHandler("dragover",t);this._fireEnterLeaveEvents(e,t)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onDoubleClick:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData(t)},getPointerId:function(t){var e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1},_isMainEvent:function(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||(!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId))},_onTouchStart:function(t){t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var r=this.upperCanvasEl,a=this._getEventPrefix();e(fabric.document,"touchend",this._onTouchEnd,n),e(fabric.document,"touchmove",this._onMouseMove,n),i(r,a+"down",this._onMouseDown)},_onMouseDown:function(t){this.__onMouseDown(t),this._resetTransformEventData();var r=this.upperCanvasEl,a=this._getEventPrefix();i(r,a+"move",this._onMouseMove,n),e(fabric.document,a+"up",this._onMouseUp),e(fabric.document,a+"move",this._onMouseMove,n)},_onTouchEnd:function(t){if(!(t.touches.length>0)){this.__onMouseUp(t),this._resetTransformEventData(),this.mainTouchId=null;var r=this._getEventPrefix();i(fabric.document,"touchend",this._onTouchEnd,n),i(fabric.document,"touchmove",this._onMouseMove,n);var a=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(a.upperCanvasEl,r+"down",a._onMouseDown),a._willAddMouseDown=0},400)}},_onMouseUp:function(t){this.__onMouseUp(t),this._resetTransformEventData();var r=this.upperCanvasEl,a=this._getEventPrefix();this._isMainEvent(t)&&(i(fabric.document,a+"up",this._onMouseUp),i(fabric.document,a+"move",this._onMouseMove,n),e(r,a+"move",this._onMouseMove,n))},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t){var e=this._activeObject;return!!(!!e!=!!t||e&&t&&e!==t)||(e&&e.isEditing,!1)},__onMouseUp:function(t){var e,i=this._currentTransform,n=this._groupSelector,a=!1,s=!n||0===n.left&&0===n.top;if(this._cacheTransformEventData(t),e=this._target,this._handleEvent(t,"up:before"),!r(t,3))return r(t,2)?(this.fireMiddleClick&&this._handleEvent(t,"up",2,s),void this._resetTransformEventData()):void(this.isDrawingMode&&this._isCurrentlyDrawing?this._onMouseUpInDrawingMode(t):this._isMainEvent(t)&&(i&&(this._finalizeCurrentTransform(t),a=i.actionPerformed),s||(this._maybeGroupObjects(t),a||(a=this._shouldRender(e))),e&&(e.isMoving=!1),this._setCursorFromEvent(t,e),this._handleEvent(t,"up",1,s),this._groupSelector=null,this._currentTransform=null,e&&(e.__corner=0),a?this.requestRenderAll():s||this.renderTop()));this.fireRightClick&&this._handleEvent(t,"up",3,s)},_simpleEventHandler:function(t,e){var i=this.findTarget(e),n=this.targets,r={e:e,target:i,subTargets:n};if(this.fire(t,r),i&&i.fire(t,r),!n)return i;for(var a=0;a<n.length;a++)n[a].fire(t,r);return i},_handleEvent:function(t,e,i,n){var r=this._target,a=this.targets||[],s={e:t,target:r,subTargets:a,button:i||1,isClick:n||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+e,s),r&&r.fire("mouse"+e,s);for(var o=0;o<a.length;o++)a[o].fire("mouse"+e,s)},_finalizeCurrentTransform:function(t){var e,i=this._currentTransform,n=i.target,r={e:t,target:n,transform:i};n._scaling&&(n._scaling=!1),n.setCoords(),(i.actionPerformed||this.stateful&&n.hasStateChanged())&&(i.actionPerformed&&(e=this._addEventOptions(r,i),this._fire(e,r)),this._fire("modified",r))},_addEventOptions:function(t,e){var i,n;switch(e.action){case"scaleX":i="scaled",n="x";break;case"scaleY":i="scaled",n="y";break;case"skewX":i="skewed",n="x";break;case"skewY":i="skewed",n="y";break;case"scale":i="scaled",n="equally";break;case"rotate":i="rotated";break;case"drag":i="moved"}return t.by=n,i},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(t).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this.clipTo&&this.contextTop.restore();var e=this.getPointer(t);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:t,pointer:e}),this._handleEvent(t,"up")},__onMouseDown:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var e=this._target;if(r(t,3))this.fireRightClick&&this._handleEvent(t,"down",3);else if(r(t,2))this.fireMiddleClick&&this._handleEvent(t,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(this._isMainEvent(t)&&!this._currentTransform){var i=this._pointer;this._previousPointer=i;var n=this._shouldRender(e),a=this._shouldGroup(t,e);if(this._shouldClearSelection(t,e)?this.discardActiveObject(t):a&&(this._handleGrouping(t,e),e=this._activeObject),!this.selection||e&&(e.selectable||e.isEditing||e===this._activeObject)||(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0}),e){var s=e===this._activeObject;e.selectable&&this.setActiveObject(e,t),e!==this._activeObject||!e.__corner&&a||this._setupCurrentTransform(t,e,s)}this._handleEvent(t,"down"),(n||a)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)||null},_beforeTransform:function(t){var e=this._currentTransform;this.stateful&&e.target.saveState(),this.fire("before:transform",{e:t,transform:e}),e.corner&&this.onBeforeScaleRotate(e.target)},__onMouseMove:function(t){var e,i;if(this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(this._isMainEvent(t)){var n=this._groupSelector;n?(i=this._pointer,n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t)||null,this._setCursorFromEvent(t,e),this._fireOverOutEvents(e,t)),this._handleEvent(t,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(t,e){var i=this._hoveredTarget,n=this._hoveredTargets,r=this.targets,a=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:i,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var s=0;s<a;s++)this.fireSyntheticInOutEvents(r[s],e,{oldTarget:n[s],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(t,e){var i=this._draggedoverTarget,n=this._hoveredTargets,r=this.targets,a=Math.max(n.length,r.length);this.fireSyntheticInOutEvents(t,e,{oldTarget:i,evtOut:"dragleave",evtIn:"dragenter"});for(var s=0;s<a;s++)this.fireSyntheticInOutEvents(r[s],e,{oldTarget:n[s],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=t},fireSyntheticInOutEvents:function(t,e,i){var n,r,a,s=i.oldTarget,o=s!==t,c=i.canvasEvtIn,l=i.canvasEvtOut;o&&(n={e:e,target:t,previousTarget:s},r={e:e,target:s,nextTarget:t}),a=t&&o,s&&o&&(l&&this.fire(l,r),s.fire(i.evtOut,r)),a&&(c&&this.fire(c,n),t.fire(i.evtIn,n))},__onMouseWheel:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,i.shiftKey=t.shiftKey,i.altKey=t[this.centeredKey],this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,a=e.action,s=!1,o={target:e.target,e:t,transform:e,pointer:i};"rotate"===a?(s=this._rotateObject(n,r))&&this._fire("rotating",o):"scale"===a?(s=this._onScale(t,e,n,r))&&this._fire("scaling",o):"scaleX"===a?(s=this._scaleObject(n,r,"x"))&&this._fire("scaling",o):"scaleY"===a?(s=this._scaleObject(n,r,"y"))&&this._fire("scaling",o):"skewX"===a?(s=this._skewObject(n,r,"x"))&&this._fire("skewing",o):"skewY"===a?(s=this._skewObject(n,r,"y"))&&this._fire("skewing",o):(s=this._translateObject(n,r))&&(this._fire("moving",o),this.setCursor(o.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||s},_fire:function(t,e){this.fire("object:"+t,e),e.target.fire(t,e)},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(),e.reset=!0)}},_onScale:function(t,e,i,n){return this._isUniscalePossible(t,e.target)?(e.currentAction="scale",this._scaleObject(i,n)):(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally"))},_isUniscalePossible:function(t,e){return(t[this.uniScaleKey]||this.uniScaleTransform)&&!e.get("lockUniScaling")},_setCursorFromEvent:function(t,e){if(!e)return this.setCursor(this.defaultCursor),!1;var i=e.hoverCursor||this.hoverCursor,n=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,r=(!n||!n.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));r?this.setCursor(this.getCornerCursor(r,e,t)):(e.subTargetCheck&&this.targets.concat().reverse().map(function(t){i=t.hoverCursor||i}),this.setCursor(i))},getCornerCursor:function(e,i,n){return this.actionIsDisabled(e,i,n)?this.notAllowedCursor:e in t?this._getRotatedCornerCursor(e,i,n):"mtr"===e&&i.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(t,e,i){return"mt"===t||"mb"===t?i[this.altActionKey]?e.lockSkewingX:e.lockScalingY:"ml"===t||"mr"===t?i[this.altActionKey]?e.lockSkewingY:e.lockScalingX:"mtr"===t?e.lockRotation:this._isUniscalePossible(i,e)?e.lockScalingX&&e.lockScalingY:e.lockScalingX||e.lockScalingY},_getRotatedCornerCursor:function(e,i,n){var r=Math.round(i.angle%360/45);return r<0&&(r+=8),r+=t[e],n[this.altActionKey]&&t[e]%2==0&&(r+=2),r%=8,this.cursorMap[r]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this._activeObject;return i&&this._isSelectionKeyPressed(t)&&e&&e.selectable&&this.selection&&(i!==e||"activeSelection"===i.type)&&!e.onSelect({e:t})},_handleGrouping:function(t,e){var i=this._activeObject;i.__corner||(e!==i||(e=this.findTarget(t,!0))&&e.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(e,t):this._createActiveSelection(e,t))},_updateActiveSelection:function(t,e){var i=this._activeObject,n=i._objects.slice(0);i.contains(t)?(i.removeWithUpdate(t),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat(),1===i.size()&&this._setActiveObject(i.item(0),e)):(i.addWithUpdate(t),this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(n,e)},_createActiveSelection:function(t,e){var i=this.getActiveObjects(),n=this._createGroup(t);this._hoveredTarget=n,this._setActiveObject(n,e),this._fireSelectionEvents(i,e)},_createGroup:function(t){var e=this._objects,i=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(t){var e,i=this._collectObjects(t);1===i.length?this.setActiveObject(i[0],t):i.length>1&&(e=new fabric.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(e,t))},_collectObjects:function(i){for(var n,r=[],a=this._groupSelector.ex,s=this._groupSelector.ey,o=a+this._groupSelector.left,c=s+this._groupSelector.top,l=new fabric.Point(t(a,o),t(s,c)),h=new fabric.Point(e(a,o),e(s,c)),u=!this.selectionFullyContained,f=a===o&&s===c,d=this._objects.length;d--&&!((n=this._objects[d])&&n.selectable&&n.visible&&(u&&n.intersectsWithRect(l,h)||n.isContainedWithinRect(l,h)||u&&n.containsPoint(l)||u&&n.containsPoint(h))&&(r.push(n),f)););return r.length>1&&(r=r.filter(function(t){return!t.onSelect({e:i})})),r},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=(t.multiplier||1)*(t.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(n,t);return fabric.util.toDataURL(r,e,i)},toCanvasElement:function(t,e){t=t||1;var i=((e=e||{}).width||this.width)*t,n=(e.height||this.height)*t,r=this.getZoom(),a=this.width,s=this.height,o=r*t,c=this.viewportTransform,l=(c[4]-(e.left||0))*t,h=(c[5]-(e.top||0))*t,u=this.interactive,f=[o,0,0,o,l,h],d=this.enableRetinaScaling,p=fabric.util.createCanvasElement(),g=this.contextTop;return p.width=i,p.height=n,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=f,this.width=i,this.height=n,this.calcViewportBoundaries(),this.renderCanvas(p.getContext("2d"),this._objects),this.viewportTransform=c,this.width=a,this.height=s,this.calcViewportBoundaries(),this.interactive=u,this.enableRetinaScaling=d,this.contextTop=g,p}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t),r=this,a=n.clipPath,s=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete n.clipPath,this._enlivenObjects(n.objects,function(t){r.clear(),r._setBgOverlay(n,function(){a?r._enlivenObjects([a],function(i){r.clipPath=i[0],r.__setupCanvas.call(r,n,t,s,e)}):r.__setupCanvas.call(r,n,t,s,e)})},i),this}},__setupCanvas:function(t,e,i,n){var r=this;e.forEach(function(t,e){r.insertAt(t,e)}),this.renderOnAddRemove=i,delete t.objects,delete t.backgroundImage,delete t.overlayImage,delete t.background,delete t.overlay,this._setOptions(t),this.renderAll(),n&&n()},_setBgOverlay:function(t,e){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(t.backgroundImage||t.overlayImage||t.background||t.overlay){var n=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",t.backgroundImage,i,n),this.__setBgOverlay("overlayImage",t.overlayImage,i,n),this.__setBgOverlay("backgroundColor",t.background,i,n),this.__setBgOverlay("overlayColor",t.overlay,i,n)}else e&&e()},__setBgOverlay:function(t,e,i,n){var r=this;if(!e)return i[t]=!0,void(n&&n());"backgroundImage"===t||"overlayImage"===t?fabric.util.enlivenObjects([e],function(e){r[t]=e[0],i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()})},_enlivenObjects:function(t,e,i){t&&0!==t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},null,i):e&&e([])},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.util.createCanvasElement();e.width=this.width,e.height=this.height;var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,a=e.util.string.capitalize,s=e.util.degreesToRadians,o=e.StaticCanvas.supports("setLineDash"),c=!e.isLikelyNode;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:c,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(t){t&&this.setOptions(t)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(t){var i=e.perfLimitSizeTotal,n=t.width,r=t.height,a=e.maxCacheSideLimit,s=e.minCacheSideLimit;if(n<=a&&r<=a&&n*r<=i)return n<s&&(t.width=s),r<s&&(t.height=s),t;var o=n/r,c=e.util.limitDimsByArea(o,i),l=e.util.capValue,h=l(s,c.x,a),u=l(s,c.y,a);return n>h&&(t.zoomX/=n/h,t.width=h,t.capped=!0),r>u&&(t.zoomY/=r/u,t.height=u,t.capped=!0),t},_getCacheCanvasDimensions:function(){var t=this.getTotalObjectScaling(),e=this._getTransformedDimensions(0,0),i=e.x*t.scaleX/this.scaleX,n=e.y*t.scaleY/this.scaleY;return{width:i+2,height:n+2,zoomX:t.scaleX,zoomY:t.scaleY,x:i,y:n}},_updateCacheCanvas:function(){var t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){var i=t._currentTransform.target,n=t._currentTransform.action;if(this===i&&n.slice&&"scale"===n.slice(0,5))return!1}var r,a,s=this._cacheCanvas,o=this._limitCacheSize(this._getCacheCanvasDimensions()),c=e.minCacheSideLimit,l=o.width,h=o.height,u=o.zoomX,f=o.zoomY,d=l!==this.cacheWidth||h!==this.cacheHeight,p=this.zoomX!==u||this.zoomY!==f,g=d||p,m=0,v=0,y=!1;if(d){var _=this._cacheCanvas.width,b=this._cacheCanvas.height,x=l>_||h>b;y=x||(l<.9*_||h<.9*b)&&_>c&&b>c,x&&!o.capped&&(l>c||h>c)&&(m=.1*l,v=.1*h)}return!!g&&(y?(s.width=Math.ceil(l+m),s.height=Math.ceil(h+v)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,s.width,s.height)),r=o.x/2,a=o.y/2,this.cacheTranslationX=Math.round(s.width/2-r)+r,this.cacheTranslationY=Math.round(s.height/2-a)+a,this.cacheWidth=l,this.cacheHeight=h,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(u,f),this.zoomX=u,this.zoomY=f,!0)},setOptions:function(t){this._setOptions(t),this._initGradient(t.fill,"fill"),this._initGradient(t.stroke,"stroke"),this._initClipping(t),this._initPattern(t.fill,"fill"),this._initPattern(t.stroke,"stroke")},transform:function(t){var e;e=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5])},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,n={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:r(this.left,i),top:r(this.top,i),width:r(this.width,i),height:r(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,i),scaleX:r(this.scaleX,i),scaleY:r(this.scaleY,i),angle:r(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:r(this.skewX,i),skewY:r(this.skewY,i)};return this.clipPath&&(n.clipPath=this.clipPath.toObject(t),n.clipPath.inverted=this.clipPath.inverted,n.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,n,t),this.includeDefaultValues||(n=this._removeDefaultValues(n)),n},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){"left"!==e&&"top"!==e&&(t[e]===i[e]&&delete t[e],"[object Array]"===Object.prototype.toString.call(t[e])&&"[object Array]"===Object.prototype.toString.call(i[e])&&0===t[e].length&&0===i[e].length&&delete t[e])}),t},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){var t=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(t.scaleX),scaleY:Math.abs(t.scaleY)}},getTotalObjectScaling:function(){var t=this.getObjectScaling(),e=t.scaleX,i=t.scaleY;if(this.canvas){var n=this.canvas.getZoom(),r=this.canvas.getRetinaScaling();e*=n*r,i*=n*r}return{scaleX:e,scaleY:i}},getObjectOpacity:function(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t},_set:function(t,i){var n="scaleX"===t||"scaleY"===t,r=this[t]!==i,a=!1;return n&&(i=this._constrainScale(i)),"scaleX"===t&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==t||!i||i instanceof e.Shadow?"dirty"===t&&this.group&&this.group.set("dirty",i):i=new e.Shadow(i),this[t]=i,r&&(a=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(t)>-1?(this.dirty=!0,a&&this.group.set("dirty",!0)):a&&this.stateProperties.indexOf(t)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height&&0===this.strokeWidth||!this.visible},render:function(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t,this),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&e.util.clipContext(this,t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(t),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&t.restore(),t.restore())},renderCache:function(t){t=t||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(t){var i=this.clipPath;if(t.save(),i.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",i.absolutePositioned){var n=e.util.invertTransform(this.calcTransformMatrix());t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}i.transform(t),t.scale(1/i.zoomX,1/i.zoomY),t.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),t.restore()},drawObject:function(t,e){var i=this.fill,n=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):(this._renderBackground(t),this._setStrokeStyles(t,this),this._setFillStyles(t,this)),this._render(t),this._drawClipPath(t),this.fill=i,this.stroke=n},_drawClipPath:function(t){var e=this.clipPath;e&&(e.canvas=this.canvas,e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t))},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(t){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!t){var e=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-i/2,e,i)}return!0}return!1},_renderBackground:function(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}},_setOpacity:function(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity},_setStrokeStyles:function(t,e){e.stroke&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,t.strokeStyle=e.stroke.toLive?e.stroke.toLive(t,this):e.stroke)},_setFillStyles:function(t,e){e.fill&&(t.fillStyle=e.fill.toLive?e.fill.toLive(t,this):e.fill)},_setClippingProperties:function(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"},_setLineDash:function(t,e,i){e&&0!==e.length&&(1&e.length&&e.push.apply(e,e),o?t.setLineDash(e):i&&i(t))},_renderControls:function(t,i){var n,r,a,o=this.getViewportTransform(),c=this.calcTransformMatrix();r=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,a=void 0!==i.hasControls?i.hasControls:this.hasControls,c=e.util.multiplyTransformMatrices(o,c),n=e.util.qrDecompose(c),t.save(),t.translate(n.translateX,n.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),i.forActiveSelection?(t.rotate(s(n.angle)),r&&this.drawBordersInGroup(t,n,i)):(t.rotate(s(this.angle)),r&&this.drawBorders(t,i)),a&&this.drawControls(t,i),t.restore()},_setShadow:function(t){if(this.shadow){var i,n=this.shadow,r=this.canvas,a=r&&r.viewportTransform[0]||1,s=r&&r.viewportTransform[3]||1;i=n.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),r&&r._isRetinaScaling()&&(a*=e.devicePixelRatio,s*=e.devicePixelRatio),t.shadowColor=n.color,t.shadowBlur=n.blur*e.browserShadowBlurConstant*(a+s)*(i.scaleX+i.scaleY)/4,t.shadowOffsetX=n.offsetX*a*i.scaleX,t.shadowOffsetY=n.offsetY*s*i.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_applyPatternGradientTransform:function(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var i=e.gradientTransform||e.patternTransform,n=-this.width/2+e.offsetX||0,r=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,n,r):t.transform(1,0,0,1,n,r),i&&t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:n,offsetY:r}},_renderPaintInOrder:function(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))},_render:function(){},_renderFill:function(t){this.fill&&(t.save(),this._applyPatternGradientTransform(t,this.fill),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform&&this.group){var e=this.getObjectScaling();t.scale(1/e.scaleX,1/e.scaleY)}else this.strokeUniform&&t.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&"percentage"===this.stroke.gradientUnits?this._applyPatternForTransformedGradient(t,this.stroke):this._applyPatternGradientTransform(t,this.stroke),t.stroke(),t.restore()}},_applyPatternForTransformedGradient:function(t,i){var n,r=this._limitCacheSize(this._getCacheCanvasDimensions()),a=e.util.createCanvasElement(),s=this.canvas.getRetinaScaling(),o=r.x/this.scaleX/s,c=r.y/this.scaleY/s;a.width=o,a.height=c,(n=a.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(o,0),n.lineTo(o,c),n.lineTo(0,c),n.closePath(),n.translate(o/2,c/2),n.scale(r.zoomX/this.scaleX/s,r.zoomY/this.scaleY/s),this._applyPatternGradientTransform(n,i),n.fillStyle=i.toLive(t),n.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(s*this.scaleX/r.zoomX,s*this.scaleY/r.zoomY),t.strokeStyle=n.createPattern(a,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var t=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",t.scaleX),this.set("scaleY",t.scaleY),this.angle=t.angle,this.skewX=t.skewX,this.skewY=0}},_removeTransformMatrix:function(t){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=e.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,t&&(this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this.cropX=t.cropX,this.cropY=t.cropY,i.x+=t.offsetLeft,i.y+=t.offsetTop,this.width=t.width,this.height=t.height),this.setPositionByOrigin(i,"center","center")},clone:function(t,i){var n=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(n,t):e.Object._fromObject("Object",n,t)},cloneAsImage:function(t,i){var n=this.toCanvasElement(i);return t&&t(new e.Image(n)),this},toCanvasElement:function(t){t||(t={});var i=e.util,n=i.saveObjectTransform(this),r=this.group,a=this.shadow,s=Math.abs,o=(t.multiplier||1)*(t.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,t.withoutTransform&&i.resetObjectTransform(this),t.withoutShadow&&(this.shadow=null);var c,l,h,u,f=e.util.createCanvasElement(),d=this.getBoundingRect(!0,!0),p=this.shadow,g={x:0,y:0};p&&(l=p.blur,c=p.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),g.x=2*Math.round(s(p.offsetX)+l)*s(c.scaleX),g.y=2*Math.round(s(p.offsetY)+l)*s(c.scaleY)),h=d.width+g.x,u=d.height+g.y,f.width=Math.ceil(h),f.height=Math.ceil(u);var m=new e.StaticCanvas(f,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===t.format&&(m.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(m.width/2,m.height/2),"center","center");var v=this.canvas;m.add(this);var y=m.toCanvasElement(o||1,t);return this.shadow=a,this.set("canvas",v),r&&(this.group=r),this.set(n).setCoords(),m._objects=[],m.dispose(),m=null,y},toDataURL:function(t){return t||(t={}),e.util.toDataURL(this.toCanvasElement(t),t.format||"png",t.quality||1)},isType:function(t){return this.type===t},complexity:function(){return 1},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};return n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},n.gradientUnits=i.gradientUnits||"pixels",(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2),n.gradientTransform=i.gradientTransform,e.Gradient.prototype.addColorStop.call(n,i.colorStops),this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t,i){return this.set("fill",new e.Pattern(t,i))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},rotate:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(t,i){i=i||this.canvas.getPointer(t);var n=new e.Point(i.x,i.y),r=this._getLeftTopCoords();return this.angle&&(n=e.util.rotatePoint(n,r,s(-this.angle))),{x:n.x-r.x,y:n.y-r.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object._fromObject=function(t,i,r,a){var s=e[t];i=n(i,!0),e.util.enlivenPatterns([i.fill,i.stroke],function(t){void 0!==t[0]&&(i.fill=t[0]),void 0!==t[1]&&(i.stroke=t[1]),e.util.enlivenObjects([i.clipPath],function(t){i.clipPath=t[0];var e=a?new s(i[a],i):new s(i);r&&r(e)})})},e.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.degreesToRadians,e={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,n,r,a,s){var o,c,l,h=t.x,u=t.y;return"string"==typeof n?n=e[n]:n-=.5,"string"==typeof a?a=e[a]:a-=.5,o=a-n,"string"==typeof r?r=i[r]:r-=.5,"string"==typeof s?s=i[s]:s-=.5,c=s-r,(o||c)&&(l=this._getTransformedDimensions(),h=t.x+o*l.x,u=t.y+c*l.y),new fabric.Point(h,u)},translateToCenterPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,i,n,"center","center");return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},translateToOriginPoint:function(e,i,n){var r=this.translateToGivenOrigin(e,"center","center",i,n);return this.angle?fabric.util.rotatePoint(r,e,t(this.angle)):r},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,a,s=this.getCenterPoint();return r=void 0!==i&&void 0!==n?this.translateToGivenOrigin(s,"center","center",i,n):new fabric.Point(this.left,this.top),a=new fabric.Point(e.x,e.y),this.angle&&(a=fabric.util.rotatePoint(a,s,-t(this.angle))),a.subtractEquals(r)},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(i){var n,r,a=t(this.angle),s=this.getScaledWidth(),o=fabric.util.cos(a)*s,c=fabric.util.sin(a)*s;n="string"==typeof this.originX?e[this.originX]:this.originX-.5,r="string"==typeof i?e[i]:i-.5,this.left+=o*(r-n),this.top+=c*(r-n),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){var t=fabric.util.degreesToRadians,e=fabric.util.multiplyTransformMatrices,i=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,e){this.oCoords||this.setCoords();var i,n=t?this.aCoords:this.oCoords;return i=e?this.calcCoords(t):n,[new fabric.Point(i.tl.x,i.tl.y),new fabric.Point(i.tr.x,i.tr.y),new fabric.Point(i.br.x,i.br.y),new fabric.Point(i.bl.x,i.bl.y)]},intersectsWithRect:function(t,e,i,n){var r=this.getCoords(i,n);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(r,t,e).status},intersectsWithObject:function(t,e,i){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(e,i),t.getCoords(e,i)).status||t.isContainedWithinObject(this,e,i)||this.isContainedWithinObject(t,e,i)},isContainedWithinObject:function(t,e,i){for(var n=this.getCoords(e,i),r=0,a=t._getImageLines(i?t.calcCoords(e):e?t.aCoords:t.oCoords);r<4;r++)if(!t.containsPoint(n[r],a))return!1;return!0},isContainedWithinRect:function(t,e,i,n){var r=this.getBoundingRect(i,n);return r.left>=t.x&&r.left+r.width<=e.x&&r.top>=t.y&&r.top+r.height<=e.y},containsPoint:function(t,e,i,n){e=e||this._getImageLines(n?this.calcCoords(i):i?this.aCoords:this.oCoords);var r=this._findCrossPoints(t,e);return 0!==r&&r%2==1},isOnScreen:function(t){if(!this.canvas)return!1;for(var e,i=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,r=this.getCoords(!0,t),a=0;a<4;a++)if((e=r[a]).x<=n.x&&e.x>=i.x&&e.y<=n.y&&e.y>=i.y)return!0;return!!this.intersectsWithRect(i,n,!0,t)||this._containsCenterOfCanvas(i,n,t)},_containsCenterOfCanvas:function(t,e,i){var n={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return!!this.containsPoint(n,null,!0,i)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(e,i,!0,t)||this._containsCenterOfCanvas(e,i,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,a,s=0;for(var o in e)if(!((a=e[o]).o.y<t.y&&a.d.y<t.y||a.o.y>=t.y&&a.d.y>=t.y||(a.o.x===a.d.x&&a.o.x>=t.x?r=a.o.x:(i=0,n=(a.d.y-a.o.y)/(a.d.x-a.o.x),r=-(t.y-i*t.x-(a.o.y-n*a.o.x))/(i-n)),r>=t.x&&(s+=1),2!==s)))break;return s},getBoundingRect:function(t,e){var i=this.getCoords(t,e);return fabric.util.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,e){var i=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/i)},scaleToHeight:function(t,e){var i=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/i)},calcCoords:function(n){var r=this._calcRotateMatrix(),a=this._calcTranslateMatrix(),s=e(a,r),o=this.getViewportTransform(),c=n?s:e(o,s),l=this._getTransformedDimensions(),h=l.x/2,u=l.y/2,f=i({x:-h,y:-u},c),d=i({x:h,y:-u},c),p=i({x:-h,y:u},c),g=i({x:h,y:u},c);if(!n){var m=this.padding,v=t(this.angle),y=fabric.util.cos(v),_=fabric.util.sin(v),b=y*m,x=_*m,S=b+x,w=b-x;m&&(f.x-=w,f.y-=S,d.x+=S,d.y-=w,p.x-=S,p.y+=w,g.x+=w,g.y+=S);var T=new fabric.Point((f.x+p.x)/2,(f.y+p.y)/2),C=new fabric.Point((d.x+f.x)/2,(d.y+f.y)/2),E=new fabric.Point((g.x+d.x)/2,(g.y+d.y)/2),A=new fabric.Point((g.x+p.x)/2,(g.y+p.y)/2),M=new fabric.Point(C.x+_*this.rotatingPointOffset,C.y-y*this.rotatingPointOffset)}var O={tl:f,tr:d,br:g,bl:p};return n||(O.ml=T,O.mt=C,O.mr=E,O.mb=A,O.mtr=M),O},setCoords:function(t,e){return this.oCoords=this.calcCoords(t),e||(this.aCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){return fabric.util.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var e="";return!t&&this.group&&(e=this.group.transformMatrixKey(t)+"_"),e+this.top+"_"+this.left+"_"+this.scaleX+"_"+this.scaleY+"_"+this.skewX+"_"+this.skewY+"_"+this.angle+"_"+this.originX+"_"+this.originY+"_"+this.width+"_"+this.height+"_"+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){if(t)return this.calcOwnMatrix();var i=this.transformMatrixKey(),n=this.matrixCache||(this.matrixCache={});if(n.key===i)return n.value;var r=this.calcOwnMatrix();return this.group&&(r=e(this.group.calcTransformMatrix(),r)),n.key=i,n.value=r,r},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),e=this.ownMatrixCache||(this.ownMatrixCache={});if(e.key===t)return e.value;var i=this._calcTranslateMatrix();return this.translateX=i[4],this.translateY=i[5],e.key=t,e.value=fabric.util.composeMatrix(this),e.value},_calcDimensionsTransformMatrix:function(t,e,i){return fabric.util.calcDimensionsMatrix({skewX:t,skewY:e,scaleX:this.scaleX*(i&&this.flipX?-1:1),scaleY:this.scaleY*(i&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);var i,n,r=this._getNonTransformedDimensions(),a=0===t&&0===e;if(this.strokeUniform?(i=this.width,n=this.height):(i=r.x,n=r.y),a)return this._finalizeDimensions(i*this.scaleX,n*this.scaleY);var s=[{x:-(i/=2),y:-(n/=2)},{x:i,y:-n},{x:-i,y:n},{x:i,y:n}],o=fabric.util.calcDimensionsMatrix({scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:e}),c=fabric.util.makeBoundingBoxFromPoints(s,o);return this._finalizeDimensions(c.width,c.height)},_finalizeDimensions:function(t,e){return this.strokeUniform?{x:t+this.strokeWidth,y:e+this.strokeWidth}:{x:t,y:e}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return fabric.util.transformPoint(e,t,!0).scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas&&this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas&&this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas&&this.canvas.moveTo(this,t),this}}),function(){function t(t,e){if(e){if(e.toLive)return t+": url(#SVGID_"+e.id+"); ";var i=new fabric.Color(e),n=t+": "+i.toRgb()+"; ",r=i.getAlpha();return 1!==r&&(n+=t+"-opacity: "+r.toString()+"; "),n}return t+": none; "}var e=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(e){var i=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"none",a=this.strokeDashOffset?this.strokeDashOffset:"0",s=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=void 0!==this.opacity?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=e?"":this.getSvgFilter(),f=t("fill",this.fill);return[t("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",s,"; ","stroke-dashoffset: ",a,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",c,"; ",f,"fill-rule: ",i,"; ","opacity: ",l,";",u,h].join("")},getSvgSpanStyles:function(e,i){var n=e.fontFamily?"font-family: "+(-1===e.fontFamily.indexOf("'")&&-1===e.fontFamily.indexOf('"')?"'"+e.fontFamily+"'":e.fontFamily)+"; ":"",r=e.strokeWidth?"stroke-width: "+e.strokeWidth+"; ":"",a=(n=n,e.fontSize?"font-size: "+e.fontSize+"px; ":""),s=e.fontStyle?"font-style: "+e.fontStyle+"; ":"",o=e.fontWeight?"font-weight: "+e.fontWeight+"; ":"",c=e.fill?t("fill",e.fill):"",l=e.stroke?t("stroke",e.stroke):"",h=this.getSvgTextDecoration(e),u=e.deltaY?"baseline-shift: "+-e.deltaY+"; ":"";return h&&(h="text-decoration: "+h+"; "),[l,r,n,a,s,o,h,c,u,i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(t){return["overline","underline","line-through"].filter(function(e){return t[e.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(t,e){var i=t?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+fabric.util.matrixToSVG(i)+(e||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" "+fabric.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(t){if(this.backgroundColor){var i=fabric.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,i),'" y="',e(-this.height/2,i),'" width="',e(this.width,i),'" height="',e(this.height,i),'"></rect>\n')}},toSVG:function(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})},toClipPathSVG:function(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})},_createBaseClipPathSVGMarkup:function(t,e){var i=(e=e||{}).reviver,n=e.additionalTransform||"",r=[this.getSvgTransform(!0,n),this.getSvgCommons()].join("");return t[t.indexOf("COMMON_PARTS")]=r,i?i(t.join("")):t.join("")},_createBaseSVGMarkup:function(t,e){var i,n,r=(e=e||{}).noStyle,a=e.reviver,s=r?"":'style="'+this.getSvgStyles()+'" ',o=e.withShadow?'style="'+this.getSvgFilter()+'" ':"",c=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=c&&c.absolutePositioned,u=this.stroke,f=this.fill,d=this.shadow,p=[],g=t.indexOf("COMMON_PARTS"),m=e.additionalTransform;return c&&(c.clipPathId="CLIPPATH_"+fabric.Object.__uid++,n='<clipPath id="'+c.clipPathId+'" >\n'+c.toClipPathSVG(a)+"</clipPath>\n"),h&&p.push("<g ",o,this.getSvgCommons()," >\n"),p.push("<g ",this.getSvgTransform(!1),h?"":o+this.getSvgCommons()," >\n"),i=[s,l,r?"":this.addPaintOrder()," ",m?'transform="'+m+'" ':""].join(""),t[g]=i,f&&f.toLive&&p.push(f.toSVG(this)),u&&u.toLive&&p.push(u.toSVG(this)),d&&p.push(d.toSVG(this)),c&&p.push(n),p.push(t.join("")),p.push("</g>\n"),h&&p.push("</g>\n"),a?a(p.join("")):p.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var t=fabric.util.object.extend,e="stateProperties";function i(e,i,n){var r={};n.forEach(function(t){r[t]=e[t]}),t(e[i],r,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(t){var i="_"+(t=t||e);return Object.keys(this[i]).length<this[t].length||!function t(e,i,n){if(e===i)return!0;if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var r=0,a=e.length;r<a;r++)if(!t(e[r],i[r]))return!1;return!0}if(e&&"object"==typeof e){var s,o=Object.keys(e);if(!i||"object"!=typeof i||!n&&o.length!==Object.keys(i).length)return!1;for(r=0,a=o.length;r<a;r++)if("canvas"!==(s=o[r])&&!t(e[s],i[s]))return!1;return!0}}(this[i],this,!0)},saveState:function(t){var n=t&&t.propertySet||e,r="_"+n;return this[r]?(i(this,r,this[n]),t&&t.stateProperties&&i(this,r,t.stateProperties),this):this.setupState(t)},setupState:function(t){var i=(t=t||{}).propertySet||e;return t.propertySet=i,this["_"+i]={},this.saveState(t),this}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var e,i,n=t.x,r=t.y;for(var a in this.__corner=0,this.oCoords)if(this.isControlVisible(a)&&("mtr"!==a||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==a&&"mr"!==a&&"mb"!==a&&"ml"!==a)&&(i=this._getImageLines(this.oCoords[a].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=a,a;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),a=.707106*this.cornerSize,s=a*fabric.util.cos(r),o=a*fabric.util.sin(r);for(var c in n)e=n[c].x,i=n[c].y,n[c].corner={tl:{x:e-o,y:i-s},tr:{x:e+s,y:i-o},bl:{x:e-s,y:i+o},br:{x:e+o,y:i+s}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/r[0],1/r[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=this.borderScaleFactor,r=i.x+n,a=i.y+n,s=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,o=void 0!==e.hasControls?e.hasControls:this.hasControls,c=void 0!==e.rotatingPointOffset?e.rotatingPointOffset:this.rotatingPointOffset;if(t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray,null),t.strokeRect(-r/2,-a/2,r,a),s&&this.isControlVisible("mtr")&&o){var l=-a/2;t.beginPath(),t.moveTo(0,l),t.lineTo(0,l-c),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e,i){i=i||{};var n={x:this.width,y:this.height},r=fabric.util.composeMatrix({scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX}),a=fabric.util.transformPoint(n,r),s=this.strokeWidth,o=this.borderScaleFactor,c=a.x+s*(this.strokeUniform?this.canvas.getZoom():e.scaleX)+o,l=a.y+s*(this.strokeUniform?this.canvas.getZoom():e.scaleY)+o;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-c/2,-l/2,c,l),t.restore(),this},drawControls:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=i.x,r=i.y,a=e.cornerSize||this.cornerSize,s=-(n+a)/2,o=-(r+a)/2,c=void 0!==e.transparentCorners?e.transparentCorners:this.transparentCorners,l=void 0!==e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,h=c?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",t,h,s,o,e),this._drawControl("tr",t,h,s+n,o,e),this._drawControl("bl",t,h,s,o+r,e),this._drawControl("br",t,h,s+n,o+r,e),this.get("lockUniScaling")||(this._drawControl("mt",t,h,s+n/2,o,e),this._drawControl("mb",t,h,s+n/2,o+r,e),this._drawControl("mr",t,h,s+n,o+r/2,e),this._drawControl("ml",t,h,s,o+r/2,e)),l&&this._drawControl("mtr",t,h,s+n/2,o-this.rotatingPointOffset,e),t.restore(),this},_drawControl:function(t,e,i,n,r,a){if(a=a||{},this.isControlVisible(t)){var s=this.cornerSize,o=!this.transparentCorners&&this.cornerStrokeColor;switch(a.cornerStyle||this.cornerStyle){case"circle":e.beginPath(),e.arc(n+s/2,r+s/2,s/2,0,2*Math.PI,!1),e[i](),o&&e.stroke();break;default:this.transparentCorners||e.clearRect(n,r,s,s),e[i+"Rect"](n,r,s,s),o&&e.strokeRect(n,r,s,s)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t||(t={}),t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,a=this;return fabric.util.animate({startValue:t.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),a.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,a=this;return fabric.util.animate({startValue:t.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),a.requestRenderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){var i=function(){},n=(e=e||{}).onComplete||i,r=e.onChange||i,a=this;return fabric.util.animate({startValue:t.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(e){t.set("opacity",e),a.requestRenderAll(),r()},onComplete:function(){a.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;n<r;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,a=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var s=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=s),e=~e.indexOf("=")?s+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(a)},onChange:function(e,s,o){r?a[r[0]][r[1]]=e:a.set(t,e),n||i.onChange&&i.onChange(e,s,o)},onComplete:function(t,e,r){n||(a.setCoords(),i.onComplete&&i.onComplete(t,e,r))}})}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r={x1:1,x2:1,y1:1,y2:1},a=e.StaticCanvas.supports("setLineDash");function s(t,e){var i=t.origin,n=t.axis1,r=t.axis2,a=t.dimension,s=e.nearest,o=e.center,c=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(n),this.get(r));case o:return Math.min(this.get(n),this.get(r))+.5*this.get(a);case c:return Math.max(this.get(n),this.get(r))}}}e.Line?e.warn("fabric.Line is already defined"):(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(t,e){t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==r[t]&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t){if(t.beginPath(),!this.strokeDashArray||this.strokeDashArray&&a){var e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)}t.lineWidth=this.strokeWidth;var i=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=i},_renderDashedStroke:function(t){var i=this.calcLinePoints();t.beginPath(),e.util.drawDashedLine(t,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray),t.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(t){return i(this.callSuper("toObject",t),this.calcLinePoints())},_getNonTransformedDimensions:function(){var t=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},_toSVG:function(){var t=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'" />\n']}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(t,n,r){r=r||{};var a=e.parseAttributes(t,e.Line.ATTRIBUTE_NAMES),s=[a.x1||0,a.y1||0,a.x2||0,a.y2||0];n(new e.Line(s,i(a,r)))},e.Line.fromObject=function(t,i){var r=n(t,!0);r.points=[t.x1,t.y1,t.x2,t.y2],e.Object._fromObject("Line",r,function(t){delete t.points,i&&i(t)},"points")})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.PI;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},_toSVG:function(){var t,n=(this.endAngle-this.startAngle)%(2*i);if(0===n)t=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var r=e.util.cos(this.startAngle)*this.radius,a=e.util.sin(this.startAngle)*this.radius,s=e.util.cos(this.endAngle)*this.radius,o=e.util.sin(this.endAngle)*this.radius,c=n>i?"1":"0";t=['<path d="M '+r+" "+a," A "+this.radius+" "+this.radius," 0 ",+c+" 1"," "+s+" "+o,'" ',"COMMON_PARTS"," />\n"]}return t},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,i){var n,r=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=r)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");r.left=(r.left||0)-r.radius,r.top=(r.top||0)-r.radius,i(new e.Circle(r))},e.Circle.fromObject=function(t,i){return e.Object._fromObject("Circle",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},_toSVG:function(){var t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-t+" "+e,"0 "+-e,t+" "+e].join(","),'" />']}}),e.Triangle.fromObject=function(t,i){return e.Object._fromObject("Triangle",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this.set("rx",t&&t.rx||0),this.set("ry",t&&t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,i,!1),t.restore(),this._renderPaintInOrder(t)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){var n=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new e.Ellipse(n))},e.Ellipse.fromObject=function(t,i){return e.Object._fromObject("Ellipse",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Rect?e.warn("fabric.Rect is already defined"):(e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t){var e=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,a=-this.width/2,s=-this.height/2,o=0!==e||0!==i,c=.4477152502;t.beginPath(),t.moveTo(a+e,s),t.lineTo(a+n-e,s),o&&t.bezierCurveTo(a+n-c*e,s,a+n,s+c*i,a+n,s+i),t.lineTo(a+n,s+r-i),o&&t.bezierCurveTo(a+n,s+r-c*i,a+n-c*e,s+r,a+n-e,s+r),t.lineTo(a+e,s+r),o&&t.bezierCurveTo(a+c*e,s+r,a,s+r-c*i,a,s+r-i),t.lineTo(a,s+i),o&&t.bezierCurveTo(a,s+c*i,a+c*e,s,a+e,s),t.closePath(),this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,a=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+a,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+a,i,n+a,this.strokeDashArray),e.util.drawDashedLine(t,i,n+a,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n,r){if(!t)return n(null);r=r||{};var a=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);a.left=a.left||0,a.top=a.top||0,a.height=a.height||0,a.width=a.width||0;var s=new e.Rect(i(r?e.util.object.clone(r):{},a));s.visible=s.visible&&s.width>0&&s.height>0,n(s)},e.Rect.fromObject=function(t,i){return e.Object._fromObject("Rect",t,i)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,a=e.util.toFixed;e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._setPositionDimensions(e)},_setPositionDimensions:function(t){var e,i=this._calcDimensions(t);this.width=i.width,this.height=i.height,t.fromSVG||(e=this.translateToGivenOrigin({x:i.left-this.strokeWidth/2,y:i.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),void 0===t.left&&(this.left=t.fromSVG?i.left:e.x),void 0===t.top&&(this.top=t.fromSVG?i.top:e.y),this.pathOffset={x:i.left+this.width/2,y:i.top+this.height/2}},_calcDimensions:function(){var t=this.points,e=n(t,"x")||0,i=n(t,"y")||0;return{left:e,top:i,width:(r(t,"x")||0)-e,height:(r(t,"y")||0)-i}},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},_toSVG:function(){for(var t=[],i=this.pathOffset.x,n=this.pathOffset.y,r=e.Object.NUM_FRACTION_DIGITS,s=0,o=this.points.length;s<o;s++)t.push(a(this.points[s].x-i,r),",",a(this.points[s].y-n,r)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',t.join(""),'" />\n']},commonRender:function(t){var e,i=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-r);for(var a=0;a<i;a++)e=this.points[a],t.lineTo(e.x-n,e.y-r);return!0},_render:function(t){this.commonRender(t)&&this._renderPaintInOrder(t)},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,a=this.points.length;r<a;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(t){return function(n,r,a){if(!n)return r(null);a||(a={});var s=e.parsePointsAttribute(n.getAttribute("points")),o=e.parseAttributes(n,e[t].ATTRIBUTE_NAMES);o.fromSVG=!0,r(new e[t](s,i(o,a)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(t,i){return e.Object._fromObject("Polyline",t,i,"points")})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_render:function(t){this.commonRender(t)&&(t.closePath(),this._renderPaintInOrder(t))},_renderDashedStroke:function(t){this.callSuper("_renderDashedStroke",t),t.closePath()}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(t,i){return e.Object._fromObject("Polygon",t,i,"points")})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,a=Object.prototype.toString,s=e.util.drawArc,o=e.util.toFixed,c={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(t,i){i=i||{},this.callSuper("initialize",i),t||(t=[]);var n="[object Array]"===a.call(t);this.path=n?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(n||(this.path=this._parsePath()),e.Polyline.prototype._setPositionDimensions.call(this,i))},_renderPathCommands:function(t){var e,i,n,r=null,a=0,o=0,c=0,l=0,h=0,u=0,f=-this.pathOffset.x,d=-this.pathOffset.y;t.beginPath();for(var p=0,g=this.path.length;p<g;++p){switch((e=this.path[p])[0]){case"l":c+=e[1],l+=e[2],t.lineTo(c+f,l+d);break;case"L":c=e[1],l=e[2],t.lineTo(c+f,l+d);break;case"h":c+=e[1],t.lineTo(c+f,l+d);break;case"H":c=e[1],t.lineTo(c+f,l+d);break;case"v":l+=e[1],t.lineTo(c+f,l+d);break;case"V":l=e[1],t.lineTo(c+f,l+d);break;case"m":a=c+=e[1],o=l+=e[2],t.moveTo(c+f,l+d);break;case"M":a=c=e[1],o=l=e[2],t.moveTo(c+f,l+d);break;case"c":i=c+e[5],n=l+e[6],h=c+e[3],u=l+e[4],t.bezierCurveTo(c+e[1]+f,l+e[2]+d,h+f,u+d,i+f,n+d),c=i,l=n;break;case"C":c=e[5],l=e[6],h=e[3],u=e[4],t.bezierCurveTo(e[1]+f,e[2]+d,h+f,u+d,c+f,l+d);break;case"s":i=c+e[3],n=l+e[4],null===r[0].match(/[CcSs]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.bezierCurveTo(h+f,u+d,c+e[1]+f,l+e[2]+d,i+f,n+d),h=c+e[1],u=l+e[2],c=i,l=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.bezierCurveTo(h+f,u+d,e[1]+f,e[2]+d,i+f,n+d),c=i,l=n,h=e[1],u=e[2];break;case"q":i=c+e[3],n=l+e[4],h=c+e[1],u=l+e[2],t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+f,e[2]+d,i+f,n+d),c=i,l=n,h=e[1],u=e[2];break;case"t":i=c+e[1],n=l+e[2],null===r[0].match(/[QqTt]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(h=c,u=l):(h=2*c-h,u=2*l-u),t.quadraticCurveTo(h+f,u+d,i+f,n+d),c=i,l=n;break;case"a":s(t,c+f,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+c+f,e[7]+l+d]),c+=e[6],l+=e[7];break;case"A":s(t,c+f,l+d,[e[1],e[2],e[3],e[4],e[5],e[6]+f,e[7]+d]),c=e[6],l=e[7];break;case"z":case"Z":c=a,l=o,t.closePath()}r=e}},_render:function(t){this._renderPathCommands(t),this._renderPaintInOrder(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return r(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()})})},toDatalessObject:function(t){var e=this.toObject(["sourcePath"].concat(t));return e.sourcePath&&delete e.path,e},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',this.path.map(function(t){return t.join(" ")}).join(" "),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var t=e.Object.NUM_FRACTION_DIGITS;return" translate("+o(-this.pathOffset.x,t)+", "+o(-this.pathOffset.y,t)+")"},toClipPathSVG:function(t){var e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})},toSVG:function(t){var e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})},complexity:function(){return this.path.length},_parsePath:function(){for(var t,i,n,r,a,s=[],o=[],h=e.rePathCommand,u=0,f=this.path.length;u<f;u++){for(r=(t=this.path[u]).slice(1).trim(),o.length=0;n=h.exec(r);)o.push(n[0]);a=[t.charAt(0)];for(var d=0,p=o.length;d<p;d++)i=parseFloat(o[d]),isNaN(i)||a.push(i);var g=a[0],m=c[g.toLowerCase()],v=l[g]||g;if(a.length-1>m)for(var y=1,_=a.length;y<_;y+=m)s.push([g].concat(a.slice(y,y+m))),g=v;else s.push(a)}return s},_calcDimensions:function(){for(var t,r,a,s,o=[],c=[],l=null,h=0,u=0,f=0,d=0,p=0,g=0,m=0,v=this.path.length;m<v;++m){switch((t=this.path[m])[0]){case"l":f+=t[1],d+=t[2],s=[];break;case"L":f=t[1],d=t[2],s=[];break;case"h":f+=t[1],s=[];break;case"H":f=t[1],s=[];break;case"v":d+=t[1],s=[];break;case"V":d=t[1],s=[];break;case"m":h=f+=t[1],u=d+=t[2],s=[];break;case"M":h=f=t[1],u=d=t[2],s=[];break;case"c":r=f+t[5],a=d+t[6],p=f+t[3],g=d+t[4],s=e.util.getBoundsOfCurve(f,d,f+t[1],d+t[2],p,g,r,a),f=r,d=a;break;case"C":p=t[3],g=t[4],s=e.util.getBoundsOfCurve(f,d,t[1],t[2],p,g,t[5],t[6]),f=t[5],d=t[6];break;case"s":r=f+t[3],a=d+t[4],null===l[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,f+t[1],d+t[2],r,a),p=f+t[1],g=d+t[2],f=r,d=a;break;case"S":r=t[3],a=t[4],null===l[0].match(/[CcSs]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,t[1],t[2],r,a),f=r,d=a,p=t[1],g=t[2];break;case"q":r=f+t[3],a=d+t[4],p=f+t[1],g=d+t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,a),f=r,d=a;break;case"Q":p=t[1],g=t[2],s=e.util.getBoundsOfCurve(f,d,p,g,p,g,t[3],t[4]),f=t[3],d=t[4];break;case"t":r=f+t[1],a=d+t[2],null===l[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,a),f=r,d=a;break;case"T":r=t[1],a=t[2],null===l[0].match(/[QqTt]/)?(p=f,g=d):(p=2*f-p,g=2*d-g),s=e.util.getBoundsOfCurve(f,d,p,g,p,g,r,a),f=r,d=a;break;case"a":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6]+f,t[7]+d),f+=t[6],d+=t[7];break;case"A":s=e.util.getBoundsOfArc(f,d,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),f=t[6],d=t[7];break;case"z":case"Z":f=h,d=u}l=t,s.forEach(function(t){o.push(t.x),c.push(t.y)}),o.push(f),c.push(d)}var y=i(o)||0,_=i(c)||0;return{left:y,top:_,width:(n(o)||0)-y,height:(n(c)||0)-_}}}),e.Path.fromObject=function(t,i){if("string"==typeof t.sourcePath){var n=t.sourcePath;e.loadSVGFromURL(n,function(e){var n=e[0];n.setOptions(t),i&&i(n)})}else e.Object._fromObject("Path",t,i,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var a=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);a.fromSVG=!0,i(new e.Path(a.d,r(a,n)))})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(i)this._updateObjectsACoords();else{var r=e&&e.centerPoint;void 0!==e.originX&&(this.originX=e.originX),void 0!==e.originY&&(this.originY=e.originY),r||this._calcBounds(),this._updateObjectsCoords(r),delete e.centerPoint,this.callSuper("initialize",e)}this.setCoords()},_updateObjectsACoords:function(){for(var t=this._objects.length;t--;)this._objects[t].setCoords(!0,!0)},_updateObjectsCoords:function(t){t=t||this.getCenterPoint();for(var e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){var i=t.left,n=t.top;t.set({left:i-e.x,top:n-e.y}),t.group=this,t.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,i){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,i);if("canvas"===t)for(;n--;)this._objects[n]._set(t,i);e.Object.prototype._set.call(this,t,i)},toObject:function(t){var i=this.includeDefaultValues,n=this._objects.map(function(e){var n=e.includeDefaultValues;e.includeDefaultValues=i;var r=e.toObject(t);return e.includeDefaultValues=n,r}),r=e.Object.prototype.toObject.call(this,t);return r.objects=n,r},toDatalessObject:function(t){var i,n=this.sourcePath;if(n)i=n;else{var r=this.includeDefaultValues;i=this._objects.map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=r;var n=e.toDatalessObject(t);return e.includeDefaultValues=i,n})}var a=e.Object.prototype.toDatalessObject.call(this,t);return a.objects=i,a},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=e.Object.prototype.shouldCache.call(this);if(t)for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return this.ownCaching=!1,!1;return t},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var e=0,i=this._objects.length;e<i;e++)this._objects[e].render(t);this._drawClipPath(t)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].isCacheDirty(!0)){if(this._cacheCanvas){var n=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-n/2,-r/2,n,r)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),n=e.util.qrDecompose(i),r=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(r,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var t=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new e.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),t.forEach(function(t){t.group=r,t.dirty=!0,i.add(t)}),r.canvas=i,r._objects=t,i._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0,!0)}),this},_calcBounds:function(t){for(var e,i,n,r=[],a=[],s=["tr","br","bl","tl"],o=0,c=this._objects.length,l=s.length;o<c;++o)for((e=this._objects[o]).setCoords(!0),n=0;n<l;n++)i=s[n],r.push(e.oCoords[i].x),a.push(e.oCoords[i].y);this._getBounds(r,a,t)},_getBounds:function(t,r,a){var s=new e.Point(i(t),i(r)),o=new e.Point(n(t),n(r)),c=s.y||0,l=s.x||0,h=o.x-s.x||0,u=o.y-s.y||0;this.width=h,this.height=u,a||this.setPositionByOrigin({x:l,y:c},"left","top")},_toSVG:function(t){for(var e=["<g ","COMMON_PARTS"," >\n"],i=0,n=this._objects.length;i<n;i++)e.push("\t\t",this._objects[i].toSVG(t));return e.push("</g>\n"),e},getSvgStyles:function(){var t=void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")},toClipPathSVG:function(t){for(var e=[],i=0,n=this._objects.length;i<n;i++)e.push("\t",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}}),e.Group.fromObject=function(t,i){var n=t.objects,r=e.util.object.clone(t,!0);delete r.objects,"string"!=typeof n?e.util.enlivenObjects(n,function(n){e.util.enlivenObjects([t.clipPath],function(r){var a=e.util.object.clone(t,!0);a.clipPath=r[0],delete a.objects,i&&i(new e.Group(n,a,!0))})}):e.loadSVGFromURL(n,function(a){var s=e.util.groupSVGElements(a,t,n);s.set(r),i&&i(s)})})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(t,i){i=i||{},this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var t=this._objects.concat();this._objects=[];var i=e.Object.prototype.toObject.call(this),n=new e.Group([]);if(delete i.type,n.set(i),t.forEach(function(t){t.canvas.remove(t),t.group=n}),n._objects=t,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),void 0===i.hasRotatingPoint&&(i.hasRotatingPoint=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(t,i);t.restore()}}),e.ActiveSelection.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.ActiveSelection(n,t,!0))})})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=fabric.util.object.extend;t.fabric||(t.fabric={}),t.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(t,e){e||(e={}),this.filters=[],this.cacheKey="texture"+fabric.Object.__uid++,this.callSuper("initialize",e),this._initElement(t,e)},getElement:function(){return this._element||{}},setElement:function(t,e){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=t,this._originalElement=t,this._initConfig(e),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(t){var e=fabric.filterBackend;e&&e.evictCachesForKey&&e.evictCachesForKey(t)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(t){fabric.util.cleanUpJsdomNode(this[t]),this[t]=void 0}.bind(this))},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}},_stroke:function(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath()}},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t,this),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var i=[];this.filters.forEach(function(t){t&&i.push(t.toObject())});var n=e(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(t)),{src:this.getSrc(),filters:i});return this.resizeFilter&&(n.resizeFilter=this.resizeFilter.toObject()),n},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var t,e=[],i=[],n=-this.width/2,r=-this.height/2,a="";if(this.hasCrop()){var s=fabric.Object.__uid++;e.push('<clipPath id="imageCrop_'+s+'">\n','\t<rect x="'+n+'" y="'+r+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),a=' clip-path="url(#imageCrop_'+s+')" '}if(i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',n-this.cropX,'" y="',r-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',a,"></image>\n"),this.stroke||this.strokeDashArray){var o=this.fill;this.fill=null,t=["\t<rect ",'x="',n,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=o}return e="fill"!==this.paintFirst?e.concat(t,i):e.concat(i,t)},getSrc:function(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src"):e.src:this.src||""},setSrc:function(t,e,i){return fabric.util.loadImage(t,function(t){this.setElement(t,i),this._setWidthHeight(),e&&e(this)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var t=this.resizeFilter,e=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,r=i.scaleY,a=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||n>e&&r>e)return this._element=a,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=r);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var s=fabric.util.createCanvasElement(),o=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,c=a.width,l=a.height;s.width=c,s.height=l,this._element=s,this._lastScaleX=t.scaleX=n,this._lastScaleY=t.scaleY=r,fabric.filterBackend.applyFilters([t],a,c,l,this._element,o),this._filterScalingX=s.width/this._originalElement.width,this._filterScalingY=s.height/this._originalElement.height},applyFilters:function(t){if(t=(t=t||this.filters||[]).filter(function(t){return t&&!t.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===t.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var e=this._originalElement,i=e.naturalWidth||e.width,n=e.naturalHeight||e.height;if(this._element===this._originalElement){var r=fabric.util.createCanvasElement();r.width=i,r.height=n,this._element=r,this._filteredEl=r}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(t,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(t){!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(t){var e=this._element,i=this.width,n=this.height,r=Math.min(e.naturalWidth||e.width,i*this._filterScalingX),a=Math.min(e.naturalHeight||e.height,n*this._filterScalingY),s=-i/2,o=-n/2,c=Math.max(0,this.cropX*this._filterScalingX),l=Math.max(0,this.cropY*this._filterScalingY);e&&t.drawImage(e,c,l,r,a,s,o,i,n)},_needsResize:function(){var t=this.getTotalObjectScaling();return t.scaleX!==this._lastScaleX||t.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(t,e){this.setElement(fabric.util.getById(t),e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){t||(t={});var e=this.getElement();this.width=t.width||e.naturalWidth||e.width||0,this.height=t.height||e.naturalHeight||e.height||0},parsePreserveAspectRatioAttribute:function(){var t,e=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,r=1,a=1,s=0,o=0,c=0,l=0,h=this.width,u=this.height,f={width:h,height:u};return!e||"none"===e.alignX&&"none"===e.alignY?(r=h/i,a=u/n):("meet"===e.meetOrSlice&&(t=(h-i*(r=a=fabric.util.findScaleToFit(this._element,f)))/2,"Min"===e.alignX&&(s=-t),"Max"===e.alignX&&(s=t),t=(u-n*a)/2,"Min"===e.alignY&&(o=-t),"Max"===e.alignY&&(o=t)),"slice"===e.meetOrSlice&&(t=i-h/(r=a=fabric.util.findScaleToCover(this._element,f)),"Mid"===e.alignX&&(c=t/2),"Max"===e.alignX&&(c=t),t=n-u/a,"Mid"===e.alignY&&(l=t/2),"Max"===e.alignY&&(l=t),i=h/r,n=u/a)),{width:i,height:n,scaleX:r,scaleY:a,offsetLeft:s,offsetTop:o,cropX:c,cropY:l}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){var i=fabric.util.object.clone(t);fabric.util.loadImage(i.src,function(t,n){n?e&&e(null,n):fabric.Image.prototype._initFilters.call(i,i.filters,function(n){i.filters=n||[],fabric.Image.prototype._initFilters.call(i,[i.resizeFilter],function(n){i.resizeFilter=n[0],fabric.util.enlivenObjects([i.clipPath],function(n){i.clipPath=n[0];var r=new fabric.Image(t,i);e(r)})})})},null,i.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),fabric.Image.fromElement=function(t,i,n){var r=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(r["xlink:href"],i,e(n?fabric.util.object.clone(n):{},r))})}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.angle%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(t){var e=function(){},i=(t=t||{}).onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.rotate(t),n()},onComplete:function(){r.setCoords(),i()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){"use strict";function t(t){t&&t.tileSize&&(this.tileSize=t.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}fabric.isWebglSupported=function(t){if(fabric.isLikelyNode)return!1;t=t||fabric.WebglFilterBackend.prototype.tileSize;var e,i,n,r=document.createElement("canvas"),a=r.getContext("webgl")||r.getContext("experimental-webgl"),s=!1;if(a){fabric.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),s=fabric.maxTextureSize>=t;for(var o=["highp","mediump","lowp"],c=0;c<3;c++)if(void 0,void 0,i="precision "+o[c]+" float;\nvoid main(){}",n=(e=a).createShader(e.FRAGMENT_SHADER),e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)){fabric.webGlPrecision=o[c];break}}return this.isSupported=s,s},fabric.WebglFilterBackend=t,t.prototype={tileSize:2048,resources:{},setupGLContext:function(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(t,e)},chooseFastestCopyGLTo2DMethod:function(t,e){var i,n=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(t){i=!1}var r="undefined"!=typeof ArrayBuffer,a="undefined"!=typeof Uint8ClampedArray;if(n&&i&&r&&a){var s=fabric.util.createCanvasElement(),o=new ArrayBuffer(t*e*4);if(fabric.forceGLPutImageData)return this.imageBuffer=o,void(this.copyGLTo2D=copyGLTo2DPutImageData);var c,l,h={imageBuffer:o,destinationWidth:t,destinationHeight:e,targetCanvas:s};s.width=t,s.height=e,c=window.performance.now(),copyGLTo2DDrawImage.call(h,this.gl,h),l=window.performance.now()-c,c=window.performance.now(),copyGLTo2DPutImageData.call(h,this.gl,h),l>window.performance.now()-c?(this.imageBuffer=o,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(t,e){var i=fabric.util.createCanvasElement();i.width=t,i.height=e;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},r=i.getContext("webgl",n);r||(r=i.getContext("experimental-webgl",n)),r&&(r.clearColor(0,0,0,0),this.canvas=i,this.gl=r)},applyFilters:function(t,e,i,n,r,a){var s,o=this.gl;a&&(s=this.getCachedTexture(a,e));var c={originalWidth:e.width||e.originalWidth,originalHeight:e.height||e.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:o,sourceTexture:this.createTexture(o,i,n,!s&&e),targetTexture:this.createTexture(o,i,n),originalTexture:s||this.createTexture(o,i,n,!s&&e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:r},l=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,l),t.forEach(function(t){t&&t.applyTo(c)}),resizeCanvasIfNeeded(c),this.copyGLTo2D(o,c),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(c.sourceTexture),o.deleteTexture(c.targetTexture),o.deleteFramebuffer(l),r.getContext("2d").setTransform(1,0,0,1,0,0),c},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(t,e,i,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),r},getCachedTexture:function(t,e){if(this.textureCache[t])return this.textureCache[t];var i=this.createTexture(this.gl,e.width,e.height,e);return this.textureCache[t]=i,i},evictCachesForKey:function(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,e={renderer:"",vendor:""};if(!t)return e;var i=t.getExtension("WEBGL_debug_renderer_info");if(i){var n=t.getParameter(i.UNMASKED_RENDERER_WEBGL),r=t.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(e.renderer=n.toLowerCase()),r&&(e.vendor=r.toLowerCase())}return this.gpuInfo=e,e}}}(),function(){"use strict";var t=function(){};function e(){}fabric.Canvas2dFilterBackend=e,e.prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(t,e,i,n,r){var a=r.getContext("2d");a.drawImage(e,0,0,i,n);var s={sourceWidth:i,sourceHeight:n,imageData:a.getImageData(0,0,i,n),originalEl:e,originalImageData:a.getImageData(0,0,i,n),canvasEl:r,ctx:a,filterBackend:this};return t.forEach(function(t){t.applyTo(s)}),s.imageData.width===i&&s.imageData.height===n||(r.width=s.imageData.width,r.height=s.imageData.height),a.putImageData(s.imageData,0,0),s}}}(),fabric.Image=fabric.Image||{},fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},createProgram:function(t,e,i){e=e||this.fragmentSource,i=i||this.vertexSource,"highp"!==fabric.webGlPrecision&&(e=e.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+t.getShaderInfoLog(n));var r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+t.getShaderInfoLog(r));var a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,r),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(a));var s=this.getAttributeLocations(t,a),o=this.getUniformLocations(t,a)||{};return o.uStepW=t.getUniformLocation(a,"uStepW"),o.uStepH=t.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:s,uniformLocations:o}},getAttributeLocations:function(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(t,e,i){var n=e.aPosition,r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW)},_setupFrameBuffer:function(t){var e,i,n=t.context;t.passes>1?(e=t.destinationWidth,i=t.destinationHeight,t.sourceWidth===e&&t.sourceHeight===i||(n.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(n,e,i)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(t){t.passes--,t.pass++;var e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e},isNeutralState:function(){var t=this.mainParameter,e=fabric.Image.filters[this.type].prototype;if(t){if(Array.isArray(e[t])){for(var i=e[t].length;i--;)if(this[t][i]!==e[t][i])return!1;return!0}return e[t]===this[t]}return!1},applyTo:function(t){t.webgl?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},retrieveShader:function(t){return t.programCache.hasOwnProperty(this.type)||(t.programCache[this.type]=this.createProgram(t.context)),t.programCache[this.type]},applyToWebGL:function(t){var e=t.context,i=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(i.program),this.sendAttributeData(e,i.attributeLocations,t.aPosition),e.uniform1f(i.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(i.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,i.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(t,e,i){t.activeTexture(i),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)},unbindAdditionalTexture:function(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(t){this[this.mainParameter]=t},sendUniformData:function(){},createHelpLayer:function(t){if(!t.helpLayer){var e=document.createElement("canvas");e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}},toObject:function(){var t={type:this.type},e=this.mainParameter;return e&&(t[e]=this[e]),t},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(t,e){var i=new fabric.Image.filters[t.type](t);return e&&e(i),i},function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.ColorMatrix=n(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var e,i,n,r,a,s=t.imageData.data,o=s.length,c=this.matrix,l=this.colorsOnly;for(a=0;a<o;a+=4)e=s[a],i=s[a+1],n=s[a+2],l?(s[a]=e*c[0]+i*c[1]+n*c[2]+255*c[4],s[a+1]=e*c[5]+i*c[6]+n*c[7]+255*c[9],s[a+2]=e*c[10]+i*c[11]+n*c[12]+255*c[14]):(r=s[a+3],s[a]=e*c[0]+i*c[1]+n*c[2]+r*c[3]+255*c[4],s[a+1]=e*c[5]+i*c[6]+n*c[7]+r*c[8]+255*c[9],s[a+2]=e*c[10]+i*c[11]+n*c[12]+r*c[13]+255*c[14],s[a+3]=e*c[15]+i*c[16]+n*c[17]+r*c[18]+255*c[19])},getUniformLocations:function(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}},sendUniformData:function(t,e){var i=this.matrix,n=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],r=[i[4],i[9],i[14],i[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,n),t.uniform4fv(e.uConstants,r)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Brightness=n(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(0!==this.brightness){var e,i=t.imageData.data,n=i.length,r=Math.round(255*this.brightness);for(e=0;e<n;e+=4)i[e]=i[e]+r,i[e+1]=i[e+1]+r,i[e+2]=i[e+2]+r}},getUniformLocations:function(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}},sendUniformData:function(t,e){t.uniform1f(e.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Convolute=r(n.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(t){var e=Math.sqrt(this.matrix.length),i=this.type+"_"+e+"_"+(this.opaque?1:0),n=this.fragmentSource[i];return t.programCache.hasOwnProperty(i)||(t.programCache[i]=this.createProgram(t.context,n)),t.programCache[i]},applyTo2d:function(t){var e,i,n,r,a,s,o,c,l,h,u,f,d,p=t.imageData,g=p.data,m=this.matrix,v=Math.round(Math.sqrt(m.length)),y=Math.floor(v/2),_=p.width,b=p.height,x=t.ctx.createImageData(_,b),S=x.data,w=this.opaque?1:0;for(u=0;u<b;u++)for(h=0;h<_;h++){for(a=4*(u*_+h),e=0,i=0,n=0,r=0,d=0;d<v;d++)for(f=0;f<v;f++)s=h+f-y,(o=u+d-y)<0||o>=b||s<0||s>=_||(c=4*(o*_+s),l=m[d*v+f],e+=g[c]*l,i+=g[c+1]*l,n+=g[c+2]*l,w||(r+=g[c+3]*l));S[a]=e,S[a+1]=i,S[a+2]=n,S[a+3]=w?g[a+3]:r}t.imageData=x},getUniformLocations:function(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}},sendUniformData:function(t,e){t.uniform1fv(e.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Grayscale=n(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(t){var e,i,n=t.imageData.data,r=n.length,a=this.mode;for(e=0;e<r;e+=4)"average"===a?i=(n[e]+n[e+1]+n[e+2])/3:"lightness"===a?i=(Math.min(n[e],n[e+1],n[e+2])+Math.max(n[e],n[e+1],n[e+2]))/2:"luminosity"===a&&(i=.21*n[e]+.72*n[e+1]+.07*n[e+2]),n[e]=i,n[e+1]=i,n[e+2]=i},retrieveShader:function(t){var e=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(e)){var i=this.fragmentSource[this.mode];t.programCache[e]=this.createProgram(t.context,i)}return t.programCache[e]},getUniformLocations:function(t,e){return{uMode:t.getUniformLocation(e,"uMode")}},sendUniformData:function(t,e){t.uniform1i(e.uMode,1)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Invert=n(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(t){var e,i=t.imageData.data,n=i.length;for(e=0;e<n;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,e){return{uInvert:t.getUniformLocation(e,"uInvert")}},sendUniformData:function(t,e){t.uniform1i(e.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.Noise=r(n.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(t){if(0!==this.noise){var e,i,n=t.imageData.data,r=n.length,a=this.noise;for(e=0,r=n.length;e<r;e+=4)i=(.5-Math.random())*a,n[e]+=i,n[e+1]+=i,n[e+2]+=i}},getUniformLocations:function(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}},sendUniformData:function(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Pixelate=n(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(t){var e,i,n,r,a,s,o,c,l,h,u,f=t.imageData,d=f.data,p=f.height,g=f.width;for(i=0;i<p;i+=this.blocksize)for(n=0;n<g;n+=this.blocksize)for(r=d[e=4*i*g+4*n],a=d[e+1],s=d[e+2],o=d[e+3],h=Math.min(i+this.blocksize,p),u=Math.min(n+this.blocksize,g),c=i;c<h;c++)for(l=n;l<u;l++)d[e=4*c*g+4*l]=r,d[e+1]=a,d[e+2]=s,d[e+3]=o},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}},sendUniformData:function(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.Image.filters,r=e.util.createClass;n.RemoveColor=r(n.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(t){var i,n,r,a,s=t.imageData.data,o=255*this.distance,c=new e.Color(this.color).getSource(),l=[c[0]-o,c[1]-o,c[2]-o],h=[c[0]+o,c[1]+o,c[2]+o];for(i=0;i<s.length;i+=4)n=s[i],r=s[i+1],a=s[i+2],n>l[0]&&r>l[1]&&a>l[2]&&n<h[0]&&r<h[1]&&a<h[2]&&(s[i+3]=0)},getUniformLocations:function(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource(),r=parseFloat(this.distance),a=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],s=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];t.uniform4fv(i.uLow,a),t.uniform4fv(i.uHigh,s)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in r)i[a]=n(i.ColorMatrix,{type:a,matrix:r[a],mainParameter:!1,colorsOnly:!0}),e.Image.filters[a].fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.BlendColor=n(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(t){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[t]+"}\n}"},retrieveShader:function(t){var e,i=this.type+"_"+this.mode;return t.programCache.hasOwnProperty(i)||(e=this.buildSource(this.mode),t.programCache[i]=this.createProgram(t.context,e)),t.programCache[i]},applyTo2d:function(t){var i,n,r,a,s,o,c,l=t.imageData.data,h=l.length,u=1-this.alpha;i=(c=new e.Color(this.color).getSource())[0]*this.alpha,n=c[1]*this.alpha,r=c[2]*this.alpha;for(var f=0;f<h;f+=4)switch(a=l[f],s=l[f+1],o=l[f+2],this.mode){case"multiply":l[f]=a*i/255,l[f+1]=s*n/255,l[f+2]=o*r/255;break;case"screen":l[f]=255-(255-a)*(255-i)/255,l[f+1]=255-(255-s)*(255-n)/255,l[f+2]=255-(255-o)*(255-r)/255;break;case"add":l[f]=a+i,l[f+1]=s+n,l[f+2]=o+r;break;case"diff":case"difference":l[f]=Math.abs(a-i),l[f+1]=Math.abs(s-n),l[f+2]=Math.abs(o-r);break;case"subtract":l[f]=a-i,l[f+1]=s-n,l[f+2]=o-r;break;case"darken":l[f]=Math.min(a,i),l[f+1]=Math.min(s,n),l[f+2]=Math.min(o,r);break;case"lighten":l[f]=Math.max(a,i),l[f+1]=Math.max(s,n),l[f+2]=Math.max(o,r);break;case"overlay":l[f]=i<128?2*a*i/255:255-2*(255-a)*(255-i)/255,l[f+1]=n<128?2*s*n/255:255-2*(255-s)*(255-n)/255,l[f+2]=r<128?2*o*r/255:255-2*(255-o)*(255-r)/255;break;case"exclusion":l[f]=i+a-2*i*a/255,l[f+1]=n+s-2*n*s/255,l[f+2]=r+o-2*r*o/255;break;case"tint":l[f]=i+a*u,l[f+1]=n+s*u,l[f+2]=r+o*u}},getUniformLocations:function(t,e){return{uColor:t.getUniformLocation(e,"uColor")}},sendUniformData:function(t,i){var n=new e.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(i.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric,i=e.Image.filters,n=e.util.createClass;i.BlendImage=n(i.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(t){var e=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(e)||(t.programCache[e]=this.createProgram(t.context,i)),t.programCache[e]},applyToWebGL:function(t){var e=t.context,i=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,i,e.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(e,e.TEXTURE1)},createTexture:function(t,e){return t.getCachedTexture(e.cacheKey,e._element)},calculateMatrix:function(){var t=this.image,e=t._element.width,i=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/i,1]},applyTo2d:function(t){var i,n,r,a,s,o,c,l,h,u,f,d=t.imageData,p=t.filterBackend.resources,g=d.data,m=g.length,v=d.width,y=d.height,_=this.image;p.blendImage||(p.blendImage=e.util.createCanvasElement()),u=(h=p.blendImage).getContext("2d"),h.width!==v||h.height!==y?(h.width=v,h.height=y):u.clearRect(0,0,v,y),u.setTransform(_.scaleX,0,0,_.scaleY,_.left,_.top),u.drawImage(_._element,0,0,v,y),f=u.getImageData(0,0,v,y).data;for(var b=0;b<m;b+=4)switch(s=g[b],o=g[b+1],c=g[b+2],l=g[b+3],i=f[b],n=f[b+1],r=f[b+2],a=f[b+3],this.mode){case"multiply":g[b]=s*i/255,g[b+1]=o*n/255,g[b+2]=c*r/255,g[b+3]=l*a/255;break;case"mask":g[b+3]=a}},getUniformLocations:function(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}},sendUniformData:function(t,e){var i=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(t,i){e.Image.fromObject(t.image,function(n){var r=e.util.object.clone(t);r.image=n,i(new e.Image.filters.BlendImage(r))})}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,a=Math.abs,s=Math.round,o=Math.sin,c=Math.ceil,l=e.Image.filters,h=e.util.createClass;l.Resize=h(l.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}},sendUniformData:function(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)},retrieveShader:function(t){var e=this.getFilterWindow(),i=this.type+"_"+e;if(!t.programCache.hasOwnProperty(i)){var n=this.generateShader(e);t.programCache[i]=this.createProgram(t.context,n)}return t.programCache[i]},getFilterWindow:function(){var t=this.tempScale;return Math.ceil(this.lanczosLobes/t)},getTaps:function(){for(var t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,i=this.getFilterWindow(),n=new Array(i),r=1;r<=i;r++)n[r-1]=t(r*e);return n},generateShader:function(t){for(var e=new Array(t),i=this.fragmentSourceTOP,n=1;n<=t;n++)e[n-1]=n+".0 * uDelta";return i+="uniform float uTaps["+t+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",e.forEach(function(t,e){i+="  color += texture2D(uTexture, vTexCoord + "+t+") * uTaps["+e+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+t+") * uTaps["+e+"];\n",i+="  sum += 2.0 * uTaps["+e+"];\n"}),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(t){t.webgl?(t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceHeight=t.destinationHeight):this.applyTo2d(t)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(t){return function(e){if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;var i=(e*=Math.PI)/t;return o(e)/e*o(i)/i}},applyTo2d:function(t){var e=t.imageData,i=this.scaleX,n=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/n;var r,a=e.width,o=e.height,c=s(a*i),l=s(o*n);"sliceHack"===this.resizeType?r=this.sliceByTwo(t,a,o,c,l):"hermite"===this.resizeType?r=this.hermiteFastResize(t,a,o,c,l):"bilinear"===this.resizeType?r=this.bilinearFiltering(t,a,o,c,l):"lanczos"===this.resizeType&&(r=this.lanczosResize(t,a,o,c,l)),t.imageData=r},sliceByTwo:function(t,i,r,a,s){var o,c,l=t.imageData,h=!1,u=!1,f=.5*i,d=.5*r,p=e.filterBackend.resources,g=0,m=0,v=i,y=0;for(p.sliceByTwo||(p.sliceByTwo=document.createElement("canvas")),((o=p.sliceByTwo).width<1.5*i||o.height<r)&&(o.width=1.5*i,o.height=r),(c=o.getContext("2d")).clearRect(0,0,1.5*i,r),c.putImageData(l,0,0),a=n(a),s=n(s);!h||!u;)i=f,r=d,a<n(.5*f)?f=n(.5*f):(f=a,h=!0),s<n(.5*d)?d=n(.5*d):(d=s,u=!0),c.drawImage(o,g,m,i,r,v,y,f,d),g=v,m=y,y+=d;return c.getImageData(g,m,a,s)},lanczosResize:function(t,e,s,o,l){var h=t.imageData.data,u=t.ctx.createImageData(o,l),f=u.data,d=this.lanczosCreate(this.lanczosLobes),p=this.rcpScaleX,g=this.rcpScaleY,m=2/this.rcpScaleX,v=2/this.rcpScaleY,y=c(p*this.lanczosLobes/2),_=c(g*this.lanczosLobes/2),b={},x={},S={};return function t(c){var w,T,C,E,A,M,O,L,P,I,R;for(x.x=(c+.5)*p,S.x=n(x.x),w=0;w<l;w++){for(x.y=(w+.5)*g,S.y=n(x.y),A=0,M=0,O=0,L=0,P=0,T=S.x-y;T<=S.x+y;T++)if(!(T<0||T>=e)){I=n(1e3*a(T-x.x)),b[I]||(b[I]={});for(var D=S.y-_;D<=S.y+_;D++)D<0||D>=s||(R=n(1e3*a(D-x.y)),b[I][R]||(b[I][R]=d(r(i(I*m,2)+i(R*v,2))/1e3)),(C=b[I][R])>0&&(A+=C,M+=C*h[E=4*(D*e+T)],O+=C*h[E+1],L+=C*h[E+2],P+=C*h[E+3]))}f[E=4*(w*o+c)]=M/A,f[E+1]=O/A,f[E+2]=L/A,f[E+3]=P/A}return++c<o?t(c):u}(0)},bilinearFiltering:function(t,e,i,r,a){var s,o,c,l,h,u,f,d,p,g=0,m=this.rcpScaleX,v=this.rcpScaleY,y=4*(e-1),_=t.imageData.data,b=t.ctx.createImageData(r,a),x=b.data;for(c=0;c<a;c++)for(l=0;l<r;l++)for(h=m*l-(s=n(m*l)),u=v*c-(o=n(v*c)),p=4*(o*e+s),f=0;f<4;f++)d=_[p+f]*(1-h)*(1-u)+_[p+4+f]*h*(1-u)+_[p+y+f]*u*(1-h)+_[p+y+4+f]*h*u,x[g++]=d;return b},hermiteFastResize:function(t,e,i,s,o){for(var l=this.rcpScaleX,h=this.rcpScaleY,u=c(l/2),f=c(h/2),d=t.imageData.data,p=t.ctx.createImageData(s,o),g=p.data,m=0;m<o;m++)for(var v=0;v<s;v++){for(var y=4*(v+m*s),_=0,b=0,x=0,S=0,w=0,T=0,C=0,E=(m+.5)*h,A=n(m*h);A<(m+1)*h;A++)for(var M=a(E-(A+.5))/f,O=(v+.5)*l,L=M*M,P=n(v*l);P<(v+1)*l;P++){var I=a(O-(P+.5))/u,R=r(L+I*I);R>1&&R<-1||(_=2*R*R*R-3*R*R+1)>0&&(C+=_*d[(I=4*(P+A*e))+3],x+=_,d[I+3]<255&&(_=_*d[I+3]/250),S+=_*d[I],w+=_*d[I+1],T+=_*d[I+2],b+=_)}g[y]=S/b,g[y+1]=w/b,g[y+2]=T/b,g[y+3]=C/x}return p},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Contrast=n(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(0!==this.contrast){var e,i=t.imageData.data,n=i.length,r=Math.floor(255*this.contrast),a=259*(r+255)/(255*(259-r));for(e=0;e<n;e+=4)i[e]=a*(i[e]-128)+128,i[e+1]=a*(i[e+1]-128)+128,i[e+2]=a*(i[e+2]-128)+128}},getUniformLocations:function(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}},sendUniformData:function(t,e){t.uniform1f(e.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Saturation=n(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(0!==this.saturation){var e,i,n=t.imageData.data,r=n.length,a=-this.saturation;for(e=0;e<r;e+=4)i=Math.max(n[e],n[e+1],n[e+2]),n[e]+=i!==n[e]?(i-n[e])*a:0,n[e+1]+=i!==n[e+1]?(i-n[e+1])*a:0,n[e+2]+=i!==n[e+2]?(i-n[e+2])*a:0}},getUniformLocations:function(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}},sendUniformData:function(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Blur=n(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var i,n,r=t.filterBackend.resources,a=t.imageData.width,s=t.imageData.height;r.blurLayer1||(r.blurLayer1=e.util.createCanvasElement(),r.blurLayer2=e.util.createCanvasElement()),i=r.blurLayer1,n=r.blurLayer2,i.width===a&&i.height===s||(n.width=i.width=a,n.height=i.height=s);var o,c,l,h,u=i.getContext("2d"),f=n.getContext("2d"),d=.06*this.blur*.5;for(u.putImageData(t.imageData,0,0),f.clearRect(0,0,a,s),h=-15;h<=15;h++)o=(Math.random()-.5)/4,l=d*(c=h/15)*a+o,f.globalAlpha=1-Math.abs(c),f.drawImage(i,l,o),u.drawImage(n,0,0),f.globalAlpha=1,f.clearRect(0,0,n.width,n.height);for(h=-15;h<=15;h++)o=(Math.random()-.5)/4,l=d*(c=h/15)*s+o,f.globalAlpha=1-Math.abs(c),f.drawImage(i,o,l),u.drawImage(n,0,0),f.globalAlpha=1,f.clearRect(0,0,n.width,n.height);t.ctx.drawImage(i,0,0);var p=t.ctx.getImageData(0,0,i.width,i.height);return u.globalAlpha=1,u.clearRect(0,0,i.width,i.height),p},getUniformLocations:function(t,e){return{delta:t.getUniformLocation(e,"uDelta")}},sendUniformData:function(t,e){var i=this.chooseRightDelta();t.uniform2fv(e.delta,i)},chooseRightDelta:function(){var t,e=1,i=[0,0];return this.horizontal?this.aspectRatio>1&&(e=1/this.aspectRatio):this.aspectRatio<1&&(e=this.aspectRatio),t=e*this.blur*.12,this.horizontal?i[0]=t:i[1]=t,i}}),i.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Gamma=n(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],i.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var e,i=t.imageData.data,n=this.gamma,r=i.length,a=1/n[0],s=1/n[1],o=1/n[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),e=0,r=256;e<r;e++)this.rVals[e]=255*Math.pow(e/255,a),this.gVals[e]=255*Math.pow(e/255,s),this.bVals[e]=255*Math.pow(e/255,o);for(e=0,r=i.length;e<r;e+=4)i[e]=this.rVals[i[e]],i[e+1]=this.gVals[i[e+1]],i[e+2]=this.bVals[i[e+2]]},getUniformLocations:function(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}},sendUniformData:function(t,e){t.uniform3fv(e.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.Composed=n(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(e){e.applyTo(t)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(t){return!t.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(t,i){var n=(t.subFilters||[]).map(function(t){return new e.Image.filters[t.type](t)}),r=new e.Image.filters.Composed({subFilters:n});return i&&i(r),r}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.Image.filters,n=e.util.createClass;i.HueRotation=n(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,i=e.util.cos(t),n=e.util.sin(t),r=Math.sqrt(1/3)*n,a=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+a/3,this.matrix[1]=1/3*a-r,this.matrix[2]=1/3*a+r,this.matrix[5]=1/3*a+r,this.matrix[6]=i+1/3*a,this.matrix[7]=1/3*a-r,this.matrix[10]=1/3*a-r,this.matrix[11]=1/3*a+r,this.matrix[12]=i+1/3*a},isNeutralState:function(t){return this.calculateMatrix(),i.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),i.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.clone;e.Text?e.warn("fabric.Text is already defined"):(e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:e.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(t,e){this.styles=e&&e.styles||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var t,e,i,n,r,a,s,o=0,c=this._textLines.length;o<c;o++)if(("justify"===this.textAlign||o!==c-1&&!this.isEndOfWrapping(o))&&(n=0,r=this._textLines[o],(e=this.getLineWidth(o))<this.width&&(s=this.textLines[o].match(this._reSpacesAndTabs)))){i=s.length,t=(this.width-e)/i;for(var l=0,h=r.length;l<=h;l++)a=this.__charBounds[o][l],this._reSpaceAndTab.test(r[l])?(a.width+=t,a.kernedWidth+=t,a.left+=n,n+=t):a.left+=n}},isEndOfWrapping:function(t){return t===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var t=this.callSuper("_getCacheCanvasDimensions"),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t},_render:function(t){this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")},_renderText:function(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))},_setTextStyles:function(t,e,i){t.textBaseline="alphabetic",t.font=this._getFontDeclaration(e,i)},calcTextWidth:function(){for(var t=this.getLineWidth(0),e=1,i=this._textLines.length;e<i;e++){var n=this.getLineWidth(e);n>t&&(t=n)}return t},_renderTextLine:function(t,e,i,n,r,a){this._renderChars(t,e,i,n,r,a)},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e,i,n,r,a,s,o=0,c=t.fillStyle,l=this._getLeftOffset(),h=this._getTopOffset(),u=0,f=0,d=0,p=this._textLines.length;d<p;d++)if(e=this.getHeightOfLine(d),this.textBackgroundColor||this.styleHas("textBackgroundColor",d)){n=this._textLines[d],i=this._getLineLeftOffset(d),f=0,u=0,r=this.getValueOfPropertyAt(d,0,"textBackgroundColor");for(var g=0,m=n.length;g<m;g++)a=this.__charBounds[d][g],(s=this.getValueOfPropertyAt(d,g,"textBackgroundColor"))!==r?(t.fillStyle=r,r&&t.fillRect(l+i+u,h+o,f,e/this.lineHeight),u=a.left,f=a.width,r=s):f+=a.kernedWidth;s&&(t.fillStyle=s,t.fillRect(l+i+u,h+o,f,e/this.lineHeight)),o+=e}else o+=e;t.fillStyle=c,this._removeShadow(t)}},getFontCache:function(t){var i=t.fontFamily.toLowerCase();e.charWidthsCache[i]||(e.charWidthsCache[i]={});var n=e.charWidthsCache[i],r=t.fontStyle.toLowerCase()+"_"+(t.fontWeight+"").toLowerCase();return n[r]||(n[r]={}),n[r]},_applyCharStyles:function(t,e,i,n,r){this._setFillStyles(e,r),this._setStrokeStyles(e,r),e.font=this._getFontDeclaration(r)},_measureChar:function(t,e,i,n){var r,a,s,o,c=this.getFontCache(e),l=i+t,h=this._getFontDeclaration(e)===this._getFontDeclaration(n),u=e.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==c[i]&&(s=c[i]),void 0!==c[t]&&(o=r=c[t]),h&&void 0!==c[l]&&(o=(a=c[l])-s),void 0===r||void 0===s||void 0===a){var f=this.getMeasuringContext();this._setTextStyles(f,e,!0)}return void 0===r&&(o=r=f.measureText(t).width,c[t]=r),void 0===s&&h&&i&&(s=f.measureText(i).width,c[i]=s),h&&void 0===a&&(a=f.measureText(l).width,c[l]=a,o=a-s),{width:r*u,kernedWidth:o*u}},getHeightOfChar:function(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")},measureLine:function(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e},_measureLine:function(t){var e,i,n,r,a=0,s=this._textLines[t],o=new Array(s.length);for(this.__charBounds[t]=o,e=0;e<s.length;e++)i=s[e],r=this._getGraphemeBox(i,t,e,n),o[e]=r,a+=r.kernedWidth,n=i;return o[e]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:a,numOfSpaces:0}},_getGraphemeBox:function(t,e,i,n,r){var a,s=this.getCompleteStyleDeclaration(e,i),o=n?this.getCompleteStyleDeclaration(e,i-1):{},c=this._measureChar(t,s,n,o),l=c.kernedWidth,h=c.width;0!==this.charSpacing&&(h+=a=this._getWidthOfCharSpacing(),l+=a);var u={width:h,left:0,height:s.fontSize,kernedWidth:l,deltaY:s.deltaY};if(i>0&&!r){var f=this.__charBounds[e][i-1];u.left=f.left+f.width+c.kernedWidth-c.width}return u},getHeightOfLine:function(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var e=this._textLines[t],i=this.getHeightOfChar(t,0),n=1,r=e.length;n<r;n++)i=Math.max(this.getHeightOfChar(t,n),i);return this.__lineHeights[t]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var t,e=0,i=0,n=this._textLines.length;i<n;i++)t=this.getHeightOfLine(i),e+=i===n-1?t/this.lineHeight:t;return e},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_applyPatternGradientTransform:function(t,e){if(!e||!e.toLive)return{offsetX:0,offsetY:0};var i=-this.width/2+e.offsetX||0,n=-this.height/2+e.offsetY||0;return t.transform(1,0,0,1,i,n),{offsetX:i,offsetY:n}},_renderTextCommon:function(t,e){t.save();for(var i=0,n=this._getLeftOffset(),r=this._getTopOffset(),a=this._applyPatternGradientTransform(t,"fillText"===e?this.fill:this.stroke),s=0,o=this._textLines.length;s<o;s++){var c=this.getHeightOfLine(s),l=c/this.lineHeight,h=this._getLineLeftOffset(s);this._renderTextLine(e,t,this._textLines[s],n+h-a.offsetX,r+i+l-a.offsetY,s),i+=c}t.restore()},_renderTextFill:function(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_renderChars:function(t,e,i,n,r,a){var s,o,c,l,h=this.getHeightOfLine(a),u=-1!==this.textAlign.indexOf("justify"),f="",d=0,p=!u&&0===this.charSpacing&&this.isEmptyStyles(a);if(e.save(),r-=h*this._fontSizeFraction/this.lineHeight,p)return this._renderChar(t,e,a,0,this.textLines[a],n,r,h),void e.restore();for(var g=0,m=i.length-1;g<=m;g++)l=g===m||this.charSpacing,f+=i[g],c=this.__charBounds[a][g],0===d?(n+=c.kernedWidth-c.width,d+=c.width):d+=c.kernedWidth,u&&!l&&this._reSpaceAndTab.test(i[g])&&(l=!0),l||(s=s||this.getCompleteStyleDeclaration(a,g),o=this.getCompleteStyleDeclaration(a,g+1),l=this._hasStyleChanged(s,o)),l&&(this._renderChar(t,e,a,g,f,n,r,h),f="",s=o,n+=d,d=0);e.restore()},_renderChar:function(t,e,i,n,r,a,s){var o=this._getStyleDeclaration(i,n),c=this.getCompleteStyleDeclaration(i,n),l="fillText"===t&&c.fill,h="strokeText"===t&&c.stroke&&c.strokeWidth;(h||l)&&(o&&e.save(),this._applyCharStyles(t,e,i,n,c),o&&o.textBackgroundColor&&this._removeShadow(e),o&&o.deltaY&&(s+=o.deltaY),l&&e.fillText(r,a,s),h&&e.strokeText(r,a,s),o&&e.restore())},setSuperscript:function(t,e){return this._setScript(t,e,this.superscript)},setSubscript:function(t,e){return this._setScript(t,e,this.subscript)},_setScript:function(t,e,i){var n=this.get2DCursorLocation(t,!0),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),a=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),s={fontSize:r*i.size,deltaY:a+r*i.baseline};return this.setSelectionStyles(s,t,e),this},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.deltaY!==e.deltaY},_hasStyleChangedForSvg:function(t,e){return this._hasStyleChanged(t,e)||t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough},_getLineLeftOffset:function(t){var e=this.getLineWidth(t);return"center"===this.textAlign?(this.width-e)/2:"right"===this.textAlign?this.width-e:"justify-center"===this.textAlign&&this.isEndOfWrapping(t)?(this.width-e)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(t)?this.width-e:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var t=this._forceClearCache;return t||(t=this.hasStateChanged("_dimensionAffectingProps")),t&&(this.dirty=!0,this._forceClearCache=!1),t},getLineWidth:function(t){return this.__lineWidths[t]?this.__lineWidths[t]:(e=""===this._textLines[t]?0:this.measureLine(t).width,this.__lineWidths[t]=e,e);var e},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(t,e,i){var n=this._getStyleDeclaration(t,e);return n&&void 0!==n[i]?n[i]:this[i]},_renderTextDecoration:function(t,e){if(this[e]||this.styleHas(e)){for(var i,n,r,a,s,o,c,l,h,u,f,d,p,g,m,v,y=this._getLeftOffset(),_=this._getTopOffset(),b=this._getWidthOfCharSpacing(),x=0,S=this._textLines.length;x<S;x++)if(i=this.getHeightOfLine(x),this[e]||this.styleHas(e,x)){c=this._textLines[x],g=i/this.lineHeight,a=this._getLineLeftOffset(x),u=0,f=0,l=this.getValueOfPropertyAt(x,0,e),v=this.getValueOfPropertyAt(x,0,"fill"),h=_+g*(1-this._fontSizeFraction),n=this.getHeightOfChar(x,0),s=this.getValueOfPropertyAt(x,0,"deltaY");for(var w=0,T=c.length;w<T;w++)d=this.__charBounds[x][w],p=this.getValueOfPropertyAt(x,w,e),m=this.getValueOfPropertyAt(x,w,"fill"),r=this.getHeightOfChar(x,w),o=this.getValueOfPropertyAt(x,w,"deltaY"),(p!==l||m!==v||r!==n||o!==s)&&f>0?(t.fillStyle=v,l&&v&&t.fillRect(y+a+u,h+this.offsets[e]*n+s,f,this.fontSize/15),u=d.left,f=d.width,l=p,v=m,n=r,s=o):f+=d.kernedWidth;t.fillStyle=m,p&&m&&t.fillRect(y+a+u,h+this.offsets[e]*n+s,f-b,this.fontSize/15),_+=i}else _+=i;this._removeShadow(t)}},_getFontDeclaration:function(t,i){var n=t||this,r=this.fontFamily,a=e.Text.genericFonts.indexOf(r.toLowerCase())>-1,s=void 0===r||r.indexOf("'")>-1||r.indexOf(",")>-1||r.indexOf('"')>-1||a?n.fontFamily:'"'+n.fontFamily+'"';return[e.isLikelyNode?n.fontWeight:n.fontStyle,e.isLikelyNode?n.fontStyle:n.fontWeight,i?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",s].join(" ")},render:function(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",t)))},_splitTextIntoLines:function(t){for(var i=t.split(this._reNewline),n=new Array(i.length),r=["\n"],a=[],s=0;s<i.length;s++)n[s]=e.util.string.graphemeSplit(i[s]),a=a.concat(n[s],r);return a.pop(),{_unwrappedLines:n,lines:i,graphemeText:a,graphemeLines:n}},toObject:function(t){var e=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(t),n=this.callSuper("toObject",e);return n.styles=i(this.styles,!0),n},set:function(t,e){this.callSuper("set",t,e);var i=!1;if("object"==typeof t)for(var n in t)i=i||-1!==this._dimensionAffectingProps.indexOf(n);else i=-1!==this._dimensionAffectingProps.indexOf(t);return i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,n,r){if(!t)return n(null);var a=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES),s=a.textAnchor||"left";if((r=e.util.object.extend(r?i(r):{},a)).top=r.top||0,r.left=r.left||0,a.textDecoration){var o=a.textDecoration;-1!==o.indexOf("underline")&&(r.underline=!0),-1!==o.indexOf("overline")&&(r.overline=!0),-1!==o.indexOf("line-through")&&(r.linethrough=!0),delete r.textDecoration}"dx"in a&&(r.left+=a.dx),"dy"in a&&(r.top+=a.dy),"fontSize"in r||(r.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var c="";"textContent"in t?c=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(c=t.firstChild.data),c=c.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var l=r.strokeWidth;r.strokeWidth=0;var h=new e.Text(c,r),u=h.getScaledHeight()/h.height,f=((h.height+h.strokeWidth)*h.lineHeight-h.height)*u,d=h.getScaledHeight()+f,p=0;"center"===s&&(p=h.getScaledWidth()/2),"right"===s&&(p=h.getScaledWidth()),h.set({left:h.left-p,top:h.top-(d-h.fontSize*(.07+h._fontSizeFraction))/h.lineHeight,strokeWidth:void 0!==l?l:1}),n(h)},e.Text.fromObject=function(t,i){return e.Object._fromObject("Text",t,i,"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;var e=void 0===t?this.styles:{line:this.styles[t]};for(var i in e)for(var n in e[i])for(var r in e[i][n])return!1;return!0},styleHas:function(t,e){if(!this.styles||!t||""===t)return!1;if(void 0!==e&&!this.styles[e])return!1;var i=void 0===e?this.styles:{0:this.styles[e]};for(var n in i)for(var r in i[n])if(void 0!==i[n][r][t])return!0;return!1},cleanStyle:function(t){if(!this.styles||!t||""===t)return!1;var e,i,n=this.styles,r=0,a=!0,s=0;for(var o in n){for(var c in e=0,n[o]){var l;r++,(l=n[o][c]).hasOwnProperty(t)?(i?l[t]!==i&&(a=!1):i=l[t],l[t]===this[t]&&delete l[t]):a=!1,0!==Object.keys(l).length?e++:delete n[o][c]}0===e&&delete n[o]}for(var h=0;h<this._textLines.length;h++)s+=this._textLines[h].length;a&&r===s&&(this[t]=i,this.removeStyle(t))},removeStyle:function(t){if(this.styles&&t&&""!==t){var e,i,n,r=this.styles;for(i in r){for(n in e=r[i])delete e[n][t],0===Object.keys(e[n]).length&&delete e[n];0===Object.keys(e).length&&delete r[i]}}},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),e)},get2DCursorLocation:function(t,e){void 0===t&&(t=this.selectionStart);for(var i=e?this._unwrappedTextLines:this._textLines,n=i.length,r=0;r<n;r++){if(t<=i[r].length)return{lineIndex:r,charIndex:t};t-=i[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:i[r-1].length<t?i[r-1].length:t}},getSelectionStyles:function(t,e,i){void 0===t&&(t=this.selectionStart||0),void 0===e&&(e=this.selectionEnd||t);for(var n=[],r=t;r<e;r++)n.push(this.getStyleAtPosition(r,i));return n},getStyleAtPosition:function(t,e){var i=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(t,e,i){void 0===e&&(e=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||e);for(var n=e;n<i;n++)this._extendStyles(n,t);return this._forceClearCache=!0,this},_getStyleDeclaration:function(t,e){var i=this.styles&&this.styles[t];return i?i[e]:null},getCompleteStyleDeclaration:function(t,e){for(var i,n=this._getStyleDeclaration(t,e)||{},r={},a=0;a<this._styleProperties.length;a++)r[i=this._styleProperties[a]]=void 0===n[i]?this[i]:n[i];return r},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return!!this.styles[t]},_setLineStyle:function(t){this.styles[t]={}},_deleteLineStyle:function(t){delete this.styles[t]}}),function(){function t(t){t.textDecoration&&(t.textDecoration.indexOf("underline")>-1&&(t.underline=!0),t.textDecoration.indexOf("line-through")>-1&&(t.linethrough=!0),t.textDecoration.indexOf("overline")>-1&&(t.overline=!0),delete t.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(t,e){this.callSuper("initialize",t,e),this.initBehavior()},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(t){this.clearContextTop(),this.callSuper("render",t),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(t){this.callSuper("_render",t)},clearContextTop:function(t){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var e=this.canvas.contextTop,i=this.canvas.viewportTransform;e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(e),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this._clearTextArea(e),t||e.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this._getCursorBoundaries(),e=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(t,e):this.renderSelection(t,e),e.restore()}},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},_getCursorBoundaries:function(t){void 0===t&&(t=this.selectionStart);var e=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t);return{left:e,top:i,leftOffset:n.left,topOffset:n.top}},_getCursorBoundariesOffsets:function(t){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var e,i,n,r,a=0,s=0,o=this.get2DCursorLocation(t);n=o.charIndex,i=o.lineIndex;for(var c=0;c<i;c++)a+=this.getHeightOfLine(c);e=this._getLineLeftOffset(i);var l=this.__charBounds[i][n];return l&&(s=l.left),0!==this.charSpacing&&n===this._textLines[i].length&&(s-=this._getWidthOfCharSpacing()),r={top:a,left:e+(s>0?s:0)},this.cursorOffsetCache=r,this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex>0?i.charIndex-1:0,a=this.getValueOfPropertyAt(n,r,"fontSize"),s=this.scaleX*this.canvas.getZoom(),o=this.cursorWidth/s,c=t.topOffset,l=this.getValueOfPropertyAt(n,r,"deltaY");c+=(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-a*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(t,e),e.fillStyle=this.getValueOfPropertyAt(n,r,"fill"),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+t.leftOffset-o/2,c+t.top+l,o,a)},renderSelection:function(t,e){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,n=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=-1!==this.textAlign.indexOf("justify"),a=this.get2DCursorLocation(i),s=this.get2DCursorLocation(n),o=a.lineIndex,c=s.lineIndex,l=a.charIndex<0?0:a.charIndex,h=s.charIndex<0?0:s.charIndex,u=o;u<=c;u++){var f,d=this._getLineLeftOffset(u)||0,p=this.getHeightOfLine(u),g=0,m=0;if(u===o&&(g=this.__charBounds[o][l].left),u>=o&&u<c)m=r&&!this.isEndOfWrapping(u)?this.width:this.getLineWidth(u)||5;else if(u===c)if(0===h)m=this.__charBounds[c][h].left;else{var v=this._getWidthOfCharSpacing();m=this.__charBounds[c][h-1].left+this.__charBounds[c][h-1].width-v}f=p,(this.lineHeight<1||u===c&&this.lineHeight>1)&&(p/=this.lineHeight),this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",e.fillRect(t.left+d+g,t.top+t.topOffset+p,m-g,1)):(e.fillStyle=this.selectionColor,e.fillRect(t.left+d+g,t.top+t.topOffset,m-g,p)),t.topOffset+=f}},getCurrentCharFontSize:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")},getCurrentCharColor:function(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")},_getCurrentCharIndex:function(){var t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}}),fabric.IText.fromObject=function(e,i){if(t(e),e.styles)for(var n in e.styles)for(var r in e.styles[n])t(e.styles[n][r]);fabric.Object._fromObject("IText",e,i,"text")}}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var t=this;this.on("added",function(){var e=t.canvas;e&&(e._hasITextHandlers||(e._hasITextHandlers=!0,t._initCanvasHandlers(e)),e._iTextInstances=e._iTextInstances||[],e._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){var e=t.canvas;e&&(e._iTextInstances=e._iTextInstances||[],fabric.util.removeFromArray(e._iTextInstances,t),0===e._iTextInstances.length&&(e._hasITextHandlers=!1,t._removeCanvasHandlers(e)))})},_initCanvasHandlers:function(t){t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})},t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState,e=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&e&&e.clearContext(e.contextTop||e.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i--;for(;/\S/.test(this._text[i])&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)e++,i++;for(;/\S/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this._text[i])&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this._text[i])&&i<this._text.length;)e++,i++;return t+e},searchWordBoundary:function(t,e){for(var i=this._text,n=this._reSpace.test(i[t])?t-1:t,r=i[n],a=fabric.reNonWord;!a.test(r)&&n>0&&n<i.length;)r=i[n+=e];return a.test(r)&&(n+=1===e?0:1),n},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){if(this.__isMousedown&&this.isEditing){var e=this.getSelectionStartFromPointer(t.e),i=this.selectionStart,n=this.selectionEnd;(e===this.__selectionStartOnMouseDown&&i!==n||i!==e&&n!==e)&&(e>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=e):(this.selectionStart=e,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(t,e,i){var n=i.slice(0,t),r=fabric.util.string.graphemeSplit(n).length;if(t===e)return{selectionStart:r,selectionEnd:r};var a=i.slice(t,e);return{selectionStart:r,selectionEnd:r+fabric.util.string.graphemeSplit(a).length}},fromGraphemeToStringSelection:function(t,e,i){var n=i.slice(0,t).join("").length;return t===e?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+i.slice(t,e).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var t=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),i=this.get2DCursorLocation(t),n=i.lineIndex,r=i.charIndex,a=this.getValueOfPropertyAt(n,r,"fontSize")*this.lineHeight,s=e.leftOffset,o=this.calcTransformMatrix(),c={x:e.left+s,y:e.top+e.topOffset+a},l=this.canvas.getRetinaScaling(),h=this.canvas.upperCanvasEl,u=h.width/l,f=h.height/l,d=u-a,p=f-a,g=h.clientWidth/u,m=h.clientHeight/f;return c=fabric.util.transformPoint(c,o),(c=fabric.util.transformPoint(c,this.canvas.viewportTransform)).x*=g,c.y*=m,c.x<0&&(c.x=0),c.x>d&&(c.x=d),c.y<0&&(c.y=0),c.y>p&&(c.y=p),c.x+=this.canvas._offset.left,c.y+=this.canvas._offset.top,{left:c.x+"px",top:c.y+"px",fontSize:a+"px",charHeight:a}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var t=this._textBeforeEdit!==this.text,e=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,e&&(e.blur&&e.blur(),e.parentNode&&e.parentNode.removeChild(e)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},removeStyleFromTo:function(t,e){var i,n,r=this.get2DCursorLocation(t,!0),a=this.get2DCursorLocation(e,!0),s=r.lineIndex,o=r.charIndex,c=a.lineIndex,l=a.charIndex;if(s!==c){if(this.styles[s])for(i=o;i<this._unwrappedTextLines[s].length;i++)delete this.styles[s][i];if(this.styles[c])for(i=l;i<this._unwrappedTextLines[c].length;i++)(n=this.styles[c][i])&&(this.styles[s]||(this.styles[s]={}),this.styles[s][o+i-l]=n);for(i=s+1;i<=c;i++)delete this.styles[i];this.shiftLineStyles(c,s-c)}else if(this.styles[s]){n=this.styles[s];var h,u,f=l-o;for(i=o;i<l;i++)delete n[i];for(u in this.styles[s])(h=parseInt(u,10))>=l&&(n[h-f]=n[u],delete n[u])}},shiftLineStyles:function(e,i){var n=t(this.styles);for(var r in this.styles){var a=parseInt(r,10);a>e&&(this.styles[a+i]=n[a],n[a-i]||delete this.styles[a])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(e,i,n,r){var a,s={},o=!1;for(var c in n||(n=1),this.shiftLineStyles(e,n),this.styles[e]&&(a=this.styles[e][0===i?i:i-1]),this.styles[e]){var l=parseInt(c,10);l>=i&&(o=!0,s[l-i]=this.styles[e][c],delete this.styles[e][c])}for(o?this.styles[e+n]=s:delete this.styles[e+n];n>1;)n--,r&&r[n]?this.styles[e+n]={0:t(r[n])}:a?this.styles[e+n]={0:t(a)}:delete this.styles[e+n];this._forceClearCache=!0},insertCharStyleObject:function(e,i,n,r){this.styles||(this.styles={});var a=this.styles[e],s=a?t(a):{};for(var o in n||(n=1),s){var c=parseInt(o,10);c>=i&&(a[c+n]=s[c],s[c-n]||delete a[c])}if(this._forceClearCache=!0,r)for(;n--;)Object.keys(r[n]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][i+n]=t(r[n]));else if(a)for(var l=a[i?i-1:1];l&&n--;)this.styles[e][i+n]=t(l)},insertNewStyleBlock:function(t,e,i){for(var n=this.get2DCursorLocation(e,!0),r=[0],a=0,s=0;s<t.length;s++)"\n"===t[s]?r[++a]=0:r[a]++;r[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,r[0],i),i=i&&i.slice(r[0]+1)),a&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+r[0],a);for(s=1;s<a;s++)r[s]>0?this.insertCharStyleObject(n.lineIndex+s,0,r[s],i):i&&(this.styles[n.lineIndex+s][0]=i[0]),i=i&&i.slice(r[s]+1);r[s]>0&&this.insertCharStyleObject(n.lineIndex+s,0,r[s],i)},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):i>t&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(t){if(this.canvas){this.__newClickTime=+new Date;var e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))},tripleClickHandler:function(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(t){!this.canvas||!this.editable||t.e.button&&1!==t.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(t){if(this.__isMousedown=!1,!(!this.editable||this.group||t.transform&&t.transform.actionPerformed||t.e.button&&1!==t.e.button)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,n,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(t){for(var e=this.getLocalPointer(t),i=0,n=0,r=0,a=0,s=0,o=0,c=this._textLines.length;o<c&&r<=e.y;o++)r+=this.getHeightOfLine(o)*this.scaleY,s=o,o>0&&(a+=this._textLines[o-1].length+this.missingNewlineOffset(o-1));n=this._getLineLeftOffset(s)*this.scaleX;for(var l=0,h=this._textLines[s].length;l<h&&(i=n,(n+=this.__charBounds[s][l].kernedWidth*this.scaleX)<=e.x);l++)a++;return this._getNewSelectionStartFromOffset(e,i,n,a,h)},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var a=t.x-e,s=i-t.x,o=n+(s>a||s<0?0:1);return this.flipX&&(o=r-o),o>this._text.length&&(o=this._text.length),o}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+t.fontSize+";",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing&&!this.inCompositionMode){if(t.keyCode in this.keysMap)this[this.keysMap[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(t){var e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),this.isEditing){var i,n,r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,a=this._text.length,s=r.length,o=s-a;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var c,l=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),h=this.selectionStart>l.selectionStart;this.selectionStart!==this.selectionEnd?(i=this._text.slice(this.selectionStart,this.selectionEnd),o+=this.selectionEnd-this.selectionStart):s<a&&(i=h?this._text.slice(this.selectionEnd+o,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-o)),n=r.slice(l.selectionEnd-o,l.selectionEnd),i&&i.length&&(n.length&&(c=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0)),this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):h?this.removeStyleFromTo(this.selectionEnd-i.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+i.length)),n.length&&(e&&n.join("")===fabric.copiedText&&!fabric.disableStyleCopyPaste?this.insertNewStyleBlock(n,this.selectionStart,fabric.copiedTextStyle):this.insertNewStyleBlock(n,this.selectionStart,c)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.disableStyleCopyPaste?fabric.copiedTextStyle=null:fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){var i,n=this._getLineLeftOffset(t);return e>0&&(n+=(i=this.__charBounds[t][e-1]).left+i.width),n},getDownCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(r===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-i;var a=n.charIndex,s=this._getWidthBeforeCursor(r,a),o=this._getIndexOnLine(r+1,s);return this._textLines[r].slice(a).length+o+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var i=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(i),r=n.lineIndex;if(0===r||t.metaKey||33===t.keyCode)return-i;var a=n.charIndex,s=this._getWidthBeforeCursor(r,a),o=this._getIndexOnLine(r-1,s),c=this._textLines[r].slice(0,a),l=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+o-c.length+(1-l)},_getIndexOnLine:function(t,e){for(var i,n,r=this._textLines[t],a=this._getLineLeftOffset(t),s=0,o=0,c=r.length;o<c;o++)if((a+=i=this.__charBounds[t][o].width)>e){n=!0;var l=a-i,h=a,u=Math.abs(l-e);s=Math.abs(h-e)<u?o:o-1;break}return n||(s=r.length-1),s},moveCursorDown:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){var i=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var n;if(t.altKey)n=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;n=this["findLineBoundary"+i](this[e])}if(void 0!==typeof n&&this[e]!==n)return this[e]=n,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){var i="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?i+="Shift":i+="outShift",this[i](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t,e){void 0===e&&(e=t+1),this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(t,e,i,n){void 0===n&&(n=i),n>i&&this.removeStyleFromTo(i,n);var r=fabric.util.string.graphemeSplit(t);this.insertNewStyleBlock(r,i,e),this._text=[].concat(this._text.slice(0,i),r,this._text.slice(n)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var t=fabric.util.toFixed,e=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)},toSVG:function(t){return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(t){var e=this.getSvgTextDecoration(this);return[t.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",e?'text-decoration="'+e+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",t.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(t,e){var i,n=[],r=[],a=t;this._setSVGBg(r);for(var s=0,o=this._textLines.length;s<o;s++)i=this._getLineLeftOffset(s),(this.textBackgroundColor||this.styleHas("textBackgroundColor",s))&&this._setSVGTextLineBg(r,s,e+i,a),this._setSVGTextLineText(n,s,e+i,a),a+=this.getHeightOfLine(s);return{textSpans:n,textBgRects:r}},_createTextCharSpan:function(i,n,r,a){var s=i!==i.trim()||i.match(e),o=this.getSvgSpanStyles(n,s),c=o?'style="'+o+'"':"",l=n.deltaY,h="",u=fabric.Object.NUM_FRACTION_DIGITS;return l&&(h=' dy="'+t(l,u)+'" '),['<tspan x="',t(r,u),'" y="',t(a,u),'" ',h,c,">",fabric.util.string.escapeXml(i),"</tspan>"].join("")},_setSVGTextLineText:function(t,e,i,n){var r,a,s,o,c,l=this.getHeightOfLine(e),h=-1!==this.textAlign.indexOf("justify"),u="",f=0,d=this._textLines[e];n+=l*(1-this._fontSizeFraction)/this.lineHeight;for(var p=0,g=d.length-1;p<=g;p++)c=p===g||this.charSpacing,u+=d[p],s=this.__charBounds[e][p],0===f?(i+=s.kernedWidth-s.width,f+=s.width):f+=s.kernedWidth,h&&!c&&this._reSpaceAndTab.test(d[p])&&(c=!0),c||(r=r||this.getCompleteStyleDeclaration(e,p),a=this.getCompleteStyleDeclaration(e,p+1),c=this._hasStyleChangedForSvg(r,a)),c&&(o=this._getStyleDeclaration(e,p)||{},t.push(this._createTextCharSpan(u,o,i,n)),u="",r=a,i+=f,f=0)},_pushTextBgRect:function(e,i,n,r,a,s){var o=fabric.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(i),' x="',t(n,o),'" y="',t(r,o),'" width="',t(a,o),'" height="',t(s,o),'"></rect>\n')},_setSVGTextLineBg:function(t,e,i,n){for(var r,a,s=this._textLines[e],o=this.getHeightOfLine(e)/this.lineHeight,c=0,l=0,h=this.getValueOfPropertyAt(e,0,"textBackgroundColor"),u=0,f=s.length;u<f;u++)r=this.__charBounds[e][u],(a=this.getValueOfPropertyAt(e,u,"textBackgroundColor"))!==h?(h&&this._pushTextBgRect(t,h,i+l,n,c,o),l=r.left,c=r.width,h=a):c+=r.kernedWidth;a&&this._pushTextBgRect(t,a,i+l,n,c,o)},_getFillAttributes:function(t){var e=t&&"string"==typeof t?new fabric.Color(t):"";return e&&e.getSource()&&1!==e.getAlpha()?'opacity="'+e.getAlpha()+'" fill="'+e.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_getSVGLineTopOffset:function(t){for(var e,i=0,n=0;n<t;n++)i+=this.getHeightOfLine(n);return e=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(t){return fabric.Object.prototype.getSvgStyles.call(this,t)+" white-space: pre;"}})}(),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(t){for(var e=0,i=0,n=0,r={},a=0;a<t.graphemeLines.length;a++)"\n"===t.graphemeText[n]&&a>0?(i=0,n++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[n])&&a>0&&(i++,n++),r[a]={line:e,offset:i},n+=t.graphemeLines[a].length,i+=t.graphemeLines[a].length;return r},styleHas:function(t,i){if(this._styleMap&&!this.isWrapping){var n=this._styleMap[i];n&&(i=n.line)}return e.Text.prototype.styleHas.call(this,t,i)},isEmptyStyles:function(t){if(!this.styles)return!0;var e,i,n=0,r=!1,a=this._styleMap[t],s=this._styleMap[t+1];for(var o in a&&(t=a.line,n=a.offset),s&&(r=s.line===t,e=s.offset),i=void 0===t?this.styles:{line:this.styles[t]})for(var c in i[o])if(c>=n&&(!r||c<e))for(var l in i[o][c])return!1;return!0},_getStyleDeclaration:function(t,e){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[t];if(!i)return null;t=i.line,e=i.offset+e}return this.callSuper("_getStyleDeclaration",t,e)},_setStyleDeclaration:function(t,e,i){var n=this._styleMap[t];t=n.line,e=n.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){var e=this._styleMap[t];return!!this.styles[e.line]},_setLineStyle:function(t){var e=this._styleMap[t];this.styles[e.line]={}},_wrapText:function(t,e){var i,n=[];for(this.isWrapping=!0,i=0;i<t.length;i++)n=n.concat(this._wrapLine(t[i],i,e));return this.isWrapping=!1,n},_measureWord:function(t,e,i){var n,r=0;i=i||0;for(var a=0,s=t.length;a<s;a++){r+=this._getGraphemeBox(t[a],e,a+i,n,!0).kernedWidth,n=t[a]}return r},_wrapLine:function(t,i,n,r){var a=0,s=this.splitByGrapheme,o=[],c=[],l=s?e.util.string.graphemeSplit(t):t.split(this._wordJoiners),h="",u=0,f=s?"":" ",d=0,p=0,g=0,m=!0,v=s?0:this._getWidthOfCharSpacing();r=r||0;0===l.length&&l.push([]),n-=r;for(var y=0;y<l.length;y++)h=s?l[y]:e.util.string.graphemeSplit(l[y]),d=this._measureWord(h,i,u),u+=h.length,(a+=p+d-v)>=n&&!m?(o.push(c),c=[],a=d,m=!0):a+=v,m||s||c.push(f),c=c.concat(h),p=this._measureWord([f],i,u),u++,m=!1,d>g&&(g=d);return y&&o.push(c),g+r>this.dynamicMinWidth&&(this.dynamicMinWidth=g-v+r),o},isEndOfWrapping:function(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line},missingNewlineOffset:function(t){return this.splitByGrapheme?this.isEndOfWrapping(t)?1:0:1},_splitTextIntoLines:function(t){for(var i=e.Text.prototype._splitTextIntoLines.call(this,t),n=this._wrapText(i.lines,this.width),r=new Array(n.length),a=0;a<n.length;a++)r[a]=n[a].join("");return i.lines=r,i.graphemeLines=n,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var t={};for(var e in this._styleMap)this._textLines[e]&&(t[this._styleMap[e].line]=1);for(var e in this.styles)t[e]||delete this.styles[e]},toObject:function(t){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(t))}}),e.Textbox.fromObject=function(t,i){return e.Object._fromObject("Textbox",t,i,"text")}}("undefined"!=typeof exports?exports:this),function(){var t=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(e,i,n,r,a,s,o){var c,l=i.target,h=e.x*l.scaleX/o.x,u=e.y*l.scaleY/o.y;if(!("x"===a&&l instanceof fabric.Textbox))return t.call(fabric.Canvas.prototype,e,i,n,r,a,s,o);var f=l._getTransformedDimensions().x,d=l.width*(e.x/f);return i.newScaleX=h,i.newScaleY=u,d>=l.getMinWidth()?(c=d!==l.width,l.set("width",d),c):void 0},fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]}})}(),function(){function t(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function e(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function i(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+e+";"}function n(t){var e=t.a.offsetWidth,i=e+100;return t.f.style.width=i+"px",t.c.scrollLeft=i,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e&&(t.g=e,!0)}function r(e,i){function r(){var t=a;n(t)&&t.a.parentNode&&i(t.g)}var a=e;t(e.b,r),t(e.c,r),n(e)}function a(t,e){var i=e||{};this.family=t,this.style=i.style||"normal",this.weight=i.weight||"normal",this.stretch=i.stretch||"normal"}var s=null,o=null,c=null,l=null;function h(){return null===l&&(l=!!document.fonts),l}function u(t,e){return[t.style,t.weight,function(){if(null===c){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(t){}c=""!==t.style.font}return c}()?t.stretch:"","100px",e].join(" ")}a.prototype.load=function(t,n){var a=this,c=t||"BESbswy",l=0,f=n||3e3,d=(new Date).getTime();return new Promise(function(t,n){if(h()&&!function(){if(null===o)if(h()&&/Apple/.test(window.navigator.vendor)){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);o=!!t&&603>parseInt(t[1],10)}else o=!1;return o}()){var p=new Promise(function(t,e){!function i(){(new Date).getTime()-d>=f?e(Error(f+"ms timeout exceeded")):document.fonts.load(u(a,'"'+a.family+'"'),c).then(function(e){1<=e.length?t():setTimeout(i,25)},e)}()}),g=new Promise(function(t,e){l=setTimeout(function(){e(Error(f+"ms timeout exceeded"))},f)});Promise.race([g,p]).then(function(){clearTimeout(l),t(a)},n)}else m=function(){function o(){var e;(e=-1!=m&&-1!=v||-1!=m&&-1!=y||-1!=v&&-1!=y)&&((e=m!=v&&m!=y&&v!=y)||(null===s&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),s=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=s&&(m==_&&v==_&&y==_||m==b&&v==b&&y==b||m==x&&v==x&&y==x)),e=!e),e&&(S.parentNode&&S.parentNode.removeChild(S),clearTimeout(l),t(a))}var h=new e(c),p=new e(c),g=new e(c),m=-1,v=-1,y=-1,_=-1,b=-1,x=-1,S=document.createElement("div");S.dir="ltr",i(h,u(a,"sans-serif")),i(p,u(a,"serif")),i(g,u(a,"monospace")),S.appendChild(h.a),S.appendChild(p.a),S.appendChild(g.a),document.body.appendChild(S),_=h.a.offsetWidth,b=p.a.offsetWidth,x=g.a.offsetWidth,function t(){if((new Date).getTime()-d>=f)S.parentNode&&S.parentNode.removeChild(S),n(Error(f+"ms timeout exceeded"));else{var e=document.hidden;!0!==e&&void 0!==e||(m=h.a.offsetWidth,v=p.a.offsetWidth,y=g.a.offsetWidth,o()),l=setTimeout(t,50)}}(),r(h,function(t){m=t,o()}),i(h,u(a,'"'+a.family+'",sans-serif')),r(p,function(t){v=t,o()}),i(p,u(a,'"'+a.family+'",serif')),r(g,function(t){y=t,o()}),i(g,u(a,'"'+a.family+'",monospace'))},document.body?m():document.addEventListener?document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t),m()}):document.attachEvent("onreadystatechange",function t(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",t),m())});var m})},"object"==typeof module?module.exports=a:(window.FontFaceObserver=a,window.FontFaceObserver.prototype.load=a.prototype.load)}();"use strict";var Constants,ValueMap=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.map={},t.length%2!=0)throw new TypeError;for(var i=0;i<t.length;i+=2){var n=t[i],r=t[i+1];this.map.put(n,r)}}return t.prototype.put=function(e,i){this.map[e]=i,new t},t.prototype.get=function(t){return this.map[t]},t}(),Associated=function(){function t(t){this.name=t,Object.getPrototypeOf(this).constructor.map.put(t,this)}return t.get=function(t){return this.map.get(t)},t.prototype.getName=function(){return this.name},t.map=new ValueMap,t}(),__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Color=function(t){function e(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return 1===i.length?typeof i[0]===Constants.STRING?t.apply(this,i)||this:t.call(this,i[0].toRgba())||this:t.call(this,e.componentsToRgbaString.apply(e,i))||this}return __extends(e,t),e.prototype.toHex=function(){return"#"+t.prototype.toHex.call(this)},e.prototype.toNumber=function(){var t=this.getSource();return(t[3]<<24)+(t[2]<<16)+(t[1]<<8)+t[0]},e.prototype.toRgba=function(){return t.prototype.toRgba.call(this)},e.random=function(){return new e(Utils.randomInt(256),Utils.randomInt(256),Utils.randomInt(256),1)},e.componentsToRgbaString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(t.length<4?"rgb(":"rgba(")+t.join(",")+")"},e.prototype.serialize=function(){return this.toRgba()},e.deserialize=function(t){return new e(t)},e.prototype.equals=function(t){if(this.getSource().length!=t.getSource().length)return!1;for(var e=0;e<this.getSource().length;e++)if(this.getSource()[e]!=t.getSource()[e])return!1;return!0},e.WHITE=new e(255,255,255),e.BLACK=new e(0,0,0),e.GRAY=new e(127,127,127),e.BACKGROUND_GRAY=new e(221,221,221),e.LIGHT_GRAY=new e(240,240,240),e.DARK_GRAY=new e(70,70,70),e.TRANSPARENT=new e(0,0,0,0),e.TRANSPARENT_BLACK=new e(0,0,0,.5),e.GUIDE=new e(0,255,0,.5),e}(fabric.Color);!function(t){t.STRING="string",t.AUTO="auto",t.SCROLL="scroll",t.CENTER="center",t.BLOCK="block",t.NONE="none",t.CANVAS="canvas",t.DIV="div",t.IMG="img",t.BUTTON="button",t.INPUT="input",t.LINE_STYLE_PREFIX="1px solid ",t.PX="px",t.STYLE="style",t.TEXT_CSS="text/css",t.APPLICATION_JSON="application/json",t.SOLID="solid",t.ABSOLUTE="absolute",t.TRANSPARENT="transparent",t.GET="GET",t.ADDED="added",t.ROTATING="rotating",t.MOVING="moving",t.SCALING="scaling",t.SELECTED="selected",t.DESELECTED="deselected",t.REMOVED="removed",t.MODIFIED="modified",t.SELECTION_CLEARED="selection:cleared",t.SELECTION_CREATED="selection:created",t.SELECTION_UPDATED="selection:updated",t.MOUSE_UP="mouse:up",t.AFTER_RENDER="after:render",t.PROGRESS="progress",t.LOAD="load",t.OBJECT_MODIFIED="object:modified",t.OBJECT_MOVED="object:moved",t.OBJECT_SCALED="object:scaled",t.OBJECT_ROTATED="object:rotated",t.OBJECT_SKEWED="object:skewed",t.OBJECT_ADDED="object:added",t.OBJECT_REMOVED="object:removed",t.CHANGE="change",t.CONTEXT_2D="2d",t.FILL="fill",t.NORMAL="normal",t.ITALIC="italic",t.BOLD="bold",t.BODY="body",t.SIDE="side",t.ENV="env",t.MESH_PHYSICAL_MATERIAL="MeshPhysicalMaterial",t.MARGIN="margin",t.PERSPECTIVE_CAMERA="PerspectiveCamera",t.MESH="Mesh",t.GROUP="Group",t.MULTI_MATERIAL_NAME_SEPARATOR="+",t.MATERIAL_NAME_SEPARATOR="_",t.PNG="png",t.JPG="jpg"}(Constants||(Constants={}));var Icon,Mode,Version=function(){function t(){}return t.version="29.11.2020 16:50",t}(),Trigger=function(){function t(){this.actions={},this.visibilityActions=[]}return t.prototype.changed=function(){var e=this;t.preventUpdate||Object.keys(this.actions).forEach(function(t,i){if(UIControl.getById(t)){var n=e.actions[t];try{n(e)}catch(t){console.error(t.message)}}else delete e.actions[t]})},t.prototype.visibilityChanged=function(){var t=this;this.visibilityActions.forEach(function(e){return e(t)})},t.prototype.onChange=function(t,e){this.actions[e.getId()]=t},t.prototype.onVisibilityChange=function(t){this.visibilityActions.push(t)},t.preventUpdate=!1,t}(),View=function(t){function e(e){var i=t.call(this)||this;return i.container=e,i}return __extends(e,t),e.prototype.show=function(){this.getElement().style.display=null,this.visibilityChanged()},e.prototype.hide=function(){this.getElement().style.display=Constants.NONE,this.visibilityChanged()},e.prototype.setVisible=function(t){t!=this.isVisible()&&(t?this.show():this.hide())},e.prototype.toggleVisibility=function(){this.setVisible(!this.isVisible())},e.prototype.clear=function(){this.getElement().innerHTML="",this.changed()},e.prototype.allowUserSelect=function(){return this.container.style.userSelect="all",this},e.prototype.isVisible=function(){return null!=this.getElement()&&null!=this.getElement().style&&this.getElement().style.display!=Constants.NONE},e.prototype.getClassName=function(){return""},e.prototype.addClass=function(t){return this.hasClass(t)||this.container.classList.add(t),this},e.prototype.removeClass=function(t){return this.hasClass(t)&&this.container.classList.remove(t),this},e.prototype.hasClass=function(t){return this.container.classList.contains(t)},e.prototype.toggleClass=function(t){this.hasClass(t)?this.removeClass(t):this.addClass(t)},e.prototype.setFontFamily=function(t){return this.container.style.fontFamily=t,this},e.prototype.setFontSize=function(t){return this.container.style.fontSize=t+"px",this},e.prototype.isEmpty=function(){return""==this.container.innerHTML},e.prototype.setColor=function(t){return this.container.style.color=t,this},e.prototype.setBackgroundColor=function(t){return this.container.style.backgroundColor=t,this},e.prototype.setAttribute=function(t,e){return this.container.setAttribute(t,e),this},e}(Trigger),Preview=function(t){function e(i){var n=t.call(this,i.container)||this;n.sides=[],n.fills=[],n.originalFillColors=[],e.instance=n,n.exportRenderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0}),n.renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});try{n.renderer.setClearColor(Constructor.settings.previewBackgroundColor)}catch(t){n.renderer.setClearColor(Color.BACKGROUND_GRAY.toHex())}return n.renderer.setPixelRatio(window.devicePixelRatio),n.renderer.setSize(400,300),n.camera=new THREE.PerspectiveCamera(70,n.renderer.getSize().width/n.renderer.getSize().height,.1),n.scene=new THREE.Scene,n.scene.add(n.camera),n.setupControls(),n.showMargins=!1,i.container.appendChild(n.renderer.domElement),n.render(),n}return __extends(e,t),e.prototype.autoSize=function(){this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(Constructor.instance.getElement().clientWidth,Constructor.instance.getElement().clientHeight),this.camera.aspect=this.renderer.getSize().width/this.renderer.getSize().height,this.camera.updateProjectionMatrix(),this.render()},e.prototype.getElement=function(){return e.instance.renderer.domElement},e.prototype.animate=function(){requestAnimationFrame(this.animate),e.instance.controls.update(),this.render()},e.prototype.render=function(){e.instance.camera.lookAt(e.instance.scene.position),e.instance.camera.updateMatrixWorld(!0),e.instance.renderer.render(e.instance.scene,e.instance.camera)},e.prototype.clear=function(){for(this.sides=[],this.fills=[],this.originalFillColors=[];this.scene.children.length>0;)this.scene.remove(this.scene.children[0])},e.prototype.setScene=function(t){e.instance.clear(),e.instance.scene=t,t.background=Color.WHITE.toHex(),e.instance.setupScene(),e.instance.updateSideMaterials(),Constructor.instance.spinner.hide(),e.instance.render()},e.prototype.setModel=function(t,i,n){var r=this;Constructor.instance.spinner.show(),this.modelName=t,e.objectLoader.manager.onError=function(){return Constructor.instance.spinner.hide()},e.objectLoader.parse(i,function(t){r.setScene(t),Constructor.instance.spinner.hide(),n&&n()})},e.prototype.loadModel=function(t,i){var n=this;Constructor.instance.spinner.show(),this.modelName=t,e.objectLoader.manager.onError=function(){return Constructor.instance.spinner.hide()},e.objectLoader.load(Constructor.settings.urls.models+this.modelName+Constructor.settings.fileExtensions.model,function(t){n.setScene(t),Constructor.instance.spinner.hide(),i&&i()})},e.prototype.setupScene=function(){var t=this;this.scene.traverse(function(e){if(e.type&&e.type===Constants.PERSPECTIVE_CAMERA)t.camera=e,t.camera.near=.1,t.camera.aspect=t.renderer.domElement.width/t.renderer.domElement.height,t.camera.updateProjectionMatrix(),t.setupControls();else if(e.material&&e.material.type&&e.material.name)for(var i=e.material,n=i.name.split(Constants.MULTI_MATERIAL_NAME_SEPARATOR),r=0;r<n.length;r++){e.renderOrder=100;var a=i.name.split(Constants.MATERIAL_NAME_SEPARATOR),s=a[0],o=a.length?parseInt(a[1])-1:0;i.envMap&&(i.envMap.mapping=THREE.EquirectangularReflectionMapping,i.envMap.magFilter=THREE.LinearFilter,i.envMap.minFilter=THREE.LinearMipMapLinearFilter,i.needsUpdate=!0),s===Constants.SIDE?(e.renderOrder=0,t.sides[o]=i):s===Constants.FILL&&(t.fills[o]=i,t.originalFillColors[o]=i.color.getHex())}})},e.prototype.setupControls=function(){var t=Math.max(this.camera.position.x,this.camera.position.y,this.camera.position.z);this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.addEventListener(Constants.CHANGE,this.render),this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI/2,this.controls.minDistance=t/2,this.controls.maxDistance=2*t,this.controls.zoomSpeed=1,this.controls.enablePan=!1,this.controls.update()},e.prototype.clearFills=function(){for(var t=0;t<this.fills.length;t++)this.setFills(null,t)},e.prototype.setFills=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.fills&&this.fills.length){for(var n=0,r=e;n<r.length;n++){var a=r[n];if(this.fills.length>a){if(!this.fills[a])continue;this.fills[a].color=null===t?new THREE.Color(this.originalFillColors[a]):new THREE.Color(t)}}this.render()}},e.prototype.setShowMargin=function(t){var e=this;this.scene.traverse(function(i){i.material&&i.material.name&&i.material.name===Constants.MARGIN&&(i.visible=t,e.render())})},e.prototype.updateSideMaterials=function(t){var e=this;if(this.sides&&this.sides.length){for(var i=function(t){var e,i=Constructor.instance.sides[t];if(!i||!i.canvas)return"continue";var r=i.canvas.getWidth()/i.getZoom(),a=i.canvas.getHeight()/i.getZoom(),s=Constructor.settings.previewTextureSize/Math.max(r,a);try{var o=i.canvas.toDataURL({format:Constants.PNG,multiplier:s});n.sides[t].userData=null;var c=document.createElement(Constants.IMG);c.crossOrigin="anonymous",c.src=o,c.onload=function(){(e=new THREE.Texture(c)).wrapS=e.wrapT=THREE.ClampToEdgeWrapping,e.minFilter=THREE.NearestMipMapNearestFilter,e.anisotropy=Constructor.instance.preview.renderer.capabilities.getMaxAnisotropy(),e.needsUpdate=!0;var i=Constructor.instance.preview.sides[t];i.map=e,i.transparent=!0,i.needsUpdate=!0,i.userData=!0,Constructor.instance.preview.render()}}catch(t){console.error("failed to update side",i.getIndex())}},n=this,r=0;r<this.sides.length;r++)i(r);this.render(),this.waitUntilSidesUpdate(function(){e.render(),t&&t()})}},e.prototype.waitUntilSidesUpdate=function(t,e){var i=this;if(e||(e=(new Date).getMilliseconds()+100),this.sides&&this.sides.length)for(var n=0;n<this.sides.length;n++)if(1!=this.sides[n].userData)return void((new Date).getMilliseconds()<e?setTimeout(function(){return i.waitUntilSidesUpdate(t,e)},10):t());t()},e.prototype.exportImage=function(t,e,i,n){var r=this;this.updateSideMaterials(function(){t(r.exportImageSync(e,i,n))})},e.prototype.exportImageSync=function(t,e,i){e||(e=ImageType.PNG),i||(i=.9);var n=this.renderer.domElement.width,r=this.renderer.domElement.height,a=t?t/Math.max(n,r):1;return n*=a,r*=a,e==ImageType.JPG?this.exportRenderer.setClearColor(Color.WHITE.toHex()):this.exportRenderer.setClearColor(Color.TRANSPARENT.toRgba(),0),this.exportRenderer.getSize().width!=n&&this.exportRenderer.getSize().height!=r&&this.exportRenderer.setSize(n,r),this.exportRenderer.render(this.scene,this.camera),this.exportRenderer.domElement.toDataURL(e,i)},e.prototype.setSceneBackgroundColor=function(t){var e;e=t instanceof Color?t.toRgb():new THREE.Color(t),this.renderer.setClearColor(e),this.render()},e.marginMaterial=new THREE.LineBasicMaterial({name:Constants.MARGIN,color:Color.GUIDE.toNumber(),transparent:!0,linewidth:4,opacity:.5}),e.objectLoader=new THREE.ObjectLoader,e}(View),Settings=function(){return function(){this.debug=!1,this.ui={layerIconSize:38},this.urls={textures:"textures/",maps:"textures/maps/",models:window.constructorConfiguration&&window.constructorConfiguration.modelsUrl||"models/",presets:"presets/"},this.fileExtensions={model:".json",object:".obj",archive:".zip",presets:".json",map:".jpg"},this.elementDefaults={circle:{radius:50},rect:{width:100,height:100},triangle:{width:100,height:100},"i-text":{text:"Text",fontSize:25,fontFamily:"Helvetica"}},this.rotationStep=15,this.snapSize=10,this.gridSize=20,this.duplicateOffset=10,this.stateBufferSize=100,this.previewTextureSize=1024,this.previewBackgroundColor="#eeeeee",this.fitIntoMargins=!1,this.localStorage={enabled:!0,keyPrefix:"CONSTRUCTOR_STATE_"},this.autoSize=!1,this.printWidth=window.constructorConfiguration?window.constructorConfiguration.printWidth:800}}(),Constructor=function(t){function e(i,n){var r=t.call(this,i instanceof HTMLElement?i:document.getElementById(i))||this;r.sides=[],r.onSelectHandler=function(){},r.onDeselectHandler=function(){},r.onModeChangeHandler=function(){},r.onElementModificationHandler=function(){},r.isExplicitlyLoaded=!1,e.instance=r,r.container.style.overflow=Constants.AUTO,fabric.textureSize=4096,r.clipboard=null,r.snapToObjects=!1,r.setMode(Mode.Mode2D),r.spinner=new Spinner(r.container),r.preview=new Preview(r);var a=r.container.parentElement?.8*r.container.parentElement.clientWidth:320,s=r.container.parentElement?.8*r.container.parentElement.clientHeight:240;if(n)try{console.log(n),r.setState(n)}catch(t){console.error(t),r.addSide(a,s)}else console.log("this.container.clientWidth",r.container.clientWidth),r.addSide(a,s);return r.preview.hide(),r}return __extends(e,t),e.prototype.loadModel=function(t,e){Utils.logMethodName(),this.preview.loadModel(t,e)},e.prototype.addSide=function(t,e,i,n){Utils.logMethodName();var r=new Side2D(this.container,t,e,i,n);return this.insertSide(r),r},e.prototype.insertSide=function(t,e){this.sides.push(t),e||t.loadFromLocalStorage(),1==this.sides.length&&(this.activeSideIndex=0,this.getActiveSide().show(),t.canvas.renderAll(),t.zoomToFit()),this.changed()},e.prototype.loadPreset=function(t,i){this.loadState(e.settings.urls.presets+t+e.settings.fileExtensions.presets,i)},e.prototype.loadState=function(t,e){var i=this;Utils.logMethodName(),Utils.loadJSON(t,function(t){i.setStateInternal(t,e)})},e.prototype.deleteAllSides=function(){Utils.logMethodName(),this.sides.forEach(function(t){t.getElement().parentElement.removeChild(t.getElement())}),this.sides=[],this.changed()},e.prototype.clear=function(){localStorage.clear(),this.deleteAllSides()},e.prototype.clearAllSides=function(){Utils.logMethodName(),this.sides.forEach(function(t){return t.clear()}),localStorage.clear(),this.changed()},e.prototype.getElement=function(){return this.container},e.prototype.setActiveSide=function(t){this.activeSideIndex!=t&&t<this.sides.length&&(this.getMode()!=Mode.Mode2D&&this.setMode(Mode.Mode2D),this.getActiveSide().hide(),this.activeSideIndex=t,this.getActiveSide().show(),this.getActiveSide().canvas.renderAll(),this.zoomToFit(),this.changed())},e.prototype.getActiveSide=function(){return this.sides[this.activeSideIndex]},e.prototype.setZoom=function(t){this.getActiveSide().setZoom(t)},e.prototype.getZoom=function(){return this.getActiveSide().getZoom()},e.prototype.setShow3DMargin=function(t){this.preview.setShowMargin(t)},e.prototype.zoomIn=function(){this.is3D()?(this.preview.controls.dollyIn(1+e.zoomStep),this.preview.controls.update()):this.getActiveSide().setZoom(this.getActiveSide().getZoom()+e.zoomStep)},e.prototype.zoomOut=function(){this.is3D()?(this.preview.controls.dollyOut(1+e.zoomStep),this.preview.controls.update()):this.getActiveSide().setZoom(this.getActiveSide().getZoom()-e.zoomStep)},e.prototype.zoomToFit=function(){var t=this;this.is3D()||(this.getActiveSide()?this.getActiveSide().zoomToFit():setTimeout(function(){return t.zoomToFit()},10))},e.prototype.resetZoom=function(){this.getActiveSide().resetZoom()},e.prototype.is3D=function(){return this.getMode()===Mode.Mode3D},e.prototype.is2D=function(){return this.getMode()===Mode.Mode2D},e.prototype.getMode=function(){return this.preview&&this.preview.isVisible()?Mode.Mode3D:Mode.Mode2D},e.prototype.toggleSnapToGrid=function(){this.snapToGrid=!this.snapToGrid,this.changed()},e.prototype.toggleSnapToObjects=function(){this.snapToObjects=!this.snapToObjects,this.changed()},e.prototype.setMode=function(t){this.preview&&(Utils.logMethodName(),t==Mode.Mode2D?(this.preview.hide(),this.getActiveSide().show(),this.onModeChangeHandler&&this.onModeChangeHandler()):this.getActiveSide&&this.preview&&(this.preview.autoSize(),this.getActiveSide().deselect(),this.preview.updateSideMaterials(),this.getActiveSide().hide(),this.preview.show(),this.preview.render(),this.onModeChangeHandler&&this.onModeChangeHandler()),this.changed())},e.prototype.toggleMode=function(){this.setMode(this.getMode()==Mode.Mode2D?Mode.Mode3D:Mode.Mode2D)},e.prototype.onSelect=function(t){this.onSelectHandler=t},e.prototype.onDeselect=function(t){this.onDeselectHandler=t},e.prototype.onModeChange=function(t){this.onModeChangeHandler=t},e.prototype.onElementModification=function(t){this.onElementModificationHandler=t},e.prototype.hasSelection=function(){return null!=this.getSelection()},e.prototype.hasTextSelection=function(){return null!=this.getSelection()&&this.getSelection().type==ElementType.TEXT},e.prototype.hasImageSelection=function(){return null!=this.getSelection()&&this.getSelection().type==ElementType.IMAGE},e.prototype.getSelection=function(){return this.getActiveSide().selection},e.prototype.addElement=function(t){Utils.logMethodName();var i=this.getActiveSide().addElement(t);return i.object.setOptions(e.settings.elementDefaults[t.getNativeTypeName()]),i.randomizePosition(),i.setColor(Color.random()),i},e.prototype.addImage=function(t,i){Utils.logMethodName();var n=this.getActiveSide().addElement(ElementType.IMAGE),r=n.object;return r.setSrc(t,function(){var t=e.instance.getActiveSide(),a=Math.min(t.width/r.width,t.height/r.height);a<1&&r.scale(a),r.setCoords(),n.randomizePosition(),t.canvas.renderAll(),t.saveState(),n.changed(),i&&i(n)}),n},e.prototype.getModelName=function(){return this.preview.modelName},e.prototype.getSettings=function(){return e.settings},e.prototype.setSettings=function(t){e.settings=t},e.prototype.remove=function(){this.getSelection()&&this.getActiveSide().remove(this.getSelection())},e.prototype.copy=function(){var t=this.getSelection();t&&(this.clipboard=t.clone())},e.prototype.cut=function(){var t=this.getSelection();t&&(this.clipboard=t.clone(),this.getActiveSide().remove(this.getSelection()))},e.prototype.paste=function(){if(this.clipboard){var t=this.clipboard.clone();return this.getActiveSide().add(t),this.getActiveSide().select(t)}},e.prototype.duplicate=function(){var t=this.getSelection();if(t){var e=t.clone();return this.getActiveSide().add(e),e.randomizePosition(),this.getActiveSide().select(e)}},e.prototype.getState=function(t){var e=new ConstructorState;this.sides.forEach(function(t){return e.sides.push(t.serialize())}),e.model=this.preview.modelName,e.fills=[];for(var i=0;i<this.preview.fills.length;i++)try{e.fills[i]=this.preview.fills[i].color.getHex()}catch(t){e.fills[i]=null}return JSON.stringify(e,null,t?4:0)},e.prototype.applyPreset=function(t,e,i){var n=JSON.stringify({model:t,sides:e});this.setStateInternal(n,i)},e.prototype.applyState=function(t,e){this.setStateInternal(t,e,!1)},e.prototype.setState=function(t,e){this.setStateInternal(t,e,!0)},e.prototype.setStateInternal=function(t,e,i){var n,r=this;if(Utils.logMethodName(),n=typeof t===Constants.STRING?JSON.parse(t):t,i&&localStorage.clear(),this.deleteAllSides(),n.sides&&n.sides.forEach(function(t){var e=Side2D.prototype.deserialize(t);e.elements&&e.elements.length>0?r.insertSide(e,!0):r.insertSide(e,i),e.canvas.renderAll()}),n.model&&this.preview.modelName!=n.model)this.loadModel(n.model,function(){if(n.fills)for(var t=0;t<n.fills.length;t++)r.preview.fills[t]&&(r.preview.fills[t].color=new THREE.Color(n.fills[t]));e&&e()});else{if(n.fills)for(var a=0;a<n.fills.length;a++)this.preview.fills[a]&&(this.preview.fills[a].color=new THREE.Color(n.fills[a]));e&&e()}},e.prototype.undo=function(){this.getActiveSide().undo()},e.prototype.redo=function(){this.getActiveSide().redo()},e.version=Version.version,e.settings=new Settings,e.zoomStep=.05,e}(View),ConstructorState=function(){function t(){this.model=null,this.fills=[],this.sides=[]}return t.prototype.equals=function(t){return JSON.stringify(this)===JSON.stringify(t)},t}(),DoubleLinkedNode=function(){return function(t){this.value=t}}(),HistoryList=function(){function t(t){this.locked=!1,this.state=new DoubleLinkedNode(t)}return t.prototype.isLocked=function(){return!0===this.locked},t.prototype.lock=function(){this.locked=!0},t.prototype.unlock=function(){this.locked=!1},t.prototype.current=function(){return this.state.value},t.prototype.hasNext=function(){return!!this.state.next},t.prototype.hasPrevious=function(){return!!this.state.previous},t.prototype.back=function(){return this.state.previous?(this.state=this.state.previous,this.state.value):null},t.prototype.forward=function(){return this.state.next?(this.state=this.state.next,this.state.value):null},t.prototype.add=function(t){if(!this.locked&&!t.equals(this.current())){var e=new DoubleLinkedNode(t);e.previous=this.state,this.state.next=e,this.state=e}},t}();!function(t){t.ACCESSIBLE_ICON='<i class="fa fa-accessible-icon"></i>',t.ACCUSOFT='<i class="fa fa-accusoft"></i>',t.ACQUISITIONS_INCORPORATED='<i class="fa fa-acquisitions-incorporated"></i>',t.AD='<i class="fa fa-ad"></i>',t.ADDRESS_BOOK='<i class="fa fa-address-book"></i>',t.ADDRESS_CARD='<i class="fa fa-address-card"></i>',t.ADJUST='<i class="fa fa-adjust"></i>',t.ADN='<i class="fa fa-adn"></i>',t.ADVERSAL='<i class="fa fa-adversal"></i>',t.AFFILIATETHEME='<i class="fa fa-affiliatetheme"></i>',t.AIRBNB='<i class="fa fa-airbnb"></i>',t.AIR_FRESHENER='<i class="fa fa-air-freshener"></i>',t.ALGOLIA='<i class="fa fa-algolia"></i>',t.ALIGN_CENTER='<i class="fa fa-align-center"></i>',t.ALIGN_JUSTIFY='<i class="fa fa-align-justify"></i>',t.ALIGN_LEFT='<i class="fa fa-align-left"></i>',t.ALIGN_RIGHT='<i class="fa fa-align-right"></i>',t.ALIPAY='<i class="fa fa-alipay"></i>',t.ALLERGIES='<i class="fa fa-allergies"></i>',t.AMAZON='<i class="fa fa-amazon"></i>',t.AMAZON_PAY='<i class="fa fa-amazon-pay"></i>',t.AMBULANCE='<i class="fa fa-ambulance"></i>',t.AMERICAN_SIGN_LANGUAGE_INTERPRETING='<i class="fa fa-american-sign-language-interpreting"></i>',t.AMILIA='<i class="fa fa-amilia"></i>',t.ANCHOR='<i class="fa fa-anchor"></i>',t.ANDROID='<i class="fa fa-android"></i>',t.ANGELLIST='<i class="fa fa-angellist"></i>',t.ANGLE_DOUBLE_DOWN='<i class="fa fa-angle-double-down"></i>',t.ANGLE_DOUBLE_LEFT='<i class="fa fa-angle-double-left"></i>',t.ANGLE_DOUBLE_RIGHT='<i class="fa fa-angle-double-right"></i>',t.ANGLE_DOUBLE_UP='<i class="fa fa-angle-double-up"></i>',t.ANGLE_DOWN='<i class="fa fa-angle-down"></i>',t.ANGLE_LEFT='<i class="fa fa-angle-left"></i>',t.ANGLE_RIGHT='<i class="fa fa-angle-right"></i>',t.ANGLE_UP='<i class="fa fa-angle-up"></i>',t.ANGRY='<i class="fa fa-angry"></i>',t.ANGRYCREATIVE='<i class="fa fa-angrycreative"></i>',t.ANGULAR='<i class="fa fa-angular"></i>',t.ANKH='<i class="fa fa-ankh"></i>',t.APPER='<i class="fa fa-apper"></i>',t.APPLE='<i class="fa fa-apple"></i>',t.APPLE_ALT='<i class="fa fa-apple-alt"></i>',t.APPLE_PAY='<i class="fa fa-apple-pay"></i>',t.APP_STORE='<i class="fa fa-app-store"></i>',t.APP_STORE_IOS='<i class="fa fa-app-store-ios"></i>',t.ARCHIVE='<i class="fa fa-archive"></i>',t.ARCHWAY='<i class="fa fa-archway"></i>',t.ARROWS_ALT='<i class="fa fa-arrows-alt"></i>',t.ARROWS_ALT_H='<i class="fa fa-arrows-alt-h"></i>',t.ARROWS_ALT_V='<i class="fa fa-arrows-alt-v"></i>',t.ARROW_ALT_CIRCLE_DOWN='<i class="fa fa-arrow-alt-circle-down"></i>',t.ARROW_ALT_CIRCLE_LEFT='<i class="fa fa-arrow-alt-circle-left"></i>',t.ARROW_ALT_CIRCLE_RIGHT='<i class="fa fa-arrow-alt-circle-right"></i>',t.ARROW_ALT_CIRCLE_UP='<i class="fa fa-arrow-alt-circle-up"></i>',t.ARROW_CIRCLE_DOWN='<i class="fa fa-arrow-circle-down"></i>',t.ARROW_CIRCLE_LEFT='<i class="fa fa-arrow-circle-left"></i>',t.ARROW_CIRCLE_RIGHT='<i class="fa fa-arrow-circle-right"></i>',t.ARROW_CIRCLE_UP='<i class="fa fa-arrow-circle-up"></i>',t.ARROW_DOWN='<i class="fa fa-arrow-down"></i>',t.ARROW_LEFT='<i class="fa fa-arrow-left"></i>',t.ARROW_RIGHT='<i class="fa fa-arrow-right"></i>',t.ARROW_UP='<i class="fa fa-arrow-up"></i>',t.ARTSTATION='<i class="fa fa-artstation"></i>',t.ASSISTIVE_LISTENING_SYSTEMS='<i class="fa fa-assistive-listening-systems"></i>',t.ASTERISK='<i class="fa fa-asterisk"></i>',t.ASYMMETRIK='<i class="fa fa-asymmetrik"></i>',t.AT='<i class="fa fa-at"></i>',t.ATLAS='<i class="fa fa-atlas"></i>',t.ATLASSIAN='<i class="fa fa-atlassian"></i>',t.ATOM='<i class="fa fa-atom"></i>',t.AUDIBLE='<i class="fa fa-audible"></i>',t.AUDIO_DESCRIPTION='<i class="fa fa-audio-description"></i>',t.AUTOPREFIXER='<i class="fa fa-autoprefixer"></i>',t.AVIANEX='<i class="fa fa-avianex"></i>',t.AVIATO='<i class="fa fa-aviato"></i>',t.AWARD='<i class="fa fa-award"></i>',t.AWS='<i class="fa fa-aws"></i>',t.BABY='<i class="fa fa-baby"></i>',t.BABY_CARRIAGE='<i class="fa fa-baby-carriage"></i>',t.BACKSPACE='<i class="fa fa-backspace"></i>',t.BACKWARD='<i class="fa fa-backward"></i>',t.BACON='<i class="fa fa-bacon"></i>',t.BACTERIA='<i class="fa fa-bacteria"></i>',t.BACTERIUM='<i class="fa fa-bacterium"></i>',t.BAHAI='<i class="fa fa-bahai"></i>',t.BALANCE_SCALE='<i class="fa fa-balance-scale"></i>',t.BALANCE_SCALE_LEFT='<i class="fa fa-balance-scale-left"></i>',t.BALANCE_SCALE_RIGHT='<i class="fa fa-balance-scale-right"></i>',t.BAN='<i class="fa fa-ban"></i>',t.BANDCAMP='<i class="fa fa-bandcamp"></i>',t.BAND_AID='<i class="fa fa-band-aid"></i>',t.BARCODE='<i class="fa fa-barcode"></i>',t.BARS='<i class="fa fa-bars"></i>',t.BASEBALL_BALL='<i class="fa fa-baseball-ball"></i>',t.BASKETBALL_BALL='<i class="fa fa-basketball-ball"></i>',t.BATH='<i class="fa fa-bath"></i>',t.BATTERY_EMPTY='<i class="fa fa-battery-empty"></i>',t.BATTERY_FULL='<i class="fa fa-battery-full"></i>',t.BATTERY_HALF='<i class="fa fa-battery-half"></i>',t.BATTERY_QUARTER='<i class="fa fa-battery-quarter"></i>',t.BATTERY_THREE_QUARTERS='<i class="fa fa-battery-three-quarters"></i>',t.BATTLE_NET='<i class="fa fa-battle-net"></i>',t.BED='<i class="fa fa-bed"></i>',t.BEER='<i class="fa fa-beer"></i>',t.BEHANCE='<i class="fa fa-behance"></i>',t.BEHANCE_SQUARE='<i class="fa fa-behance-square"></i>',t.BELL='<i class="fa fa-bell"></i>',t.BELL_SLASH='<i class="fa fa-bell-slash"></i>',t.BEZIER_CURVE='<i class="fa fa-bezier-curve"></i>',t.BIBLE='<i class="fa fa-bible"></i>',t.BICYCLE='<i class="fa fa-bicycle"></i>',t.BIKING='<i class="fa fa-biking"></i>',t.BIMOBJECT='<i class="fa fa-bimobject"></i>',t.BINOCULARS='<i class="fa fa-binoculars"></i>',t.BIOHAZARD='<i class="fa fa-biohazard"></i>',t.BIRTHDAY_CAKE='<i class="fa fa-birthday-cake"></i>',t.BITBUCKET='<i class="fa fa-bitbucket"></i>',t.BITCOIN='<i class="fa fa-bitcoin"></i>',t.BITY='<i class="fa fa-bity"></i>',t.BLACKBERRY='<i class="fa fa-blackberry"></i>',t.BLACK_TIE='<i class="fa fa-black-tie"></i>',t.BLENDER='<i class="fa fa-blender"></i>',t.BLENDER_PHONE='<i class="fa fa-blender-phone"></i>',t.BLIND='<i class="fa fa-blind"></i>',t.BLOG='<i class="fa fa-blog"></i>',t.BLOGGER='<i class="fa fa-blogger"></i>',t.BLOGGER_B='<i class="fa fa-blogger-b"></i>',t.BLUETOOTH='<i class="fa fa-bluetooth"></i>',t.BLUETOOTH_B='<i class="fa fa-bluetooth-b"></i>',t.BOLD='<i class="fa fa-bold"></i>',t.BOLT='<i class="fa fa-bolt"></i>',t.BOMB='<i class="fa fa-bomb"></i>',t.BONE='<i class="fa fa-bone"></i>',t.BONG='<i class="fa fa-bong"></i>',t.BOOK='<i class="fa fa-book"></i>',t.BOOKMARK='<i class="fa fa-bookmark"></i>',t.BOOK_DEAD='<i class="fa fa-book-dead"></i>',t.BOOK_MEDICAL='<i class="fa fa-book-medical"></i>',t.BOOK_OPEN='<i class="fa fa-book-open"></i>',t.BOOK_READER='<i class="fa fa-book-reader"></i>',t.BOOTSTRAP='<i class="fa fa-bootstrap"></i>',t.BORDER_ALL='<i class="fa fa-border-all"></i>',t.BORDER_NONE='<i class="fa fa-border-none"></i>',t.BORDER_STYLE='<i class="fa fa-border-style"></i>',t.BOWLING_BALL='<i class="fa fa-bowling-ball"></i>',t.BOX='<i class="fa fa-box"></i>',t.BOXES='<i class="fa fa-boxes"></i>',t.BOX_OPEN='<i class="fa fa-box-open"></i>',t.BOX_TISSUE='<i class="fa fa-box-tissue"></i>',t.BRAILLE='<i class="fa fa-braille"></i>',t.BRAIN='<i class="fa fa-brain"></i>',t.BREAD_SLICE='<i class="fa fa-bread-slice"></i>',t.BRIEFCASE='<i class="fa fa-briefcase"></i>',t.BRIEFCASE_MEDICAL='<i class="fa fa-briefcase-medical"></i>',t.BROADCAST_TOWER='<i class="fa fa-broadcast-tower"></i>',t.BROOM='<i class="fa fa-broom"></i>',t.BRUSH='<i class="fa fa-brush"></i>',t.BTC='<i class="fa fa-btc"></i>',t.BUFFER='<i class="fa fa-buffer"></i>',t.BUG='<i class="fa fa-bug"></i>',t.BUILDING='<i class="fa fa-building"></i>',t.BULLHORN='<i class="fa fa-bullhorn"></i>',t.BULLSEYE='<i class="fa fa-bullseye"></i>',t.BURN='<i class="fa fa-burn"></i>',t.BUROMOBELEXPERTE='<i class="fa fa-buromobelexperte"></i>',t.BUS='<i class="fa fa-bus"></i>',t.BUSINESS_TIME='<i class="fa fa-business-time"></i>',t.BUS_ALT='<i class="fa fa-bus-alt"></i>',t.BUYSELLADS='<i class="fa fa-buysellads"></i>',t.BUY_N_LARGE='<i class="fa fa-buy-n-large"></i>',t.CALCULATOR='<i class="fa fa-calculator"></i>',t.CALENDAR='<i class="fa fa-calendar"></i>',t.CALENDAR_ALT='<i class="fa fa-calendar-alt"></i>',t.CALENDAR_CHECK='<i class="fa fa-calendar-check"></i>',t.CALENDAR_DAY='<i class="fa fa-calendar-day"></i>',t.CALENDAR_MINUS='<i class="fa fa-calendar-minus"></i>',t.CALENDAR_PLUS='<i class="fa fa-calendar-plus"></i>',t.CALENDAR_TIMES='<i class="fa fa-calendar-times"></i>',t.CALENDAR_WEEK='<i class="fa fa-calendar-week"></i>',t.CAMERA='<i class="fa fa-camera"></i>',t.CAMERA_RETRO='<i class="fa fa-camera-retro"></i>',t.CAMPGROUND='<i class="fa fa-campground"></i>',t.CANADIAN_MAPLE_LEAF='<i class="fa fa-canadian-maple-leaf"></i>',t.CANDY_CANE='<i class="fa fa-candy-cane"></i>',t.CANNABIS='<i class="fa fa-cannabis"></i>',t.CAPSULES='<i class="fa fa-capsules"></i>',t.CAR='<i class="fa fa-car"></i>',t.CARAVAN='<i class="fa fa-caravan"></i>',t.CARET_DOWN='<i class="fa fa-caret-down"></i>',t.CARET_LEFT='<i class="fa fa-caret-left"></i>',t.CARET_RIGHT='<i class="fa fa-caret-right"></i>',t.CARET_SQUARE_DOWN='<i class="fa fa-caret-square-down"></i>',t.CARET_SQUARE_LEFT='<i class="fa fa-caret-square-left"></i>',t.CARET_SQUARE_RIGHT='<i class="fa fa-caret-square-right"></i>',t.CARET_SQUARE_UP='<i class="fa fa-caret-square-up"></i>',t.CARET_UP='<i class="fa fa-caret-up"></i>',t.CARROT='<i class="fa fa-carrot"></i>',t.CART_ARROW_DOWN='<i class="fa fa-cart-arrow-down"></i>',t.CART_PLUS='<i class="fa fa-cart-plus"></i>',t.CAR_ALT='<i class="fa fa-car-alt"></i>',t.CAR_BATTERY='<i class="fa fa-car-battery"></i>',t.CAR_CRASH='<i class="fa fa-car-crash"></i>',t.CAR_SIDE='<i class="fa fa-car-side"></i>',t.CASH_REGISTER='<i class="fa fa-cash-register"></i>',t.CAT='<i class="fa fa-cat"></i>',t.CC_AMAZON_PAY='<i class="fa fa-cc-amazon-pay"></i>',t.CC_AMEX='<i class="fa fa-cc-amex"></i>',t.CC_APPLE_PAY='<i class="fa fa-cc-apple-pay"></i>',t.CC_DINERS_CLUB='<i class="fa fa-cc-diners-club"></i>',t.CC_DISCOVER='<i class="fa fa-cc-discover"></i>',t.CC_JCB='<i class="fa fa-cc-jcb"></i>',t.CC_MASTERCARD='<i class="fa fa-cc-mastercard"></i>',t.CC_PAYPAL='<i class="fa fa-cc-paypal"></i>',t.CC_STRIPE='<i class="fa fa-cc-stripe"></i>',t.CC_VISA='<i class="fa fa-cc-visa"></i>',t.CENTERCODE='<i class="fa fa-centercode"></i>',t.CENTOS='<i class="fa fa-centos"></i>',t.CERTIFICATE='<i class="fa fa-certificate"></i>',t.CHAIR='<i class="fa fa-chair"></i>',t.CHALKBOARD='<i class="fa fa-chalkboard"></i>',t.CHALKBOARD_TEACHER='<i class="fa fa-chalkboard-teacher"></i>',t.CHARGING_STATION='<i class="fa fa-charging-station"></i>',t.CHART_AREA='<i class="fa fa-chart-area"></i>',t.CHART_BAR='<i class="fa fa-chart-bar"></i>',t.CHART_LINE='<i class="fa fa-chart-line"></i>',t.CHART_PIE='<i class="fa fa-chart-pie"></i>',t.CHECK='<i class="fa fa-check"></i>',t.CHECK_CIRCLE='<i class="fa fa-check-circle"></i>',t.CHECK_DOUBLE='<i class="fa fa-check-double"></i>',t.CHECK_SQUARE='<i class="fa fa-check-square"></i>',t.CHEESE='<i class="fa fa-cheese"></i>',t.CHESS='<i class="fa fa-chess"></i>',t.CHESS_BISHOP='<i class="fa fa-chess-bishop"></i>',t.CHESS_BOARD='<i class="fa fa-chess-board"></i>',t.CHESS_KING='<i class="fa fa-chess-king"></i>',t.CHESS_KNIGHT='<i class="fa fa-chess-knight"></i>',t.CHESS_PAWN='<i class="fa fa-chess-pawn"></i>',t.CHESS_QUEEN='<i class="fa fa-chess-queen"></i>',t.CHESS_ROOK='<i class="fa fa-chess-rook"></i>',t.CHEVRON_CIRCLE_DOWN='<i class="fa fa-chevron-circle-down"></i>',t.CHEVRON_CIRCLE_LEFT='<i class="fa fa-chevron-circle-left"></i>',t.CHEVRON_CIRCLE_RIGHT='<i class="fa fa-chevron-circle-right"></i>',t.CHEVRON_CIRCLE_UP='<i class="fa fa-chevron-circle-up"></i>',t.CHEVRON_DOWN='<i class="fa fa-chevron-down"></i>',t.CHEVRON_LEFT='<i class="fa fa-chevron-left"></i>',t.CHEVRON_RIGHT='<i class="fa fa-chevron-right"></i>',t.CHEVRON_UP='<i class="fa fa-chevron-up"></i>',t.CHILD='<i class="fa fa-child"></i>',t.CHROME='<i class="fa fa-chrome"></i>',t.CHROMECAST='<i class="fa fa-chromecast"></i>',t.CHURCH='<i class="fa fa-church"></i>',t.CIRCLE='<i class="fa fa-circle"></i>',t.CIRCLE_NOTCH='<i class="fa fa-circle-notch"></i>',t.CITY='<i class="fa fa-city"></i>',t.CLINIC_MEDICAL='<i class="fa fa-clinic-medical"></i>',t.CLIPBOARD='<i class="fa fa-clipboard"></i>',t.CLIPBOARD_CHECK='<i class="fa fa-clipboard-check"></i>',t.CLIPBOARD_LIST='<i class="fa fa-clipboard-list"></i>',t.CLOCK='<i class="fa fa-clock"></i>',t.CLONE='<i class="fa fa-clone"></i>',t.CLOSED_CAPTIONING='<i class="fa fa-closed-captioning"></i>',t.CLOUD='<i class="fa fa-cloud"></i>',t.CLOUDFLARE='<i class="fa fa-cloudflare"></i>',t.CLOUDSCALE='<i class="fa fa-cloudscale"></i>',t.CLOUDSMITH='<i class="fa fa-cloudsmith"></i>',t.CLOUDVERSIFY='<i class="fa fa-cloudversify"></i>',t.CLOUD_DOWNLOAD_ALT='<i class="fa fa-cloud-download-alt"></i>',t.CLOUD_MEATBALL='<i class="fa fa-cloud-meatball"></i>',t.CLOUD_MOON='<i class="fa fa-cloud-moon"></i>',t.CLOUD_MOON_RAIN='<i class="fa fa-cloud-moon-rain"></i>',t.CLOUD_RAIN='<i class="fa fa-cloud-rain"></i>',t.CLOUD_SHOWERS_HEAVY='<i class="fa fa-cloud-showers-heavy"></i>',t.CLOUD_SUN='<i class="fa fa-cloud-sun"></i>',t.CLOUD_SUN_RAIN='<i class="fa fa-cloud-sun-rain"></i>',t.CLOUD_UPLOAD_ALT='<i class="fa fa-cloud-upload-alt"></i>',t.COCKTAIL='<i class="fa fa-cocktail"></i>',t.CODE='<i class="fa fa-code"></i>',t.CODEPEN='<i class="fa fa-codepen"></i>',t.CODE_BRANCH='<i class="fa fa-code-branch"></i>',t.CODIEPIE='<i class="fa fa-codiepie"></i>',t.COFFEE='<i class="fa fa-coffee"></i>',t.COG='<i class="fa fa-cog"></i>',t.COGS='<i class="fa fa-cogs"></i>',t.COINS='<i class="fa fa-coins"></i>',t.COLUMNS='<i class="fa fa-columns"></i>',t.COMMENT='<i class="fa fa-comment"></i>',t.COMMENTS='<i class="fa fa-comments"></i>',t.COMMENTS_DOLLAR='<i class="fa fa-comments-dollar"></i>',t.COMMENT_ALT='<i class="fa fa-comment-alt"></i>',t.COMMENT_DOLLAR='<i class="fa fa-comment-dollar"></i>',t.COMMENT_DOTS='<i class="fa fa-comment-dots"></i>',t.COMMENT_MEDICAL='<i class="fa fa-comment-medical"></i>',t.COMMENT_SLASH='<i class="fa fa-comment-slash"></i>',t.COMPACT_DISC='<i class="fa fa-compact-disc"></i>',t.COMPASS='<i class="fa fa-compass"></i>',t.COMPRESS='<i class="fa fa-compress"></i>',t.COMPRESS_ALT='<i class="fa fa-compress-alt"></i>',t.COMPRESS_ARROWS_ALT='<i class="fa fa-compress-arrows-alt"></i>',t.CONCIERGE_BELL='<i class="fa fa-concierge-bell"></i>',t.CONFLUENCE='<i class="fa fa-confluence"></i>',t.CONNECTDEVELOP='<i class="fa fa-connectdevelop"></i>',t.CONTAO='<i class="fa fa-contao"></i>',t.COOKIE='<i class="fa fa-cookie"></i>',t.COOKIE_BITE='<i class="fa fa-cookie-bite"></i>',t.COPY='<i class="fa fa-copy"></i>',t.COPYRIGHT='<i class="fa fa-copyright"></i>',t.COTTON_BUREAU='<i class="fa fa-cotton-bureau"></i>',t.COUCH='<i class="fa fa-couch"></i>',t.CPANEL='<i class="fa fa-cpanel"></i>',t.CREATIVE_COMMONS='<i class="fa fa-creative-commons"></i>',t.CREATIVE_COMMONS_BY='<i class="fa fa-creative-commons-by"></i>',t.CREATIVE_COMMONS_NC='<i class="fa fa-creative-commons-nc"></i>',t.CREATIVE_COMMONS_NC_EU='<i class="fa fa-creative-commons-nc-eu"></i>',t.CREATIVE_COMMONS_NC_JP='<i class="fa fa-creative-commons-nc-jp"></i>',t.CREATIVE_COMMONS_ND='<i class="fa fa-creative-commons-nd"></i>',t.CREATIVE_COMMONS_PD='<i class="fa fa-creative-commons-pd"></i>',t.CREATIVE_COMMONS_PD_ALT='<i class="fa fa-creative-commons-pd-alt"></i>',t.CREATIVE_COMMONS_REMIX='<i class="fa fa-creative-commons-remix"></i>',t.CREATIVE_COMMONS_SA='<i class="fa fa-creative-commons-sa"></i>',t.CREATIVE_COMMONS_SAMPLING='<i class="fa fa-creative-commons-sampling"></i>',t.CREATIVE_COMMONS_SAMPLING_PLUS='<i class="fa fa-creative-commons-sampling-plus"></i>',t.CREATIVE_COMMONS_SHARE='<i class="fa fa-creative-commons-share"></i>',t.CREATIVE_COMMONS_ZERO='<i class="fa fa-creative-commons-zero"></i>',t.CREDIT_CARD='<i class="fa fa-credit-card"></i>',t.CRITICAL_ROLE='<i class="fa fa-critical-role"></i>',t.CROP='<i class="fa fa-crop"></i>',t.CROP_ALT='<i class="fa fa-crop-alt"></i>',t.CROSS='<i class="fa fa-cross"></i>',t.CROSSHAIRS='<i class="fa fa-crosshairs"></i>',t.CROW='<i class="fa fa-crow"></i>',t.CROWN='<i class="fa fa-crown"></i>',t.CRUTCH='<i class="fa fa-crutch"></i>',t.CSS3='<i class="fa fa-css3"></i>',t.CSS3_ALT='<i class="fa fa-css3-alt"></i>',t.CUBE='<i class="fa fa-cube"></i>',t.CUBES='<i class="fa fa-cubes"></i>',t.CUT='<i class="fa fa-cut"></i>',t.CUTTLEFISH='<i class="fa fa-cuttlefish"></i>',t.DAILYMOTION='<i class="fa fa-dailymotion"></i>',t.DASHCUBE='<i class="fa fa-dashcube"></i>',t.DATABASE='<i class="fa fa-database"></i>',t.DEAF='<i class="fa fa-deaf"></i>',t.DEEZER='<i class="fa fa-deezer"></i>',t.DELICIOUS='<i class="fa fa-delicious"></i>',t.DEMOCRAT='<i class="fa fa-democrat"></i>',t.DEPLOYDOG='<i class="fa fa-deploydog"></i>',t.DESKPRO='<i class="fa fa-deskpro"></i>',t.DESKTOP='<i class="fa fa-desktop"></i>',t.DEV='<i class="fa fa-dev"></i>',t.DEVIANTART='<i class="fa fa-deviantart"></i>',t.DHARMACHAKRA='<i class="fa fa-dharmachakra"></i>',t.DHL='<i class="fa fa-dhl"></i>',t.DIAGNOSES='<i class="fa fa-diagnoses"></i>',t.DIASPORA='<i class="fa fa-diaspora"></i>',t.DICE='<i class="fa fa-dice"></i>',t.DICE_D20='<i class="fa fa-dice-d20"></i>',t.DICE_D6='<i class="fa fa-dice-d6"></i>',t.DICE_FIVE='<i class="fa fa-dice-five"></i>',t.DICE_FOUR='<i class="fa fa-dice-four"></i>',t.DICE_ONE='<i class="fa fa-dice-one"></i>',t.DICE_SIX='<i class="fa fa-dice-six"></i>',t.DICE_THREE='<i class="fa fa-dice-three"></i>',t.DICE_TWO='<i class="fa fa-dice-two"></i>',t.DIGG='<i class="fa fa-digg"></i>',t.DIGITAL_OCEAN='<i class="fa fa-digital-ocean"></i>',t.DIGITAL_TACHOGRAPH='<i class="fa fa-digital-tachograph"></i>',t.DIRECTIONS='<i class="fa fa-directions"></i>',t.DISCORD='<i class="fa fa-discord"></i>',t.DISCOURSE='<i class="fa fa-discourse"></i>',t.DISEASE='<i class="fa fa-disease"></i>',t.DIVIDE='<i class="fa fa-divide"></i>',t.DIZZY='<i class="fa fa-dizzy"></i>',t.DNA='<i class="fa fa-dna"></i>',t.DOCHUB='<i class="fa fa-dochub"></i>',t.DOCKER='<i class="fa fa-docker"></i>',t.DOG='<i class="fa fa-dog"></i>',t.DOLLAR_SIGN='<i class="fa fa-dollar-sign"></i>',t.DOLLY='<i class="fa fa-dolly"></i>',t.DOLLY_FLATBED='<i class="fa fa-dolly-flatbed"></i>',t.DONATE='<i class="fa fa-donate"></i>',t.DOOR_CLOSED='<i class="fa fa-door-closed"></i>',t.DOOR_OPEN='<i class="fa fa-door-open"></i>',t.DOT_CIRCLE='<i class="fa fa-dot-circle"></i>',t.DOVE='<i class="fa fa-dove"></i>',t.DOWNLOAD='<i class="fa fa-download"></i>',t.DRAFT2DIGITAL='<i class="fa fa-draft2digital"></i>',t.DRAFTING_COMPASS='<i class="fa fa-drafting-compass"></i>',t.DRAGON='<i class="fa fa-dragon"></i>',t.DRAW_POLYGON='<i class="fa fa-draw-polygon"></i>',t.DRIBBBLE='<i class="fa fa-dribbble"></i>',t.DRIBBBLE_SQUARE='<i class="fa fa-dribbble-square"></i>',t.DROPBOX='<i class="fa fa-dropbox"></i>',t.DRUM='<i class="fa fa-drum"></i>',t.DRUMSTICK_BITE='<i class="fa fa-drumstick-bite"></i>',t.DRUM_STEELPAN='<i class="fa fa-drum-steelpan"></i>',t.DRUPAL='<i class="fa fa-drupal"></i>',t.DUMBBELL='<i class="fa fa-dumbbell"></i>',t.DUMPSTER='<i class="fa fa-dumpster"></i>',t.DUMPSTER_FIRE='<i class="fa fa-dumpster-fire"></i>',t.DUNGEON='<i class="fa fa-dungeon"></i>',t.DYALOG='<i class="fa fa-dyalog"></i>',t.D_AND_D='<i class="fa fa-d-and-d"></i>',t.D_AND_D_BEYOND='<i class="fa fa-d-and-d-beyond"></i>',t.EARLYBIRDS='<i class="fa fa-earlybirds"></i>',t.EBAY='<i class="fa fa-ebay"></i>',t.EDGE='<i class="fa fa-edge"></i>',t.EDGE_LEGACY='<i class="fa fa-edge-legacy"></i>',t.EDIT='<i class="fa fa-edit"></i>',t.EGG='<i class="fa fa-egg"></i>',t.EJECT='<i class="fa fa-eject"></i>',t.ELEMENTOR='<i class="fa fa-elementor"></i>',t.ELLIPSIS_H='<i class="fa fa-ellipsis-h"></i>',t.ELLIPSIS_V='<i class="fa fa-ellipsis-v"></i>',t.ELLO='<i class="fa fa-ello"></i>',t.EMBER='<i class="fa fa-ember"></i>',t.EMPIRE='<i class="fa fa-empire"></i>',t.ENVELOPE='<i class="fa fa-envelope"></i>',t.ENVELOPE_OPEN='<i class="fa fa-envelope-open"></i>',t.ENVELOPE_OPEN_TEXT='<i class="fa fa-envelope-open-text"></i>',t.ENVELOPE_SQUARE='<i class="fa fa-envelope-square"></i>',t.ENVIRA='<i class="fa fa-envira"></i>',t.EQUALS='<i class="fa fa-equals"></i>',t.ERASER='<i class="fa fa-eraser"></i>',t.ERLANG='<i class="fa fa-erlang"></i>',t.ETHEREUM='<i class="fa fa-ethereum"></i>',t.ETHERNET='<i class="fa fa-ethernet"></i>',t.ETSY='<i class="fa fa-etsy"></i>',t.EURO_SIGN='<i class="fa fa-euro-sign"></i>',t.EVERNOTE='<i class="fa fa-evernote"></i>',t.EXCHANGE_ALT='<i class="fa fa-exchange-alt"></i>',t.EXCLAMATION='<i class="fa fa-exclamation"></i>',t.EXCLAMATION_CIRCLE='<i class="fa fa-exclamation-circle"></i>',t.EXCLAMATION_TRIANGLE='<i class="fa fa-exclamation-triangle"></i>',t.EXPAND='<i class="fa fa-expand"></i>',t.EXPAND_ALT='<i class="fa fa-expand-alt"></i>',t.EXPAND_ARROWS_ALT='<i class="fa fa-expand-arrows-alt"></i>',t.EXPEDITEDSSL='<i class="fa fa-expeditedssl"></i>',t.EXTERNAL_LINK_ALT='<i class="fa fa-external-link-alt"></i>',t.EXTERNAL_LINK_SQUARE_ALT='<i class="fa fa-external-link-square-alt"></i>',t.EYE='<i class="fa fa-eye"></i>',t.EYE_DROPPER='<i class="fa fa-eye-dropper"></i>',t.EYE_SLASH='<i class="fa fa-eye-slash"></i>',t.FACEBOOK='<i class="fa fa-facebook"></i>',t.FACEBOOK_F='<i class="fa fa-facebook-f"></i>',t.FACEBOOK_MESSENGER='<i class="fa fa-facebook-messenger"></i>',t.FACEBOOK_SQUARE='<i class="fa fa-facebook-square"></i>',t.FAN='<i class="fa fa-fan"></i>',t.FANTASY_FLIGHT_GAMES='<i class="fa fa-fantasy-flight-games"></i>',t.FAST_BACKWARD='<i class="fa fa-fast-backward"></i>',t.FAST_FORWARD='<i class="fa fa-fast-forward"></i>',t.FAUCET='<i class="fa fa-faucet"></i>',t.FAX='<i class="fa fa-fax"></i>',t.FEATHER='<i class="fa fa-feather"></i>',t.FEATHER_ALT='<i class="fa fa-feather-alt"></i>',t.FEDEX='<i class="fa fa-fedex"></i>',t.FEDORA='<i class="fa fa-fedora"></i>',t.FEMALE='<i class="fa fa-female"></i>',t.FIGHTER_JET='<i class="fa fa-fighter-jet"></i>',t.FIGMA='<i class="fa fa-figma"></i>',t.FILE='<i class="fa fa-file"></i>',t.FILE_ALT='<i class="fa fa-file-alt"></i>',t.FILE_ARCHIVE='<i class="fa fa-file-archive"></i>',t.FILE_AUDIO='<i class="fa fa-file-audio"></i>',t.FILE_CODE='<i class="fa fa-file-code"></i>',t.FILE_CONTRACT='<i class="fa fa-file-contract"></i>',t.FILE_CSV='<i class="fa fa-file-csv"></i>',t.FILE_DOWNLOAD='<i class="fa fa-file-download"></i>',t.FILE_EXCEL='<i class="fa fa-file-excel"></i>',t.FILE_EXPORT='<i class="fa fa-file-export"></i>',t.FILE_IMAGE='<i class="fa fa-file-image"></i>',t.FILE_IMPORT='<i class="fa fa-file-import"></i>',t.FILE_INVOICE='<i class="fa fa-file-invoice"></i>',t.FILE_INVOICE_DOLLAR='<i class="fa fa-file-invoice-dollar"></i>',t.FILE_MEDICAL='<i class="fa fa-file-medical"></i>',t.FILE_MEDICAL_ALT='<i class="fa fa-file-medical-alt"></i>',t.FILE_PDF='<i class="fa fa-file-pdf"></i>',t.FILE_POWERPOINT='<i class="fa fa-file-powerpoint"></i>',t.FILE_PRESCRIPTION='<i class="fa fa-file-prescription"></i>',t.FILE_SIGNATURE='<i class="fa fa-file-signature"></i>',t.FILE_UPLOAD='<i class="fa fa-file-upload"></i>',t.FILE_VIDEO='<i class="fa fa-file-video"></i>',t.FILE_WORD='<i class="fa fa-file-word"></i>',t.FILL='<i class="fa fa-fill"></i>',t.FILL_DRIP='<i class="fa fa-fill-drip"></i>',t.FILM='<i class="fa fa-film"></i>',t.FILTER='<i class="fa fa-filter"></i>',t.FINGERPRINT='<i class="fa fa-fingerprint"></i>',t.FIRE='<i class="fa fa-fire"></i>',t.FIREFOX='<i class="fa fa-firefox"></i>',t.FIREFOX_BROWSER='<i class="fa fa-firefox-browser"></i>',t.FIRE_ALT='<i class="fa fa-fire-alt"></i>',t.FIRE_EXTINGUISHER='<i class="fa fa-fire-extinguisher"></i>',t.FIRSTDRAFT='<i class="fa fa-firstdraft"></i>',t.FIRST_AID='<i class="fa fa-first-aid"></i>',t.FIRST_ORDER='<i class="fa fa-first-order"></i>',t.FIRST_ORDER_ALT='<i class="fa fa-first-order-alt"></i>',t.FISH='<i class="fa fa-fish"></i>',t.FIST_RAISED='<i class="fa fa-fist-raised"></i>',t.FLAG='<i class="fa fa-flag"></i>',t.FLAG_CHECKERED='<i class="fa fa-flag-checkered"></i>',t.FLAG_USA='<i class="fa fa-flag-usa"></i>',t.FLASK='<i class="fa fa-flask"></i>',t.FLICKR='<i class="fa fa-flickr"></i>',t.FLIPBOARD='<i class="fa fa-flipboard"></i>',t.FLUSHED='<i class="fa fa-flushed"></i>',t.FLY='<i class="fa fa-fly"></i>',t.FOLDER='<i class="fa fa-folder"></i>',t.FOLDER_MINUS='<i class="fa fa-folder-minus"></i>',t.FOLDER_OPEN='<i class="fa fa-folder-open"></i>',t.FOLDER_PLUS='<i class="fa fa-folder-plus"></i>',t.FONT='<i class="fa fa-font"></i>',t.FONTICONS='<i class="fa fa-fonticons"></i>',t.FONTICONS_FI='<i class="fa fa-fonticons-fi"></i>',t.FONT_AWESOME='<i class="fa fa-font-awesome"></i>',t.FONT_AWESOME_ALT='<i class="fa fa-font-awesome-alt"></i>',t.FONT_AWESOME_FLAG='<i class="fa fa-font-awesome-flag"></i>',t.FONT_AWESOME_LOGO_FULL='<i class="fa fa-font-awesome-logo-full"></i>',t.FOOTBALL_BALL='<i class="fa fa-football-ball"></i>',t.FORT_AWESOME='<i class="fa fa-fort-awesome"></i>',t.FORT_AWESOME_ALT='<i class="fa fa-fort-awesome-alt"></i>',t.FORUMBEE='<i class="fa fa-forumbee"></i>',t.FORWARD='<i class="fa fa-forward"></i>',t.FOURSQUARE='<i class="fa fa-foursquare"></i>',t.FREEBSD='<i class="fa fa-freebsd"></i>',t.FREE_CODE_CAMP='<i class="fa fa-free-code-camp"></i>',t.FROG='<i class="fa fa-frog"></i>',t.FROWN='<i class="fa fa-frown"></i>',t.FROWN_OPEN='<i class="fa fa-frown-open"></i>',t.FULCRUM='<i class="fa fa-fulcrum"></i>',t.FUNNEL_DOLLAR='<i class="fa fa-funnel-dollar"></i>',t.FUTBOL='<i class="fa fa-futbol"></i>',t.GALACTIC_REPUBLIC='<i class="fa fa-galactic-republic"></i>',t.GALACTIC_SENATE='<i class="fa fa-galactic-senate"></i>',t.GAMEPAD='<i class="fa fa-gamepad"></i>',t.GAS_PUMP='<i class="fa fa-gas-pump"></i>',t.GAVEL='<i class="fa fa-gavel"></i>',t.GEM='<i class="fa fa-gem"></i>',t.GENDERLESS='<i class="fa fa-genderless"></i>',t.GET_POCKET='<i class="fa fa-get-pocket"></i>',t.GG='<i class="fa fa-gg"></i>',t.GG_CIRCLE='<i class="fa fa-gg-circle"></i>',t.GHOST='<i class="fa fa-ghost"></i>',t.GIFT='<i class="fa fa-gift"></i>',t.GIFTS='<i class="fa fa-gifts"></i>',t.GIT='<i class="fa fa-git"></i>',t.GITHUB='<i class="fa fa-github"></i>',t.GITHUB_ALT='<i class="fa fa-github-alt"></i>',t.GITHUB_SQUARE='<i class="fa fa-github-square"></i>',t.GITKRAKEN='<i class="fa fa-gitkraken"></i>',t.GITLAB='<i class="fa fa-gitlab"></i>',t.GITTER='<i class="fa fa-gitter"></i>',t.GIT_ALT='<i class="fa fa-git-alt"></i>',t.GIT_SQUARE='<i class="fa fa-git-square"></i>',t.GLASSES='<i class="fa fa-glasses"></i>',t.GLASS_CHEERS='<i class="fa fa-glass-cheers"></i>',t.GLASS_MARTINI='<i class="fa fa-glass-martini"></i>',t.GLASS_MARTINI_ALT='<i class="fa fa-glass-martini-alt"></i>',t.GLASS_WHISKEY='<i class="fa fa-glass-whiskey"></i>',t.GLIDE='<i class="fa fa-glide"></i>',t.GLIDE_G='<i class="fa fa-glide-g"></i>',t.GLOBE='<i class="fa fa-globe"></i>',t.GLOBE_AFRICA='<i class="fa fa-globe-africa"></i>',t.GLOBE_AMERICAS='<i class="fa fa-globe-americas"></i>',t.GLOBE_ASIA='<i class="fa fa-globe-asia"></i>',t.GLOBE_EUROPE='<i class="fa fa-globe-europe"></i>',t.GOFORE='<i class="fa fa-gofore"></i>',t.GOLF_BALL='<i class="fa fa-golf-ball"></i>',t.GOODREADS='<i class="fa fa-goodreads"></i>',t.GOODREADS_G='<i class="fa fa-goodreads-g"></i>',t.GOOGLE='<i class="fa fa-google"></i>',t.GOOGLE_DRIVE='<i class="fa fa-google-drive"></i>',t.GOOGLE_PAY='<i class="fa fa-google-pay"></i>',t.GOOGLE_PLAY='<i class="fa fa-google-play"></i>',t.GOOGLE_PLUS='<i class="fa fa-google-plus"></i>',t.GOOGLE_PLUS_G='<i class="fa fa-google-plus-g"></i>',t.GOOGLE_PLUS_SQUARE='<i class="fa fa-google-plus-square"></i>',t.GOOGLE_WALLET='<i class="fa fa-google-wallet"></i>',t.GOPURAM='<i class="fa fa-gopuram"></i>',t.GRADUATION_CAP='<i class="fa fa-graduation-cap"></i>',t.GRATIPAY='<i class="fa fa-gratipay"></i>',t.GRAV='<i class="fa fa-grav"></i>',t.GREATER_THAN='<i class="fa fa-greater-than"></i>',t.GREATER_THAN_EQUAL='<i class="fa fa-greater-than-equal"></i>',t.GRIMACE='<i class="fa fa-grimace"></i>',t.GRIN='<i class="fa fa-grin"></i>',t.GRIN_ALT='<i class="fa fa-grin-alt"></i>',t.GRIN_BEAM='<i class="fa fa-grin-beam"></i>',t.GRIN_BEAM_SWEAT='<i class="fa fa-grin-beam-sweat"></i>',t.GRIN_HEARTS='<i class="fa fa-grin-hearts"></i>',t.GRIN_SQUINT='<i class="fa fa-grin-squint"></i>',t.GRIN_SQUINT_TEARS='<i class="fa fa-grin-squint-tears"></i>',t.GRIN_STARS='<i class="fa fa-grin-stars"></i>',t.GRIN_TEARS='<i class="fa fa-grin-tears"></i>',t.GRIN_TONGUE='<i class="fa fa-grin-tongue"></i>',t.GRIN_TONGUE_SQUINT='<i class="fa fa-grin-tongue-squint"></i>',t.GRIN_TONGUE_WINK='<i class="fa fa-grin-tongue-wink"></i>',t.GRIN_WINK='<i class="fa fa-grin-wink"></i>',t.GRIPFIRE='<i class="fa fa-gripfire"></i>',t.GRIP_HORIZONTAL='<i class="fa fa-grip-horizontal"></i>',t.GRIP_LINES='<i class="fa fa-grip-lines"></i>',t.GRIP_LINES_VERTICAL='<i class="fa fa-grip-lines-vertical"></i>',t.GRIP_VERTICAL='<i class="fa fa-grip-vertical"></i>',t.GRUNT='<i class="fa fa-grunt"></i>',t.GUILDED='<i class="fa fa-guilded"></i>',t.GUITAR='<i class="fa fa-guitar"></i>',t.GULP='<i class="fa fa-gulp"></i>',t.HACKERRANK='<i class="fa fa-hackerrank"></i>',t.HACKER_NEWS='<i class="fa fa-hacker-news"></i>',t.HACKER_NEWS_SQUARE='<i class="fa fa-hacker-news-square"></i>',t.HAMBURGER='<i class="fa fa-hamburger"></i>',t.HAMMER='<i class="fa fa-hammer"></i>',t.HAMSA='<i class="fa fa-hamsa"></i>',t.HANDS='<i class="fa fa-hands"></i>',t.HANDSHAKE='<i class="fa fa-handshake"></i>',t.HANDSHAKE_ALT_SLASH='<i class="fa fa-handshake-alt-slash"></i>',t.HANDSHAKE_SLASH='<i class="fa fa-handshake-slash"></i>',t.HANDS_HELPING='<i class="fa fa-hands-helping"></i>',t.HANDS_WASH='<i class="fa fa-hands-wash"></i>',t.HAND_HOLDING='<i class="fa fa-hand-holding"></i>',t.HAND_HOLDING_HEART='<i class="fa fa-hand-holding-heart"></i>',t.HAND_HOLDING_MEDICAL='<i class="fa fa-hand-holding-medical"></i>',t.HAND_HOLDING_USD='<i class="fa fa-hand-holding-usd"></i>',t.HAND_HOLDING_WATER='<i class="fa fa-hand-holding-water"></i>',t.HAND_LIZARD='<i class="fa fa-hand-lizard"></i>',t.HAND_MIDDLE_FINGER='<i class="fa fa-hand-middle-finger"></i>',t.HAND_PAPER='<i class="fa fa-hand-paper"></i>',t.HAND_PEACE='<i class="fa fa-hand-peace"></i>',t.HAND_POINTER='<i class="fa fa-hand-pointer"></i>',t.HAND_POINT_DOWN='<i class="fa fa-hand-point-down"></i>',t.HAND_POINT_LEFT='<i class="fa fa-hand-point-left"></i>',t.HAND_POINT_RIGHT='<i class="fa fa-hand-point-right"></i>',t.HAND_POINT_UP='<i class="fa fa-hand-point-up"></i>',t.HAND_ROCK='<i class="fa fa-hand-rock"></i>',t.HAND_SCISSORS='<i class="fa fa-hand-scissors"></i>',t.HAND_SPARKLES='<i class="fa fa-hand-sparkles"></i>',t.HAND_SPOCK='<i class="fa fa-hand-spock"></i>',t.HANUKIAH='<i class="fa fa-hanukiah"></i>',t.HARD_HAT='<i class="fa fa-hard-hat"></i>',t.HASHTAG='<i class="fa fa-hashtag"></i>',t.HAT_COWBOY='<i class="fa fa-hat-cowboy"></i>',t.HAT_COWBOY_SIDE='<i class="fa fa-hat-cowboy-side"></i>',t.HAT_WIZARD='<i class="fa fa-hat-wizard"></i>',t.HDD='<i class="fa fa-hdd"></i>',t.HEADING='<i class="fa fa-heading"></i>',t.HEADPHONES='<i class="fa fa-headphones"></i>',t.HEADPHONES_ALT='<i class="fa fa-headphones-alt"></i>',t.HEADSET='<i class="fa fa-headset"></i>',t.HEAD_SIDE_COUGH='<i class="fa fa-head-side-cough"></i>',t.HEAD_SIDE_COUGH_SLASH='<i class="fa fa-head-side-cough-slash"></i>',t.HEAD_SIDE_MASK='<i class="fa fa-head-side-mask"></i>',t.HEAD_SIDE_VIRUS='<i class="fa fa-head-side-virus"></i>',t.HEART='<i class="fa fa-heart"></i>',t.HEARTBEAT='<i class="fa fa-heartbeat"></i>',t.HEART_BROKEN='<i class="fa fa-heart-broken"></i>',t.HELICOPTER='<i class="fa fa-helicopter"></i>',t.HIGHLIGHTER='<i class="fa fa-highlighter"></i>',t.HIKING='<i class="fa fa-hiking"></i>',t.HIPPO='<i class="fa fa-hippo"></i>',t.HIPS='<i class="fa fa-hips"></i>',t.HIRE_A_HELPER='<i class="fa fa-hire-a-helper"></i>',t.HISTORY='<i class="fa fa-history"></i>',t.HIVE='<i class="fa fa-hive"></i>',t.HOCKEY_PUCK='<i class="fa fa-hockey-puck"></i>',t.HOLLY_BERRY='<i class="fa fa-holly-berry"></i>',t.HOME='<i class="fa fa-home"></i>',t.HOOLI='<i class="fa fa-hooli"></i>',t.HORNBILL='<i class="fa fa-hornbill"></i>',t.HORSE='<i class="fa fa-horse"></i>',t.HORSE_HEAD='<i class="fa fa-horse-head"></i>',t.HOSPITAL='<i class="fa fa-hospital"></i>',t.HOSPITAL_ALT='<i class="fa fa-hospital-alt"></i>',t.HOSPITAL_SYMBOL='<i class="fa fa-hospital-symbol"></i>',t.HOSPITAL_USER='<i class="fa fa-hospital-user"></i>',t.HOTDOG='<i class="fa fa-hotdog"></i>',t.HOTEL='<i class="fa fa-hotel"></i>',t.HOTJAR='<i class="fa fa-hotjar"></i>',t.HOT_TUB='<i class="fa fa-hot-tub"></i>',t.HOURGLASS='<i class="fa fa-hourglass"></i>',t.HOURGLASS_END='<i class="fa fa-hourglass-end"></i>',t.HOURGLASS_HALF='<i class="fa fa-hourglass-half"></i>',t.HOURGLASS_START='<i class="fa fa-hourglass-start"></i>',t.HOUSE_DAMAGE='<i class="fa fa-house-damage"></i>',t.HOUSE_USER='<i class="fa fa-house-user"></i>',t.HOUZZ='<i class="fa fa-houzz"></i>',t.HRYVNIA='<i class="fa fa-hryvnia"></i>',t.HTML5='<i class="fa fa-html5"></i>',t.HUBSPOT='<i class="fa fa-hubspot"></i>',t.H_SQUARE='<i class="fa fa-h-square"></i>',t.ICE_CREAM='<i class="fa fa-ice-cream"></i>',t.ICICLES='<i class="fa fa-icicles"></i>',t.ICONS='<i class="fa fa-icons"></i>',t.IDEAL='<i class="fa fa-ideal"></i>',t.ID_BADGE='<i class="fa fa-id-badge"></i>',t.ID_CARD='<i class="fa fa-id-card"></i>',t.ID_CARD_ALT='<i class="fa fa-id-card-alt"></i>',t.IGLOO='<i class="fa fa-igloo"></i>',t.IMAGE='<i class="fa fa-image"></i>',t.IMAGES='<i class="fa fa-images"></i>',t.IMDB='<i class="fa fa-imdb"></i>',t.INBOX='<i class="fa fa-inbox"></i>',t.INDENT='<i class="fa fa-indent"></i>',t.INDUSTRY='<i class="fa fa-industry"></i>',t.INFINITY='<i class="fa fa-infinity"></i>',t.INFO='<i class="fa fa-info"></i>',t.INFO_CIRCLE='<i class="fa fa-info-circle"></i>',t.INNOSOFT='<i class="fa fa-innosoft"></i>',t.INSTAGRAM='<i class="fa fa-instagram"></i>',t.INSTAGRAM_SQUARE='<i class="fa fa-instagram-square"></i>',t.INSTALOD='<i class="fa fa-instalod"></i>',t.INTERCOM='<i class="fa fa-intercom"></i>',t.INTERNET_EXPLORER='<i class="fa fa-internet-explorer"></i>',t.INVISION='<i class="fa fa-invision"></i>',t.IOXHOST='<i class="fa fa-ioxhost"></i>',t.ITALIC='<i class="fa fa-italic"></i>',t.ITCH_IO='<i class="fa fa-itch-io"></i>',t.ITUNES='<i class="fa fa-itunes"></i>',t.ITUNES_NOTE='<i class="fa fa-itunes-note"></i>',t.I_CURSOR='<i class="fa fa-i-cursor"></i>',t.JAVA='<i class="fa fa-java"></i>',t.JEDI='<i class="fa fa-jedi"></i>',t.JEDI_ORDER='<i class="fa fa-jedi-order"></i>',t.JENKINS='<i class="fa fa-jenkins"></i>',t.JIRA='<i class="fa fa-jira"></i>',t.JOGET='<i class="fa fa-joget"></i>',t.JOINT='<i class="fa fa-joint"></i>',t.JOOMLA='<i class="fa fa-joomla"></i>',t.JOURNAL_WHILLS='<i class="fa fa-journal-whills"></i>',t.JS='<i class="fa fa-js"></i>',t.JSFIDDLE='<i class="fa fa-jsfiddle"></i>',t.JS_SQUARE='<i class="fa fa-js-square"></i>',t.KAABA='<i class="fa fa-kaaba"></i>',t.KAGGLE='<i class="fa fa-kaggle"></i>',t.KEY='<i class="fa fa-key"></i>',t.KEYBASE='<i class="fa fa-keybase"></i>',t.KEYBOARD='<i class="fa fa-keyboard"></i>',t.KEYCDN='<i class="fa fa-keycdn"></i>',t.KHANDA='<i class="fa fa-khanda"></i>',t.KICKSTARTER='<i class="fa fa-kickstarter"></i>',t.KICKSTARTER_K='<i class="fa fa-kickstarter-k"></i>',t.KISS='<i class="fa fa-kiss"></i>',t.KISS_BEAM='<i class="fa fa-kiss-beam"></i>',t.KISS_WINK_HEART='<i class="fa fa-kiss-wink-heart"></i>',t.KIWI_BIRD='<i class="fa fa-kiwi-bird"></i>',t.KORVUE='<i class="fa fa-korvue"></i>',t.LANDMARK='<i class="fa fa-landmark"></i>',t.LANGUAGE='<i class="fa fa-language"></i>',t.LAPTOP='<i class="fa fa-laptop"></i>',t.LAPTOP_CODE='<i class="fa fa-laptop-code"></i>',t.LAPTOP_HOUSE='<i class="fa fa-laptop-house"></i>',t.LAPTOP_MEDICAL='<i class="fa fa-laptop-medical"></i>',t.LARAVEL='<i class="fa fa-laravel"></i>',t.LASTFM='<i class="fa fa-lastfm"></i>',t.LASTFM_SQUARE='<i class="fa fa-lastfm-square"></i>',t.LAUGH='<i class="fa fa-laugh"></i>',t.LAUGH_BEAM='<i class="fa fa-laugh-beam"></i>',t.LAUGH_SQUINT='<i class="fa fa-laugh-squint"></i>',t.LAUGH_WINK='<i class="fa fa-laugh-wink"></i>',t.LAYER_GROUP='<i class="fa fa-layer-group"></i>',t.LEAF='<i class="fa fa-leaf"></i>',t.LEANPUB='<i class="fa fa-leanpub"></i>',t.LEMON='<i class="fa fa-lemon"></i>',t.LESS='<i class="fa fa-less"></i>',t.LESS_THAN='<i class="fa fa-less-than"></i>',t.LESS_THAN_EQUAL='<i class="fa fa-less-than-equal"></i>',t.LEVEL_DOWN_ALT='<i class="fa fa-level-down-alt"></i>',t.LEVEL_UP_ALT='<i class="fa fa-level-up-alt"></i>',t.LIFE_RING='<i class="fa fa-life-ring"></i>',t.LIGHTBULB='<i class="fa fa-lightbulb"></i>',t.LINE='<i class="fa fa-line"></i>',t.LINK='<i class="fa fa-link"></i>',t.LINKEDIN='<i class="fa fa-linkedin"></i>',t.LINKEDIN_IN='<i class="fa fa-linkedin-in"></i>',t.LINODE='<i class="fa fa-linode"></i>',t.LINUX='<i class="fa fa-linux"></i>',t.LIRA_SIGN='<i class="fa fa-lira-sign"></i>',t.LIST='<i class="fa fa-list"></i>',t.LIST_ALT='<i class="fa fa-list-alt"></i>',t.LIST_OL='<i class="fa fa-list-ol"></i>',t.LIST_UL='<i class="fa fa-list-ul"></i>',t.LOCATION_ARROW='<i class="fa fa-location-arrow"></i>',t.LOCK='<i class="fa fa-lock"></i>',t.LOCK_OPEN='<i class="fa fa-lock-open"></i>',t.LONG_ARROW_ALT_DOWN='<i class="fa fa-long-arrow-alt-down"></i>',t.LONG_ARROW_ALT_LEFT='<i class="fa fa-long-arrow-alt-left"></i>',t.LONG_ARROW_ALT_RIGHT='<i class="fa fa-long-arrow-alt-right"></i>',t.LONG_ARROW_ALT_UP='<i class="fa fa-long-arrow-alt-up"></i>',t.LOW_VISION='<i class="fa fa-low-vision"></i>',t.LUGGAGE_CART='<i class="fa fa-luggage-cart"></i>',t.LUNGS='<i class="fa fa-lungs"></i>',t.LUNGS_VIRUS='<i class="fa fa-lungs-virus"></i>',t.LYFT='<i class="fa fa-lyft"></i>',t.MAGENTO='<i class="fa fa-magento"></i>',t.MAGIC='<i class="fa fa-magic"></i>',t.MAGNET='<i class="fa fa-magnet"></i>',t.MAILCHIMP='<i class="fa fa-mailchimp"></i>',t.MAIL_BULK='<i class="fa fa-mail-bulk"></i>',t.MALE='<i class="fa fa-male"></i>',t.MANDALORIAN='<i class="fa fa-mandalorian"></i>',t.MAP='<i class="fa fa-map"></i>',t.MAP_MARKED='<i class="fa fa-map-marked"></i>';t.MAP_MARKED_ALT='<i class="fa fa-map-marked-alt"></i>',t.MAP_MARKER='<i class="fa fa-map-marker"></i>',t.MAP_MARKER_ALT='<i class="fa fa-map-marker-alt"></i>',t.MAP_PIN='<i class="fa fa-map-pin"></i>',t.MAP_SIGNS='<i class="fa fa-map-signs"></i>',t.MARKDOWN='<i class="fa fa-markdown"></i>',t.MARKER='<i class="fa fa-marker"></i>',t.MARS='<i class="fa fa-mars"></i>',t.MARS_DOUBLE='<i class="fa fa-mars-double"></i>',t.MARS_STROKE='<i class="fa fa-mars-stroke"></i>',t.MARS_STROKE_H='<i class="fa fa-mars-stroke-h"></i>',t.MARS_STROKE_V='<i class="fa fa-mars-stroke-v"></i>',t.MASK='<i class="fa fa-mask"></i>',t.MASTODON='<i class="fa fa-mastodon"></i>',t.MAXCDN='<i class="fa fa-maxcdn"></i>',t.MDB='<i class="fa fa-mdb"></i>',t.MEDAL='<i class="fa fa-medal"></i>',t.MEDAPPS='<i class="fa fa-medapps"></i>',t.MEDIUM='<i class="fa fa-medium"></i>',t.MEDIUM_M='<i class="fa fa-medium-m"></i>',t.MEDKIT='<i class="fa fa-medkit"></i>',t.MEDRT='<i class="fa fa-medrt"></i>',t.MEETUP='<i class="fa fa-meetup"></i>',t.MEGAPORT='<i class="fa fa-megaport"></i>',t.MEH='<i class="fa fa-meh"></i>',t.MEH_BLANK='<i class="fa fa-meh-blank"></i>',t.MEH_ROLLING_EYES='<i class="fa fa-meh-rolling-eyes"></i>',t.MEMORY='<i class="fa fa-memory"></i>',t.MENDELEY='<i class="fa fa-mendeley"></i>',t.MENORAH='<i class="fa fa-menorah"></i>',t.MERCURY='<i class="fa fa-mercury"></i>',t.METEOR='<i class="fa fa-meteor"></i>',t.MICROBLOG='<i class="fa fa-microblog"></i>',t.MICROCHIP='<i class="fa fa-microchip"></i>',t.MICROPHONE='<i class="fa fa-microphone"></i>',t.MICROPHONE_ALT='<i class="fa fa-microphone-alt"></i>',t.MICROPHONE_ALT_SLASH='<i class="fa fa-microphone-alt-slash"></i>',t.MICROPHONE_SLASH='<i class="fa fa-microphone-slash"></i>',t.MICROSCOPE='<i class="fa fa-microscope"></i>',t.MICROSOFT='<i class="fa fa-microsoft"></i>',t.MINUS='<i class="fa fa-minus"></i>',t.MINUS_CIRCLE='<i class="fa fa-minus-circle"></i>',t.MINUS_SQUARE='<i class="fa fa-minus-square"></i>',t.MITTEN='<i class="fa fa-mitten"></i>',t.MIX='<i class="fa fa-mix"></i>',t.MIXCLOUD='<i class="fa fa-mixcloud"></i>',t.MIXER='<i class="fa fa-mixer"></i>',t.MIZUNI='<i class="fa fa-mizuni"></i>',t.MOBILE='<i class="fa fa-mobile"></i>',t.MOBILE_ALT='<i class="fa fa-mobile-alt"></i>',t.MODX='<i class="fa fa-modx"></i>',t.MONERO='<i class="fa fa-monero"></i>',t.MONEY_BILL='<i class="fa fa-money-bill"></i>',t.MONEY_BILL_ALT='<i class="fa fa-money-bill-alt"></i>',t.MONEY_BILL_WAVE='<i class="fa fa-money-bill-wave"></i>',t.MONEY_BILL_WAVE_ALT='<i class="fa fa-money-bill-wave-alt"></i>',t.MONEY_CHECK='<i class="fa fa-money-check"></i>',t.MONEY_CHECK_ALT='<i class="fa fa-money-check-alt"></i>',t.MONUMENT='<i class="fa fa-monument"></i>',t.MOON='<i class="fa fa-moon"></i>',t.MORTAR_PESTLE='<i class="fa fa-mortar-pestle"></i>',t.MOSQUE='<i class="fa fa-mosque"></i>',t.MOTORCYCLE='<i class="fa fa-motorcycle"></i>',t.MOUNTAIN='<i class="fa fa-mountain"></i>',t.MOUSE='<i class="fa fa-mouse"></i>',t.MOUSE_POINTER='<i class="fa fa-mouse-pointer"></i>',t.MUG_HOT='<i class="fa fa-mug-hot"></i>',t.MUSIC='<i class="fa fa-music"></i>',t.NAPSTER='<i class="fa fa-napster"></i>',t.NEOS='<i class="fa fa-neos"></i>',t.NETWORK_WIRED='<i class="fa fa-network-wired"></i>',t.NEUTER='<i class="fa fa-neuter"></i>',t.NEWSPAPER='<i class="fa fa-newspaper"></i>',t.NIMBLR='<i class="fa fa-nimblr"></i>',t.NODE='<i class="fa fa-node"></i>',t.NODE_JS='<i class="fa fa-node-js"></i>',t.NOTES_MEDICAL='<i class="fa fa-notes-medical"></i>',t.NOT_EQUAL='<i class="fa fa-not-equal"></i>',t.NPM='<i class="fa fa-npm"></i>',t.NS8='<i class="fa fa-ns8"></i>',t.NUTRITIONIX='<i class="fa fa-nutritionix"></i>',t.OBJECT_GROUP='<i class="fa fa-object-group"></i>',t.OBJECT_UNGROUP='<i class="fa fa-object-ungroup"></i>',t.OCTOPUS_DEPLOY='<i class="fa fa-octopus-deploy"></i>',t.ODNOKLASSNIKI='<i class="fa fa-odnoklassniki"></i>',t.ODNOKLASSNIKI_SQUARE='<i class="fa fa-odnoklassniki-square"></i>',t.OIL_CAN='<i class="fa fa-oil-can"></i>',t.OLD_REPUBLIC='<i class="fa fa-old-republic"></i>',t.OM='<i class="fa fa-om"></i>',t.OPENCART='<i class="fa fa-opencart"></i>',t.OPENID='<i class="fa fa-openid"></i>',t.OPERA='<i class="fa fa-opera"></i>',t.OPTIN_MONSTER='<i class="fa fa-optin-monster"></i>',t.ORCID='<i class="fa fa-orcid"></i>',t.OSI='<i class="fa fa-osi"></i>',t.OTTER='<i class="fa fa-otter"></i>',t.OUTDENT='<i class="fa fa-outdent"></i>',t.PAGE4='<i class="fa fa-page4"></i>',t.PAGELINES='<i class="fa fa-pagelines"></i>',t.PAGER='<i class="fa fa-pager"></i>',t.PAINT_BRUSH='<i class="fa fa-paint-brush"></i>',t.PAINT_ROLLER='<i class="fa fa-paint-roller"></i>',t.PALETTE='<i class="fa fa-palette"></i>',t.PALFED='<i class="fa fa-palfed"></i>',t.PALLET='<i class="fa fa-pallet"></i>',t.PAPERCLIP='<i class="fa fa-paperclip"></i>',t.PAPER_PLANE='<i class="fa fa-paper-plane"></i>',t.PARACHUTE_BOX='<i class="fa fa-parachute-box"></i>',t.PARAGRAPH='<i class="fa fa-paragraph"></i>',t.PARKING='<i class="fa fa-parking"></i>',t.PASSPORT='<i class="fa fa-passport"></i>',t.PASTAFARIANISM='<i class="fa fa-pastafarianism"></i>',t.PASTE='<i class="fa fa-paste"></i>',t.PATREON='<i class="fa fa-patreon"></i>',t.PAUSE='<i class="fa fa-pause"></i>',t.PAUSE_CIRCLE='<i class="fa fa-pause-circle"></i>',t.PAW='<i class="fa fa-paw"></i>',t.PAYPAL='<i class="fa fa-paypal"></i>',t.PEACE='<i class="fa fa-peace"></i>',t.PEN='<i class="fa fa-pen"></i>',t.PENCIL_ALT='<i class="fa fa-pencil-alt"></i>',t.PENCIL_RULER='<i class="fa fa-pencil-ruler"></i>',t.PENNY_ARCADE='<i class="fa fa-penny-arcade"></i>',t.PEN_ALT='<i class="fa fa-pen-alt"></i>',t.PEN_FANCY='<i class="fa fa-pen-fancy"></i>',t.PEN_NIB='<i class="fa fa-pen-nib"></i>',t.PEN_SQUARE='<i class="fa fa-pen-square"></i>',t.PEOPLE_ARROWS='<i class="fa fa-people-arrows"></i>',t.PEOPLE_CARRY='<i class="fa fa-people-carry"></i>',t.PEPPER_HOT='<i class="fa fa-pepper-hot"></i>',t.PERBYTE='<i class="fa fa-perbyte"></i>',t.PERCENT='<i class="fa fa-percent"></i>',t.PERCENTAGE='<i class="fa fa-percentage"></i>',t.PERISCOPE='<i class="fa fa-periscope"></i>',t.PERSON_BOOTH='<i class="fa fa-person-booth"></i>',t.PHABRICATOR='<i class="fa fa-phabricator"></i>',t.PHOENIX_FRAMEWORK='<i class="fa fa-phoenix-framework"></i>',t.PHOENIX_SQUADRON='<i class="fa fa-phoenix-squadron"></i>',t.PHONE='<i class="fa fa-phone"></i>',t.PHONE_ALT='<i class="fa fa-phone-alt"></i>',t.PHONE_SLASH='<i class="fa fa-phone-slash"></i>',t.PHONE_SQUARE='<i class="fa fa-phone-square"></i>',t.PHONE_SQUARE_ALT='<i class="fa fa-phone-square-alt"></i>',t.PHONE_VOLUME='<i class="fa fa-phone-volume"></i>',t.PHOTO_VIDEO='<i class="fa fa-photo-video"></i>',t.PHP='<i class="fa fa-php"></i>',t.PIED_PIPER='<i class="fa fa-pied-piper"></i>',t.PIED_PIPER_ALT='<i class="fa fa-pied-piper-alt"></i>',t.PIED_PIPER_HAT='<i class="fa fa-pied-piper-hat"></i>',t.PIED_PIPER_PP='<i class="fa fa-pied-piper-pp"></i>',t.PIED_PIPER_SQUARE='<i class="fa fa-pied-piper-square"></i>',t.PIGGY_BANK='<i class="fa fa-piggy-bank"></i>',t.PILLS='<i class="fa fa-pills"></i>',t.PINTEREST='<i class="fa fa-pinterest"></i>',t.PINTEREST_P='<i class="fa fa-pinterest-p"></i>',t.PINTEREST_SQUARE='<i class="fa fa-pinterest-square"></i>',t.PIZZA_SLICE='<i class="fa fa-pizza-slice"></i>',t.PLACE_OF_WORSHIP='<i class="fa fa-place-of-worship"></i>',t.PLANE='<i class="fa fa-plane"></i>',t.PLANE_ARRIVAL='<i class="fa fa-plane-arrival"></i>',t.PLANE_DEPARTURE='<i class="fa fa-plane-departure"></i>',t.PLANE_SLASH='<i class="fa fa-plane-slash"></i>',t.PLAY='<i class="fa fa-play"></i>',t.PLAYSTATION='<i class="fa fa-playstation"></i>',t.PLAY_CIRCLE='<i class="fa fa-play-circle"></i>',t.PLUG='<i class="fa fa-plug"></i>',t.PLUS='<i class="fa fa-plus"></i>',t.PLUS_CIRCLE='<i class="fa fa-plus-circle"></i>',t.PLUS_SQUARE='<i class="fa fa-plus-square"></i>',t.PODCAST='<i class="fa fa-podcast"></i>',t.POLL='<i class="fa fa-poll"></i>',t.POLL_H='<i class="fa fa-poll-h"></i>',t.POO='<i class="fa fa-poo"></i>',t.POOP='<i class="fa fa-poop"></i>',t.POO_STORM='<i class="fa fa-poo-storm"></i>',t.PORTRAIT='<i class="fa fa-portrait"></i>',t.POUND_SIGN='<i class="fa fa-pound-sign"></i>',t.POWER_OFF='<i class="fa fa-power-off"></i>',t.PRAY='<i class="fa fa-pray"></i>',t.PRAYING_HANDS='<i class="fa fa-praying-hands"></i>',t.PRESCRIPTION='<i class="fa fa-prescription"></i>',t.PRESCRIPTION_BOTTLE='<i class="fa fa-prescription-bottle"></i>',t.PRESCRIPTION_BOTTLE_ALT='<i class="fa fa-prescription-bottle-alt"></i>',t.PRINT='<i class="fa fa-print"></i>',t.PROCEDURES='<i class="fa fa-procedures"></i>',t.PRODUCT_HUNT='<i class="fa fa-product-hunt"></i>',t.PROJECT_DIAGRAM='<i class="fa fa-project-diagram"></i>',t.PUMP_MEDICAL='<i class="fa fa-pump-medical"></i>',t.PUMP_SOAP='<i class="fa fa-pump-soap"></i>',t.PUSHED='<i class="fa fa-pushed"></i>',t.PUZZLE_PIECE='<i class="fa fa-puzzle-piece"></i>',t.PYTHON='<i class="fa fa-python"></i>',t.QQ='<i class="fa fa-qq"></i>',t.QRCODE='<i class="fa fa-qrcode"></i>',t.QUESTION='<i class="fa fa-question"></i>',t.QUESTION_CIRCLE='<i class="fa fa-question-circle"></i>',t.QUIDDITCH='<i class="fa fa-quidditch"></i>',t.QUINSCAPE='<i class="fa fa-quinscape"></i>',t.QUORA='<i class="fa fa-quora"></i>',t.QUOTE_LEFT='<i class="fa fa-quote-left"></i>',t.QUOTE_RIGHT='<i class="fa fa-quote-right"></i>',t.QURAN='<i class="fa fa-quran"></i>',t.RADIATION='<i class="fa fa-radiation"></i>',t.RADIATION_ALT='<i class="fa fa-radiation-alt"></i>',t.RAINBOW='<i class="fa fa-rainbow"></i>',t.RANDOM='<i class="fa fa-random"></i>',t.RASPBERRY_PI='<i class="fa fa-raspberry-pi"></i>',t.RAVELRY='<i class="fa fa-ravelry"></i>',t.REACT='<i class="fa fa-react"></i>',t.REACTEUROPE='<i class="fa fa-reacteurope"></i>',t.README='<i class="fa fa-readme"></i>',t.REBEL='<i class="fa fa-rebel"></i>',t.RECEIPT='<i class="fa fa-receipt"></i>',t.RECORD_VINYL='<i class="fa fa-record-vinyl"></i>',t.RECYCLE='<i class="fa fa-recycle"></i>',t.REDDIT='<i class="fa fa-reddit"></i>',t.REDDIT_ALIEN='<i class="fa fa-reddit-alien"></i>',t.REDDIT_SQUARE='<i class="fa fa-reddit-square"></i>',t.REDHAT='<i class="fa fa-redhat"></i>',t.REDO='<i class="fa fa-redo"></i>',t.REDO_ALT='<i class="fa fa-redo-alt"></i>',t.RED_RIVER='<i class="fa fa-red-river"></i>',t.REGISTERED='<i class="fa fa-registered"></i>',t.REMOVE_FORMAT='<i class="fa fa-remove-format"></i>',t.RENREN='<i class="fa fa-renren"></i>',t.REPLY='<i class="fa fa-reply"></i>',t.REPLYD='<i class="fa fa-replyd"></i>',t.REPLY_ALL='<i class="fa fa-reply-all"></i>',t.REPUBLICAN='<i class="fa fa-republican"></i>',t.RESEARCHGATE='<i class="fa fa-researchgate"></i>',t.RESOLVING='<i class="fa fa-resolving"></i>',t.RESTROOM='<i class="fa fa-restroom"></i>',t.RETWEET='<i class="fa fa-retweet"></i>',t.REV='<i class="fa fa-rev"></i>',t.RIBBON='<i class="fa fa-ribbon"></i>',t.RING='<i class="fa fa-ring"></i>',t.ROAD='<i class="fa fa-road"></i>',t.ROBOT='<i class="fa fa-robot"></i>',t.ROCKET='<i class="fa fa-rocket"></i>',t.ROCKETCHAT='<i class="fa fa-rocketchat"></i>',t.ROCKRMS='<i class="fa fa-rockrms"></i>',t.ROUTE='<i class="fa fa-route"></i>',t.RSS='<i class="fa fa-rss"></i>',t.RSS_SQUARE='<i class="fa fa-rss-square"></i>',t.RUBLE_SIGN='<i class="fa fa-ruble-sign"></i>',t.RULER='<i class="fa fa-ruler"></i>',t.RULER_COMBINED='<i class="fa fa-ruler-combined"></i>',t.RULER_HORIZONTAL='<i class="fa fa-ruler-horizontal"></i>',t.RULER_VERTICAL='<i class="fa fa-ruler-vertical"></i>',t.RUNNING='<i class="fa fa-running"></i>',t.RUPEE_SIGN='<i class="fa fa-rupee-sign"></i>',t.RUST='<i class="fa fa-rust"></i>',t.R_PROJECT='<i class="fa fa-r-project"></i>',t.SAD_CRY='<i class="fa fa-sad-cry"></i>',t.SAD_TEAR='<i class="fa fa-sad-tear"></i>',t.SAFARI='<i class="fa fa-safari"></i>',t.SALESFORCE='<i class="fa fa-salesforce"></i>',t.SASS='<i class="fa fa-sass"></i>',t.SATELLITE='<i class="fa fa-satellite"></i>',t.SATELLITE_DISH='<i class="fa fa-satellite-dish"></i>',t.SAVE='<i class="fa fa-save"></i>',t.SCHLIX='<i class="fa fa-schlix"></i>',t.SCHOOL='<i class="fa fa-school"></i>',t.SCREWDRIVER='<i class="fa fa-screwdriver"></i>',t.SCRIBD='<i class="fa fa-scribd"></i>',t.SCROLL='<i class="fa fa-scroll"></i>',t.SD_CARD='<i class="fa fa-sd-card"></i>',t.SEARCH='<i class="fa fa-search"></i>',t.SEARCHENGIN='<i class="fa fa-searchengin"></i>',t.SEARCH_DOLLAR='<i class="fa fa-search-dollar"></i>',t.SEARCH_LOCATION='<i class="fa fa-search-location"></i>',t.SEARCH_MINUS='<i class="fa fa-search-minus"></i>',t.SEARCH_PLUS='<i class="fa fa-search-plus"></i>',t.SEEDLING='<i class="fa fa-seedling"></i>',t.SELLCAST='<i class="fa fa-sellcast"></i>',t.SELLSY='<i class="fa fa-sellsy"></i>',t.SERVER='<i class="fa fa-server"></i>',t.SERVICESTACK='<i class="fa fa-servicestack"></i>',t.SHAPES='<i class="fa fa-shapes"></i>',t.SHARE='<i class="fa fa-share"></i>',t.SHARE_ALT='<i class="fa fa-share-alt"></i>',t.SHARE_ALT_SQUARE='<i class="fa fa-share-alt-square"></i>',t.SHARE_SQUARE='<i class="fa fa-share-square"></i>',t.SHEKEL_SIGN='<i class="fa fa-shekel-sign"></i>',t.SHIELD_ALT='<i class="fa fa-shield-alt"></i>',t.SHIELD_VIRUS='<i class="fa fa-shield-virus"></i>',t.SHIP='<i class="fa fa-ship"></i>',t.SHIPPING_FAST='<i class="fa fa-shipping-fast"></i>',t.SHIRTSINBULK='<i class="fa fa-shirtsinbulk"></i>',t.SHOE_PRINTS='<i class="fa fa-shoe-prints"></i>',t.SHOPIFY='<i class="fa fa-shopify"></i>',t.SHOPPING_BAG='<i class="fa fa-shopping-bag"></i>',t.SHOPPING_BASKET='<i class="fa fa-shopping-basket"></i>',t.SHOPPING_CART='<i class="fa fa-shopping-cart"></i>',t.SHOPWARE='<i class="fa fa-shopware"></i>',t.SHOWER='<i class="fa fa-shower"></i>',t.SHUTTLE_VAN='<i class="fa fa-shuttle-van"></i>',t.SIGN='<i class="fa fa-sign"></i>',t.SIGNAL='<i class="fa fa-signal"></i>',t.SIGNATURE='<i class="fa fa-signature"></i>',t.SIGN_IN_ALT='<i class="fa fa-sign-in-alt"></i>',t.SIGN_LANGUAGE='<i class="fa fa-sign-language"></i>',t.SIGN_OUT_ALT='<i class="fa fa-sign-out-alt"></i>',t.SIMPLYBUILT='<i class="fa fa-simplybuilt"></i>',t.SIM_CARD='<i class="fa fa-sim-card"></i>',t.SINK='<i class="fa fa-sink"></i>',t.SISTRIX='<i class="fa fa-sistrix"></i>',t.SITEMAP='<i class="fa fa-sitemap"></i>',t.SITH='<i class="fa fa-sith"></i>',t.SKATING='<i class="fa fa-skating"></i>',t.SKETCH='<i class="fa fa-sketch"></i>',t.SKIING='<i class="fa fa-skiing"></i>',t.SKIING_NORDIC='<i class="fa fa-skiing-nordic"></i>',t.SKULL='<i class="fa fa-skull"></i>',t.SKULL_CROSSBONES='<i class="fa fa-skull-crossbones"></i>',t.SKYATLAS='<i class="fa fa-skyatlas"></i>',t.SKYPE='<i class="fa fa-skype"></i>',t.SLACK='<i class="fa fa-slack"></i>',t.SLACK_HASH='<i class="fa fa-slack-hash"></i>',t.SLASH='<i class="fa fa-slash"></i>',t.SLEIGH='<i class="fa fa-sleigh"></i>',t.SLIDERS_H='<i class="fa fa-sliders-h"></i>',t.SLIDESHARE='<i class="fa fa-slideshare"></i>',t.SMILE='<i class="fa fa-smile"></i>',t.SMILE_BEAM='<i class="fa fa-smile-beam"></i>',t.SMILE_WINK='<i class="fa fa-smile-wink"></i>',t.SMOG='<i class="fa fa-smog"></i>',t.SMOKING='<i class="fa fa-smoking"></i>',t.SMOKING_BAN='<i class="fa fa-smoking-ban"></i>',t.SMS='<i class="fa fa-sms"></i>',t.SNAPCHAT='<i class="fa fa-snapchat"></i>',t.SNAPCHAT_GHOST='<i class="fa fa-snapchat-ghost"></i>',t.SNAPCHAT_SQUARE='<i class="fa fa-snapchat-square"></i>',t.SNOWBOARDING='<i class="fa fa-snowboarding"></i>',t.SNOWFLAKE='<i class="fa fa-snowflake"></i>',t.SNOWMAN='<i class="fa fa-snowman"></i>',t.SNOWPLOW='<i class="fa fa-snowplow"></i>',t.SOAP='<i class="fa fa-soap"></i>',t.SOCKS='<i class="fa fa-socks"></i>',t.SOLAR_PANEL='<i class="fa fa-solar-panel"></i>',t.SORT='<i class="fa fa-sort"></i>',t.SORT_ALPHA_DOWN='<i class="fa fa-sort-alpha-down"></i>',t.SORT_ALPHA_DOWN_ALT='<i class="fa fa-sort-alpha-down-alt"></i>',t.SORT_ALPHA_UP='<i class="fa fa-sort-alpha-up"></i>',t.SORT_ALPHA_UP_ALT='<i class="fa fa-sort-alpha-up-alt"></i>',t.SORT_AMOUNT_DOWN='<i class="fa fa-sort-amount-down"></i>',t.SORT_AMOUNT_DOWN_ALT='<i class="fa fa-sort-amount-down-alt"></i>',t.SORT_AMOUNT_UP='<i class="fa fa-sort-amount-up"></i>',t.SORT_AMOUNT_UP_ALT='<i class="fa fa-sort-amount-up-alt"></i>',t.SORT_DOWN='<i class="fa fa-sort-down"></i>',t.SORT_NUMERIC_DOWN='<i class="fa fa-sort-numeric-down"></i>',t.SORT_NUMERIC_DOWN_ALT='<i class="fa fa-sort-numeric-down-alt"></i>',t.SORT_NUMERIC_UP='<i class="fa fa-sort-numeric-up"></i>',t.SORT_NUMERIC_UP_ALT='<i class="fa fa-sort-numeric-up-alt"></i>',t.SORT_UP='<i class="fa fa-sort-up"></i>',t.SOUNDCLOUD='<i class="fa fa-soundcloud"></i>',t.SOURCETREE='<i class="fa fa-sourcetree"></i>',t.SPA='<i class="fa fa-spa"></i>',t.SPACE_SHUTTLE='<i class="fa fa-space-shuttle"></i>',t.SPEAKAP='<i class="fa fa-speakap"></i>',t.SPEAKER_DECK='<i class="fa fa-speaker-deck"></i>',t.SPELL_CHECK='<i class="fa fa-spell-check"></i>',t.SPIDER='<i class="fa fa-spider"></i>',t.SPINNER='<i class="fa fa-spinner"></i>',t.SPLOTCH='<i class="fa fa-splotch"></i>',t.SPOTIFY='<i class="fa fa-spotify"></i>',t.SPRAY_CAN='<i class="fa fa-spray-can"></i>',t.SQUARE='<i class="fa fa-square"></i>',t.SQUARESPACE='<i class="fa fa-squarespace"></i>',t.SQUARE_FULL='<i class="fa fa-square-full"></i>',t.SQUARE_ROOT_ALT='<i class="fa fa-square-root-alt"></i>',t.STACKPATH='<i class="fa fa-stackpath"></i>',t.STACK_EXCHANGE='<i class="fa fa-stack-exchange"></i>',t.STACK_OVERFLOW='<i class="fa fa-stack-overflow"></i>',t.STAMP='<i class="fa fa-stamp"></i>',t.STAR='<i class="fa fa-star"></i>',t.STAR_AND_CRESCENT='<i class="fa fa-star-and-crescent"></i>',t.STAR_HALF='<i class="fa fa-star-half"></i>',t.STAR_HALF_ALT='<i class="fa fa-star-half-alt"></i>',t.STAR_OF_DAVID='<i class="fa fa-star-of-david"></i>',t.STAR_OF_LIFE='<i class="fa fa-star-of-life"></i>',t.STAYLINKED='<i class="fa fa-staylinked"></i>',t.STEAM='<i class="fa fa-steam"></i>',t.STEAM_SQUARE='<i class="fa fa-steam-square"></i>',t.STEAM_SYMBOL='<i class="fa fa-steam-symbol"></i>',t.STEP_BACKWARD='<i class="fa fa-step-backward"></i>',t.STEP_FORWARD='<i class="fa fa-step-forward"></i>',t.STETHOSCOPE='<i class="fa fa-stethoscope"></i>',t.STICKER_MULE='<i class="fa fa-sticker-mule"></i>',t.STICKY_NOTE='<i class="fa fa-sticky-note"></i>',t.STOP='<i class="fa fa-stop"></i>',t.STOPWATCH='<i class="fa fa-stopwatch"></i>',t.STOPWATCH_20='<i class="fa fa-stopwatch-20"></i>',t.STOP_CIRCLE='<i class="fa fa-stop-circle"></i>',t.STORE='<i class="fa fa-store"></i>',t.STORE_ALT='<i class="fa fa-store-alt"></i>',t.STORE_ALT_SLASH='<i class="fa fa-store-alt-slash"></i>',t.STORE_SLASH='<i class="fa fa-store-slash"></i>',t.STRAVA='<i class="fa fa-strava"></i>',t.STREAM='<i class="fa fa-stream"></i>',t.STREET_VIEW='<i class="fa fa-street-view"></i>',t.STRIKETHROUGH='<i class="fa fa-strikethrough"></i>',t.LINETHROUGH='<i class="fa fa-strikethrough"></i>',t.STRIPE='<i class="fa fa-stripe"></i>',t.STRIPE_S='<i class="fa fa-stripe-s"></i>',t.STROOPWAFEL='<i class="fa fa-stroopwafel"></i>',t.STUDIOVINARI='<i class="fa fa-studiovinari"></i>',t.STUMBLEUPON='<i class="fa fa-stumbleupon"></i>',t.STUMBLEUPON_CIRCLE='<i class="fa fa-stumbleupon-circle"></i>',t.SUBSCRIPT='<i class="fa fa-subscript"></i>',t.SUBWAY='<i class="fa fa-subway"></i>',t.SUITCASE='<i class="fa fa-suitcase"></i>',t.SUITCASE_ROLLING='<i class="fa fa-suitcase-rolling"></i>',t.SUN='<i class="fa fa-sun"></i>',t.SUPERPOWERS='<i class="fa fa-superpowers"></i>',t.SUPERSCRIPT='<i class="fa fa-superscript"></i>',t.SUPPLE='<i class="fa fa-supple"></i>',t.SURPRISE='<i class="fa fa-surprise"></i>',t.SUSE='<i class="fa fa-suse"></i>',t.SWATCHBOOK='<i class="fa fa-swatchbook"></i>',t.SWIFT='<i class="fa fa-swift"></i>',t.SWIMMER='<i class="fa fa-swimmer"></i>',t.SWIMMING_POOL='<i class="fa fa-swimming-pool"></i>',t.SYMFONY='<i class="fa fa-symfony"></i>',t.SYNAGOGUE='<i class="fa fa-synagogue"></i>',t.SYNC='<i class="fa fa-sync"></i>',t.SYNC_ALT='<i class="fa fa-sync-alt"></i>',t.SYRINGE='<i class="fa fa-syringe"></i>',t.TABLE='<i class="fa fa-table"></i>',t.TABLET='<i class="fa fa-tablet"></i>',t.TABLETS='<i class="fa fa-tablets"></i>',t.TABLET_ALT='<i class="fa fa-tablet-alt"></i>',t.TABLE_TENNIS='<i class="fa fa-table-tennis"></i>',t.TACHOMETER_ALT='<i class="fa fa-tachometer-alt"></i>',t.TAG='<i class="fa fa-tag"></i>',t.TAGS='<i class="fa fa-tags"></i>',t.TAPE='<i class="fa fa-tape"></i>',t.TASKS='<i class="fa fa-tasks"></i>',t.TAXI='<i class="fa fa-taxi"></i>',t.TEAMSPEAK='<i class="fa fa-teamspeak"></i>',t.TEETH='<i class="fa fa-teeth"></i>',t.TEETH_OPEN='<i class="fa fa-teeth-open"></i>',t.TELEGRAM='<i class="fa fa-telegram"></i>',t.TELEGRAM_PLANE='<i class="fa fa-telegram-plane"></i>',t.TEMPERATURE_HIGH='<i class="fa fa-temperature-high"></i>',t.TEMPERATURE_LOW='<i class="fa fa-temperature-low"></i>',t.TENCENT_WEIBO='<i class="fa fa-tencent-weibo"></i>',t.TENGE='<i class="fa fa-tenge"></i>',t.TERMINAL='<i class="fa fa-terminal"></i>',t.TEXT_HEIGHT='<i class="fa fa-text-height"></i>',t.TEXT_WIDTH='<i class="fa fa-text-width"></i>',t.TH='<i class="fa fa-th"></i>',t.THEATER_MASKS='<i class="fa fa-theater-masks"></i>',t.THEMECO='<i class="fa fa-themeco"></i>',t.THEMEISLE='<i class="fa fa-themeisle"></i>',t.THERMOMETER='<i class="fa fa-thermometer"></i>',t.THERMOMETER_EMPTY='<i class="fa fa-thermometer-empty"></i>',t.THERMOMETER_FULL='<i class="fa fa-thermometer-full"></i>',t.THERMOMETER_HALF='<i class="fa fa-thermometer-half"></i>',t.THERMOMETER_QUARTER='<i class="fa fa-thermometer-quarter"></i>',t.THERMOMETER_THREE_QUARTERS='<i class="fa fa-thermometer-three-quarters"></i>',t.THE_RED_YETI='<i class="fa fa-the-red-yeti"></i>',t.THINK_PEAKS='<i class="fa fa-think-peaks"></i>',t.THUMBS_DOWN='<i class="fa fa-thumbs-down"></i>',t.THUMBS_UP='<i class="fa fa-thumbs-up"></i>',t.THUMBTACK='<i class="fa fa-thumbtack"></i>',t.TH_LARGE='<i class="fa fa-th-large"></i>',t.TH_LIST='<i class="fa fa-th-list"></i>',t.TICKET_ALT='<i class="fa fa-ticket-alt"></i>',t.TIKTOK='<i class="fa fa-tiktok"></i>',t.TIMES='<i class="fa fa-times"></i>',t.TIMES_CIRCLE='<i class="fa fa-times-circle"></i>',t.TINT='<i class="fa fa-tint"></i>',t.TINT_SLASH='<i class="fa fa-tint-slash"></i>',t.TIRED='<i class="fa fa-tired"></i>',t.TOGGLE_OFF='<i class="fa fa-toggle-off"></i>',t.TOGGLE_ON='<i class="fa fa-toggle-on"></i>',t.TOILET='<i class="fa fa-toilet"></i>',t.TOILET_PAPER='<i class="fa fa-toilet-paper"></i>',t.TOILET_PAPER_SLASH='<i class="fa fa-toilet-paper-slash"></i>',t.TOOLBOX='<i class="fa fa-toolbox"></i>',t.TOOLS='<i class="fa fa-tools"></i>',t.TOOTH='<i class="fa fa-tooth"></i>',t.TORAH='<i class="fa fa-torah"></i>',t.TORII_GATE='<i class="fa fa-torii-gate"></i>',t.TRACTOR='<i class="fa fa-tractor"></i>',t.TRADEMARK='<i class="fa fa-trademark"></i>',t.TRADE_FEDERATION='<i class="fa fa-trade-federation"></i>',t.TRAFFIC_LIGHT='<i class="fa fa-traffic-light"></i>',t.TRAILER='<i class="fa fa-trailer"></i>',t.TRAIN='<i class="fa fa-train"></i>',t.TRAM='<i class="fa fa-tram"></i>',t.TRANSGENDER='<i class="fa fa-transgender"></i>',t.TRANSGENDER_ALT='<i class="fa fa-transgender-alt"></i>',t.TRASH='<i class="fa fa-trash"></i>',t.TRASH_ALT='<i class="fa fa-trash-alt"></i>',t.TRASH_RESTORE='<i class="fa fa-trash-restore"></i>',t.TRASH_RESTORE_ALT='<i class="fa fa-trash-restore-alt"></i>',t.TREE='<i class="fa fa-tree"></i>',t.TRELLO='<i class="fa fa-trello"></i>',t.TRIPADVISOR='<i class="fa fa-tripadvisor"></i>',t.TROPHY='<i class="fa fa-trophy"></i>',t.TRUCK='<i class="fa fa-truck"></i>',t.TRUCK_LOADING='<i class="fa fa-truck-loading"></i>',t.TRUCK_MONSTER='<i class="fa fa-truck-monster"></i>',t.TRUCK_MOVING='<i class="fa fa-truck-moving"></i>',t.TRUCK_PICKUP='<i class="fa fa-truck-pickup"></i>',t.TSHIRT='<i class="fa fa-tshirt"></i>',t.TTY='<i class="fa fa-tty"></i>',t.TUMBLR='<i class="fa fa-tumblr"></i>',t.TUMBLR_SQUARE='<i class="fa fa-tumblr-square"></i>',t.TV='<i class="fa fa-tv"></i>',t.TWITCH='<i class="fa fa-twitch"></i>',t.TWITTER='<i class="fa fa-twitter"></i>',t.TWITTER_SQUARE='<i class="fa fa-twitter-square"></i>',t.TYPO3='<i class="fa fa-typo3"></i>',t.UBER='<i class="fa fa-uber"></i>',t.UBUNTU='<i class="fa fa-ubuntu"></i>',t.UIKIT='<i class="fa fa-uikit"></i>',t.UMBRACO='<i class="fa fa-umbraco"></i>',t.UMBRELLA='<i class="fa fa-umbrella"></i>',t.UMBRELLA_BEACH='<i class="fa fa-umbrella-beach"></i>',t.UNCHARTED='<i class="fa fa-uncharted"></i>',t.UNDERLINE='<i class="fa fa-underline"></i>',t.UNDO='<i class="fa fa-undo"></i>',t.UNDO_ALT='<i class="fa fa-undo-alt"></i>',t.UNIREGISTRY='<i class="fa fa-uniregistry"></i>',t.UNITY='<i class="fa fa-unity"></i>',t.UNIVERSAL_ACCESS='<i class="fa fa-universal-access"></i>',t.UNIVERSITY='<i class="fa fa-university"></i>',t.UNLINK='<i class="fa fa-unlink"></i>',t.UNLOCK='<i class="fa fa-unlock"></i>',t.UNLOCK_ALT='<i class="fa fa-unlock-alt"></i>',t.UNSPLASH='<i class="fa fa-unsplash"></i>',t.UNTAPPD='<i class="fa fa-untappd"></i>',t.UPLOAD='<i class="fa fa-upload"></i>',t.UPS='<i class="fa fa-ups"></i>',t.USB='<i class="fa fa-usb"></i>',t.USER='<i class="fa fa-user"></i>',t.USERS='<i class="fa fa-users"></i>',t.USERS_COG='<i class="fa fa-users-cog"></i>',t.USERS_SLASH='<i class="fa fa-users-slash"></i>',t.USER_ALT='<i class="fa fa-user-alt"></i>',t.USER_ALT_SLASH='<i class="fa fa-user-alt-slash"></i>',t.USER_ASTRONAUT='<i class="fa fa-user-astronaut"></i>',t.USER_CHECK='<i class="fa fa-user-check"></i>',t.USER_CIRCLE='<i class="fa fa-user-circle"></i>',t.USER_CLOCK='<i class="fa fa-user-clock"></i>',t.USER_COG='<i class="fa fa-user-cog"></i>',t.USER_EDIT='<i class="fa fa-user-edit"></i>',t.USER_FRIENDS='<i class="fa fa-user-friends"></i>',t.USER_GRADUATE='<i class="fa fa-user-graduate"></i>',t.USER_INJURED='<i class="fa fa-user-injured"></i>',t.USER_LOCK='<i class="fa fa-user-lock"></i>',t.USER_MD='<i class="fa fa-user-md"></i>',t.USER_MINUS='<i class="fa fa-user-minus"></i>',t.USER_NINJA='<i class="fa fa-user-ninja"></i>',t.USER_NURSE='<i class="fa fa-user-nurse"></i>',t.USER_PLUS='<i class="fa fa-user-plus"></i>',t.USER_SECRET='<i class="fa fa-user-secret"></i>',t.USER_SHIELD='<i class="fa fa-user-shield"></i>',t.USER_SLASH='<i class="fa fa-user-slash"></i>',t.USER_TAG='<i class="fa fa-user-tag"></i>',t.USER_TIE='<i class="fa fa-user-tie"></i>',t.USER_TIMES='<i class="fa fa-user-times"></i>',t.USPS='<i class="fa fa-usps"></i>',t.USSUNNAH='<i class="fa fa-ussunnah"></i>',t.UTENSILS='<i class="fa fa-utensils"></i>',t.UTENSIL_SPOON='<i class="fa fa-utensil-spoon"></i>',t.VAADIN='<i class="fa fa-vaadin"></i>',t.VECTOR_SQUARE='<i class="fa fa-vector-square"></i>',t.VENUS='<i class="fa fa-venus"></i>',t.VENUS_DOUBLE='<i class="fa fa-venus-double"></i>',t.VENUS_MARS='<i class="fa fa-venus-mars"></i>',t.VEST='<i class="fa fa-vest"></i>',t.VEST_PATCHES='<i class="fa fa-vest-patches"></i>',t.VIACOIN='<i class="fa fa-viacoin"></i>',t.VIADEO='<i class="fa fa-viadeo"></i>',t.VIADEO_SQUARE='<i class="fa fa-viadeo-square"></i>',t.VIAL='<i class="fa fa-vial"></i>',t.VIALS='<i class="fa fa-vials"></i>',t.VIBER='<i class="fa fa-viber"></i>',t.VIDEO='<i class="fa fa-video"></i>',t.VIDEO_SLASH='<i class="fa fa-video-slash"></i>',t.VIHARA='<i class="fa fa-vihara"></i>',t.VIMEO='<i class="fa fa-vimeo"></i>',t.VIMEO_SQUARE='<i class="fa fa-vimeo-square"></i>',t.VIMEO_V='<i class="fa fa-vimeo-v"></i>',t.VINE='<i class="fa fa-vine"></i>',t.VIRUS='<i class="fa fa-virus"></i>',t.VIRUSES='<i class="fa fa-viruses"></i>',t.VIRUS_SLASH='<i class="fa fa-virus-slash"></i>',t.VK='<i class="fa fa-vk"></i>',t.VNV='<i class="fa fa-vnv"></i>',t.VOICEMAIL='<i class="fa fa-voicemail"></i>',t.VOLLEYBALL_BALL='<i class="fa fa-volleyball-ball"></i>',t.VOLUME_DOWN='<i class="fa fa-volume-down"></i>',t.VOLUME_MUTE='<i class="fa fa-volume-mute"></i>',t.VOLUME_OFF='<i class="fa fa-volume-off"></i>',t.VOLUME_UP='<i class="fa fa-volume-up"></i>',t.VOTE_YEA='<i class="fa fa-vote-yea"></i>',t.VR_CARDBOARD='<i class="fa fa-vr-cardboard"></i>',t.VUEJS='<i class="fa fa-vuejs"></i>',t.WALKING='<i class="fa fa-walking"></i>',t.WALLET='<i class="fa fa-wallet"></i>',t.WAREHOUSE='<i class="fa fa-warehouse"></i>',t.WATCHMAN_MONITORING='<i class="fa fa-watchman-monitoring"></i>',t.WATER='<i class="fa fa-water"></i>',t.WAVE_SQUARE='<i class="fa fa-wave-square"></i>',t.WAZE='<i class="fa fa-waze"></i>',t.WEEBLY='<i class="fa fa-weebly"></i>',t.WEIBO='<i class="fa fa-weibo"></i>',t.WEIGHT='<i class="fa fa-weight"></i>',t.WEIGHT_HANGING='<i class="fa fa-weight-hanging"></i>',t.WEIXIN='<i class="fa fa-weixin"></i>',t.WHATSAPP='<i class="fa fa-whatsapp"></i>',t.WHATSAPP_SQUARE='<i class="fa fa-whatsapp-square"></i>',t.WHEELCHAIR='<i class="fa fa-wheelchair"></i>',t.WHMCS='<i class="fa fa-whmcs"></i>',t.WIFI='<i class="fa fa-wifi"></i>',t.WIKIPEDIA_W='<i class="fa fa-wikipedia-w"></i>',t.WIND='<i class="fa fa-wind"></i>',t.WINDOWS='<i class="fa fa-windows"></i>',t.WINDOW_CLOSE='<i class="fa fa-window-close"></i>',t.WINDOW_MAXIMIZE='<i class="fa fa-window-maximize"></i>',t.WINDOW_MINIMIZE='<i class="fa fa-window-minimize"></i>',t.WINDOW_RESTORE='<i class="fa fa-window-restore"></i>',t.WINE_BOTTLE='<i class="fa fa-wine-bottle"></i>',t.WINE_GLASS='<i class="fa fa-wine-glass"></i>',t.WINE_GLASS_ALT='<i class="fa fa-wine-glass-alt"></i>',t.WIX='<i class="fa fa-wix"></i>',t.WIZARDS_OF_THE_COAST='<i class="fa fa-wizards-of-the-coast"></i>',t.WODU='<i class="fa fa-wodu"></i>',t.WOLF_PACK_BATTALION='<i class="fa fa-wolf-pack-battalion"></i>',t.WON_SIGN='<i class="fa fa-won-sign"></i>',t.WORDPRESS='<i class="fa fa-wordpress"></i>',t.WORDPRESS_SIMPLE='<i class="fa fa-wordpress-simple"></i>',t.WPBEGINNER='<i class="fa fa-wpbeginner"></i>',t.WPEXPLORER='<i class="fa fa-wpexplorer"></i>',t.WPFORMS='<i class="fa fa-wpforms"></i>',t.WPRESSR='<i class="fa fa-wpressr"></i>',t.WRENCH='<i class="fa fa-wrench"></i>',t.XBOX='<i class="fa fa-xbox"></i>',t.XING='<i class="fa fa-xing"></i>',t.XING_SQUARE='<i class="fa fa-xing-square"></i>',t.X_RAY='<i class="fa fa-x-ray"></i>',t.YAHOO='<i class="fa fa-yahoo"></i>',t.YAMMER='<i class="fa fa-yammer"></i>',t.YANDEX='<i class="fa fa-yandex"></i>',t.YANDEX_INTERNATIONAL='<i class="fa fa-yandex-international"></i>',t.YARN='<i class="fa fa-yarn"></i>',t.YELP='<i class="fa fa-yelp"></i>',t.YEN_SIGN='<i class="fa fa-yen-sign"></i>',t.YIN_YANG='<i class="fa fa-yin-yang"></i>',t.YOAST='<i class="fa fa-yoast"></i>',t.YOUTUBE='<i class="fa fa-youtube"></i>',t.YOUTUBE_SQUARE='<i class="fa fa-youtube-square"></i>',t.Y_COMBINATOR='<i class="fa fa-y-combinator"></i>',t.ZHIHU='<i class="fa fa-zhihu"></i>',t._500PX='<i class="fa fa-500px"></i>'}(Icon||(Icon={})),function(t){t[t.Mode2D=0]="Mode2D",t[t.Mode3D=1]="Mode3D"}(Mode||(Mode={}));var ImageType,Spinner=function(t){function e(i){var n=t.call(this,i)||this;n.bar=document.createElement(Constants.DIV),n.bar.style.zIndex="1000",n.bar.style.border=e.border+Constants.PX+" "+Constants.SOLID+" "+Color.LIGHT_GRAY.toHex(),n.bar.style.borderTop=e.border+Constants.PX+" "+Constants.SOLID+" "+Color.DARK_GRAY.toHex(),n.bar.style.borderRadius=e.borderRadius,n.bar.style.width=e.size+Constants.PX,n.bar.style.height=e.size+Constants.PX,n.bar.style.animation=e.animation,n.bar.style.position=Constants.ABSOLUTE;e.size;return n.bar.style.left="50%",n.bar.style.top="50%",n.container.appendChild(n.bar),n.style=document.createElement(Constants.STYLE),n.style.type=Constants.TEXT_CSS,n.style.innerHTML=e.keyframes,document.body.appendChild(n.style),n.hide(),n}return __extends(e,t),e.prototype.update=function(){},e.prototype.getElement=function(){return this.bar},e.prototype.show=function(){t.prototype.show.call(this),this.update()},e.size=64,e.border=6,e.speed=1,e.keyframes="@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}",e.animation="spin "+e.speed+"s linear infinite",e.borderRadius="50%",e}(View),Utils=function(){function t(){}return t.logMethodName=function(){if(Constructor.settings.debug){var t={stack:""},e="";if(!Error.captureStackTrace)return;Error.captureStackTrace(t,this.logMethodName);var i=!0;t.stack.split("\n").forEach(function(t){(t.includes("Constructor.")||t.includes("Side2D.")||t.includes("Element2D."))&&t.split(" ").forEach(function(t){(t.startsWith("Constructor.")||t.startsWith("Side2D.")||t.startsWith("Element2D."))&&(i?(e+=t+"\n",i=!1):e+="< "+t+"\n")})}),""!=e&&(e="-----------------------------------------------\n"+e+"-----------------------------------------------\n",console.log(e))}},t.randomInt=function(t){return Math.floor(Math.random()*t)},t.loadJSON=function(t,e){var i=new XMLHttpRequest;i.overrideMimeType(Constants.APPLICATION_JSON),i.open(Constants.GET,t,!0),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(i.responseText)},i.send(null)},t.arrayMove=function(t,e,i){var n=t[e];t.splice(e,1),t.splice(i,0,n)},t.arrayMoveToStart=function(t,e){this.arrayMove(t,e,0)},t.arrayMoveToEnd=function(t,e){this.arrayMove(t,e,t.length-1)},t.div=function(t){var e=document.createElement(Constants.DIV);return t&&(e.innerText=t),e},t.input=function(){return document.createElement(Constants.INPUT)},t.isFullscreen=function(){return window.innerWidth==screen.width&&window.innerHeight==screen.height},t.isCompact=function(){return window.innerWidth<800},t.isIos=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},t.toUrlParameters=function(t){var e=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");return console.log(e),e},t}(),Dimensions=function(){return function(t,e){this.width=t,this.height=e}}(),Element2D=function(t){function e(e,i){var n=t.call(this)||this;if(n.type=e,n.side=i,e===ElementType.IMAGE)n.object=new e.nativeType;else{var r=Constructor.settings.elementDefaults[e.getNativeTypeName()];e.nativeType.fromObject(r,function(t){n.object=t,n.setOptions(n.object),n.side&&n.side.canvas&&(n.object.dirty=!0,Constructor.instance.getActiveSide().canvas.requestRenderAll()),Constructor.instance.preview&&Constructor.instance.preview.render()})}return n.setOptions(n.object),n}return __extends(e,t),e.prototype.setOptions=function(t){var i=this;t&&(t.on(Constants.ADDED,function(){i.calculateGuides()}),t.on(Constants.MODIFIED,function(){i.calculateGuides(),i.changed()}),t.on(Constants.SCALING,function(t){}),t.on(Constants.MOVING,function(){i.fitIntoMargins(),i.snapPosition()}),t.on(Constants.ROTATING,function(){return i.snapRotation()}),t.on(Constants.SELECTED,function(){i.side.selection=i,Constructor.instance.onSelectHandler(i),i.changed()}),t.on(Constants.DESELECTED,function(){Constructor.instance.onDeselectHandler(i),i.side.selection=null,i.changed()}),t.on(Constants.REMOVED,function(){i.side.selection=null}),t.setOptions(e.commonDefaults))},e.prototype.randomizePosition=function(){var t=this.side.canvas.getWidth()/this.side.getZoom(),e=this.side.canvas.getHeight()/this.side.getZoom(),i=Math.max(t/2*Math.random(),.1*t),n=Math.max(e/2*Math.random(),.1*e);this.object.left=(t-i)*Math.random()+i/2,this.object.top=(e-n)*Math.random()+n/2,this.fitIntoMargins(),this.object.setCoords(),this.side.canvas.renderAll()},e.prototype.offset=function(){this.object.left=this.object.left+Constructor.settings.duplicateOffset,this.object.top=this.object.top+Constructor.settings.duplicateOffset,this.object.setCoords(),this.side.canvas.renderAll()},e.prototype.getColor=function(){return new Color(this.object.fill)},e.prototype.setColor=function(t){if(this.type!=ElementType.IMAGE){typeof t===Constants.STRING&&(t=new Color(t));var e=t;this.object.fill=e.toRgba(),this.object.dirty=!0,this.side.canvas.renderAll(),setTimeout(function(){Constructor.instance.getActiveSide().canvas.renderAll()},100),this.side.saveState()}},e.prototype.getAlpha=function(){return this.object.opacity},e.prototype.setAlpha=function(t){this.object.opacity=t,this.side.saveState(),this.side.canvas.renderAll()},e.prototype.setShadow=function(t){if(t&&0!=t){var e={color:Color.TRANSPARENT_BLACK.toRgba(),includeDefaultValues:!0};this.object.setShadow(new fabric.Shadow(e));var i=this.object.shadow;i.offsetX=t,i.offsetY=t,i.blur=t}else this.object.setShadow(null);this.side.saveState(),this.side.canvas.renderAll()},e.prototype.getShadow=function(){var t=this.object.shadow;return t?t.offsetX:0},e.prototype.setPosition=function(t,e){this.object.left=t,this.object.top=e,this.object.setCoords(),this.object.dirty=!0,this.side.canvas.requestRenderAll(),this.side.saveState()},e.prototype.setFontFamily=function(t,e){if(this.isText()){var i=this;new FontFaceObserver(t).load(FontFamilyButton.charset).then(function(){i.object.set("fontFamily",t),i.side.canvas.requestRenderAll(),i.changed(),i.side.saveState()}).catch(function(t){console.log(t)})}},e.prototype.isEditing=function(){return this.type==ElementType.TEXT&&this.object.isEditing},e.prototype.getText=function(){return this.isText()?this.object.text:null},e.prototype.setText=function(t){this.isText()&&(this.object.text=t,this.side.canvas.renderAll())},e.prototype.getFontFamily=function(){return this.isText()?this.object.fontFamily:null},e.prototype.setFontSize=function(t){this.isText()&&(this.object.fontSize=t,this.object.dirty=!0,this.side.canvas.requestRenderAll(),Constructor.instance.changed(),this.changed())},e.prototype.getFontSize=function(){return this.isText()?this.object.fontSize:null},e.prototype.setItalic=function(t){this.isText()&&(this.object.fontStyle=t?Constants.ITALIC:Constants.NORMAL,this.object.dirty=!0,this.side.canvas.requestRenderAll(),this.side.saveState(),this.changed())},e.prototype.isItalic=function(){return this.isText()?this.object.fontStyle===Constants.ITALIC:null},e.prototype.toggleItalic=function(){this.setItalic(!this.isItalic())},e.prototype.setBold=function(t){this.isText()&&(this.object.fontWeight=t?Constants.BOLD:Constants.NORMAL,this.side.canvas.renderAll(),this.side.saveState(),this.changed())},e.prototype.isText=function(){return this.type===ElementType.TEXT},e.prototype.isImage=function(){return this.type===ElementType.IMAGE},e.prototype.isBold=function(){return this.isText()?this.object.fontWeight===Constants.BOLD:null},e.prototype.toggleBold=function(){this.setBold(!this.isBold())},e.prototype.setTextDecoration=function(t){if(this.isText()){switch(t){case TextDecoration.LINETHROUGH:this.object.linethrough=!0;break;case TextDecoration.OVERLINE:this.object.overline=!0;break;case TextDecoration.UNDERLINE:this.object.underline=!0;break;default:this.object.linethrough=!1,this.object.overline=!1,this.object.underline=!1}this.side.canvas.requestRenderAll(),this.side.canvas.renderAll(),this.side.saveState(),this.changed()}},e.prototype.toggleUnderline=function(){this.isUnderline()?this.setTextDecoration(null):this.setTextDecoration(TextDecoration.UNDERLINE)},e.prototype.toggleOverline=function(){this.isOverline()?this.setTextDecoration(null):this.setTextDecoration(TextDecoration.OVERLINE)},e.prototype.toggleLinethrough=function(){this.isLinethrough()?this.setTextDecoration(null):this.setTextDecoration(TextDecoration.LINETHROUGH)},e.prototype.clearDecoration=function(){this.setTextDecoration(null)},e.prototype.isUnderline=function(){return this.getTextDecoration()==TextDecoration.UNDERLINE},e.prototype.isOverline=function(){return this.getTextDecoration()==TextDecoration.OVERLINE},e.prototype.isLinethrough=function(){return this.getTextDecoration()==TextDecoration.LINETHROUGH},e.prototype.getTextDecoration=function(){return this.type!=ElementType.TEXT?null:this.object.underline?TextDecoration.UNDERLINE:this.object.overline?TextDecoration.OVERLINE:this.object.linethrough?TextDecoration.LINETHROUGH:null},e.prototype.setTextAlignment=function(t){this.isText()&&(this.object.textAlign=t,this.side.canvas.renderAll(),this.side.saveState())},e.prototype.getTextAlignment=function(){return this.isText()?this.object.textAlign:null},e.prototype.setLineHeight=function(t){this.isText()&&(this.object.lineHeight=t,this.side.canvas.renderAll(),Constructor.instance.changed())},e.prototype.getLineHeight=function(){return this.isText()?this.object.lineHeight:null},e.prototype.setLetterSpacing=function(t){this.isText()&&(this.object.charSpacing=t,this.side.canvas.renderAll(),Constructor.instance.changed())},e.prototype.getLetterSpacing=function(){return this.isText()?this.object.charSpacing:0},e.prototype.addFilter=function(t,e){if(this.object instanceof fabric.Image){if(this.filters||(this.filters=[]),t.isBoolean){var i=this.filters.indexOf(t);if(-1!=i)return this.filters.splice(i,1),Constructor.instance.changed(),0===this.filters.length&&(this.filters=null),void this.applyFilters(e)}this.filters.push(t),Constructor.instance.changed(),this.applyFilters(e)}},e.prototype.removeFilter=function(t,e){if(this.object instanceof fabric.Image){if(!this.filters)return void(this.filters=[]);var i=this.filters.indexOf(t);if(-1!=i)return this.filters.splice(i,1),this.changed(),Constructor.instance.changed(),0===this.filters.length&&(this.filters=null),void this.applyFilters(e);this.applyFilters(e)}},e.prototype.hasFilters=function(){return this.filters&&this.filters.length>0},e.prototype.hasFilter=function(t){return this.object instanceof fabric.Image&&(!!this.filters&&-1!=this.filters.indexOf(t))},e.prototype.resetFilters=function(t){this.filters=null,Constructor.instance.changed(),this.object instanceof fabric.Image&&(this.object.filters=[],this.applyFilters(t))},e.prototype.applyFilters=function(t){var e=this.object;if(e.filters=[],this.filters)for(var i=0,n=this.filters;i<n.length;i++){var r=n[i];e.filters.push(r.getFilter())}this.side.saveState(),e.applyFilters(),this.side.canvas.renderAll(),t&&t(this)},e.prototype.snapRotation=function(){var t=this.object.angle;t=Math.round(t/Constructor.settings.rotationStep)*Constructor.settings.rotationStep,this.object.rotate(t)},e.prototype.toggleLock=function(){this.setLocked(!this.isLocked())},e.prototype.setLocked=function(t){this.object.lockScalingX=this.object.lockScalingY=this.object.lockRotation=this.object.lockMovementX=this.object.lockMovementY=t},e.prototype.isLocked=function(){return this.object&&this.object.lockScalingX},e.prototype.toFront=function(){this.side.canvas.bringToFront(this.object),Utils.arrayMoveToEnd(this.side.elements,this.getIndex()),this.side.horizontalGuide.sendToBack(),this.side.verticalGuide.sendToBack(),this.side.deselect(),this.side.saveState()},e.prototype.toBack=function(){this.side.canvas.sendToBack(this.object),Utils.arrayMoveToStart(this.side.elements,this.getIndex()),this.side.horizontalGuide.sendToBack(),this.side.verticalGuide.sendToBack(),this.side.deselect(),this.side.saveState()},e.prototype.bringDown=function(){this.shiftLayer(-1)},e.prototype.bringUp=function(){this.shiftLayer(1)},e.prototype.shiftLayer=function(t){var e=this.getIndex()+t;e<0?e=0:e>this.side.getLayers().length-1&&(e=this.side.getLayers().length-1),this.toLayerInternal(e)},e.prototype.toLayer=function(t){this.toLayerInternal(this.side.getLayers().length-t-1)},e.prototype.toLayerInternal=function(t){this.side.canvas.moveTo(this.object,t+2),this.side.horizontalGuide.sendToBack(),this.side.verticalGuide.sendToBack(),Utils.arrayMove(this.side.elements,this.getIndex(),t),this.side.deselect(),this.side.canvas.renderAll(),this.side.saveState()},e.prototype.isVisible=function(){return this.object&&1==this.object.visible},e.prototype.isSelected=function(){return Constructor.instance.getSelection()==this},e.prototype.toggleVisibility=function(){this.isVisible()?this.hide():this.show()},e.prototype.hide=function(){this.object.visible=!1,this.object.selectable=!1,this.side.deselect(),this.side.canvas.renderAll(),this.side.saveState()},e.prototype.show=function(){this.object.selectable=!0,this.side.deselect(),this.side.canvas.renderAll(),this.object.visible=!0,this.side.saveState()},e.prototype.toDataURL=function(t){if(!t)return this.object.toDataURL({});var e=t/Math.max(this.object.width*this.object.scaleX,this.object.height*this.object.scaleY);return this.object.toDataURL({multiplier:e})},e.prototype.clone=function(){var t=fabric.util.object.clone(this.object),i=new e(this.type,this.side);return i.object=t,i},e.prototype.remove=function(){var t=this;setTimeout(function(){return t.side.remove(t)},0)},e.prototype.calculateGuides=function(){if(this.side){this.object.setCoords();var t=this.object.getBoundingRect().width/this.side.getZoom(),e=this.object.getBoundingRect().height/this.side.getZoom(),i=this.object.left-t/2,n=this.object.top-e/2;this.horizontalGuides=[i+t/2,i,i+t],this.verticalGuides=[n+e/2,n,n+e]}},e.getSnapOffset=function(t,e){for(var i,n=Constructor.settings.snapSize,r=0,a=t;r<a.length;r++)for(var s=a[r],o=0,c=e;o<c.length;o++){var l=c[o],h=Math.abs(l-s);if(h<n){n=h;var u=e.indexOf(l)-1;-1==u?u=0:0==u&&(u=-1);var f=u*(e[0]-e[1]);i=new SnapOffset(s,s-f)}}return i},e.prototype.getHorizontalSnapPosition=function(t){return e.getSnapOffset(t.horizontalGuides,this.horizontalGuides)},e.prototype.getVerticalSnapPosition=function(t){return e.getSnapOffset(t.verticalGuides,this.verticalGuides)},e.prototype.fitIntoMargins=function(){if(Constructor.settings.fitIntoMargins){var t=this.object.getBoundingRect(),e=t.width/2,i=t.height/2,n=this.side.canvas.getWidth()/this.side.getZoom()-e,r=this.side.canvas.getHeight()/this.side.getZoom()-i;this.object.left<e?this.object.left=e:this.object.left>n&&(this.object.left=n),this.object.top<i?this.object.top=i:this.object.top>r&&(this.object.top=r)}},e.prototype.snapPosition=function(){if(Constructor.instance.snapToObjects){this.calculateGuides(),this.side.hideGuides();for(var t=!1,e=!1,i=0,n=this.side.elements;i<n.length;i++){var r=n[i];if(r!==this){if(!t){var a=this.getHorizontalSnapPosition(r);null!=a&&(this.object.left=a.objectPosition,this.side.horizontalGuide.update(a.guidePosition),t=!0)}if(!e){var s=this.getVerticalSnapPosition(r);null!=s&&(this.object.top=s.objectPosition,this.side.verticalGuide.update(s.guidePosition),e=!0)}if(t&&e)return}}}if(Constructor.instance.snapToGrid){var o=Constructor.settings.gridSize;this.object.left=Math.round(this.object.left/o)*o,this.object.top=Math.round(this.object.top/o)*o}},e.prototype.snapTransform=function(t){var e=t.e;this.calculateGuides(),this.side.hideGuides();for(var i=!1,n=0,r=this.side.elements;n<r.length;n++){var a=r[n];if(a!==this){if(!i){var s=this.getHorizontalSnapPosition(a);if(null!=s){var o=s.objectPosition-e.clientX;this.object.width=this.object.width+o/2,this.object.left=this.object.left-o/2,this.object.setCoords(),this.side.horizontalGuide.update(s.guidePosition),i=!0}}0}}},e.prototype.getIndex=function(){return this.side.elements.indexOf(this)},e.prototype.getLayerIndex=function(){return this.side.getLayers().indexOf(this)},e.prototype.serialize=function(){return new ObjectOptions(this)},e.prototype.deserialize=function(t){var i=ElementType.get(t.type),n=new e(i),r=t.filters;if(r&&r.length>0&&(n.filtersCache=t.filters,delete t.filters),n.object.setOptions(t.toObject()),i===ElementType.IMAGE)n.object;if(i===ElementType.TEXT&&n.object.text){var a=n.object;a.text=a.text.split("<br>").join("\n")}return n.setOptions(n.object),n},e.commonDefaults={hasBorders:!1,cornerColor:Color.TRANSPARENT_BLACK.toRgba(),transparentCorners:!1,cornerSize:8*window.devicePixelRatio,originX:Constants.CENTER,originY:Constants.CENTER,rotatingPointOffset:8*window.devicePixelRatio*2},e}(Trigger),ElementType=function(t){function e(e){var i=t.call(this,e.prototype.type)||this;return i.nativeType=e,i}return __extends(e,t),e.prototype.getNativeTypeName=function(){return this.nativeType.prototype.type},e.CIRCLE=new e(fabric.Circle),e.RECTANGLE=new e(fabric.Rect),e.TRIANGLE=new e(fabric.Triangle),e.TEXT=new e(fabric.IText),e.IMAGE=new e(fabric.Image),e}(Associated),Filter=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.nativeFilter=i,r.isBoolean=n,r}return __extends(e,t),e.prototype.getFilter=function(){return this.nativeFilter},e.GRAYSCALE=new e("grayscale",new fabric.Image.filters.Grayscale,!0),e.INVERT=new e("invert",new fabric.Image.filters.Invert,!0),e.BRIGHTNESS=new e("brightness",new fabric.Image.filters.Brightness({brightness:.1})),e.DARKNESS=new e("darkness",new fabric.Image.filters.Brightness({brightness:-.1})),e.BLUR=new e("blur",new fabric.Image.filters.Convolute({matrix:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]})),e.SHARPEN=new e("sharpen",new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]})),e.EMBOSS=new e("emboss",new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]})),e}(Associated),Guide=function(t){function e(){var i=t.call(this,[0,0,0,0],e.DEFAULTS)||this;return i.dirty=!0,i}return __extends(e,t),e.prototype.show=function(){this.stroke=Color.GUIDE.toRgba(),this.bringToFront(),this.dirty=!0},e.prototype.hide=function(){this.stroke=Color.TRANSPARENT.toRgba(),this.dirty=!0},e.DEFAULTS={left:0,top:0,stroke:Color.GUIDE.toRgba(),selectable:!1,width:1},e}(fabric.Line),HorizontalGuide=function(t){function e(e){var i=t.call(this)||this;return i.height=e,i}return __extends(e,t),e.prototype.update=function(t){this.left=t,this.show()},e}(Guide);!function(t){t.PNG="image/png",t.JPG="image/jpeg",t.GIF="image/gif",t.SVG="image/svg+xml"}(ImageType||(ImageType={}));var TextAlignment,TextDecoration,ObjectOptions=function(){function t(e){if(e){for(var i=e.object.toJSON(),n=t.excludedNativeOptions[e.object.type],r=0,a=t.nativeOptions;r<a.length;r++){var s=a[r];!i[s]||n&&n[s]||(this[s]=i[s],"text"===s&&(this[s]=this[s].split("\n").join("<br>")))}if(e.filters&&e.filters.length>0){this.filters=[];for(var o=0,c=e.filters;o<c.length;o++){var l=c[o];this.filters.push(l.getName())}}else e.filtersCache&&e.filtersCache.length&&(this.filters=e.filtersCache)}}return t.fromObject=function(e){for(var i=new t,n=0,r=t.nativeOptions;n<r.length;n++){var a=r[n];e[a]&&(i[a]=e[a])}return i},t.prototype.toObject=function(){for(var e={},i=0,n=t.nativeOptions;i<n.length;i++){var r=n[i];this[r]&&(e[r]=this[r])}return this.filters&&(e.filters=this.filters),e},t.prototype.equals=function(t){var e=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(this);if(e.length!=i.length)return!1;for(var n=0;n<i.length;n++){var r=i[n],a=e[n];if(this[r]!=t[r])return!1;if(r!=a&&this[a]!=t[a])return!1}return!0},t.nativeOptions=["angle","fill","flipX","flipY","fontFamily","filters","fontSize","fontStyle","fontWeight","height","left","lineHeight","opacity","radius","scaleX","scaleY","shadow","src","text","textAlign","charSpacing","textBackgroundColor","underline","overline","linethrough","top","transformMatrix","type","width"],t.excludedNativeOptions={image:["fill"]},t}(),Side2DStateObjects=function(){function t(t){if(this.objects=[],t)for(var e=0,i=t.elements;e<i.length;e++){var n=i[e];this.objects.push(n.serialize())}}return t.parse=function(e){for(var i=new t,n=0,r=JSON.parse(e).objects;n<r.length;n++){var a=r[n],s=ObjectOptions.fromObject(a);i.objects.push(s)}return i},t.prototype.equals=function(t){if(t.objects.length!=this.objects.length)return!1;for(var e=0;e<this.objects.length;e++){var i=this.objects[e],n=t.objects[e];if(!i.equals(n))return!1}return!0},t}(),Side2DState=function(t){function e(e){var i=t.call(this,e)||this;return i.width=e.width,i.height=e.height,i.roundCorners=e.roundCorners,i}return __extends(e,t),e.prototype.equals=function(e){return this.width==e.width&&this.height==e.height&&this.roundCorners==e.roundCorners&&t.prototype.equals.call(this,e)},e}(Side2DStateObjects),Side2D=function(t){function e(e,i,n,r,a){var s=t.call(this,e)||this;return s.elements=[],s.id=1e18*Math.random(),s.history=new HistoryList(new Side2DState(s)),s.width=i,s.height=n,s.name=a,s.canvasElement=document.createElement(Constants.CANVAS),s.container.appendChild(s.canvasElement),s.canvas=new fabric.Canvas(s.canvasElement,null),s.canvasElement.style.background=Constructor.instance.background,s.canvas.setWidth(i),s.canvas.setHeight(n),s.canvas.selection=!1,s.canvas.on(Constants.MOUSE_UP,function(){s.hideGuides(),s.saveState()}),s.canvas.on(Constants.SELECTION_CLEARED,function(){s.selection=null,s.changed(),Constructor.instance.changed()}),s.canvas.on(Constants.SELECTION_UPDATED,function(){s.changed(),Constructor.instance.changed()}),s.canvas.on(Constants.SELECTION_CREATED,function(){s.changed(),Constructor.instance.changed()}),s.canvas.on(Constants.AFTER_RENDER,function(){Constructor.instance.onElementModificationHandler&&Constructor.instance.onElementModificationHandler()}),s.horizontalGuide=new HorizontalGuide(n),s.verticalGuide=new VerticalGuide(i),s.canvas.add(s.horizontalGuide),s.canvas.add(s.verticalGuide),s.setZoom(1),s.hideGuides(),s.hide(),s.needsHistoryUpdate=!1,s.roundCorners=r,r&&s.setRoundCorners(),s.canvasElement.style.border=Constants.LINE_STYLE_PREFIX+Color.GRAY.toHex(),s}return __extends(e,t),e.prototype.getName=function(){return this.name||this.getIndex().toString()},e.prototype.setName=function(t){this.name=t},e.prototype.setRoundCorners=function(){var t=Math.min(this.canvasElement.width,this.canvasElement.height);this.canvasElement.style.borderRadius=t/2*this.roundCorners/100+Constants.PX},e.prototype.centerPosition=function(){var t=this.canvasElement.parentElement;this.container.clientWidth,t.clientWidth,this.container.clientHeight,t.clientHeight;this.setRoundCorners()},e.prototype.setZoom=function(t){t>=e.maxZoom&&t<=e.minZoom||(this.canvas.setZoom(t),this.canvas.setWidth(this.width*t),this.canvas.setHeight(this.height*t),this.canvas.renderAll(),this.setRoundCorners())},e.prototype.getZoom=function(){return this.canvas?this.canvas.getZoom():1},e.prototype.resetZoom=function(){this.canvas.setZoom(1),this.canvas.setWidth(this.width),this.canvas.setHeight(this.height),this.canvas.renderAll()},e.prototype.zoomToFit=function(){var t=this,e=Math.min(this.container.clientWidth/this.width,this.container.clientHeight/this.height);e?(e*=.8,this.setZoom(e)):setTimeout(function(){return t.zoomToFit()},10)},e.prototype.getRatio=function(){return this.width/this.height},e.prototype.getElement=function(){return this.canvas.getElement().parentElement},e.prototype.getIndex=function(){for(var t=0;t<Constructor.instance.sides.length;t++)if(Constructor.instance.sides[t].equals(this))return t;return-1},e.prototype.fixElementPosition=function(t){t.object.isOnScreen(!0)||this.resetElementPosition(t)},e.prototype.resetElementPosition=function(t){t.object.left=this.width/2,t.object.top=this.height/2},e.prototype.add=function(t){var e=this;return this.elements.length>=20?(alert("Too many objects on the canvas! Please consider removing some objects before adding new."),null):(Utils.logMethodName(),t.side=this,this.elements.push(t),this.canvas.add(t.object),setTimeout(function(){return e.fixElementPosition(t)},200),t.fitIntoMargins(),t.object.setCoords(),this.canvas.requestRenderAll(),setTimeout(function(){return e.canvas.renderAll()},null),this.changed(),t)},e.prototype.addElement=function(t){return Utils.logMethodName(),this.add(new Element2D(t,this))},e.prototype.getLayers=function(){for(var t=[],e=0;e<this.elements.length;e++)t.unshift(this.elements[e]);return t},e.prototype.moveLayer=function(t,e){this.getLayers()[t].toLayer(e),this.changed()},e.prototype.remove=function(t){this.canvas.remove(t.object),this.elements.splice(this.elements.indexOf(t),1),this.deselect(),this.canvas.renderAll(),this.saveState()},e.prototype.getPointSize=function(){return 96/72*this.getZoom()},e.prototype.getInchSize=function(){return 72*this.getPointSize()},e.prototype.getCentimeterSize=function(){return this.getInchSize()/2.54},e.prototype.getMillimeterSize=function(){return this.getCentimeterSize()/10},e.prototype.select=function(t){return this.deselect(),this.selection=t,this.canvas.setActiveObject(t.object),this.canvas.renderAll(),t},e.prototype.deselect=function(){this.selection=null,this.canvas.discardActiveObject(),this.canvas.renderAll()},e.prototype.hideGuides=function(){this.horizontalGuide.hide(),this.verticalGuide.hide(),this.canvas.renderAll()},e.prototype.serialize=function(){return new Side2DState(this)},e.prototype.deserialize=function(t){var i=new e(Constructor.instance.getElement(),t.width,t.height,t.roundCorners);if(t.objects){var n='{"objects":'+JSON.stringify(t.objects)+"}",r=Side2DStateObjects.parse(n);i.setState(r)}return i},e.prototype.clear=function(){Utils.logMethodName(),this.elements=[],this.selection=null,this.canvas.clear(),this.canvas.add(this.horizontalGuide),this.canvas.add(this.verticalGuide),this.changed(),Constructor.instance.changed()},e.prototype.removeElements=function(){for(Utils.logMethodName();this.elements.length;)this.elements[0].remove();this.saveState()},e.prototype.addImageFromObjectOptions=function(t){var e=this;Utils.logMethodName();var i=t.toObject(),n=this;fabric.Image.fromObject(i,function(i){if(null!==i){var r=new Element2D(ElementType.IMAGE);if(r.side=e,r.object=i,r.setOptions(r.object),n.add(r),t.filters){r.filters=[];for(var a=0,s=t.filters;a<s.length;a++){var o=s[a],c=Filter.get(o);try{r.addFilter(c,function(){return r.side.canvas.renderAll()})}catch(t){console.error(t.message)}}r.applyFilters(function(t){t.object.dirty=!0,t.side.canvas.requestRenderAll()})}}})},e.prototype.setState=function(t){var e=this;Utils.logMethodName(),this.history.lock(),this.clear();for(var i=function(t){if("image"===t.type)n.addImageFromObjectOptions(t);else{var e=Element2D.prototype.deserialize(t);n.add(e),e.object.dirty=!0,e.type===ElementType.TEXT&&setTimeout(function(){return e.setFontFamily(e.getFontFamily())},0)}},n=this,r=0,a=t.objects;r<a.length;r++){i(a[r])}this.saveToLocalStorage(t),this.canvas.requestRenderAll(),setTimeout(function(){e.history.unlock(),Constructor.instance.changed()},50)},e.prototype.getLocalStorageKey=function(){return Constructor.settings.localStorage.keyPrefix+this.getIndex()},e.prototype.saveToLocalStorage=function(t){if(!this.history.isLocked()){Utils.logMethodName();var e=JSON.stringify(t);e.length<1e5?localStorage.setItem(this.getLocalStorageKey(),e):console.error("state.length > "+1e5)}},e.prototype.loadFromLocalStorage=function(){if(Constructor.settings.localStorage.enabled&&!Constructor.instance.isExplicitlyLoaded){Utils.logMethodName();var t=this.getLocalStorageKey(),e=localStorage.getItem(t);if(e){var i=Side2DStateObjects.parse(e);this.setState(i)}}},e.prototype.saveState=function(){Utils.logMethodName();var t=new Side2DStateObjects(this);this.history.add(t),this.saveToLocalStorage(t),this.changed(),Constructor.instance.changed()},e.prototype.undo=function(){var t=this.history.back();t&&this.setState(t)},e.prototype.redo=function(){var t=this.history.forward();t&&this.setState(t)},e.prototype.exportImage=function(t,e){var i=this.canvas.getWidth()/this.getZoom(),n=this.canvas.getHeight()/this.getZoom(),r=t?t/Math.max(i,n):1;if(e||(e=ImageType.PNG),e==ImageType.JPG){this.history.lock();var a=this.addElement(ElementType.RECTANGLE);a.setColor(Color.WHITE),a.object.width=i,a.object.height=n,a.object.left=i/2,a.object.top=n/2,a.object.setCoords(),a.toBack(),this.canvas.renderAll();var s=this.canvas.toDataURL({format:"image/jpeg",multiplier:r,quality:.5});return a.remove(),this.canvas.renderAll(),this.history.unlock(),s}return e==ImageType.SVG?this.canvas.toSVG({width:i*r,height:n*r}):this.canvas.toDataURL({format:Constants.PNG,multiplier:r})},e.prototype.getState=function(){return new Side2DState(this)},e.prototype.equals=function(t){return this.id==t.id},e.prototype.isEmpty=function(){return 0==this.elements.length},e.maxZoom=10,e.minZoom=.001,e}(View),SnapOffset=function(){return function(t,e){this.guidePosition=t,this.objectPosition=e}}();!function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify"}(TextAlignment||(TextAlignment={})),function(t){t.UNDERLINE="underline",t.OVERLINE="overline",t.LINETHROUGH="line-through"}(TextDecoration||(TextDecoration={}));var pechat,VerticalGuide=function(t){function e(e){var i=t.call(this)||this;return i.width=e,i}return __extends(e,t),e.prototype.update=function(t){this.top=t,this.show()},e}(Guide),UIControl=function(t){function e(i){var n=t.call(this,i?document.createElement(i):Utils.div())||this;return n.children=[],n.id=e.nextId++,e.map[n.id]=n,n.c=Constructor.instance,n.container.className=n.getClassName(),n}return __extends(e,t),e.prototype.getClassName=function(){return"control"},e.prototype.getId=function(){return this.id},e.prototype.update=function(){},e.prototype.getElement=function(){return this.container},e.getById=function(t){return this.map[t]},e.prototype.appendChild=function(t){return this.children.push(t),this.container.appendChild(t.container),this},e.prototype.append=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.forEach(function(e){return t.appendChild(e)}),this},e.prototype.removeChild=function(t){return this.children.splice(t,1)[0]},e.prototype.moveChild=function(t,e){var i=this.children[t].container,n=this.children[e].container;this.children.splice(e,0,this.removeChild(t)),this.container.insertBefore(i,n)},e.prototype.clear=function(){this.getElement().innerHTML="",this.children.forEach(function(t){t.clear(),t.container.remove(),delete e.map[t.id]}),this.children=[]},e.map={},e.nextId=0,e}(View),Column=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n.append(new Spacer),e.forEach(function(t){n.append(t),n.append(new Spacer)}),n}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" column"},e}(UIControl),ConstructorController=function(t){function e(){var e=t.call(this)||this,i=constructorConfiguration&&constructorConfiguration.sharedState;return e.c=i?new Constructor(e.container,i):new Constructor(e.container),e.container.onclick=function(t){t.target===e.container&&Constructor.instance.getActiveSide().deselect()},e}return __extends(e,t),e.prototype.getClassName=function(){return"constructor-container"},e}(UIControl),ToolBar=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n.append.apply(n,e),n}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" toolbar"},e}(UIControl),TriggeredUIControl=function(t){function e(e,i){var n=t.call(this,i)||this;return e.onChange(function(){return n.update()},n),e.onVisibilityChange(function(){return n.updateVisibility()}),n.trigger=e,n}return __extends(e,t),e.prototype.updateVisibility=function(){},e}(UIControl);!function(t){var e=function(){function t(){}return t.getCategoryOptions=function(e,i){var n=t.url+e,r=new XMLHttpRequest;r.open("GET",n),r.setRequestHeader("x-requested-with","XMLHttpRequest"),r.onreadystatechange=function(t){4===r.readyState&&i&&i(JSON.parse(r.response))},r.send()},t.getModel=function(e,i){var n=t.modelUrl+e+".json",r=new XMLHttpRequest;r.open("GET",n,!0),r.withCredentials=!0,r.onreadystatechange=function(t){4===r.readyState&&i&&i(r.response)};try{r.send()}catch(t){console.log(t.message)}},t.url="https://pechat.photo/index.php?route=product/category/category&category_id=",t.modelUrl="https://pechat.photo/catalog/view/javascript/constructor/v2/models/",t}();t.PrintUtils=e}(pechat||(pechat={}));var PechatUtils=pechat.PrintUtils,ModelsPanel=function(t){function e(){return t.call(this,Constructor.instance)||this}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" models-panel vertical"},e.prototype.update=function(){},e.prefix="https://pechat.photo/image/cache/",e}(TriggeredUIControl),ConstructorUI=function(t){function e(){var i=t.call(this)||this;i.order=new Order,e.instance=i;try{i.domain=constructorConfiguration.domain}catch(t){i.domain=""}var n=document.getElementById("constructor-ui");return n?(i.constructorControl=new ConstructorController,i.toolBar=new ToolBar,i.sidePanel=new SidePanel,i.sideBar=new SideBar,i.topBar=new TopBar,i.bottomBar=new BottomBar,i.orderPopover=new Popover(new Row(new Spacer,new LabelControl("Add to Cart").addClass("title"),new Spacer),new Row(new LabelControl("Quantity"),new Spacer,new ConditionalButton(function(){return i.order.decrementQuantity()},function(){return i.order.getQuantity()>1},Icon.MINUS_CIRCLE,null,i.order),new Button(function(){return i.order.incrementQuantity()},Icon.PLUS_CIRCLE),new NumberInputControl(function(t){return i.order.setQuantity(t)},function(){return i.order.getQuantity()},i.order)),new Row(new LabelControl("Price"),new Spacer,new TriggeredLabelControl(i.order,function(){return i.order.getPrice()})),new Row,new Row(new Spacer,new Button(function(){return i.orderPopover.hide()},null,"Cancel"),new Spacer,new Spacer,new Button(function(){i.order.addToCart(),i.orderPopover.hide()},null,"OK"),new Spacer)),i.sharePopover=new SharePopover,i.append(i.constructorControl,i.toolBar,i.sidePanel,i.sideBar,i.topBar,i.bottomBar,i.orderPopover,i.sharePopover),n.appendChild(i.container),i.bindDelKey(),window.addEventListener("load",function(){setTimeout(function(){window.scrollTo(0,0)},0)}),window.addEventListener("orientationchange",function(){setTimeout(function(){window.scrollTo(0,0)},0)}),window.addEventListener("touchstart",function(){setTimeout(function(){window.scrollTo(0,0)},0)}),i):(console.log("'#constructor-ui' element not found"),i)}return __extends(e,t),e.prototype.getClassName=function(){return"constructor-ui-container"},e.init=function(){document.addEventListener("DOMContentLoaded",function(){new e})},e.prototype.loadCategory=function(t){var e=this,i=Constructor.instance;PechatUtils.getCategoryOptions(t,function(n){n&&n.constructor_models?(e.options=n,i.preview.modelName=null,n.constructor_models.forEach(function(t){i.preview.modelName||(e.loadModelOptions(t,n),i.loadModel(t.file_main));var r=t.thumb;e.sidePanel.modelsPanel.append(Button.of(function(){i.loadModel(t.file_main),e.loadModelOptions(t,n)},new Row(new Spacer,new ImageControl(r),new Spacer)),new Row(new Spacer,new LabelControl(t.name),new Spacer))})):console.error("error loading category options for category #"+t)})},e.prototype.loadModelOptions=function(t,e){var i=this;console.log(t);this.sidePanel.optionsPanel.clear(),constructorConfiguration&&constructorConfiguration.state||(Constructor.instance.deleteAllSides(),t.printareas.forEach(function(t){Constructor.instance.addSide(t.width,t.height,parseInt(t.roundCorners),t.name),Constructor.instance.zoomToFit()})),this.order.setModel(t);var n=[];e.options.forEach(function(t){var e=new OptionGroupPanel(t);n.push(e),i.sidePanel.optionsPanel.append(e)}),t.constructor_model_option.forEach(function(t){n.forEach(function(e){t.namegroup==e.option.name&&e.addOption(t)})})},e.prototype.bindDelKey=function(){document.addEventListener("keydown",function(t){if(46==t.keyCode){var e=Constructor.instance.getSelection();e&&!e.isEditing()&&e.remove()}},!1)},e.test=e.init(),e}(UIControl),Container=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n.append.apply(n,e),n}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)},e.prototype.setValue=function(t){this.container.innerText=t},e}(UIControl),Divider=function(t){function e(e){var i=t.call(this)||this;return e?(i.append(new Row((new Spacer).addClass("v-divider"))),i.addClass("vertical")):i.append(new Row(new Spacer,(new Spacer).addClass("h-divider"))),i.container.addEventListener("touchstart",function(t){t.preventDefault()}),i}return __extends(e,t),e.prototype.getClassName=function(){return"divider"},e.prototype.update=function(){},e}(UIControl),IconControl=function(t){function e(e){var i=t.call(this)||this;return i.container.innerHTML=e,i}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" icon"},e.prototype.setValue=function(t){this.container.innerHTML=t},e.prototype.getValue=function(){return this.container.innerHTML},e}(UIControl),ImageControl=function(t){function e(e){var i=t.call(this,"img")||this;return i.container.src=e||"",i}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" image"},e.prototype.setValue=function(t){this.container.src=t},e}(UIControl),LabelControl=function(t){function e(e){var i=t.call(this)||this;return i.container.innerText=e||"",i}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" label"},e.prototype.setValue=function(t){this.container.innerText=t},e}(UIControl),Popover=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this,r=(new Container).addClass("vertical");return r.append.apply(r,e),n.container.onclick=function(t){t.target===n.container&&n.hide()},n.frame=r,n.hide(),n.append(r),n}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" popover"},e.prototype.show=function(){var t=this;this.container.style.display=null,setTimeout(function(){t.container.style.opacity="1",t.frame.container.style.bottom="0"})},e.prototype.hide=function(){var t=this;setTimeout(function(){t.container.style.display=Constants.NONE},500),this.container.style.opacity="0",this.frame.container.style.bottom="-100vh"},e}(UIControl),Row=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n.append.apply(n,e),n}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" row"},e}(UIControl),SharePopover=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(){var t=this;this.frame.clear(),this.frame.append(new Row(new Spacer,new LabelControl("Share as Link").addClass("title"),new Spacer),new Row(new LabelControl("https://pechat.photo/create_constructor?url="+this.link).allowUserSelect()),new Row(new Spacer,new Button(function(){t.hide()},null,"OK"),new Spacer))},e.prototype.setValue=function(t){this.link=t,this.update()},e}(Popover),Spacer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getClassName=function(){return"spacer"},e.prototype.update=function(){},e}(UIControl),TriggeredLabelControl=function(t){function e(e,i){var n=t.call(this,e)||this;return n.getter=i,n.update(),n}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" label"},e.prototype.setValue=function(t){this.container.innerText=t},e.prototype.update=function(){var t=null;try{t=this.getter()}catch(t){}null!=t&&this.setValue(t.toLocaleString())},e}(TriggeredUIControl),Button=function(t){function e(e,i,n){var r=t.call(this)||this;return i&&r.append(new IconControl(i)),n&&r.append(new LabelControl(n),new Spacer),r.container.onclick=function(){return e()},r}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" button"},e.of=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var r=new e(t);return r.append.apply(r,i),r},e}(UIControl),TriggeredButton=function(t){function e(e,i,n,r){var a=t.call(this,r||Constructor.instance)||this;return i&&a.append(new IconControl(i)),n&&a.append(new LabelControl(n)),a.container.onclick=function(){return e()},a}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" button"},e}(TriggeredUIControl),ConditionalButton=function(t){function e(e,i,n,r,a){var s=t.call(this,function(){s.hasClass("disabled")||e()},n,r,a)||this;return s.check=i,s.update(),s}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" button conditional"},e.prototype.update=function(){this.check()?this.removeClass("disabled"):this.addClass("disabled")},e}(TriggeredButton),FontFamilyButton=function(t){function e(i){var n=t.call(this,Constructor.instance)||this;n.fontFamily=i;var r=new FontFaceObserver(i),a=n,s=new IconControl(Icon.CIRCLE);return n.icon=s,r.load(e.charset).then(function(){a.append(new LabelControl(i).setFontFamily(i))}).catch(function(t){}),n.container.onclick=function(){n.c.getSelection().setFontFamily(i,!0)},n}return __extends(e,t),e.initCharset=function(){for(var t="",e=32;e<=1024;e++)t+=String.fromCharCode(e);return t},e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" button font-family"},e.prototype.update=function(){this.c.hasTextSelection()&&this.c.getSelection().getFontFamily()==this.fontFamily?(this.icon.setValue(Icon.CHECK_CIRCLE),this.addClass("selected")):this.isEmpty()||(this.icon.setValue(Icon.CIRCLE),this.removeClass("selected"))},e.charset=e.initCharset(),e}(TriggeredUIControl),ToggleButton=function(t){function e(e,i,n,r,a,s,o){var c=t.call(this,o||Constructor.instance)||this;return c.action=e,c.check=i,c.enabledCheck=a,c.iconOn=n,c.iconOn=n,c.iconOff=r||n,c.iconOn!=c.iconOff&&c.addClass("active"),c.container.onclick=function(){return c.action()},c.update(),n&&(c.icon=new IconControl(n),c.append(c.icon)),s&&(c.label=new LabelControl(s),c.append(c.label)),c.container.onclick=function(){c.enabledCheck&&!c.enabledCheck()||e()},c}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" button toggle"},e.of=function(t,i,n){for(var r=[],a=3;a<arguments.length;a++)r[a-3]=arguments[a];var s=new e(i,n,null,null,null,null,t);return s.append.apply(s,r),s},e.prototype.updateEnabled=function(){this.enabledCheck&&(this.enabledCheck()?this.removeClass("disabled"):this.addClass("disabled"))},e.prototype.update=function(){this.updateEnabled();var t=!1;try{t=this.check()}catch(t){console.log(t.message)}t?this.icon&&this.iconOn!=this.iconOff?this.icon.setValue(this.iconOn):this.addClass("active"):this.icon&&this.iconOn!=this.iconOff?this.icon.setValue(this.iconOff):this.iconOn==this.iconOff&&this.removeClass("active")},e}(TriggeredUIControl),FullScreenButton=function(t){function e(){var e=t.call(this,function(){return e.toggleFullscreen()},function(){return Utils.isFullscreen()},Icon.COMPRESS,Icon.EXPAND)||this;return e}return __extends(e,t),e.prototype.toggleFullscreen=function(){var t=this;Utils.isFullscreen()?document.exitFullscreen():this.c.container.requestFullscreen(),setTimeout(function(){return t.update()},100)},e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" fullscreen"},e}(ToggleButton),RightButton=function(t){function e(e,i,n){var r=t.call(this)||this;return n&&r.append(new LabelControl(n),new Spacer),i&&r.append(new IconControl(i)),r.container.onclick=function(){return e()},r}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" button"},e}(UIControl),SwitchButton=function(t){function e(e,i,n){var r=t.call(this,e)||this;return r.visibility=n,r.container.innerHTML=i,r.container.onclick=function(){r.trigger.show()},r}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" button"},e.prototype.updateVisibility=function(){this.update()},e.prototype.update=function(){this.visibility&&!this.visibility()?this.hide():this.show(),this.trigger.isVisible()?this.addClass("active"):this.removeClass("active")},e}(TriggeredUIControl),InputControl=function(t){function e(e,i,n,r,a,s,o){var c=t.call(this,o||Constructor.instance,"input")||this;c.getter=n,c.setter=i;var l=c.container;return l.type=e,l.min=r||0,l.max=a||100,l.step=s||10,l.value=n(),l.onchange=function(){Trigger.preventUpdate=!1;var t=c.container.value;c.setter(t),c.changed()},l.oninput=function(t){console.log("Trigger.preventUpdate = true;"),Trigger.preventUpdate=!0;var e=c.container.value;c.setter(e)},c}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" input"},e.prototype.update=function(){(this.trigger===this.c&&this.c.hasSelection()||this.trigger!=this.c)&&this.updateValue()},e.prototype.updateValue=function(){this.container.value=this.getter()},e}(TriggeredUIControl),ColorControl=function(t){function e(e,i){return t.call(this,"color",e,i)||this}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" color"},e}(InputControl),NumberInputControl=function(t){function e(i,n,r){var a=t.call(this,"text",i,n,1,e.max,1,r)||this;return a.setAttribute("pattern","[0-9]*"),a.container.oninput=function(t){var i=t;i.data&&(i.data.match(/[0-9]+/g)||(a.container.value=a.container.value.substring(0,a.container.value.length-i.data.length))),a.container.value&&"0"!==a.container.value||(a.container.value=1),parseInt(a.container.value)>e.max&&(a.container.value=e.max),a.setter(a.container.value)},a.container.addEventListener("paste",function(t){return t.preventDefault()}),a}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" number-input"},e.max=999,e}(InputControl),RangeControl=function(t){function e(e,i,n,r,a){return t.call(this,"range",e,i,n,r,a)||this}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" input"},e}(InputControl),SelectControl=function(t){function e(e,i,n,r,a){for(var s=t.call(this,Constructor.instance,"select")||this,o=n||0;o<=(r||100);o+=a||10){var c=document.createElement("option");c.value=o.toString(),c.innerText=o.toString(),s.container.appendChild(c)}return s.getter=i,s.setter=e,s.container.value=i(),s.container.onchange=function(){var t=s.container.value;s.setter(t),s.changed()},s}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" select"},e.prototype.update=function(){if(this.c.getSelection()){var t=this.getter();this.container.value=t}},e}(TriggeredUIControl),SelectionColorControl=function(t){function e(e,i,n,r,a){var s=t.call(this)||this;return s.append(new Row(new LabelControl(e),new Spacer,new ColorControl(i,n))),s}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" property-control color"},e.prototype.update=function(){},e}(UIControl),SelectPropertyControl=function(t){function e(e,i,n,r,a,s){var o=t.call(this)||this;return o.append(new Row(new LabelControl(e),new Spacer,new SelectControl(i,n,r,a,s))),o}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" property-control select"},e}(UIControl),SelectRangePropertyControl=function(t){function e(e,i,n,r,a,s){var o=t.call(this)||this;return o.input=Utils.isIos()?new SelectControl(i,n,r,a,s):new RangeControl(i,n,r,a,s),o.append(new Row(new LabelControl(e),new Spacer,o.input)),o}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" property-control"},e}(UIControl),TogglePropertyControl=function(t){function e(e,i,n,r){var a=t.call(this)||this;return a.append(new Row(new LabelControl(i),new Spacer,new ToggleButton(n,r,i,i))),a}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" property-control toggle"},e}(UIControl),ExportPanel=function(t){function e(){var e=t.call(this)||this;return e.append(new Row(new Button(function(){return e.download(ImageType.JPG)},null,"Export JPEG")),new Row(new Button(function(){return e.download(ImageType.PNG)},null,"Export PNG")),new Row(new ConditionalButton(function(){return e.download(ImageType.SVG)},function(){return Constructor.instance.is2D()},"Export SVG")),new Row(new Button(function(){return ConstructorUI.instance.order.shareLink()},null,"Share link"))),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" share-panel vertical"},e.prototype.download=function(t){var e;e=Constructor.instance.is3D()?Constructor.instance.preview.exportImageSync(window.outerWidth,t):Constructor.instance.getActiveSide().exportImage(window.outerWidth,t),t==ImageType.SVG&&(e="data:image/svg+xml;charset=utf-8,"+e);var i,n=document.createElement("a");document.body.appendChild(n),n.href=e,n.target="_self",i=t==ImageType.SVG?"svg":t==ImageType.JPG?"jpg":t.substr("image/".length,3),n.download="image-"+(new Date).toLocaleString()+"."+i,n.click(),document.body.removeChild(n)},e.prototype.update=function(){},e}(UIControl),FiltersPanel=function(t){function e(){var e=t.call(this,Constructor.instance)||this;return e.addFilterButton(Filter.BRIGHTNESS,"Brightness"),e.addFilterButton(Filter.DARKNESS,"Darkness"),e.addFilterButton(Filter.BLUR,"Blur"),e.addFilterButton(Filter.SHARPEN,"Sharpen"),e.addFilterButton(Filter.EMBOSS,"Sharpen"),e.addFilterButton(Filter.INVERT,"Invert"),e.addFilterButton(Filter.GRAYSCALE,"Grayscale"),e.append(new Row(new Spacer,new ConditionalButton(function(){return Constructor.instance.getSelection().resetFilters()},function(){return Constructor.instance.getSelection()&&Constructor.instance.getSelection().hasFilters()},"Reset Filters"),new Spacer)),e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" filters vertical"},e.prototype.addFilterButton=function(t,e){t.isBoolean?this.append(new Row(new LabelControl(e),new Spacer,new ToggleButton(function(){return Constructor.instance.getSelection().addFilter(t)},function(){return Constructor.instance.hasSelection()&&Constructor.instance.getSelection().hasFilter(t)},Icon.TOGGLE_ON,Icon.TOGGLE_OFF))):this.append(new Row(new LabelControl(e),new Spacer,new ConditionalButton(function(){return Constructor.instance.getSelection().removeFilter(t)},function(){return Constructor.instance.getSelection()&&Constructor.instance.getSelection().hasFilter(t)},Icon.MINUS_CIRCLE),new Button(function(){return Constructor.instance.getSelection().addFilter(t)},Icon.PLUS_CIRCLE)))},e.prototype.show=function(){t.prototype.show.call(this),this.update()},e}(TriggeredUIControl),FontFamilyPanel=function(t){function e(){for(var e=t.call(this,Constructor.instance)||this,i=e.getFontFamilies(),n=0;n<i.length;n++){var r=i[n];e.append(new FontFamilyButton(r))}return e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" font-family-panel vertical"},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.update=function(){},e.prototype.updateVisibility=function(){this.trigger.getMode()==Mode.Mode2D&&this.trigger.hasTextSelection()?this.show():this.hide()},e.prototype.getFontFamilies=function(){for(var t=document.fonts.entries(),e=[],i=!1;!i;){var n=t.next();if(n.done)i=n.done;else{var r=n.value.family;r||(r=n.value[0].family),e.includes(r)||r.includes("Awesome")||e.push(r)}}return e},e}(TriggeredUIControl),LayersPanelUIControl=function(t){function e(){var e=t.call(this,Constructor.instance)||this;return e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" layers-panel"},e.prototype.update=function(){if(this.children.length!=this.c.sides.length){this.clear();for(var t=0;t<this.trigger.sides.length;t++){var e=this.trigger.sides[t];this.append(new LayersUIControl(e))}}},e}(TriggeredUIControl),LayersUIControl=function(t){function e(e){var i=t.call(this,e)||this;return i.update(),i}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" layers vertical"},e.prototype.update=function(){var t=this.getLayerControls();if(this.trigger.getLayers().length==t.length){for(var e=0;e<t.length;e++){var i=t[e],n=this.trigger.getLayers()[e];if(i.trigger!=n)return void this.repopulate()}this.updateVisibility()}else this.repopulate()},e.prototype.getLayerControls=function(){for(var t=[],e=0;e<this.children.length;e++)this.children[e]instanceof LayerUIControl&&t.push(this.children[e]);return t},e.prototype.repopulate=function(){var t,e=this;try{t=this.container.parentElement.parentElement.scrollTop}catch(t){}this.clear(),console.log("CLEARED"),this.trigger.getLayers().forEach(function(t){e.append(new LayerUIControl(t,e))}),t&&(this.container.parentElement.parentElement.scrollTop=t)},e.prototype.updateVisibility=function(){this.isVisible()!=this.trigger.isVisible()&&this.setVisible(this.trigger.isVisible())},e}(TriggeredUIControl),LayerUIControl=function(t){function e(i,n){var r=t.call(this,i)||this;r.iconCanvas=new fabric.Canvas(document.createElement("canvas")),r.updateLocked=!1,r.updateQueued=!1,r.parent=n;var a=new Container(new Container).addClass("grip");return r.container.onclick=function(t){return r.trigger.side.select(r.trigger)},r.iconContainerElement=document.createElement(Constants.DIV),r.container.style.userSelect="none",r.container.draggable=!0,a.container.ontouchstart=function(t){t.preventDefault(),e.touchStart=t.touches.item(0).clientY,r.addClass("source")},a.container.ontouchmove=function(t){t.preventDefault(),r.addClass("selected"),r.addClass("touch"),r.addClass("drag-over");var i=t.touches.item(0).clientY,n=r.container.parentElement.parentElement.parentElement.scrollTop,a=r.container.offsetTop-n-i,s=Math.floor(a/r.container.clientHeight)+1,o=r.trigger.getLayerIndex(),c=o-s;c>=r.parent.children.length?c=r.parent.children.length-1:c<0&&(c=0),e.dragTo=c;for(var l=0;l<r.parent.children.length;l++){var h=r.parent.children[l];l===e.dragTo&&l!=o?h.addClass("touch").addClass("drag-over").swapIcon(r.iconElement.data):h.removeClass("touch").removeClass("drag-over").swapIcon()}},a.container.ontouchend=function(t){r.trigger.side.moveLayer(r.trigger.getLayerIndex(),e.dragTo),r.trigger.side.select(r.trigger),r.removeClass("selected"),r.removeClass("touch"),r.removeClass("source"),r.removeClass("drag-over");for(var i=0;i<r.parent.children.length;i++)r.parent.children[i].removeClass("touch").removeClass("drag-over")},r.container.ontouchcancel=function(t){console.log("ontouchcancel",r.trigger.getLayerIndex()),r.removeClass("touch").removeClass("drag-over")},r.container.ondragstart=function(t){e.dragSource=r,r.addClass("source")},r.container.ondragover=function(t){t.preventDefault(),e.dragTo=r.trigger.getLayerIndex(),r.addClass("drag-over").swapIcon(e.dragSource.iconElement.data)},r.container.ondragleave=function(t){r.removeClass("drag-over").removeClass("source").swapIcon()},r.container.ondragend=function(t){r.trigger.side.moveLayer(r.trigger.getLayerIndex(),e.dragTo),r.trigger.side.select(r.trigger)},r.iconElement=document.createElement("object"),r.iconContainerElement.className="icon-frame",r.container.appendChild(r.iconContainerElement),r.iconContainerElement.appendChild(r.iconElement),r.append(new Spacer,new ToggleButton(function(){return i.toggleVisibility()},function(){return i.isVisible()},Icon.EYE,Icon.EYE_SLASH),new Spacer,new ToggleButton(function(){return i.toggleLock()},function(){return i.isLocked()},Icon.LOCK,Icon.UNLOCK_ALT),new Spacer,new Button(function(){return r.c.duplicate()},Icon.CLONE),new Spacer,new Button(function(){return i.remove()},Icon.TRASH),new Spacer,a),r.update(),r}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" layer"},e.prototype.select=function(){this.addClass("select")},e.prototype.deselect=function(){this.removeClass("select")},e.prototype.swapIcon=function(t){!t&&this.cachedIcon?(this.iconElement.data=this.cachedIcon,this.cachedIcon=null):t&&!this.cachedIcon&&(this.cachedIcon=this.iconElement.data,this.iconElement.data=t)},e.prototype.traverseLayerIndex=function(t){if(t.classList&&t.classList.contains("layer"))for(var e=0;e<t.parentElement.childNodes.length;e++)if(t.parentElement.childNodes[e]===t)return e},e.prototype.update=function(){if(this.updateLocked)this.updateQueued=!0;else{this.updateLocked=!0,this.removeClass("drag-over");var t=Math.max(this.trigger.object.width*this.trigger.object.scaleX,this.trigger.object.height*this.trigger.object.scaleY);this.trigger.isVisible()?this.getIcon(t):this.iconElement.data||(this.trigger.show(),this.getIcon(t),this.trigger.hide()),this.trigger.isSelected()?this.addClass("selected"):this.removeClass("selected");var e=this;setTimeout(function(){e.updateLocked=!1},200)}},e.prototype.getIcon=function(t){this.getPngIcon(t)},e.prototype.getPngIcon=function(t){var i={format:"png",multiplier:4*(e.iconSize/t)},n=this.trigger.object.toDataURL(i).toString();this.iconElement.data=n},e.prototype.getSvgIcon=function(){var t,i=this;if(this.trigger.isText()){var n=this.trigger.getFontFamily();t='<defs>   <style type="text/css">@import url(\'https://fonts.googleapis.com/css?family='+n+"');</style></defs>"}var r=this.trigger.object.width*this.trigger.object.scaleX,a=this.trigger.object.height*this.trigger.object.scaleY;this.iconCanvas.clear(),this.iconCanvas.setWidth(r),this.iconCanvas.setHeight(a),this.trigger.object.clone(function(n){i.iconCanvas.add(n),n.left=r/2,n.top=a/2;var s=i.iconCanvas.toSVG({width:e.iconSize,height:e.iconSize}),o="data:image/svg+xml;charset=utf-8,"+(s=s.replace(/<defs>[\s\S.]+<\/defs>/m,t));i.iconElement.data.length!=o.length&&(console.log("data set"),i.iconElement.data=o)})},e.prototype.updateVisibility=function(){this.update()},e.iconSize=38,e.dragTo=0,e.touchStart=0,e}(TriggeredUIControl),NewElementPanel=function(t){function e(){var e=t.call(this,Constructor.instance)||this,i=document.createElement("form"),n=document.createElement("input"),r=document.createElement("input");return r.type="text",r.name="constructor",r.value="1",n.type="file",n.name="file",n.accept="image/*",n.size=24,n.hidden=!0,i.append(n),i.append(r),i.style.display="none",n.onchange=function(t){var e=(t.target||window.event.srcElement).files;if(FileReader&&e&&e.length){var n=new FileReader;n.onload=function(){var t=Constructor.instance.addImage(n.result),e=(new URLSearchParams(new FormData(i)),new URLSearchParams),r=new FormData(i);r.forEach(function(t,i){e.append(i,t)}),fetch(ConstructorUI.instance.domain+"index.php?route=tool/upload",{method:"POST",body:r,headers:{accept:"application/json, text/javascript, */*; q=0.01"}}).then(function(e){e.json().then(function(e){console.log(e),console.log(e.files[0].file);var i=t.object.width,n=t.object.height;t.object.setSrc(e.files[0].file,function(){t.object.width=i,t.object.height=n,t.side.canvas.renderAll(),console.log("image src replaced from local to:",e.files[0].file)})})})},n.readAsDataURL(e[0])}},e.container.appendChild(i),e.addButton("Circle",ElementType.CIRCLE,Icon.CIRCLE),e.addButton("Rectangle",ElementType.RECTANGLE,Icon.SQUARE),e.addButton("Triangle",ElementType.TRIANGLE,Icon.CARET_UP),e.addButton("Text",ElementType.TEXT,Icon.FONT),e.append(new Row(new Button(function(){return n.click()},Icon.IMAGE,"Image"))),e.append(new Row(new ConditionalButton(function(){return e.c.getActiveSide().clear()},function(){return!e.c.getActiveSide().isEmpty()},null,"Clear All"))),e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" vertical"},e.prototype.show=function(){t.prototype.show.call(this),this.update()},e.prototype.updateVisibility=function(){this.trigger.getMode()==Mode.Mode2D?this.show():this.hide()},e.prototype.addButton=function(t,e,i){var n=this;this.append(new Row(new Button(function(){return n.c.addElement(e)},i,t)))},e}(TriggeredUIControl),OptionsPanel=function(t){function e(){var e=t.call(this,Constructor.instance)||this;return e.selectedOption=[],e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" options-panel vertical"},e.prototype.update=function(){},e}(TriggeredUIControl),OrderPanel=function(t){function e(){var e=t.call(this,Constructor.instance)||this;return e.append(new Row(new Spacer,new ConditionalButton(function(){return Constructor.instance.getSelection().resetFilters()},function(){return Constructor.instance.getSelection()&&Constructor.instance.getSelection().hasFilters()},"Reset Filters"),new Spacer)),e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" order vertical"},e}(TriggeredUIControl),SelectionPanel=function(t){function e(){var e=t.call(this,Constructor.instance)||this;return e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" selection-panel vertical"},e.prototype.show=function(){t.prototype.show.call(this),this.update()},e.prototype.update=function(){var t=this;this.clear(),this.c.getSelection()&&(this.append(new SelectRangePropertyControl("Transparency",function(e){return t.c.getSelection().setAlpha(e/100)},function(){return 100*t.c.getSelection().getAlpha()},10,100,10),new SelectRangePropertyControl("Shadow",function(e){return t.c.getSelection().setShadow(e/10)},function(){return 10*t.c.getSelection().getShadow()}),new SelectionColorControl("Color",function(e){return t.c.getSelection().setColor(e)},function(){return t.c.getSelection().getColor().toHex()})),this.c.hasTextSelection()&&this.append(new SelectRangePropertyControl("Font Size",function(e){return t.c.getSelection().setFontSize(e)},function(){return t.c.getSelection().getFontSize()},4,96,8),new SelectRangePropertyControl("Letter Spacing",function(e){return t.c.getSelection().setLetterSpacing(e)},function(){return t.c.getSelection().getLetterSpacing()},-200,2e3,50),new SelectRangePropertyControl("Line Height",function(e){return t.c.getSelection().setLineHeight(e)},function(){return t.c.getSelection().getLineHeight()},.5,3,.25),new Row(new LabelControl("Font Family"),new Spacer,new Button(function(){return ConstructorUI.instance.sidePanel.fontFamilyPanel.show()},null,this.c.getSelection().getFontFamily())),new Row(new LabelControl("Font"),new Spacer,this.textPropertyToggleButton("Bold"),this.textPropertyToggleButton("Italic"),this.textPropertyToggleButton("Underline"),this.textPropertyToggleButton("Linethrough")),new Row(new LabelControl("Alignment"),new Spacer,this.textAlignmentButton(TextAlignment.LEFT,Icon.ALIGN_LEFT),this.textAlignmentButton(TextAlignment.CENTER,Icon.ALIGN_CENTER),this.textAlignmentButton(TextAlignment.RIGHT,Icon.ALIGN_RIGHT),this.textAlignmentButton(TextAlignment.JUSTIFY,Icon.ALIGN_JUSTIFY))))},e.prototype.updateVisibility=function(){this.trigger.getMode()==Mode.Mode2D?this.show():this.hide()},e.prototype.textAlignmentButton=function(t,e){var i=this;return new ToggleButton(function(){return i.c.getSelection().setTextAlignment(t)},function(){return i.c.hasTextSelection()&&i.c.getSelection().getTextAlignment()==t},e)},e.prototype.textPropertyToggleButton=function(t){var e=this;return new ToggleButton(function(){Constructor.instance.getSelection()["toggle"+t](),e.update()},function(){return Constructor.instance.getSelection()["is"+t]()},Icon[t.toUpperCase()])},e}(TriggeredUIControl),SidePanel=function(t){function e(){var e=t.call(this)||this;return e.layersPanel=new LayersPanelUIControl,e.selectionPanel=new SelectionPanel,e.newElementPanel=new NewElementPanel,e.fontFamilyPanel=new FontFamilyPanel,e.modelsPanel=new ModelsPanel,e.optionsPanel=new OptionsPanel,e.filtersPanel=new FiltersPanel,e.sharePanel=new ExportPanel,e.append(e.newElementPanel,e.layersPanel,e.selectionPanel,e.fontFamilyPanel,e.modelsPanel,e.optionsPanel,e.filtersPanel,e.sharePanel),e.container.onclick=function(t){t.target===e.container&&Constructor.instance.getActiveSide().deselect()},e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" sidepanel"},e}(ToolBar),OptionButton=function(t){function e(e,i){var n=t.call(this)||this;n.parent=i,n.value=e;var r=ConstructorUI.instance.order,a=ToggleButton.of(r,function(){return n.parent.selectOption(n)},function(){return r.hasOption(e)},new IconControl(Icon.SQUARE).setColor(e.constructor_value),new LabelControl(e.name),new Spacer,new LabelControl(e.priceText));return a.enabledCheck=function(){if(n.isSelected()||!n.value.option_s||0==n.value.option_s.length||0==ConstructorUI.instance.order.selectedOptions.length)return!0;for(var t=0;t<n.value.option_s.length;t++){var e=n.value.option_s[t].option_value_relation_id;if(ConstructorUI.instance.order.hasOptionId(e))return!0}return!1},n.append(a),n}return __extends(e,t),e.prototype.isSelected=function(){return this.parent.selection===this},e}(UIControl),OptionGroupPanel=function(t){function e(e){var i=t.call(this)||this;return i.values=[],i.option=e,i.append(new Row(new Spacer),new Row(new Spacer,new LabelControl(e.name).addClass("bold"),new Spacer)),i}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" options-panel vertical"},e.prototype.selectOption=function(t){if(this.selection&&(ConstructorUI.instance.order.removeSelectedOption(this.selection.value),this.selection==t))this.selection=null;else{this.selection=t,ConstructorUI.instance.order.addSelectedOption(t.value),Constructor.instance.preview.clearFills();var e,i=t.value.zalivka.split(",").map(function(t){return parseInt(t)});(e=Constructor.instance.preview).setFills.apply(e,[t.value.constructor_value].concat(i))}},e.prototype.addOption=function(t){var e=new OptionButton(t,this);this.values.push(e),this.append(e)},e}(UIControl),Order=function(t){function e(){var e=t.call(this)||this;return e.selectedOptions=[],e.quantity=1,e}return __extends(e,t),e.prototype.getPrice=function(){var t=this.model?this.model.price:0;return this.selectedOptions.forEach(function(e){t+=parseFloat(e.price)}),t*this.quantity},e.prototype.setModel=function(t){this.model=t,this.changed()},e.prototype.setQuantity=function(t){this.quantity=t,this.changed()},e.prototype.incrementQuantity=function(){this.quantity<e.max&&(this.quantity++,this.changed())},e.prototype.decrementQuantity=function(){this.quantity--,this.changed()},e.prototype.getQuantity=function(){return this.quantity},e.prototype.setSelectedOptions=function(t){this.selectedOptions=t,this.changed()},e.prototype.addSelectedOption=function(t){this.selectedOptions.push(t),this.changed()},e.prototype.removeSelectedOption=function(t){var e=this.selectedOptions.indexOf(t);-1!=e&&(this.selectedOptions.splice(e,1),this.changed())},e.prototype.removeSelectedOptionId=function(t){for(var e=0;e<this.selectedOptions.length;e++)if(this.selectedOptions[e].id===t)return this.selectedOptions.splice(e,1),void this.changed()},e.prototype.hasOption=function(t){return-1!=this.selectedOptions.indexOf(t)},e.prototype.hasOptionId=function(t){for(var e=0;e<this.selectedOptions.length;e++)if(this.selectedOptions[e].id===t)return!0;return!1},e.prototype.checkPrice=function(){},e.prototype.addToCart=function(){var t=Constructor.instance,e=(ConstructorUI.instance,t.getState()),i=this.model.constructor_model_id;this.getPrice(),this.getPrice();t.setActiveSide(0);var n=t.getActiveSide().exportImage(Constructor.settings.printWidth);t.setActiveSide(1);var r=t.getActiveSide().exportImage(Constructor.settings.printWidth);t.setActiveSide(2);var a=t.getActiveSide().exportImage(Constructor.settings.printWidth);t.setActiveSide(3);var s=t.getActiveSide().exportImage(Constructor.settings.printWidth),o="";this.selectedOptions.forEach(function(t){o+="+++++"+t.id}),console.log(o);var c=this.quantity,l=Utils.toUrlParameters({json:e,animation:e,price:this.getPrice(),priceOriginal:"0",category:this.model.category_id,constructor_model_id:i,text_type:this.model.name,holst_1:n,holst_2:r,holst_3:a,holst_4:s,preview:"",option:o,quantity:c});this.getPriceDiscount();var h=new Headers({"content-type":"application/x-www-form-urlencoded"});fetch(ConstructorUI.instance.domain+"index.php?route=constructor/constructor/add_product_by_constructor",{method:"POST",headers:h,body:l}).then(function(t){t.json().then(function(t){console.log("productId",t),fetch(ConstructorUI.instance.domain+"index.php?route=constructor/constructor/rendering",{method:"POST",headers:h,body:Utils.toUrlParameters({product_id:t})}),fetch(ConstructorUI.instance.domain+"index.php?route=checkout/cart/add",{method:"POST",headers:h,body:Utils.toUrlParameters({product_id:t,quantity:c})})})})},e.prototype.shareLink=function(){var t=new Headers({"content-type":"application/x-www-form-urlencoded"});fetch(ConstructorUI.instance.domain+"index.php?route=constructor/constructor/get_url_post",{method:"POST",headers:t,body:Utils.toUrlParameters({data_u:btoa(encodeURIComponent(Constructor.instance.getState())),category:this.model.category_id,text_type:this.model.name,quantity:this.quantity})}).then(function(t){t.json().then(function(t){console.log(t),ConstructorUI.instance.sharePopover.setValue(t),ConstructorUI.instance.sharePopover.show()})})},e.prototype.getPriceDiscount=function(){var t=this.getPrice(),e=Utils.toUrlParameters({constructor_model_id:this.model.constructor_model_id,quantity:this.quantity,priceWithOption:t,priceOption:0,priceSide:0});fetch(ConstructorUI.instance.domain+"index.php?route=constructor/constructor/calcPriceAjax",{method:"POST",headers:new Headers({"content-type":"application/x-www-form-urlencoded"}),body:e}).then(function(t){t.text().then(function(t){return console.log("discout",t)})})},e.max=999,e}(Trigger),BottomBar=function(t){function e(){var e=t.call(this)||this;return e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" bottom"},e.prototype.update=function(){var t=this;this.clear(),this.append(new Button(function(){ConstructorUI.instance.toggleClass("collapsed"),ConstructorUI.instance.sidePanel.toggleVisibility(),ConstructorUI.instance.sideBar.buttons.forEach(function(t){return t.toggleVisibility()}),window.dispatchEvent(new Event("resize"))},Icon.BARS),new Spacer,new Button(function(){t.c.zoomIn()},Icon.SEARCH_PLUS),new Button(function(){t.c.zoomOut()},Icon.SEARCH_MINUS),new ConditionalButton(function(){return t.c.zoomToFit()},function(){return t.c.is2D()},Icon.SEARCH),new ToggleButton(function(){return t.c.toggleSnapToGrid()},function(){return t.c.snapToGrid},Icon.BORDER_ALL,null,function(){return t.c.is2D()}),new ToggleButton(function(){return t.c.toggleSnapToObjects()},function(){return t.c.snapToObjects},Icon.VECTOR_SQUARE,null,function(){return t.c.is2D()}),new ToggleButton(function(){t.c.is2D()?ConstructorUI.instance.sidePanel.optionsPanel.show():t.c.getActiveSide().isEmpty()?ConstructorUI.instance.sidePanel.newElementPanel.show():ConstructorUI.instance.sidePanel.layersPanel.show(),t.c.toggleMode()},function(){return t.c.getMode()==Mode.Mode3D},Icon.DICE_D6,null,null,"3D"),new Spacer,new TriggeredLabelControl(ConstructorUI.instance.order,function(){return ConstructorUI.instance.order.getPrice()}),new Button(function(){return ConstructorUI.instance.orderPopover.show()},Icon.CART_PLUS))},e}(ToolBar),Pager=function(t){function e(){var e=t.call(this,Constructor.instance)||this;return e.index=0,e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" toolbar pager vertical"},e.prototype.update=function(){var t=this;if(this.clear(),Constructor.instance.is2D()&&Constructor.instance.sides.length>1)for(var e=function(e){var n=i.c.sides[e];i.append(new ToggleButton(function(){Constructor.instance.setActiveSide(e),t.index=e},function(){return Constructor.instance.getActiveSide().getIndex()==n.getIndex()},null,null,null,n.getName()).addClass("desktop"))},i=this,n=0;n<this.c.sides.length;n++)e(n)},e}(TriggeredUIControl),VerticalToolBarUIControl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" vertical"},e}(ToolBar),SideBar=function(t){function e(){var e=t.call(this)||this;e.buttons=[];var i=ConstructorUI.instance.sidePanel;return e.appendSwitch(i.newElementPanel,Icon.SHAPES,function(){return Constructor.instance.is2D()}),e.appendSwitch(i.layersPanel,Icon.LAYER_GROUP,function(){return Constructor.instance.is2D()}),e.appendSwitch(i.selectionPanel,Icon.SLIDERS_H,function(){return Constructor.instance.hasSelection()}),e.appendSwitch(i.fontFamilyPanel,Icon.FONT,function(){return Constructor.instance.hasTextSelection()}),e.appendSwitch(i.filtersPanel,Icon.TINT,function(){return Constructor.instance.hasImageSelection()}),e.appendSwitch(i.modelsPanel,Icon.MUG_HOT),e.appendSwitch(i.optionsPanel,Icon.CLIPBOARD_LIST),e.appendSwitch(i.sharePanel,Icon.FILE_DOWNLOAD),e.append(new Spacer),e.hideOthers(e.c.getActiveSide().isEmpty()?i.newElementPanel:i.layersPanel),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" sidebar"},e.prototype.appendSwitch=function(t,e,i){var n=this,r=new SwitchButton(t,e,i);this.buttons.push(r),Constructor.instance.onChange(function(){return r.update()},r),t.onVisibilityChange(function(t){t.isVisible()&&n.hideOthers(t)}),this.append(r)},e.prototype.hideOthers=function(t){this.buttons.forEach(function(e){e.trigger!=t?(e.trigger.hide(),e.removeClass("selected")):e.addClass("selected")})},e}(VerticalToolBarUIControl),TextBar=function(t){function e(){var e=t.call(this)||this;return e.update(),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" text"},e.prototype.update=function(){this.clear(),this.append()},e}(ToolBar),TriggeredToolBar=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this,Constructor.instance)||this;return n.append.apply(n,e),n}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" toolbar"},e}(TriggeredUIControl),TopBar=function(t){function e(){var e=t.call(this)||this,i=new Pager;return e.append(i,new Spacer,new ConditionalButton(function(){return e.c.undo()},function(){return e.c.getActiveSide().history.hasPrevious()},Icon.UNDO_ALT),new ConditionalButton(function(){return e.c.redo()},function(){return e.c.getActiveSide().history.hasNext()},Icon.REDO_ALT),new ConditionalButton(function(){return e.c.duplicate()},function(){return e.c.hasSelection()},Icon.CLONE),new ConditionalButton(function(){return e.c.getSelection().remove()},function(){return e.c.hasSelection()},Icon.TRASH),new Spacer),e}return __extends(e,t),e.prototype.getClassName=function(){return t.prototype.getClassName.call(this)+" top"},e.prototype.update=function(){this.trigger.is2D()?this.show():this.hide()},e}(TriggeredToolBar);